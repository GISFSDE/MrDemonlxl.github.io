<!doctype html>
<html lang="zh"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta><title>JavaåŸºç¡€æ·±å…¥ - é­‘é­…å…ˆç”Ÿ</title><link rel="manifest" href="/manifest.json"><meta name="application-name" content="é­‘é­…å…ˆç”Ÿ"><meta name="msapplication-TileImage" content="https://gitee.com/mychimei/picture/raw/master/é€æ˜å¤´åƒ.png"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-title" content="é­‘é­…å…ˆç”Ÿ"><meta name="apple-mobile-web-app-status-bar-style" content="default"><meta description="æ–°å­¦å››é—® WHYã€ä¸å‰ä»£ä¼˜åŒ–äº†ä»€ä¹ˆï¼Œå¼¥è¡¥äº†ä»€ä¹ˆç©ºç™½ã€‘ç­‘åŸºï¼Œè¶Šæ·±è¶Šç¨³ WHATã€æ¡†æ¶ï¼Œæ€ç»´å¯¼å›¾ï¼Œä¸»é¢˜æ¡†æ¶ã€‘å®¹å™¨ã€å¹¶å‘ã€IOã€NETã€JVMã€å…¶ä»– HOWã€å¦‚ä½•è®°å¿†ï¼Œå­¦ä¹ èµ„æºã€‘:https:&amp;#x2F;&amp;#x2F;github.com&amp;#x2F;CyC2018ã€åšå®¢å®Œå–„ã€ä¹¦ç±æ·±å…¥ã€ANKIç¨³å›ºã€ç†Ÿæ‚‰åŸºç¡€æ•°æ®ç»“æ„ LEVELã€ä¸æ˜¯æ¯ä¸ªéƒ½å­¦ç²¾ã€‘ç²¾é€š"><meta property="og:type" content="blog"><meta property="og:title" content="é­‘é­…å…ˆç”Ÿ"><meta property="og:url" content="http://mrdemonlxl.github.io/2021/02/24/Draft/2021/Java/"><meta property="og:site_name" content="é­‘é­…å…ˆç”Ÿ"><meta property="og:description" content="æ–°å­¦å››é—® WHYã€ä¸å‰ä»£ä¼˜åŒ–äº†ä»€ä¹ˆï¼Œå¼¥è¡¥äº†ä»€ä¹ˆç©ºç™½ã€‘ç­‘åŸºï¼Œè¶Šæ·±è¶Šç¨³ WHATã€æ¡†æ¶ï¼Œæ€ç»´å¯¼å›¾ï¼Œä¸»é¢˜æ¡†æ¶ã€‘å®¹å™¨ã€å¹¶å‘ã€IOã€NETã€JVMã€å…¶ä»– HOWã€å¦‚ä½•è®°å¿†ï¼Œå­¦ä¹ èµ„æºã€‘:https:&amp;#x2F;&amp;#x2F;github.com&amp;#x2F;CyC2018ã€åšå®¢å®Œå–„ã€ä¹¦ç±æ·±å…¥ã€ANKIç¨³å›ºã€ç†Ÿæ‚‰åŸºç¡€æ•°æ®ç»“æ„ LEVELã€ä¸æ˜¯æ¯ä¸ªéƒ½å­¦ç²¾ã€‘ç²¾é€š"><meta property="og:locale" content="zh_CN"><meta property="og:image" content="https://gitee.com/mychimei/picture/raw/master/å¾®ä¿¡å›¾ç‰‡_20210131173244.jpg"><meta property="article:published_time" content="2021-02-24T14:10:43.000Z"><meta property="article:modified_time" content="2022-03-24T08:24:29.000Z"><meta property="article:author" content="mrdemonlxl"><meta property="article:tag" content="ç¼–ç¨‹è¯­è¨€"><meta property="twitter:card" content="summary"><meta property="twitter:image" content="https://gitee.com/mychimei/picture/raw/master/å¾®ä¿¡å›¾ç‰‡_20210131173244.jpg"><script type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"http://mrdemonlxl.github.io/2021/02/24/Draft/2021/Java/"},"headline":"é­‘é­…å…ˆç”Ÿ","image":["https://gitee.com/mychimei/picture/raw/master/oxxw29.jpg"],"datePublished":"2021-02-24T14:10:43.000Z","dateModified":"2022-03-24T08:24:29.000Z","author":{"@type":"Person","name":"é­‘é­…å…ˆç”Ÿ"},"description":"æ–°å­¦å››é—® WHYã€ä¸å‰ä»£ä¼˜åŒ–äº†ä»€ä¹ˆï¼Œå¼¥è¡¥äº†ä»€ä¹ˆç©ºç™½ã€‘ç­‘åŸºï¼Œè¶Šæ·±è¶Šç¨³ WHATã€æ¡†æ¶ï¼Œæ€ç»´å¯¼å›¾ï¼Œä¸»é¢˜æ¡†æ¶ã€‘å®¹å™¨ã€å¹¶å‘ã€IOã€NETã€JVMã€å…¶ä»– HOWã€å¦‚ä½•è®°å¿†ï¼Œå­¦ä¹ èµ„æºã€‘:https:&#x2F;&#x2F;github.com&#x2F;CyC2018ã€åšå®¢å®Œå–„ã€ä¹¦ç±æ·±å…¥ã€ANKIç¨³å›ºã€ç†Ÿæ‚‰åŸºç¡€æ•°æ®ç»“æ„ LEVELã€ä¸æ˜¯æ¯ä¸ªéƒ½å­¦ç²¾ã€‘ç²¾é€š"}</script><link rel="canonical" href="http://mrdemonlxl.github.io/2021/02/24/Draft/2021/Java/"><link rel="icon" href="https://gitee.com/mychimei/picture/raw/master/é€æ˜å¤´åƒ.png"><meta name="referrer" content="no-referrer-when-downgrade"><link rel="stylesheet" href="https://cdnjs.loli.net/ajax/libs/font-awesome/5.12.0/css/all.min.css"><link rel="stylesheet" href="https://cdnjs.loli.net/ajax/libs/highlight.js/9.12.0/styles/atom-one-light.min.css"><link rel="stylesheet" href="https://fonts.loli.net/css2?family=Ubuntu:wght@400;600&amp;family=Source+Code+Pro"><link rel="stylesheet" href="/css/default.css"><link rel="stylesheet" href="https://cdnjs.loli.net/ajax/libs/font-awesome/5.12.0/css/all.min.css"><link rel="stylesheet" href="https://fonts.loli.net/css?family=Ubuntu:400,600|Source+Code+Pro|Monda:300,300italic,400,400italic,700,700italic|Roboto Slab:300,300italic,400,400italic,700,700italic|Microsoft YaHei:300,300italic,400,400italic,700,700italic|PT Mono:300,300italic,400,400italic,700,700italic&amp;amp;subset=latin,latin-ext|Inconsolata|Itim|Lobster.css"><script src="https://cdnjs.loli.net/ajax/libs/jquery/3.3.1/jquery.min.js"></script><script src="/js/globalUtils.js"></script><style>body>.footer,body>.navbar,body>.section{opacity:0}</style><!--!--><!--!--><script src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" defer></script><!--!--><link rel="stylesheet" href="https://cdnjs.loli.net/ajax/libs/lightgallery/1.6.8/css/lightgallery.min.css"><link rel="stylesheet" href="https://cdnjs.loli.net/ajax/libs/justifiedGallery/3.7.0/css/justifiedGallery.min.css"><!--!--><!--!--><script src="https://cdnjs.loli.net/ajax/libs/pace/1.0.2/pace.min.js"></script><link rel="stylesheet" href="/live2d/waifu.css"><script type="text/javascript" async src="/live2d/autoload.js"></script><meta name="generator" content="Hexo 5.3.0"></head><body class="is-3-column has-navbar-fixed-top"><nav class="navbar navbar-main is-fixed-top"><div class="container"><div class="navbar-brand justify-content-center"><a class="navbar-item navbar-logo" href="/"><img src="https://gitee.com/mychimei/picture/raw/master/å½©è‰²logo.png" alt="é­‘é­…å…ˆç”Ÿ" height="28"></a></div><div class="navbar-menu"><div class="navbar-start"><a class="navbar-item" href="/">é¦–é¡µ</a><a class="navbar-item" href="/archives">å½’æ¡£</a><a class="navbar-item" href="/categories">åˆ†ç±»</a><a class="navbar-item" href="/tags">æ ‡ç­¾</a><a class="navbar-item" href="/album">ç›¸å†Œ</a><a class="navbar-item" href="/friend">å‹é“¾</a><a class="navbar-item" href="/message">ç•™è¨€</a><a class="navbar-item" href="/self-talking">ç¢ç¢å¿µ</a><a class="navbar-item" href="/music">éŸ³ä¹</a><a class="navbar-item" href="/media">å½±éŸ³</a><a class="navbar-item" href="/about">å…³äº</a></div><div class="navbar-end"><a class="navbar-item" target="_blank" rel="noopener" title="Join Gitter" href="https://gitter.im/hexo-theme-amazing/community"><i class="fab fa-gitter"></i></a><a class="navbar-item" target="_blank" rel="noopener" title="Download on GitHub" href="https://github.com/removeif/hexo-theme-amazing"><i class="fab fa-github"></i></a><a class="navbar-item is-hidden-tablet catalogue" title="ç›®å½•" href="javascript:;"><i class="fas fa-list-ul"></i></a><a class="navbar-item search" title="æœç´¢" href="javascript:;"><i class="fas fa-search"></i></a><a class="navbar-item" id="night-nav" title="Night Mode" href="javascript:;"><i class="fas fa-moon" id="night-icon"></i></a></div></div></div></nav><script type="text/javascript" src="/js/theme-setting.js"></script><section class="section"><div class="container"><div class="columns"><div class="column order-2 column-main is-8-tablet is-8-desktop is-9-widescreen"><!--!--><div class="card"><div class="card-image"><span class="image is-7by3"><img class="fill" src="https://gitee.com/mychimei/picture/raw/master/oxxw29.jpg" alt="JavaåŸºç¡€æ·±å…¥"></span></div><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><i class="far fa-calendar-plus">Â </i>2021-02-24Â Â <a class="commentCountImg" href="/2021/02/24/Draft/2021/Java/#comment-container"><span class="display-none-class">a252aefc3b29372d180c37601c39cc61</span><i class="far fa-comment-dots"></i>Â <span class="commentCount" id="a252aefc3b29372d180c37601c39cc61">99+</span>Â Â </a><span class="level-item"><i class="far fa-clock">Â </i>6 å°æ—¶ Â <i class="fas fa-pencil-alt">Â </i>58.0Â k</span><span class="level-item" id="busuanzi_container_page_pv"><span id="busuanzi_value_page_pv">0</span>æ¬¡è®¿é—®</span></div></div><h1 class="title is-3 is-size-4-mobile">JavaåŸºç¡€æ·±å…¥</h1><div class="content"><blockquote>
<h1 id="%E6%96%B0%E5%AD%A6%E5%9B%9B%E9%97%AE">æ–°å­¦å››é—®</h1>
<p>WHYã€ä¸å‰ä»£ä¼˜åŒ–äº†ä»€ä¹ˆï¼Œå¼¥è¡¥äº†ä»€ä¹ˆç©ºç™½ã€‘ç­‘åŸºï¼Œ<strong>è¶Šæ·±è¶Šç¨³</strong><br />
WHATã€æ¡†æ¶ï¼Œæ€ç»´å¯¼å›¾ï¼Œä¸»é¢˜æ¡†æ¶ã€‘å®¹å™¨ã€å¹¶å‘ã€IOã€NETã€JVMã€å…¶ä»–<br />
HOWã€å¦‚ä½•è®°å¿†ï¼Œå­¦ä¹ èµ„æºã€‘:<a target="_blank" rel="noopener" href="https://github.com/CyC2018%E3%80%81%E5%8D%9A%E5%AE%A2%E5%AE%8C%E5%96%84%E3%80%81%E4%B9%A6%E7%B1%8D%E6%B7%B1%E5%85%A5%E3%80%81ANKI%E7%A8%B3%E5%9B%BA%E3%80%81%E7%86%9F%E6%82%89%E5%9F%BA%E7%A1%80%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84">https://github.com/CyC2018ã€åšå®¢å®Œå–„ã€ä¹¦ç±æ·±å…¥ã€ANKIç¨³å›ºã€ç†Ÿæ‚‰åŸºç¡€æ•°æ®ç»“æ„</a><br />
LEVELã€ä¸æ˜¯æ¯ä¸ªéƒ½å­¦ç²¾ã€‘ç²¾é€š</p>
</blockquote>
<a id="more"></a>
<h1 id="%E7%BB%BC%E5%90%88%E9%97%AE%E9%A2%98">ç»¼åˆé—®é¢˜</h1>
<h2 id="%E5%A2%9E%E5%BC%BAfor%E5%92%8C%E6%99%AE%E9%80%9Afor%E5%8C%BA%E5%88%AB%EF%BC%9F" id="å¢å¼ºforå’Œæ™®é€šforåŒºåˆ«ï¼Ÿ">å¢å¼ºforå’Œæ™®é€šforåŒºåˆ«ï¼Ÿ</h2>
<p>â€‹		éœ€è¦å¾ªç¯æ•°ç»„ç»“æ„çš„æ•°æ®æ—¶ï¼Œå»ºè®®ä½¿ç”¨æ™®é€šforå¾ªç¯ï¼Œå› ä¸ºforå¾ªç¯é‡‡ç”¨ä¸‹æ ‡è®¿é—®ï¼Œå¯¹äºæ•°ç»„ç»“æ„çš„æ•°æ®æ¥è¯´ï¼Œé‡‡ç”¨ä¸‹æ ‡è®¿é—®æ¯”è¾ƒå¥½ã€‚éœ€è¦å¾ªç¯é“¾è¡¨ç»“æ„çš„æ•°æ®æ—¶ï¼Œä¸€å®šä¸è¦ä½¿ç”¨æ™®é€šforå¾ªç¯ï¼Œè¿™ç§åšæ³•å¾ˆç³Ÿç³•ï¼Œæ•°æ®é‡å¤§çš„æ—¶å€™æœ‰å¯èƒ½ä¼šå¯¼è‡´ç³»ç»Ÿå´©æºƒã€‚forå¾ªç¯æ˜¯éšæœºè¯»å–ï¼Œå¢å¼ºforçš„åº•å±‚æ˜¯è¿­ä»£å™¨ï¼Œå±äºé¡ºåºè¯»å–ã€‚ArrayListå®ç°äº†RandomAccessæ ‡è®°æ€§æ¥å£ï¼Œå¯ä»¥æ˜¾è‘—æå‡éšæœºè¯»å–çš„æ•ˆç‡ï¼›è€Œlinkedlistæ²¡æœ‰å®ç°RandomAccessæ¥å£ï¼Œéšæœºè¯»å–ä¼šå¾ˆæ…¢</p>
<h1 id="%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84">æ•°æ®ç»“æ„</h1>
<h2 id="%E5%93%88%E5%B8%8C" id="å“ˆå¸Œ"><a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV1LJ411W7dP?spm_id_from=333.999.0.0">å“ˆå¸Œ</a></h2>
<p>**æ ¸å¿ƒç†è®ºï¼š**Hashä¹Ÿç§°æ•£åˆ—ã€å“ˆå¸Œï¼Œå¯¹åº”çš„è‹±æ–‡éƒ½æ˜¯Hashã€‚åŸºæœ¬åŸç†å°±æ˜¯æŠŠä»»æ„é•¿åº¦çš„è¾“å…¥ï¼Œé€šè¿‡Hashç®—æ³•å˜æˆå›ºå®šé•¿åº¦çš„è¾“å‡ºã€‚è¿™ä¸ªæ˜ å°„çš„è§„åˆ™å°±æ˜¯å¯¹åº”çš„Hashç®—æ³•ï¼Œè€ŒåŸå§‹æ•°æ®æ˜ å°„åçš„äºŒè¿›åˆ¶ä¸²å°±æ˜¯å“ˆå¸Œå€¼ã€‚<br />
<strong>Hashçš„ç‰¹ç‚¹ï¼š</strong><br />
1.hashå€¼ä¸å¯ä»¥åå‘æ¨å¯¼å‡ºåŸå§‹çš„æ•°æ®<br />
2.è¾“å…¥æ•°æ®çš„å¾®å°å˜åŒ–ä¼šå¾—åˆ°å®Œå…¨ä¸åŒçš„hashå€¼ï¼Œç›¸åŒçš„æ•°æ®ä¼šå¾—åˆ°ç›¸åŒçš„å€¼<br />
3.å“ˆå¸Œç®—æ³•çš„æ‰§è¡Œæ•ˆç‡è¦é«˜æ•ˆï¼Œé•¿çš„æ–‡æœ¬ä¹Ÿèƒ½å¿«é€Ÿåœ°è®¡ç®—å‡ºå“ˆå¸Œå€¼<br />
4.hashç®—æ³•çš„å†²çªæ¦‚ç‡è¦å°<br />
ç”±äºhashçš„åŸç†æ˜¯å°†è¾“å…¥ç©ºé—´çš„å€¼æ˜ å°„æˆhashç©ºé—´å†…ï¼Œè€Œhashå€¼çš„ç©ºé—´è¿œå°äºè¾“å…¥çš„ç©ºé—´ã€‚æ ¹æ®æŠ½å±‰åŸç†ï¼Œä¸€å®šä¼šå­˜åœ¨ä¸åŒçš„è¾“å…¥è¢«æ˜ å°„æˆç›¸åŒè¾“å‡ºçš„æƒ…å†µã€‚<strong>æŠ½å±‰åŸç†</strong>ï¼šæ¡Œä¸Šæœ‰åä¸ªè‹¹æœï¼Œè¦æŠŠè¿™åä¸ªè‹¹æœæ”¾åˆ°ä¹ä¸ªæŠ½å±‰é‡Œï¼Œæ— è®ºæ€æ ·æ”¾ï¼Œæˆ‘ä»¬ä¼šå‘ç°è‡³å°‘ä¼šæœ‰ä¸€ä¸ªæŠ½å±‰é‡Œé¢æ”¾ä¸å°‘äºä¸¤ä¸ªè‹¹æœï¼Œè¿™ä¸€ç°è±¡å°±æ˜¯æˆ‘ä»¬æ‰€è¯´çš„æŠ½å±‰åŸç†ã€‚</p>
<h2 id="%E7%BA%A2%E9%BB%91%E6%A0%91" id="çº¢é»‘æ ‘"><a target="_blank" rel="noopener" href="https://www.cnblogs.com/skywang12345/p/3245399.html">çº¢é»‘æ ‘</a></h2>
<p>R-B Treeï¼Œå…¨ç§°æ˜¯Red-Black Treeï¼Œåˆç§°ä¸ºâ€œçº¢é»‘æ ‘â€ï¼Œå®ƒä¸€ç§ç‰¹æ®Šçš„äºŒå‰æŸ¥æ‰¾æ ‘ã€‚çº¢é»‘æ ‘çš„æ¯ä¸ªèŠ‚ç‚¹ä¸Šéƒ½æœ‰å­˜å‚¨ä½è¡¨ç¤ºèŠ‚ç‚¹çš„é¢œè‰²ï¼Œå¯ä»¥æ˜¯çº¢(Red)æˆ–é»‘(Black)ã€‚</p>
<p><strong>çº¢é»‘æ ‘çš„ç‰¹æ€§</strong>:<br />
<strong>ï¼ˆ1ï¼‰æ¯ä¸ªèŠ‚ç‚¹æˆ–è€…æ˜¯é»‘è‰²ï¼Œæˆ–è€…æ˜¯çº¢è‰²ã€‚</strong><br />
<strong>ï¼ˆ2ï¼‰æ ¹èŠ‚ç‚¹æ˜¯é»‘è‰²ã€‚</strong><br />
<strong>ï¼ˆ3ï¼‰æ¯ä¸ªå¶å­èŠ‚ç‚¹ï¼ˆNILï¼‰æ˜¯é»‘è‰²ã€‚ [æ³¨æ„ï¼šè¿™é‡Œå¶å­èŠ‚ç‚¹ï¼Œæ˜¯æŒ‡ä¸ºç©º(NILæˆ–NULL)çš„å¶å­èŠ‚ç‚¹ï¼]</strong><br />
<strong>ï¼ˆ4ï¼‰å¦‚æœä¸€ä¸ªèŠ‚ç‚¹æ˜¯çº¢è‰²çš„ï¼Œåˆ™å®ƒçš„å­èŠ‚ç‚¹å¿…é¡»æ˜¯é»‘è‰²çš„ã€‚</strong><br />
<strong>ï¼ˆ5ï¼‰ä»ä¸€ä¸ªèŠ‚ç‚¹åˆ°è¯¥èŠ‚ç‚¹çš„å­å­™èŠ‚ç‚¹çš„æ‰€æœ‰è·¯å¾„ä¸ŠåŒ…å«ç›¸åŒæ•°ç›®çš„é»‘èŠ‚ç‚¹ã€‚</strong></p>
<p><strong>æ³¨æ„</strong>ï¼š<br />
(01) ç‰¹æ€§(3)ä¸­çš„å¶å­èŠ‚ç‚¹ï¼Œæ˜¯åªä¸ºç©º(NILæˆ–null)çš„èŠ‚ç‚¹ã€‚<br />
(02) ç‰¹æ€§(5)ï¼Œç¡®ä¿æ²¡æœ‰ä¸€æ¡è·¯å¾„ä¼šæ¯”å…¶ä»–è·¯å¾„é•¿å‡ºä¿©å€ã€‚å› è€Œï¼Œçº¢é»‘æ ‘æ˜¯ç›¸å¯¹æ˜¯æ¥è¿‘å¹³è¡¡çš„äºŒå‰æ ‘ã€‚</p>
<p>çº¢é»‘æ ‘ç¤ºæ„å›¾å¦‚ä¸‹ï¼š</p>
<p><a target="_blank" rel="noopener" href="https://images0.cnblogs.com/i/497634/201403/251730074203156.jpg"><img src="https://images0.cnblogs.com/i/497634/201403/251730074203156.jpg" alt="img" /></a></p>
<h1 id="%E5%A6%82%E4%BD%95%E9%98%85%E8%AF%BB%E6%BA%90%E7%A0%81%EF%BC%9F">å¦‚ä½•é˜…è¯»æºç ï¼Ÿ</h1>
<h2 id="%E6%96%B9%E6%B3%95%EF%BC%9A" id="æ–¹æ³•ï¼š">æ–¹æ³•ï¼š</h2>
<p>1.å®è·µæ–­ç‚¹</p>
<p>2.é¡ºåºï¼šæ¥å£$\longrightarrow$å®ç°ç±»ï¼ˆ(æ–¹æ³•ã€å±æ€§--ã€‹åˆ¤æ–­ã€‘)æ„é€ å™¨æ–¹æ³•$\longrightarrow$å¸¸ç”¨æ–¹æ³•$\longrightarrow$å…¶ä»–æ–¹æ³•ï¼‰</p>
<p>3.å·¥å…·ï¼šIDEA çš„ Diagram å›¾æ ‡åŒ–æŸ¥çœ‹ç»§æ‰¿ç»“æ„ï¼Œæ‰€æœ‰ç±»çš„æ‰€æœ‰ç»“æ„ï¼ŒåŒå‡»è·³è½¬å¯¹åº”ç±».å·¦ä¸‹è§’StructureæŸ¥çœ‹ç±»ç»“æ„ã€‚ctrl+HæŸ¥çœ‹ç»§æ‰¿æ ‘ã€‚</p>
<p><img src="https://gitee.com/mychimei/picture/raw/master/work/image-20211117195911086.png" alt="DiagramsæŸ¥çœ‹ç»§æ‰¿ç»“æ„" /></p>
<p><img src="https://gitee.com/mychimei/picture/raw/master/work/image-20211201212457843.png" alt="image-20211201212457843" /></p>
<p>4.æ³¨é‡Šï¼šæŸ¥çœ‹æ³¨é‡Š</p>
<p>5.å¿«æ·é”®ï¼š</p>
<p>6.æ ¹æ®å·²çŸ¥çœ‹æœªçŸ¥ï¼šæ¯”å¦‚å·²çŸ¥åº•å±‚çœ‹æºç ï¼Œçº¿ç¨‹å®‰å…¨çœ‹åŸç†</p>
<h2 id="%E9%A1%B9%E7%9B%AE" id="é¡¹ç›®">é¡¹ç›®</h2>
<h2 id="jdk" id="JDK">JDK</h2>
<p>å¸¸ç”¨åŒ…ï¼šã€<a target="_blank" rel="noopener" href="http://java.io">java.io</a> java.lang <strong>java.util</strong>ã€‘</p>
<p>ã€java.lang.reflect  <a target="_blank" rel="noopener" href="http://java.net">java.net</a>  <a target="_blank" rel="noopener" href="http://javax.net">javax.net</a>.*  java.nio.*  java.util.concurrent.<em>ã€‘</em></p>
<h2 id="%E6%A1%86%E6%9E%B6" id="æ¡†æ¶">æ¡†æ¶</h2>
<h1 id="%E5%AE%B9%E5%99%A8">å®¹å™¨</h1>
<h2 id="%E5%AD%A6%E4%B9%A0%E6%B5%81%E7%A8%8B" id="å­¦ä¹ æµç¨‹">å­¦ä¹ æµç¨‹</h2>
<h3 id="%E8%BF%9B%E5%BA%A6%EF%BC%9A" id="è¿›åº¦ï¼š">è¿›åº¦ï¼š</h3>
<p><s>collection</s>$\longrightarrow$<s>list</s>$\longrightarrow$<s>set</s>$\longrightarrow$<s>map</s>$\longrightarrow$<s>queue</s></p>
<h3 id="%E6%96%B9%E6%B3%95%EF%BC%9A-1" id="æ–¹æ³•ï¼š-v2">æ–¹æ³•ï¼š</h3>
<p>æ€»ç»“ç‰¹ç‚¹$\longrightarrow$æ ¹æ®ç‰¹ç‚¹æŸ¥çœ‹æºç  $\longrightarrow$ç¬”è®°</p>
<h2 id="%E6%80%BB%E7%BB%93" id="æ€»ç»“">æ€»ç»“</h2>
<h3 id="%E6%80%BB%E5%85%B3%E7%B3%BB%E5%9B%BE" id="æ€»å…³ç³»å›¾"><a target="_blank" rel="noopener" href="https://img-blog.csdn.net/20160124221843905">æ€»å…³ç³»å›¾</a></h3>
<p><img src="https://gitee.com/mychimei/picture/raw/master/work/image-20210728134306985.png" alt="image-20210728134306985" /></p>
<p><img src="C:/Users/Administrator/Desktop/image-20210728135916553.png" alt="image-20210728135916553" /></p>
<img src="https://gitee.com/mychimei/picture/raw/master/work/image-20210607192537702.png" alt="image-20210607192537702" style="zoom: 67%;" />
<h3 id="%E8%A1%A8%E6%A0%BC%E6%80%BB%E7%BB%93" id="è¡¨æ ¼æ€»ç»“">è¡¨æ ¼æ€»ç»“</h3>
<table>
<thead>
<tr>
<th>é›†åˆåç§°</th>
<th>ç»“æ„</th>
<th>æ˜¯å¦å¯é‡å¤</th>
<th>æ˜¯å¦çº¿ç¨‹å®‰å…¨</th>
<th>æ˜¯å¦å¯ä¸ºç©º</th>
<th>æ˜¯å¦æœ‰åº</th>
<th>æ‰©å®¹å€æ•°</th>
<th>å¢</th>
<th>åˆ </th>
<th>æ”¹</th>
<th>æŸ¥</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>List</strong></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td><a href="#Vector">Vector</a></td>
<td>åŠ¨æ€æ•°ç»„ã€Object [ ] ã€‘</td>
<td>å¯é‡</td>
<td><strong>å®‰</strong></td>
<td>å¤šç©ºå…±å­˜</td>
<td>æœ‰åº</td>
<td>2</td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td><a href="#ArrayList">ArrayList</a></td>
<td>åŠ¨æ€æ•°ç»„ã€Object [ ] ã€‘</td>
<td>å¯é‡</td>
<td>ä¸å®‰</td>
<td>å¤šç©ºå…±å­˜</td>
<td>æœ‰åº</td>
<td><strong>1.5</strong></td>
<td>å°¾ğŸ’š</td>
<td>å°¾ğŸ’š</td>
<td></td>
<td>ğŸ’š</td>
</tr>
<tr>
<td><a href="#LinkedList">LinkedList</a></td>
<td>åŒå‘å¾ªç¯é“¾è¡¨</td>
<td>å¯é‡</td>
<td>ä¸å®‰</td>
<td>å¤šç©ºå…±å­˜</td>
<td>æœ‰åº</td>
<td><strong>é“¾è¡¨æ— </strong></td>
<td>ğŸ’š</td>
<td>ğŸ’š</td>
<td></td>
<td></td>
</tr>
<tr>
<td><strong>Set</strong></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td><a href="#TreeSet">TreeSet</a></td>
<td>çº¢é»‘æ ‘ã€red-black treeã€‘</td>
<td>ä¸é‡</td>
<td>ä¸å®‰</td>
<td>é»˜è®¤éç©ºï¼Œè‡ªå®šä¹‰å®ç°Comparatoræ¥å£å¯å­˜å‚¨null</td>
<td>æœ‰åº</td>
<td><strong>çº¢é»‘æ ‘æ— </strong></td>
<td></td>
<td></td>
<td></td>
<td>O(logN)</td>
</tr>
<tr>
<td><a href="#HashSet">HashSet</a></td>
<td>å“ˆå¸Œè¡¨ã€HashMapã€‘</td>
<td>ä¸é‡</td>
<td>ä¸å®‰</td>
<td>å¤šç©ºå•å­˜</td>
<td>æ— åº</td>
<td>2</td>
<td>ğŸ’š</td>
<td></td>
<td></td>
<td>O(1)ğŸ’š</td>
</tr>
<tr>
<td><a href="#LinkedHashSet">LinkedHashSet</a></td>
<td>åŒå‘é“¾è¡¨ã€LinkedHashMapã€‘</td>
<td>ä¸é‡</td>
<td>ä¸å®‰</td>
<td>å¤šç©ºå•å­˜</td>
<td>æœ‰åº</td>
<td>2</td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td><strong>Map</strong></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td><a href="#HashMap">HashMap</a></td>
<td>æ•°ç»„+é“¾è¡¨ï¼ˆ1.8ä¹‹åé“¾è¡¨é•¿åº¦å¤§äºé»˜è®¤8ä¸”æ•°ç»„é•¿åº¦å¤§äº64è½¬æ¢ä¸º<strong>çº¢é»‘æ ‘</strong>ï¼‰ï¼Œæ•£åˆ—ï¼ˆå“ˆå¸Œï¼‰è¡¨</td>
<td>å€¼å¯é‡</td>
<td>ä¸å®‰</td>
<td>å¤šç©ºé”®å€¼æˆ–å•ç©ºé”®æˆ–å€¼</td>
<td>æ— åº</td>
<td>2</td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td><a href="#TreeMap">TreeMap</a></td>
<td>çº¢é»‘æ ‘ï¼ˆè‡ªå¹³è¡¡çš„æ’åºäºŒå‰æ ‘ï¼‰</td>
<td>å€¼å¯é‡</td>
<td>ä¸å®‰</td>
<td><strong>å¯å€¼ç©ºå…±å­˜</strong></td>
<td>æœ‰åº</td>
<td><strong>çº¢é»‘æ ‘æ— </strong></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td><a href="#LinkedHashMap">LinkedHashMap</a></td>
<td>åº•å±‚å“ˆå¸Œè¡¨+åŒå‘é“¾è¡¨ï¼Œ<strong>HashMapå­ç±»</strong></td>
<td>å€¼å¯é‡</td>
<td>ä¸å®‰</td>
<td>å¤šç©ºé”®å€¼æˆ–å•ç©ºé”®æˆ–å€¼</td>
<td>æœ‰åº</td>
<td>2</td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td><a href="#ConcurrentHashMap">ConcurrentHashMap</a></td>
<td>1.8ä¹‹å æ•°ç»„ã€é“¾è¡¨/çº¢é»‘æ ‘   é€‚åˆå¤šçº¿ç¨‹</td>
<td>å€¼å¯é‡</td>
<td><strong>å®‰</strong></td>
<td>éç©º</td>
<td></td>
<td>2</td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>ã€ä¿ç•™ã€‘<a href="#Hashtable">Hashtable </a></td>
<td></td>
<td></td>
<td><strong>å®‰</strong></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td><strong>Queue</strong></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td><a href="#PriorityQueue">PriorityQueue</a></td>
<td>äºŒå‰å°é¡¶å †ï¼Œæ¯æ¬¡å–å‡ºæƒå€¼æœ€å°å…ƒç´ ï¼Œå…ˆè¿›å…ˆå‡º</td>
<td></td>
<td>å®‰</td>
<td>é</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
</tbody>
</table>
<h2 id="collection" id="Collection">Collection</h2>
<p>é›†åˆæ ¹æ¥å£ï¼Œå®šä¹‰å­ç±»åŸºç¡€æ“ä½œ</p>
<h3 id="%E9%81%8D%E5%8E%86%E6%96%B9%E5%BC%8F" id="éå†æ–¹å¼"><strong>éå†æ–¹å¼</strong></h3>
<p><strong>foreach</strong></p>
<p><strong>Iterator</strong></p>
<p><strong>listiterator</strong>:åŒºåˆ«ï¼šListä¸“ç”¨ã€éå†æ—¶å¯æ·»åŠ å…ƒç´ ã€å¯é€†å‘éå†ã€å¯å®šä½å½“å‰ç´¢å¼•ä½ç½®ã€å¯ä¿®æ”¹éå†å¯¹è±¡ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Collection&lt;Person&gt; persons = <span class="keyword">new</span> ArrayList&lt;Person&gt;();</span><br><span class="line">Iterator iterator = persons.iterator();</span><br><span class="line"><span class="keyword">while</span> (iterator.hasNext()) &#123; </span><br><span class="line">    System.out.println(iterator.next);  </span><br><span class="line">&#125;  </span><br></pre></td></tr></table></figure>
<p><strong>aggregate operations</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">Collection&lt;Person&gt; persons = <span class="keyword">new</span> ArrayList&lt;Person&gt;();</span><br><span class="line">persons</span><br><span class="line">    .stream()</span><br><span class="line">    .forEach(<span class="keyword">new</span> Consumer&lt;Person&gt;() &#123;  </span><br><span class="line">        <span class="meta">@Override</span>  </span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">accept</span><span class="params">(Person person)</span> </span>&#123;  </span><br><span class="line">            System.out.println(person.name);  </span><br><span class="line">        &#125;  </span><br><span class="line">&#125;); </span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//åœ¨ JDK 8 ä»¥åï¼Œæ¨èä½¿ç”¨èšåˆæ“ä½œå¯¹ä¸€ä¸ªé›†åˆè¿›è¡Œæ“ä½œã€‚èšåˆæ“ä½œé€šå¸¸å’Œ lambda è¡¨è¾¾å¼ç»“åˆä½¿ç”¨ï¼Œè®©ä»£ç çœ‹èµ·æ¥æ›´ç®€æ´ï¼ˆå› æ­¤å¯èƒ½æ›´éš¾ç†è§£ï¼‰ã€‚ä¸‹é¢ä¸¾å‡ ä¸ªç®€å•çš„æ —å­ï¼š</span></span><br><span class="line"><span class="comment">//1.ä½¿ç”¨æµæ¥éå†ä¸€ä¸ª ShapesCollectionï¼Œç„¶åè¾“å‡ºçº¢è‰²çš„å…ƒç´ ï¼š</span></span><br><span class="line">myShapesCollection.stream()</span><br><span class="line">    .filter(e -&gt; e.getColor() == Color.RED)</span><br><span class="line">    .forEach(e -&gt; System.out.println(e.getName()));</span><br><span class="line"><span class="comment">//ä½ è¿˜å¯ä»¥è·å–ä¸€ä¸ªå¹¶è¡Œæµï¼ˆparallelStreamï¼‰ï¼Œå½“é›†åˆå…ƒç´ å¾ˆå¤šæ—¶ä½¿ç”¨å¹¶å‘å¯ä»¥æé«˜æ•ˆç‡ï¼š</span></span><br><span class="line">myShapesCollection.parallelStream()</span><br><span class="line">    .filter(e -&gt; e.getColor() == Color.RED)</span><br><span class="line">    .forEach(e -&gt; System.out.println(e.getName()));                         </span><br><span class="line"><span class="comment">//èšåˆæ“ä½œè¿˜æœ‰å¾ˆå¤šæ“ä½œé›†åˆçš„æ–¹æ³•ï¼Œæ¯”å¦‚è¯´ä½ æƒ³æŠŠ Collection ä¸­çš„å…ƒç´ éƒ½è½¬æˆ String å¯¹è±¡ï¼Œç„¶åæŠŠå®ƒä»¬ è¿èµ·æ¥ï¼š</span></span><br><span class="line">String joined = elements.stream()</span><br><span class="line">    .map(Object::toString)</span><br><span class="line">    .collect(Collectors.joining(<span class="string">&quot;, &quot;</span>));</span><br><span class="line"><span class="comment">//Thanks:https://blog.csdn.net/u011240877/article/details/52773577</span></span><br></pre></td></tr></table></figure>
<h2 id="list" id="List">List</h2>
<blockquote>
<p>æ’å…¥æœ‰åºå¯é‡å¯å¤šç©º</p>
</blockquote>
<h3 id="vector" id="Vector"><strong>Vector</strong></h3>
<p>åº•å±‚æ•°ç»„ï¼ŒåŒæ­¥ï¼ŒåŒæ­¥è®©å…¶æ¯”ALæ…¢ï¼Œå†…å­˜ä¸å¤Ÿé»˜è®¤æ‰©100%</p>
<table>
<thead>
<tr>
<th>ç‰¹ç‚¹</th>
<th>åŸå› ï¼ˆæºç ï¼‰</th>
<th></th>
</tr>
</thead>
<tbody>
<tr>
<td>ä¸ ArrayList ç›¸ä¼¼</td>
<td></td>
<td></td>
</tr>
<tr>
<td>çº¿ç¨‹å®‰å…¨</td>
<td>æ–¹æ³•ä¸­æœ‰synchronizedï¼Œ<strong>æ‰€ä»¥æ€§èƒ½ä¸å¦‚ArrayList</strong></td>
<td></td>
</tr>
<tr>
<td>åŠ¨æ€æ‰©å®¹ä¸ºåŸæ¥çš„2å€</td>
<td><a href="#%E6%89%A9%E5%AE%B9%E4%B8%BA%E5%8E%9F%E6%9D%A5%E4%B8%A4%E5%80%8D">int newCapacity = oldCapacity + ((capacityIncrement &gt; 0) ? capacityIncrement : oldCapacity);</a></td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
</tr>
</tbody>
</table>
<h4 id="%E5%8F%AF%E6%8E%92%E5%BA%8F%E6%89%A9%E5%AE%B9%E4%B8%BA%E5%8E%9F%E6%9D%A5%E4%B8%A4%E5%80%8D" id="å¯æ’åºæ‰©å®¹ä¸ºåŸæ¥ä¸¤å€">å¯æ’åºæ‰©å®¹ä¸ºåŸæ¥ä¸¤å€</h4>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">grow</span><span class="params">(<span class="keyword">int</span> minCapacity)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// overflow-conscious code</span></span><br><span class="line">    <span class="keyword">int</span> oldCapacity = elementData.length;</span><br><span class="line">    <span class="comment">//æ‰©å®¹ä¸ºåŸæ¥ä¸¤å€</span></span><br><span class="line">    <span class="keyword">int</span> newCapacity = oldCapacity + ((capacityIncrement &gt; <span class="number">0</span>) ?</span><br><span class="line">                                     capacityIncrement : oldCapacity);</span><br><span class="line">    <span class="keyword">if</span> (newCapacity - minCapacity &lt; <span class="number">0</span>)</span><br><span class="line">        newCapacity = minCapacity;</span><br><span class="line">    <span class="keyword">if</span> (newCapacity - MAX_ARRAY_SIZE &gt; <span class="number">0</span>)</span><br><span class="line">        newCapacity = hugeCapacity(minCapacity);</span><br><span class="line">    elementData = Arrays.copyOf(elementData, newCapacity);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="arraylist" id="ArrayList"><strong>ArrayList</strong></h3>
<table>
<thead>
<tr>
<th>ç‰¹ç‚¹</th>
<th>åŸå› ï¼ˆæºç ï¼‰</th>
<th></th>
</tr>
</thead>
<tbody>
<tr>
<td>åº•å±‚æ•°ç»„</td>
<td>new Object[initialCapacity];</td>
<td></td>
</tr>
<tr>
<td>æŸ¥ä¼˜ï¼Œ<strong>å°¾</strong>å¢åˆ å¿«ï¼Œå…¶ä»–åœ°æ–¹å¢åˆ æ…¢</td>
<td>åº•å±‚æ•°ç»„</td>
<td></td>
</tr>
<tr>
<td>åŠ¨æ€æ‰©å®¹åŸæ¥çš„1.5å€</td>
<td><a href="#%E5%8A%A8%E6%80%81%E6%89%A9%E5%AE%B9">int newCapacity = oldCapacity + (oldCapacity &gt;&gt; 1);</a></td>
<td></td>
</tr>
<tr>
<td>çº¿ç¨‹ä¸å®‰å…¨</td>
<td>æ–¹æ³•ä¸­æ²¡æœ‰synchronized<br />/**This class is roughly equivalent to<br/> * <tt>Vector</tt>, except that it is unsynchronized.*/</td>
<td></td>
</tr>
<tr>
<td>æ”¯æŒå¿«é€Ÿéšæœºè®¿é—®</td>
<td>RandomAccess</td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
</tr>
</tbody>
</table>
<h4 id="%E5%8A%A8%E6%80%81%E6%89%A9%E5%AE%B9" id="åŠ¨æ€æ‰©å®¹">åŠ¨æ€æ‰©å®¹</h4>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Increases the capacity to ensure that it can hold at least the</span></span><br><span class="line"><span class="comment">     * number of elements specified by the minimum capacity argument.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> minCapacity the desired minimum capacity</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">grow</span><span class="params">(<span class="keyword">int</span> minCapacity)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// overflow-conscious code</span></span><br><span class="line">        <span class="keyword">int</span> oldCapacity = elementData.length;</span><br><span class="line">        <span class="comment">//====== åŠ¨æ€æ‰©å®¹ï¼šä½è¿ç®— &gt;&gt;ï¼šå³ç§»è¿ç®—ç¬¦  oldCapacity &gt;&gt; 1   ---ã€‹   M &gt;&gt; n  = M / 2^n  å³æ‰©å®¹50%======</span></span><br><span class="line">        <span class="keyword">int</span> newCapacity = oldCapacity + (oldCapacity &gt;&gt; <span class="number">1</span>);</span><br><span class="line">        <span class="keyword">if</span> (newCapacity - minCapacity &lt; <span class="number">0</span>)</span><br><span class="line">            newCapacity = minCapacity;</span><br><span class="line">        <span class="keyword">if</span> (newCapacity - MAX_ARRAY_SIZE &gt; <span class="number">0</span>)</span><br><span class="line">            newCapacity = hugeCapacity(minCapacity);</span><br><span class="line">        <span class="comment">// minCapacity is usually close to size, so this is a win:</span></span><br><span class="line">        elementData = Arrays.copyOf(elementData, newCapacity);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>å‚è€ƒï¼šä½è¿ç®—ï¼š<a target="_blank" rel="noopener" href="https://www.cnblogs.com/SunArmy/p/9837348.html">M &gt;&gt; n  = M / 2^n</a></p>
<h5 id="%E6%80%BB%E7%BB%93-1" id="æ€»ç»“-v2">æ€»ç»“</h5>
<h3 id="linkedlist" id="LinkedList"><strong>LinkedList</strong></h3>
<table>
<thead>
<tr>
<th>ç‰¹ç‚¹</th>
<th>åŸå› ï¼ˆæºç ï¼‰</th>
<th></th>
</tr>
</thead>
<tbody>
<tr>
<td>åº•å±‚åŒå‘é“¾è¡¨ï¼Œå¢åˆ ä¼˜ï¼Œå¯æ“ä½œå¤´å°¾ï¼Œç”¨ä½œæ ˆã€ï¼ˆåŒå‘ï¼‰é˜Ÿåˆ—</td>
<td><a href="#%E5%BA%95%E5%B1%82%E5%8F%8C%E5%90%91%E9%93%BE%E8%A1%A8">åº•å±‚åŒå‘é“¾è¡¨</a></td>
<td></td>
</tr>
<tr>
<td>å¯æ’å…¥ç©º</td>
<td><a href="#%E5%BA%95%E5%B1%82%E5%8F%8C%E5%90%91%E9%93%BE%E8%A1%A8">åº•å±‚åŒå‘é“¾è¡¨</a></td>
<td></td>
</tr>
<tr>
<td>æŸ¥è¯¢æ…¢</td>
<td><a href="#%E5%BA%95%E5%B1%82%E5%8F%8C%E5%90%91%E9%93%BE%E8%A1%A8">åº•å±‚åŒå‘é“¾è¡¨</a>ï¼Œä¼šéå†æ•´ä¸ªé“¾è¡¨</td>
<td></td>
</tr>
<tr>
<td>çº¿ç¨‹ä¸å®‰å…¨</td>
<td>æ–¹æ³•ä¸­æ²¡æœ‰synchronized</td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
</tr>
</tbody>
</table>
<h4 id="%E5%BA%95%E5%B1%82%E5%8F%8C%E5%90%91%E9%93%BE%E8%A1%A8" id="åº•å±‚åŒå‘é“¾è¡¨">åº•å±‚åŒå‘é“¾è¡¨</h4>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Returns the (non-null) Node at the specified element index.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function">Node&lt;E&gt; <span class="title">node</span><span class="params">(<span class="keyword">int</span> index)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// assert isElementIndex(index);</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (index &lt; (size &gt;&gt; <span class="number">1</span>)) &#123;</span><br><span class="line">            Node&lt;E&gt; x = first;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; index; i++)</span><br><span class="line">                x = x.next;</span><br><span class="line">            <span class="keyword">return</span> x;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            Node&lt;E&gt; x = last;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = size - <span class="number">1</span>; i &gt; index; i--)</span><br><span class="line">                x = x.prev;</span><br><span class="line">            <span class="keyword">return</span> x;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Inserts all of the elements in the specified collection into this</span></span><br><span class="line"><span class="comment">     * list, starting at the specified position.  Shifts the element</span></span><br><span class="line"><span class="comment">     * currently at that position (if any) and any subsequent elements to</span></span><br><span class="line"><span class="comment">     * the right (increases their indices).  The new elements will appear</span></span><br><span class="line"><span class="comment">     * in the list in the order that they are returned by the</span></span><br><span class="line"><span class="comment">     * specified collection&#x27;s iterator.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> index index at which to insert the first element</span></span><br><span class="line"><span class="comment">     *              from the specified collection</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> c collection containing elements to be added to this list</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> &#123;<span class="doctag">@code</span> true&#125; if this list changed as a result of the call</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> IndexOutOfBoundsException &#123;<span class="doctag">@inheritDoc</span>&#125;</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> NullPointerException if the specified collection is null</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">addAll</span><span class="params">(<span class="keyword">int</span> index, Collection&lt;? extends E&gt; c)</span> </span>&#123;</span><br><span class="line">        checkPositionIndex(index);</span><br><span class="line"></span><br><span class="line">        Object[] a = c.toArray();</span><br><span class="line">        <span class="keyword">int</span> numNew = a.length;</span><br><span class="line">        <span class="keyword">if</span> (numNew == <span class="number">0</span>)</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line"></span><br><span class="line">        Node&lt;E&gt; pred, succ;</span><br><span class="line">        <span class="keyword">if</span> (index == size) &#123;</span><br><span class="line">            succ = <span class="keyword">null</span>;</span><br><span class="line">            pred = last;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            succ = node(index);</span><br><span class="line">            pred = succ.prev;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (Object o : a) &#123;</span><br><span class="line">            <span class="meta">@SuppressWarnings(&quot;unchecked&quot;)</span> E e = (E) o;</span><br><span class="line">            Node&lt;E&gt; newNode = <span class="keyword">new</span> Node&lt;&gt;(pred, e, <span class="keyword">null</span>);</span><br><span class="line">            <span class="keyword">if</span> (pred == <span class="keyword">null</span>)</span><br><span class="line">                first = newNode;</span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">                pred.next = newNode;</span><br><span class="line">            pred = newNode;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (succ == <span class="keyword">null</span>) &#123;</span><br><span class="line">            last = pred;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            pred.next = succ;</span><br><span class="line">            succ.prev = pred;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        size += numNew;</span><br><span class="line">        modCount++;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<h4 id="%E6%80%BB%E7%BB%93-2" id="æ€»ç»“-v3">æ€»ç»“</h4>
<p><strong>Stack</strong><br />
åè¿›å…ˆå‡ºçš„å †æ ˆ</p>
<hr />
<h2 id="set" id="Set">Set</h2>
<blockquote>
<p>æ— åºä¸é‡å•ç©ºï¼Œå¸¸ç”¨äºå»é‡</p>
</blockquote>
<h3 id="treeset" id="TreeSet"><strong>TreeSet</strong></h3>
<table>
<thead>
<tr>
<th>ç‰¹ç‚¹</th>
<th>åŸå› ï¼ˆæºç ï¼‰</th>
<th></th>
</tr>
</thead>
<tbody>
<tr>
<td>åº•å±‚TreeMap</td>
<td><a href="#%E5%BA%95%E5%B1%82%E3%80%81%E5%8F%AF%E6%8E%92%E5%BA%8F">åº•å±‚ã€å¯æ’åº</a></td>
<td></td>
</tr>
<tr>
<td>å¯æ’åºã€è‡ªç„¶æ’åºï¼Œå®šåˆ¶æ’åºã€‘</td>
<td><a href="#%E5%BA%95%E5%B1%82%E3%80%81%E5%8F%AF%E6%8E%92%E5%BA%8F">åº•å±‚ã€å¯æ’åº</a></td>
<td></td>
</tr>
<tr>
<td>çº¿ç¨‹ä¸å®‰å…¨</td>
<td>æ–¹æ³•ä¸­æ²¡æœ‰synchronized</td>
<td></td>
</tr>
<tr>
<td>é»˜è®¤éç©ºï¼Œè‡ªå®šä¹‰å®ç°Comparatoræ¥å£å¯å­˜å‚¨null</td>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
</tr>
</tbody>
</table>
<h4 id="%E5%BA%95%E5%B1%82%E3%80%81%E5%8F%AF%E6%8E%92%E5%BA%8F%E5%BA%95%E5%B1%82%E3%80%81%E5%8F%AF%E6%8E%92%E5%BA%8F" id="åº•å±‚ã€å¯æ’åºåº•å±‚ã€å¯æ’åº">åº•å±‚ã€å¯æ’åºåº•å±‚ã€å¯æ’åº</h4>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">NavigableSet</span>&lt;<span class="title">E</span>&gt; <span class="keyword">extends</span> <span class="title">SortedSet</span>&lt;<span class="title">E</span>&gt; </span>&#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TreeSet</span>&lt;<span class="title">E</span>&gt; <span class="keyword">extends</span> <span class="title">AbstractSet</span>&lt;<span class="title">E</span>&gt;</span></span><br><span class="line"><span class="class">    <span class="keyword">implements</span> <span class="title">NavigableSet</span>&lt;<span class="title">E</span>&gt;, <span class="title">Cloneable</span>, <span class="title">java</span>.<span class="title">io</span>.<span class="title">Serializable</span></span></span><br><span class="line"><span class="class"></span>&#123;&#125;</span><br><span class="line"><span class="comment">// Integerèƒ½æ’åº(æœ‰é»˜è®¤é¡ºåº), Stringèƒ½æ’åº(æœ‰é»˜è®¤é¡ºåº)ï¼Œå¯ä»¥å¯¹å¯¹è±¡å…ƒç´ è¿›è¡Œæ’åºï¼Œä½†æ˜¯è‡ªå®šä¹‰ç±»éœ€è¦å®ç°comparableæ¥å£ï¼Œé‡å†™comparaTo() æ–¹æ³•,å¦åˆ™ï¼š&#123;@code ClassCastException&#125;æŠ¥ClassCastExceptionå¼‚å¸¸ã€‚æ‰€æœ‰å…ƒç´ å¿…é¡»å¯ä»¥ç›¸äº’æ¯”è¾ƒï¼ˆç›¸åŒç±»å‹ï¼‰ï¼Œå¦åˆ™å°†ä¼šæŠ¥ç±»å‹è½¬æ¢å¼‚å¸¸ClassCastExection</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Constructs a new, empty tree set, sorted according to the</span></span><br><span class="line"><span class="comment">     * natural ordering of its elements.  All elements inserted into</span></span><br><span class="line"><span class="comment">     * the set must implement the &#123;<span class="doctag">@link</span> Comparable&#125; interface.</span></span><br><span class="line"><span class="comment">     * Furthermore, all such elements must be &lt;i&gt;mutually</span></span><br><span class="line"><span class="comment">     * comparable&lt;/i&gt;: &#123;<span class="doctag">@code</span> e1.compareTo(e2)&#125; must not throw a</span></span><br><span class="line"><span class="comment">     * &#123;<span class="doctag">@code</span> ClassCastException&#125; for any elements &#123;<span class="doctag">@code</span> e1&#125; and</span></span><br><span class="line"><span class="comment">     * &#123;<span class="doctag">@code</span> e2&#125; in the set.  If the user attempts to add an element</span></span><br><span class="line"><span class="comment">     * to the set that violates this constraint (for example, the user</span></span><br><span class="line"><span class="comment">     * attempts to add a string element to a set whose elements are</span></span><br><span class="line"><span class="comment">     * integers), the &#123;<span class="doctag">@code</span> add&#125; call will throw a</span></span><br><span class="line"><span class="comment">     * &#123;<span class="doctag">@code</span> ClassCastException&#125;.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">TreeSet</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>(<span class="keyword">new</span> TreeMap&lt;E,Object&gt;());</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/ttqi/p/10948737.html">TreeSetçš„æ’åˆ—é¡ºåºä¸é‡å†™çš„compareTo()æ–¹æ³•çš„è¿”å›å€¼æœ‰å…³ã€‚</a></p>
<p>return 0:å…ƒç´ æ¯æ¬¡è¿›è¡Œæ¯”è¾ƒï¼Œéƒ½è®¤ä¸ºæ˜¯ç›¸åŒçš„å…ƒç´ ï¼Œè¿™æ˜¯å°±ä¸å†å‘TreeSeté‡Œé¢æ’å…¥é™¤ç¬¬ä¸€ä¸ªå…ƒç´ ä»¥å¤–çš„å…ƒç´ ï¼Œæ‰€ä»¥TreeSetä¸­å°±åªæ’å…¥äº†ä¸€ä¸ªå…ƒç´ ã€‚</p>
<p>return 1:å…ƒç´ æ¯æ¬¡è¿›è¡Œæ¯”è¾ƒï¼Œéƒ½è®¤ä¸ºæ–°æ’å…¥çš„å…ƒç´ æ¯”ä¸Šä¸€ä¸ªå…ƒç´ å¤§ï¼Œäºæ˜¯äºŒå‰æ ‘å­˜å‚¨æ—¶ï¼Œä¼šå‚¨å­˜åœ¨æ ¹çš„å³ä¾§ï¼Œè¯»å–æ—¶å°±æ˜¯æ­£åºæ’åˆ—ï¼Œå…ˆè¿›å…ˆå‡ºã€‚</p>
<p>return -1:å…ƒç´ æ¯æ¬¡è¿›è¡Œæ¯”è¾ƒï¼Œéƒ½è®¤ä¸ºæ–°æ’å…¥çš„å…ƒç´ æ¯”ä¸Šä¸€ä¸ªå…ƒç´ å°ï¼Œäºæ˜¯äºŒå‰æ ‘å­˜å‚¨æ—¶ï¼Œä¼šå‚¨å­˜åœ¨æ ¹çš„å·¦ä¾§ï¼Œè¯»å–æ—¶å°±æ˜¯å€’åºæ’åˆ—ï¼Œå…ˆè¿›åå‡ºã€‚</p>
<h3 id="hashset" id="HashSet"><strong>HashSet</strong></h3>
<p>å­¦ä¹ å‰æœ€å¥½å…ˆå­¦ä¹   <a href="#HashMap">HashMap</a></p>
<table>
<thead>
<tr>
<th>ç‰¹ç‚¹</th>
<th>åŸå› ï¼ˆæºç ï¼‰</th>
<th></th>
</tr>
</thead>
<tbody>
<tr>
<td>åº•å±‚HashMap</td>
<td><a href="#%E5%BA%95%E5%B1%82HashMap">åº•å±‚HashMap</a></td>
<td></td>
</tr>
<tr>
<td>å¯å•ç©º</td>
<td>Mapçš„keyå”¯ä¸€</td>
<td></td>
</tr>
<tr>
<td>å–„å­˜å–</td>
<td>æ•£åˆ—è¡¨å®šä½</td>
<td></td>
</tr>
<tr>
<td>æ— åº</td>
<td>æ²¡ç»§æ‰¿SortedSet</td>
<td></td>
</tr>
<tr>
<td>ä¸å®‰</td>
<td>æ–¹æ³•ä¸­æ²¡æœ‰synchronized</td>
<td></td>
</tr>
<tr>
<td>ä¸é‡å¤</td>
<td><a href="#%E4%B8%8D%E9%87%8D%E5%A4%8D">ä¸é‡å¤</a></td>
<td></td>
</tr>
<tr>
<td>2å€æ‰©å®¹</td>
<td>åŒhashmap</td>
<td></td>
</tr>
</tbody>
</table>
<h4 id="%E5%BA%95%E5%B1%82hashmap" id="åº•å±‚HashMap">åº•å±‚HashMap</h4>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">    <span class="keyword">private</span> <span class="keyword">transient</span> HashMap&lt;E,Object&gt; map;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Dummy value to associate with an Object in the backing Map</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Object PRESENT = <span class="keyword">new</span> Object();</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Constructs a new set containing the elements in the specified</span></span><br><span class="line"><span class="comment"> * collection.  The &lt;tt&gt;HashMap&lt;/tt&gt; is created with default load factor</span></span><br><span class="line"><span class="comment"> * (0.75) and an initial capacity sufficient to contain the elements in</span></span><br><span class="line"><span class="comment"> * the specified collection.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> c the collection whose elements are to be placed into this set</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@throws</span> NullPointerException if the specified collection is null</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">HashSet</span><span class="params">(Collection&lt;? extends E&gt; c)</span> </span>&#123;</span><br><span class="line">    <span class="comment">//åˆå§‹16ï¼ŒåŠ è½½å› å­0.75</span></span><br><span class="line">    map = <span class="keyword">new</span> HashMap&lt;&gt;(Math.max((<span class="keyword">int</span>) (c.size()/<span class="number">.75f</span>) + <span class="number">1</span>, <span class="number">16</span>));</span><br><span class="line">    addAll(c);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//HashSetä¸­çš„å…ƒç´ éƒ½å­˜æ”¾åœ¨HashMapçš„keyä¸Šé¢ï¼Œè€Œvalueä¸­çš„å€¼éƒ½æ˜¯ç»Ÿä¸€çš„ä¸€ä¸ªå›ºå®šå¯¹è±¡private static final Object PRESENT = new Object();</span></span><br></pre></td></tr></table></figure>
<h4 id="%E4%B8%8D%E9%87%8D%E5%A4%8D" id="ä¸é‡å¤">ä¸é‡å¤</h4>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Adds the specified element to this set if it is not already present.</span></span><br><span class="line"><span class="comment"> * More formally, adds the specified element &lt;tt&gt;e&lt;/tt&gt; to this set if</span></span><br><span class="line"><span class="comment"> * this set contains no element &lt;tt&gt;e2&lt;/tt&gt; such that</span></span><br><span class="line"><span class="comment"> * &lt;tt&gt;(e==null&amp;nbsp;?&amp;nbsp;e2==null&amp;nbsp;:&amp;nbsp;e.equals(e2))&lt;/tt&gt;.</span></span><br><span class="line"><span class="comment"> * If this set already contains the element, the call leaves the set</span></span><br><span class="line"><span class="comment"> * unchanged and returns &lt;tt&gt;false&lt;/tt&gt;.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> e element to be added to this set</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> &lt;tt&gt;true&lt;/tt&gt; if this set did not already contain the specified</span></span><br><span class="line"><span class="comment"> * element</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">add</span><span class="params">(E e)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> map.put(e, PRESENT)==<span class="keyword">null</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Associates the specified value with the specified key in this map.</span></span><br><span class="line"><span class="comment"> * If the map previously contained a mapping for the key, the old</span></span><br><span class="line"><span class="comment"> * value is replaced.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> key key with which the specified value is to be associated</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> value value to be associated with the specified key</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> the previous value associated with &lt;tt&gt;key&lt;/tt&gt;, or</span></span><br><span class="line"><span class="comment"> *         &lt;tt&gt;null&lt;/tt&gt; if there was no mapping for &lt;tt&gt;key&lt;/tt&gt;.</span></span><br><span class="line"><span class="comment"> *         (A &lt;tt&gt;null&lt;/tt&gt; return can also indicate that the map</span></span><br><span class="line"><span class="comment"> *         previously associated &lt;tt&gt;null&lt;/tt&gt; with &lt;tt&gt;key&lt;/tt&gt;.)</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> V <span class="title">put</span><span class="params">(K key, V value)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> putVal(hash(key), key, value, <span class="keyword">false</span>, <span class="keyword">true</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Implements Map.put and related methods</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> hash hash for key</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> key the key</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> value the value to put</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> onlyIfAbsent if true, don&#x27;t change existing value</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> evict if false, the table is in creation mode.</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> previous value, or null if none</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">final</span> V <span class="title">putVal</span><span class="params">(<span class="keyword">int</span> hash, K key, V value, <span class="keyword">boolean</span> onlyIfAbsent,</span></span></span><br><span class="line"><span class="function"><span class="params">               <span class="keyword">boolean</span> evict)</span> </span>&#123;</span><br><span class="line">    Node&lt;K,V&gt;[] tab; Node&lt;K,V&gt; p; <span class="keyword">int</span> n, i;</span><br><span class="line">    <span class="keyword">if</span> ((tab = table) == <span class="keyword">null</span> || (n = tab.length) == <span class="number">0</span>)</span><br><span class="line">        n = (tab = resize()).length;</span><br><span class="line">    <span class="keyword">if</span> ((p = tab[i = (n - <span class="number">1</span>) &amp; hash]) == <span class="keyword">null</span>)</span><br><span class="line">        tab[i] = newNode(hash, key, value, <span class="keyword">null</span>);</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        Node&lt;K,V&gt; e; K k;</span><br><span class="line">        <span class="keyword">if</span> (p.hash == hash &amp;&amp;</span><br><span class="line">            ((k = p.key) == key || (key != <span class="keyword">null</span> &amp;&amp; key.equals(k))))</span><br><span class="line">            e = p;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (p <span class="keyword">instanceof</span> TreeNode)</span><br><span class="line">            e = ((TreeNode&lt;K,V&gt;)p).putTreeVal(<span class="keyword">this</span>, tab, hash, key, value);</span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> binCount = <span class="number">0</span>; ; ++binCount) &#123;</span><br><span class="line">                <span class="keyword">if</span> ((e = p.next) == <span class="keyword">null</span>) &#123;</span><br><span class="line">                    p.next = newNode(hash, key, value, <span class="keyword">null</span>);</span><br><span class="line">                    <span class="keyword">if</span> (binCount &gt;= TREEIFY_THRESHOLD - <span class="number">1</span>) <span class="comment">// -1 for 1st</span></span><br><span class="line">                        treeifyBin(tab, hash);</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">if</span> (e.hash == hash &amp;&amp;</span><br><span class="line">                    ((k = e.key) == key || (key != <span class="keyword">null</span> &amp;&amp; key.equals(k))))</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                p = e;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (e != <span class="keyword">null</span>) &#123; <span class="comment">// existing mapping for key</span></span><br><span class="line">            V oldValue = e.value;</span><br><span class="line">            <span class="keyword">if</span> (!onlyIfAbsent || oldValue == <span class="keyword">null</span>)</span><br><span class="line">                e.value = value;</span><br><span class="line">            afterNodeAccess(e);</span><br><span class="line">            <span class="keyword">return</span> oldValue;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    ++modCount;</span><br><span class="line">    <span class="keyword">if</span> (++size &gt; threshold)</span><br><span class="line">        resize();</span><br><span class="line">    afterNodeInsertion(evict);</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="linkedhashset" id="LinkedHashSet"><strong>LinkedHashSet</strong></h3>
<table>
<thead>
<tr>
<th>ç‰¹ç‚¹</th>
<th>åŸå› ï¼ˆæºç ï¼‰</th>
<th></th>
</tr>
</thead>
<tbody>
<tr>
<td>åº•å±‚é“¾è¡¨ã€LinkedHashMapã€‘</td>
<td><a href="#%E5%BA%95%E5%B1%82">åº•å±‚</a></td>
<td></td>
</tr>
<tr>
<td>ä¸å®‰</td>
<td>æ–¹æ³•ä¸­æ²¡æœ‰synchronized</td>
<td></td>
</tr>
<tr>
<td>æ’å…¥æœ‰åº</td>
<td>LinkedHashSetåœ¨éå†æ—¶è·å¾—çš„è¿­ä»£å™¨æ˜¯LinkedHashSetæ‰€å®ç°çš„LinkedKeyIteratorï¼Œå®ƒçš„éå†æ˜¯ä»åŒå‘é“¾è¡¨å¤´å¼€å§‹é¡ºåºéå†ï¼Œå®ç°äº†æœ‰åºè¾“å‡ºã€‚</td>
<td></td>
</tr>
<tr>
<td>ä¸é‡å¤</td>
<td>ç±»ä¼¼<a href="#%E4%B8%8D%E9%87%8D%E5%A4%8D">ä¸é‡å¤</a></td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
</tr>
</tbody>
</table>
<h4 id="%E5%BA%95%E5%B1%82" id="åº•å±‚">åº•å±‚</h4>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">  * Constructs a new linked hash set with the same elements as the</span></span><br><span class="line"><span class="comment">  * specified collection.  The linked hash set is created with an initial</span></span><br><span class="line"><span class="comment">  * capacity sufficient to hold the elements in the specified collection</span></span><br><span class="line"><span class="comment">  * and the default load factor (0.75).</span></span><br><span class="line"><span class="comment">  *</span></span><br><span class="line"><span class="comment">  * <span class="doctag">@param</span> c  the collection whose elements are to be placed into</span></span><br><span class="line"><span class="comment">  *           this set</span></span><br><span class="line"><span class="comment">  * <span class="doctag">@throws</span> NullPointerException if the specified collection is null</span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line"> <span class="function"><span class="keyword">public</span> <span class="title">LinkedHashSet</span><span class="params">(Collection&lt;? extends E&gt; c)</span> </span>&#123;</span><br><span class="line">     <span class="keyword">super</span>(Math.max(<span class="number">2</span>*c.size(), <span class="number">11</span>), <span class="number">.75f</span>, <span class="keyword">true</span>);</span><br><span class="line">     addAll(c);</span><br><span class="line"> &#125;</span><br><span class="line"> </span><br><span class="line"> <span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LinkedHashSet</span>&lt;<span class="title">E</span>&gt;</span></span><br><span class="line"><span class="class"> <span class="keyword">extends</span> <span class="title">HashSet</span>&lt;<span class="title">E</span>&gt;</span></span><br><span class="line"><span class="class"> <span class="keyword">implements</span> <span class="title">Set</span>&lt;<span class="title">E</span>&gt;, <span class="title">Cloneable</span>, <span class="title">java</span>.<span class="title">io</span>.<span class="title">Serializable</span> </span>&#123;&#125;</span><br><span class="line"> </span><br><span class="line"> <span class="comment">/**</span></span><br><span class="line"><span class="comment">  * Constructs a new, empty linked hash set.  (This package private</span></span><br><span class="line"><span class="comment">  * constructor is only used by LinkedHashSet.) The backing</span></span><br><span class="line"><span class="comment">  * HashMap instance is a LinkedHashMap with the specified initial</span></span><br><span class="line"><span class="comment">  * capacity and the specified load factor.</span></span><br><span class="line"><span class="comment">  *</span></span><br><span class="line"><span class="comment">  * <span class="doctag">@param</span>      initialCapacity   the initial capacity of the hash map</span></span><br><span class="line"><span class="comment">  * <span class="doctag">@param</span>      loadFactor        the load factor of the hash map</span></span><br><span class="line"><span class="comment">  * <span class="doctag">@param</span>      dummy             ignored (distinguishes this</span></span><br><span class="line"><span class="comment">  *             constructor from other int, float constructor.)</span></span><br><span class="line"><span class="comment">  * <span class="doctag">@throws</span>     IllegalArgumentException if the initial capacity is less</span></span><br><span class="line"><span class="comment">  *             than zero, or if the load factor is nonpositive</span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line"> HashSet(<span class="keyword">int</span> initialCapacity, <span class="keyword">float</span> loadFactor, <span class="keyword">boolean</span> dummy) &#123;</span><br><span class="line">     map = <span class="keyword">new</span> LinkedHashMap&lt;&gt;(initialCapacity, loadFactor);</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>
<h2 id="map" id="Map">Map</h2>
<blockquote>
<p>é”®å€¼å¯¹ï¼Œé”®ä¸é‡</p>
</blockquote>
<h3 id="hashmap" id="HashMap"><strong>HashMap</strong></h3>
<p>æ¨èèµ„æºï¼š<a target="_blank" rel="noopener" href="https://blog.csdn.net/zxt0601/article/details/77413921">åšå®¢1</a></p>
<table>
<thead>
<tr>
<th>ç‰¹ç‚¹</th>
<th>åŸå› ï¼ˆæºç ï¼‰</th>
<th></th>
</tr>
</thead>
<tbody>
<tr>
<td>åº•å±‚ä¸º<strong>æ•°ç»„</strong>ç§°ä¹‹ä¸º<strong>å“ˆå¸Œæ¡¶</strong>ï¼Œæ¯ä¸ª<strong>æ¡¶é‡Œé¢æ”¾çš„æ˜¯é“¾è¡¨</strong>ï¼Œé“¾è¡¨ä¸­çš„<strong>æ¯ä¸ªèŠ‚ç‚¹</strong>ï¼Œå°±æ˜¯å“ˆå¸Œè¡¨ä¸­çš„<strong>æ¯ä¸ªå…ƒç´ </strong>ã€‚<br/>JDK8åï¼Œé“¾è¡¨å®¹é‡å¤§äº8ä¸”æ¡¶çš„å®¹é‡å¤§äº64ï¼Œè½¬åŒ–æˆçº¢é»‘æ ‘</td>
<td><a href="#%E5%BA%95%E5%B1%82">åº•å±‚</a></td>
<td></td>
</tr>
<tr>
<td>çº¿ç¨‹ä¸å®‰å…¨</td>
<td>æ–¹æ³•ä¸­æ²¡æœ‰synchronized</td>
<td></td>
</tr>
<tr>
<td>é»˜è®¤é•¿åº¦16</td>
<td><a href="#%E5%88%9D%E5%A7%8B%E5%AE%B9%E9%87%8F">åˆå§‹å®¹é‡</a></td>
<td></td>
</tr>
<tr>
<td>æ‰©å®¹ä¸ºåŸæ¥çš„ä¸¤å€</td>
<td><a href="#%E6%89%A9%E5%AE%B9">æ‰©å®¹</a></td>
<td></td>
</tr>
<tr>
<td>æ— åº</td>
<td><a href="#%E6%97%A0%E5%BA%8F,%E5%8F%AF%E7%A9%BA">æ— åº,å¯ç©º</a></td>
<td></td>
</tr>
<tr>
<td>å¤šç©ºé”®å€¼æˆ–å•ç©ºé”®æˆ–å€¼</td>
<td><a href="#%E6%97%A0%E5%BA%8F,%E5%8F%AF%E7%A9%BA">æ— åº,å¯ç©º</a></td>
<td></td>
</tr>
</tbody>
</table>
<h4 id="%E5%BA%95%E5%B1%82-1" id="åº•å±‚-v2">åº•å±‚</h4>
<img src="https://gitee.com/mychimei/picture/raw/master/work/image-20211206195158123.png" alt="image-20211206195158123" style="zoom:67%;" />
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"> <span class="comment">/** Node å•å‘é“¾è¡¨</span></span><br><span class="line"><span class="comment"> * Basic hash bin node, used for most entries.  (See below for</span></span><br><span class="line"><span class="comment"> * TreeNode subclass, and in LinkedHashMap for its Entry subclass.)</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">Node</span>&lt;<span class="title">K</span>,<span class="title">V</span>&gt; <span class="keyword">implements</span> <span class="title">Map</span>.<span class="title">Entry</span>&lt;<span class="title">K</span>,<span class="title">V</span>&gt; </span>&#123;</span><br><span class="line">    <span class="keyword">final</span> <span class="keyword">int</span> hash;</span><br><span class="line">    <span class="keyword">final</span> K key;</span><br><span class="line">    V value;</span><br><span class="line">    <span class="comment">//ç¢°æ’ä¹‹åå½¢æˆé“¾è¡¨</span></span><br><span class="line">    Node&lt;K,V&gt; next;</span><br><span class="line"></span><br><span class="line">    Node(<span class="keyword">int</span> hash, K key, V value, Node&lt;K,V&gt; next) &#123;</span><br><span class="line">        <span class="keyword">this</span>.hash = hash;</span><br><span class="line">        <span class="keyword">this</span>.key = key;</span><br><span class="line">        <span class="keyword">this</span>.value = value;</span><br><span class="line">        <span class="keyword">this</span>.next = next;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">final</span> K <span class="title">getKey</span><span class="params">()</span>        </span>&#123; <span class="keyword">return</span> key; &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">final</span> V <span class="title">getValue</span><span class="params">()</span>      </span>&#123; <span class="keyword">return</span> value; &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">final</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123; <span class="keyword">return</span> key + <span class="string">&quot;=&quot;</span> + value; &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">int</span> <span class="title">hashCode</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> Objects.hashCode(key) ^ Objects.hashCode(value);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">final</span> V <span class="title">setValue</span><span class="params">(V newValue)</span> </span>&#123;</span><br><span class="line">        V oldValue = value;</span><br><span class="line">        value = newValue;</span><br><span class="line">        <span class="keyword">return</span> oldValue;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">boolean</span> <span class="title">equals</span><span class="params">(Object o)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (o == <span class="keyword">this</span>)</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">        <span class="keyword">if</span> (o <span class="keyword">instanceof</span> Map.Entry) &#123;</span><br><span class="line">            Map.Entry&lt;?,?&gt; e = (Map.Entry&lt;?,?&gt;)o;</span><br><span class="line">            <span class="keyword">if</span> (Objects.equals(key, e.getKey()) &amp;&amp;</span><br><span class="line">                Objects.equals(value, e.getValue()))</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/**çº¢é»‘æ ‘</span></span><br><span class="line"><span class="comment"> * Entry for Tree bins. Extends LinkedHashMap.Entry (which in turn</span></span><br><span class="line"><span class="comment"> * extends Node) so can be used as extension of either regular or</span></span><br><span class="line"><span class="comment"> * linked node.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">TreeNode</span>&lt;<span class="title">K</span>,<span class="title">V</span>&gt; <span class="keyword">extends</span> <span class="title">LinkedHashMap</span>.<span class="title">Entry</span>&lt;<span class="title">K</span>,<span class="title">V</span>&gt; </span>&#123;</span><br><span class="line">    TreeNode&lt;K,V&gt; parent;  <span class="comment">// red-black tree links</span></span><br><span class="line">    TreeNode&lt;K,V&gt; left;</span><br><span class="line">    TreeNode&lt;K,V&gt; right;</span><br><span class="line">    TreeNode&lt;K,V&gt; prev;    <span class="comment">// needed to unlink next upon deletion</span></span><br><span class="line">    <span class="keyword">boolean</span> red;</span><br><span class="line">    TreeNode(<span class="keyword">int</span> hash, K key, V val, Node&lt;K,V&gt; next) &#123;</span><br><span class="line">        <span class="keyword">super</span>(hash, key, val, next);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Returns root of tree containing this node.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">final</span> TreeNode&lt;K,V&gt; <span class="title">root</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">for</span> (TreeNode&lt;K,V&gt; r = <span class="keyword">this</span>, p;;) &#123;</span><br><span class="line">            <span class="keyword">if</span> ((p = r.parent) == <span class="keyword">null</span>)</span><br><span class="line">                <span class="keyword">return</span> r;</span><br><span class="line">            r = p;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">  ......</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="%E6%89%A9%E5%AE%B9" id="æ‰©å®¹">æ‰©å®¹</h4>
<p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/hongten/p/hongten_java_yiweiyunsuangfu.html">å‚è€ƒ</a></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br></pre></td><td class="code"><pre><span class="line"> <span class="comment">/** ä¸ºä»€ä¹ˆéœ€è¦æ‰©å®¹ï¼šå“ˆå¸Œå†²çªå¯¼è‡´çš„é“¾åŒ–å½±åƒæŸ¥æ‰¾æ•ˆç‡ï¼Œæ•°ç»„ä»¥ç©ºé—´æ¢æ—¶é—´  </span></span><br><span class="line"><span class="comment"> ç”±power-of-two expansion  newCap = oldCap &lt;&lt; 1 å¯çŸ¥æ‰©å®¹ä¸ºåŸæ¥çš„ä¸¤å€</span></span><br><span class="line"><span class="comment">1010      åè¿›åˆ¶ï¼š10     åŸå§‹æ•°         number</span></span><br><span class="line"><span class="comment">10100      åè¿›åˆ¶ï¼š20     å·¦ç§»ä¸€ä½       number = number &lt;&lt; 1;</span></span><br><span class="line"><span class="comment">    1010      åè¿›åˆ¶ï¼š10     å³ç§»ä¸€ä½       number = number &gt;&gt; 1;</span></span><br><span class="line"><span class="comment"> 		å³	oldCap &lt;&lt; 1 å³äºŒè¿›åˆ¶å‘å·¦ç§»åŠ¨ä¸¤ä½ï¼šoldCap &lt;&lt; 1=oldCap*2</span></span><br><span class="line"><span class="comment"> 			åŒç†oldCap &gt;&gt; 1=oldCap/2</span></span><br><span class="line"><span class="comment"> 			è¡¥å……&gt;&gt;&gt;ï¼šæ— ç¬¦å·å³ç§»ï¼Œå¿½ç•¥ç¬¦å·ä½ï¼Œç©ºä½éƒ½ä»¥0è¡¥é½</span></span><br><span class="line"><span class="comment">   * Initializes or doubles table size.  If null, allocates in</span></span><br><span class="line"><span class="comment">   * accord with initial capacity target held in field threshold.</span></span><br><span class="line"><span class="comment">   * Otherwise, because we are using power-of-two expansion, the</span></span><br><span class="line"><span class="comment">   * elements from each bin must either stay at same index, or move</span></span><br><span class="line"><span class="comment">   * with a power of two offset in the new table.</span></span><br><span class="line"><span class="comment">   *</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@return</span> the table</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="keyword">final</span> Node&lt;K,V&gt;[] resize() &#123;</span><br><span class="line">      <span class="comment">//oldTabæ‰©å®¹å‰å“ˆå¸Œè¡¨</span></span><br><span class="line">      Node&lt;K,V&gt;[] oldTab = table;</span><br><span class="line">      <span class="comment">//æ‰©å®¹ä¹‹å‰æ•°ç»„é•¿åº¦</span></span><br><span class="line">      <span class="keyword">int</span> oldCap = (oldTab == <span class="keyword">null</span>) ? <span class="number">0</span> : oldTab.length;</span><br><span class="line">      <span class="comment">//æ‰©å®¹ä¹‹å‰çš„é˜ˆå€¼ï¼Œè§¦å‘æœ¬æ¬¡æ‰©å®¹çš„é˜ˆå€¼</span></span><br><span class="line">      <span class="keyword">int</span> oldThr = threshold;</span><br><span class="line">      <span class="comment">//æ‰©å®¹ä¹‹åçš„æ•°ç»„å¤§å°</span></span><br><span class="line">      <span class="comment">//ä¸‹æ¬¡è§¦å‘æ‰©å®¹çš„æ¡ä»¶</span></span><br><span class="line">      <span class="keyword">int</span> newCap, newThr = <span class="number">0</span>;</span><br><span class="line">      <span class="comment">//æ•£åˆ—è¡¨å·²åˆå§‹åŒ–ï¼Œè¿™æ˜¯ä¸€æ¬¡æ­£å¸¸çš„æ‰©å®¹</span></span><br><span class="line">      <span class="keyword">if</span> (oldCap &gt; <span class="number">0</span>) &#123;</span><br><span class="line">          <span class="comment">//æ‰©å®¹ä¹‹å‰æ•°ç»„å¤§å°è¾¾åˆ°æœ€å¤§é˜ˆå€¼ï¼Œåˆ™ä¸æ‰©å®¹ä¸”è®¾æ‰©å®¹æ¡ä»¶ä¸ºintæœ€å¤§å€¼</span></span><br><span class="line">          <span class="keyword">if</span> (oldCap &gt;= MAXIMUM_CAPACITY) &#123;</span><br><span class="line">              threshold = Integer.MAX_VALUE;</span><br><span class="line">              <span class="keyword">return</span> oldTab;</span><br><span class="line">          &#125;</span><br><span class="line">          <span class="comment">//oldCapå·¦ç§»ä¸€ä½å®ç°æ•°å€¼ç¿»å€ï¼Œå¹¶ä¸”å¤åˆ¶ç»™newCapï¼ŒnewCapå°äºæœ€å¤§é™åˆ¶ä¸”æ‰©å®¹ä¹‹å‰çš„æ•°ç»„é•¿åº¦ &gt;= 16</span></span><br><span class="line">          <span class="keyword">else</span> <span class="keyword">if</span> ((newCap = oldCap &lt;&lt; <span class="number">1</span>) &lt; MAXIMUM_CAPACITY &amp;&amp;</span><br><span class="line">                   oldCap &gt;= DEFAULT_INITIAL_CAPACITY)</span><br><span class="line">              newThr = oldThr &lt;&lt; <span class="number">1</span>; <span class="comment">// double threshold</span></span><br><span class="line">      &#125;</span><br><span class="line">      <span class="comment">//oldCap==0,è¯´æ˜HashMapä¸­çš„æ•£åˆ—è¡¨æ˜¯null</span></span><br><span class="line">      <span class="comment">//1.new HashMapï¼ˆinitCapï¼ŒloadFactorï¼‰ï¼›</span></span><br><span class="line">      <span class="comment">//2.new HashMapï¼ˆinitCapï¼‰ï¼›</span></span><br><span class="line">       <span class="comment">//3.new HashMapï¼ˆmapï¼‰ï¼›ä¸”mapæœ‰æ•°æ®</span></span><br><span class="line">      <span class="keyword">else</span> <span class="keyword">if</span> (oldThr &gt; <span class="number">0</span>) <span class="comment">// initial capacity was placed in threshold</span></span><br><span class="line">          newCap = oldThr;</span><br><span class="line">      <span class="comment">//oldCap==0ï¼ŒoldThr==0</span></span><br><span class="line">      <span class="comment">//new HashMapï¼ˆmapï¼‰;</span></span><br><span class="line">      <span class="keyword">else</span> &#123;               <span class="comment">// zero initial threshold signifies using defaults</span></span><br><span class="line">          newCap = DEFAULT_INITIAL_CAPACITY;<span class="comment">//16</span></span><br><span class="line">          newThr = (<span class="keyword">int</span>)(DEFAULT_LOAD_FACTOR * DEFAULT_INITIAL_CAPACITY);<span class="comment">//12</span></span><br><span class="line">      &#125;</span><br><span class="line">      </span><br><span class="line">      <span class="comment">//newThrä¸º0æ—¶ï¼Œé€šè¿‡newCapå’ŒloadFactorè®¡ç®—å‡ºä¸€ä¸ªnewThr</span></span><br><span class="line">      <span class="keyword">if</span> (newThr == <span class="number">0</span>) &#123;</span><br><span class="line">          <span class="keyword">float</span> ft = (<span class="keyword">float</span>)newCap * loadFactor;</span><br><span class="line">          newThr = (newCap &lt; MAXIMUM_CAPACITY &amp;&amp; ft &lt; (<span class="keyword">float</span>)MAXIMUM_CAPACITY ?</span><br><span class="line">                    (<span class="keyword">int</span>)ft : Integer.MAX_VALUE);</span><br><span class="line">      &#125;</span><br><span class="line">      threshold = newThr;</span><br><span class="line">      </span><br><span class="line">      <span class="comment">//ç¬¬ä¸€æ¬¡æˆ–åˆ›å»ºä¸€ä¸ªæ›´å¤§çš„æ•°ç»„</span></span><br><span class="line">      <span class="meta">@SuppressWarnings(&#123;&quot;rawtypes&quot;,&quot;unchecked&quot;&#125;)</span></span><br><span class="line">          Node&lt;K,V&gt;[] newTab = (Node&lt;K,V&gt;[])<span class="keyword">new</span> Node[newCap];</span><br><span class="line">      table = newTab;</span><br><span class="line">      <span class="comment">//æ‰©å®¹å‰æ•°ç»„ä¸ä¸ºç©º</span></span><br><span class="line">      <span class="keyword">if</span> (oldTab != <span class="keyword">null</span>) &#123;</span><br><span class="line">          <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; oldCap; ++j) &#123;</span><br><span class="line">              <span class="comment">//å½“å‰nodeèŠ‚ç‚¹</span></span><br><span class="line">              Node&lt;K,V&gt; e;</span><br><span class="line">              <span class="comment">//å½“å‰æ¡¶ä½ä¸­æœ‰æ•°æ®ï¼Œä½†æ˜¯æ•°æ®å…·ä½“æ˜¯å•ä¸ªæ•°æ®æˆ–é“¾è¡¨æˆ–çº¢é»‘æ ‘è¿˜ä¸æ˜ç¡®</span></span><br><span class="line">              <span class="keyword">if</span> ((e = oldTab[j]) != <span class="keyword">null</span>) &#123;</span><br><span class="line">                  <span class="comment">//æ–¹ä¾¿JVM GCå›æ”¶</span></span><br><span class="line">                  oldTab[j] = <span class="keyword">null</span>;</span><br><span class="line">                  <span class="comment">//å½“å‰èŠ‚ç‚¹ä¸ºå•æ•°æ®</span></span><br><span class="line">                  <span class="keyword">if</span> (e.next == <span class="keyword">null</span>)</span><br><span class="line">                      newTab[e.hash &amp; (newCap - <span class="number">1</span>)] = e;</span><br><span class="line">                  <span class="comment">//å½“å‰èŠ‚ç‚¹å·²ç»æ ‘åŒ–</span></span><br><span class="line">                  <span class="keyword">else</span> <span class="keyword">if</span> (e <span class="keyword">instanceof</span> TreeNode)</span><br><span class="line">                      ((TreeNode&lt;K,V&gt;)e).split(<span class="keyword">this</span>, newTab, j, oldCap);</span><br><span class="line">                  <span class="comment">//å½“å‰èŠ‚ç‚¹ä¸ºé“¾è¡¨</span></span><br><span class="line">                  <span class="keyword">else</span> &#123; <span class="comment">// preserve order</span></span><br><span class="line">                      <span class="comment">//loHeadä½ä½é“¾è¡¨ï¼Œå­˜æ”¾åœ¨æ‰©å®¹ä¹‹åçš„æ•°ç»„çš„ä¸‹æ ‡ä½ç½®ï¼Œä¸å½“å‰æ•°ç»„çš„ä¸‹æ ‡ä½ç½®ä¸€è‡´ã€‚</span></span><br><span class="line">                      <span class="comment">//hiHeadé«˜ä½é“¾è¡¨ï¼Œå­˜æ”¾åœ¨æ‰©å®¹ä¹‹åçš„æ•°ç»„çš„ä¸‹æ ‡ä½ç½®ä¸ºå½“å‰æ•°ç»„çš„ä¸‹æ ‡ä½ç½®+æ‰©å®¹ä¹‹å‰çš„é•¿åº¦ã€‚</span></span><br><span class="line">                      Node&lt;K,V&gt; loHead = <span class="keyword">null</span>, loTail = <span class="keyword">null</span>;</span><br><span class="line">                      Node&lt;K,V&gt; hiHead = <span class="keyword">null</span>, hiTail = <span class="keyword">null</span>;</span><br><span class="line">                      Node&lt;K,V&gt; next;</span><br><span class="line">                      <span class="keyword">do</span> &#123;</span><br><span class="line">                          next = e.next;</span><br><span class="line">                          <span class="keyword">if</span> ((e.hash &amp; oldCap) == <span class="number">0</span>) &#123;</span><br><span class="line">                              <span class="keyword">if</span> (loTail == <span class="keyword">null</span>)</span><br><span class="line">                                  loHead = e;</span><br><span class="line">                              <span class="keyword">else</span></span><br><span class="line">                                  loTail.next = e;</span><br><span class="line">                              loTail = e;</span><br><span class="line">                          &#125;</span><br><span class="line">                          <span class="keyword">else</span> &#123;</span><br><span class="line">                              <span class="keyword">if</span> (hiTail == <span class="keyword">null</span>)</span><br><span class="line">                                  hiHead = e;</span><br><span class="line">                              <span class="keyword">else</span></span><br><span class="line">                                  hiTail.next = e;</span><br><span class="line">                              hiTail = e;</span><br><span class="line">                          &#125;</span><br><span class="line">                      &#125; <span class="keyword">while</span> ((e = next) != <span class="keyword">null</span>);</span><br><span class="line">                      </span><br><span class="line">                      <span class="comment">//ä½ä½é“¾è¡¨æœ‰æ•°æ®</span></span><br><span class="line">                      <span class="keyword">if</span> (loTail != <span class="keyword">null</span>) &#123;</span><br><span class="line">                          loTail.next = <span class="keyword">null</span>;</span><br><span class="line">                          newTab[j] = loHead;</span><br><span class="line">                      &#125;</span><br><span class="line">                      <span class="keyword">if</span> (hiTail != <span class="keyword">null</span>) &#123;</span><br><span class="line">                          hiTail.next = <span class="keyword">null</span>;</span><br><span class="line">                          newTab[j + oldCap] = hiHead;</span><br><span class="line">                      &#125;</span><br><span class="line">                  &#125;</span><br><span class="line">              &#125;</span><br><span class="line">          &#125;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">return</span> newTab;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>
<h4 id="%E5%88%9D%E5%A7%8B%E5%AE%B9%E9%87%8F" id="åˆå§‹å®¹é‡">åˆå§‹å®¹é‡</h4>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**é»˜è®¤ï¼ˆç¼ºçœï¼‰æ•°ç»„é•¿åº¦</span></span><br><span class="line"><span class="comment">     * The default initial capacity - MUST be a power of two.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> DEFAULT_INITIAL_CAPACITY = <span class="number">1</span> &lt;&lt; <span class="number">4</span>; <span class="comment">// aka 16</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**æœ€å¤§æ•°ç»„é•¿åº¦</span></span><br><span class="line"><span class="comment">     * The maximum capacity, used if a higher value is implicitly specified</span></span><br><span class="line"><span class="comment">     * by either of the constructors with arguments.</span></span><br><span class="line"><span class="comment">     * MUST be a power of two &lt;= 1&lt;&lt;30.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> MAXIMUM_CAPACITY = <span class="number">1</span> &lt;&lt; <span class="number">30</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**ç¼ºçœè´Ÿè½½å› å­å¤§å°</span></span><br><span class="line"><span class="comment">     * The load factor used when none specified in constructor.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">float</span> DEFAULT_LOAD_FACTOR = <span class="number">0.75f</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**è½¬æ¢ä¸ºçº¢é»‘æ ‘çš„å•ä¸ªé“¾è¡¨å…ƒç´ é˜ˆå€¼</span></span><br><span class="line"><span class="comment">                        if (binCount &gt;= TREEIFY_THRESHOLD - 1)</span></span><br><span class="line"><span class="comment">                    treeifyBin(tab, hash);çœ‹ä¸‹é¢æ–¹æ³•</span></span><br><span class="line"><span class="comment">            &#125;</span></span><br><span class="line"><span class="comment">     * The bin count threshold for using a tree rather than list for a</span></span><br><span class="line"><span class="comment">     * bin.  Bins are converted to trees when adding an element to a</span></span><br><span class="line"><span class="comment">     * bin with at least this many nodes. The value must be greater</span></span><br><span class="line"><span class="comment">     * than 2 and should be at least 8 to mesh with assumptions in</span></span><br><span class="line"><span class="comment">     * tree removal about conversion back to plain bins upon</span></span><br><span class="line"><span class="comment">     * shrinkage.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> TREEIFY_THRESHOLD = <span class="number">8</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Replaces all linked nodes in bin at index for given hash unless</span></span><br><span class="line"><span class="comment">     * table is too small, in which case resizes instead.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">final</span> <span class="keyword">void</span> <span class="title">treeifyBin</span><span class="params">(Node&lt;K,V&gt;[] tab, <span class="keyword">int</span> hash)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> n, index; Node&lt;K,V&gt; e;</span><br><span class="line">        <span class="keyword">if</span> (tab == <span class="keyword">null</span> || (n = tab.length) &lt; MIN_TREEIFY_CAPACITY)</span><br><span class="line">            resize();</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> ((e = tab[index = (n - <span class="number">1</span>) &amp; hash]) != <span class="keyword">null</span>) &#123;</span><br><span class="line">            TreeNode&lt;K,V&gt; hd = <span class="keyword">null</span>, tl = <span class="keyword">null</span>;</span><br><span class="line">            <span class="keyword">do</span> &#123;</span><br><span class="line">                TreeNode&lt;K,V&gt; p = replacementTreeNode(e, <span class="keyword">null</span>);</span><br><span class="line">                <span class="keyword">if</span> (tl == <span class="keyword">null</span>)</span><br><span class="line">                    hd = p;</span><br><span class="line">                <span class="keyword">else</span> &#123;</span><br><span class="line">                    p.prev = tl;</span><br><span class="line">                    tl.next = p;</span><br><span class="line">                &#125;</span><br><span class="line">                tl = p;</span><br><span class="line">            &#125; <span class="keyword">while</span> ((e = e.next) != <span class="keyword">null</span>);</span><br><span class="line">            <span class="keyword">if</span> ((tab[index] = hd) != <span class="keyword">null</span>)</span><br><span class="line">                hd.treeify(tab);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**ä»çº¢é»‘æ ‘é™ä¸ºé“¾è¡¨çš„é˜ˆå€¼</span></span><br><span class="line"><span class="comment">     * The bin count threshold for untreeifying a (split) bin during a</span></span><br><span class="line"><span class="comment">     * resize operation. Should be less than TREEIFY_THRESHOLD, and at</span></span><br><span class="line"><span class="comment">     * most 6 to mesh with shrinkage detection under removal.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> UNTREEIFY_THRESHOLD = <span class="number">6</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**è½¬æ¢ä¸ºçº¢é»‘æ ‘çš„æ•°ç»„é˜ˆå€¼</span></span><br><span class="line"><span class="comment">     * The smallest table capacity for which bins may be treeified.</span></span><br><span class="line"><span class="comment">     * (Otherwise the table is resized if too many nodes in a bin.)</span></span><br><span class="line"><span class="comment">     * Should be at least 4 * TREEIFY_THRESHOLD to avoid conflicts</span></span><br><span class="line"><span class="comment">     * between resizing and treeification thresholds.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> MIN_TREEIFY_CAPACITY = <span class="number">64</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/** å“ˆç³»æ¡¶ï¼ˆè¡¨ï¼‰</span></span><br><span class="line"><span class="comment">     * The table, initialized on first use, and resized as</span></span><br><span class="line"><span class="comment">     * necessary. When allocated, length is always a power of two.</span></span><br><span class="line"><span class="comment">     * (We also tolerate length zero in some operations to allow</span></span><br><span class="line"><span class="comment">     * bootstrapping mechanics that are currently not needed.)</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">transient</span> Node&lt;K,V&gt;[] table;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Holds cached entrySet(). Note that AbstractMap fields are used</span></span><br><span class="line"><span class="comment">     * for keySet() and values().</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">transient</span> Set&lt;Map.Entry&lt;K,V&gt;&gt; entrySet;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**å½“å‰å“ˆå¸Œè¡¨å…ƒç´ ä¸ªæ•°</span></span><br><span class="line"><span class="comment">     * The number of key-value mappings contained in this map.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">transient</span> <span class="keyword">int</span> size;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**ä¿®æ”¹æ¬¡æ•°ï¼Œä¸åŒ…å«æ›¿æ¢</span></span><br><span class="line"><span class="comment">     * The number of times this HashMap has been structurally modified</span></span><br><span class="line"><span class="comment">     * Structural modifications are those that change the number of mappings in</span></span><br><span class="line"><span class="comment">     * the HashMap or otherwise modify its internal structure (e.g.,</span></span><br><span class="line"><span class="comment">     * rehash).  This field is used to make iterators on Collection-views of</span></span><br><span class="line"><span class="comment">     * the HashMap fail-fast.  (See ConcurrentModificationException).</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">transient</span> <span class="keyword">int</span> modCount;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**æ‰©å®¹é˜ˆå€¼ï¼Œå½“å“ˆå¸Œè¡¨å…ƒç´ è¶…è¿‡é˜ˆå€¼æ—¶è§¦å‘æ‰©å®¹ï¼Œ</span></span><br><span class="line"><span class="comment">     * The next size value at which to resize (capacity * load factor).</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@serial</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="comment">// (The javadoc description is true upon serialization.</span></span><br><span class="line">    <span class="comment">// Additionally, if the table array has not been allocated, this</span></span><br><span class="line">    <span class="comment">// field holds the initial array capacity, or zero signifying</span></span><br><span class="line">    <span class="comment">// DEFAULT_INITIAL_CAPACITY.)</span></span><br><span class="line">    <span class="keyword">int</span> threshold;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**è´Ÿè½½å› å­ï¼Œthreshold = capacity * loadFactor</span></span><br><span class="line"><span class="comment">     * The load factor for the hash table.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@serial</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">final</span> <span class="keyword">float</span> loadFactor;</span><br></pre></td></tr></table></figure>
<h4 id="%E6%97%A0%E5%BA%8F%2C%E5%8F%AF%E7%A9%BA" id="æ— åº-å¯ç©º">æ— åº,å¯ç©º</h4>
<p>æœªè§£å†³é—®é¢˜:ä¸ºä»€ä¹ˆæœ‰æ—¶å€™çœ‹èµ·æ¥æœ‰åºï¼Ÿ   ç­”ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br></pre></td><td class="code"><pre><span class="line"> </span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Associates the specified value with the specified key in this map.</span></span><br><span class="line"><span class="comment">     * If the map previously contained a mapping for the key, the old</span></span><br><span class="line"><span class="comment">     * value is replaced.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key key with which the specified value is to be associated</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> value value to be associated with the specified key</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> the previous value associated with &lt;tt&gt;key&lt;/tt&gt;, or</span></span><br><span class="line"><span class="comment">     *         &lt;tt&gt;null&lt;/tt&gt; if there was no mapping for &lt;tt&gt;key&lt;/tt&gt;.</span></span><br><span class="line"><span class="comment">     *         (A &lt;tt&gt;null&lt;/tt&gt; return can also indicate that the map</span></span><br><span class="line"><span class="comment">     *         previously associated &lt;tt&gt;null&lt;/tt&gt; with &lt;tt&gt;key&lt;/tt&gt;.)</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> V <span class="title">put</span><span class="params">(K key, V value)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> putVal(hash(key), key, value, <span class="keyword">false</span>, <span class="keyword">true</span>);</span><br><span class="line">    &#125;  </span><br><span class="line"><span class="comment">//====Keyä¸ºnullæƒ…å†µ</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//å‡è®¾ putVal(hash(null), null, value, false, true);</span></span><br><span class="line"><span class="comment">//å³ putVal(0, 0, value, false, true);</span></span><br><span class="line"><span class="comment">//ç”± if ((p = tab[i = (n - 1) &amp; hash]) == null)</span></span><br><span class="line"><span class="comment">// tab[i] = newNode(hash, key, value, null);</span></span><br><span class="line"><span class="comment">//å¾—tab[0]==null --&gt; tab[0] = newNode(hash, key, value, null);</span></span><br><span class="line"><span class="comment">//keyä¸ºnullæ”¾åœ¨tab[0]</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Computes key.hashCode() and spreads (XORs) higher bits of hash</span></span><br><span class="line"><span class="comment">     * to lower.  Because the table uses power-of-two masking, sets of</span></span><br><span class="line"><span class="comment">     * hashes that vary only in bits above the current mask will</span></span><br><span class="line"><span class="comment">     * always collide. (Among known examples are sets of Float keys</span></span><br><span class="line"><span class="comment">     * holding consecutive whole numbers in small tables.)  So we</span></span><br><span class="line"><span class="comment">     * apply a transform that spreads the impact of higher bits</span></span><br><span class="line"><span class="comment">     * downward. There is a tradeoff between speed, utility, and</span></span><br><span class="line"><span class="comment">     * quality of bit-spreading. Because many common sets of hashes</span></span><br><span class="line"><span class="comment">     * are already reasonably distributed (so don&#x27;t benefit from</span></span><br><span class="line"><span class="comment">     * spreading), and because we use trees to handle large sets of</span></span><br><span class="line"><span class="comment">     * collisions in bins, we just XOR some shifted bits in the</span></span><br><span class="line"><span class="comment">     * cheapest possible way to reduce systematic lossage, as well as</span></span><br><span class="line"><span class="comment">     * to incorporate impact of the highest bits that would otherwise</span></span><br><span class="line"><span class="comment">     * never be used in index calculations because of table bounds.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line"><span class="comment">//ä½œç”¨ï¼šåœ¨tableé•¿åº¦ä¸é•¿çš„æƒ…å†µä¸‹ï¼Œèƒ½è®©keyçš„hashå€¼çš„é«˜16ä½ä¹Ÿå‚ä¸è·¯ç”±è¿ç®—,</span></span><br><span class="line"><span class="comment">//å¼‚æˆ–ï¼šåŒ0å¼‚1</span></span><br><span class="line"><span class="comment">//h=0b 0010 0101 1010 1100 0011 1111 0010 1110</span></span><br><span class="line"><span class="comment">//  0b 0010 0101 1010 1100 0011 1111 0010 1110</span></span><br><span class="line"><span class="comment">//          ^</span></span><br><span class="line"><span class="comment">//  0b 0000 0000 0000 0000 0010 0101 1010 1100</span></span><br><span class="line"><span class="comment">//=&gt;   0010 0101 1010 1100 0001 1010 1000 0010</span></span><br><span class="line">    <span class="function"><span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> <span class="title">hash</span><span class="params">(Object key)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> h;</span><br><span class="line">        <span class="keyword">return</span> (key == <span class="keyword">null</span>) ? <span class="number">0</span> : (h = key.hashCode()) ^ (h &gt;&gt;&gt; <span class="number">16</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Implements Map.put and related methods</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> hash hash for key</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key the key</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> value the value to put</span></span><br><span class="line"><span class="comment">     * onlyIfAbsent  true==ã€‹keyå­˜åœ¨ï¼Œä¸æ’å…¥</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> onlyIfAbsent if true, don&#x27;t change existing value</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> evict if false, the table is in creation mode.</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> previous value, or null if none</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">final</span> V <span class="title">putVal</span><span class="params">(<span class="keyword">int</span> hash, K key, V value, <span class="keyword">boolean</span> onlyIfAbsent,</span></span></span><br><span class="line"><span class="function"><span class="params">                   <span class="keyword">boolean</span> evict)</span> </span>&#123;</span><br><span class="line">        <span class="comment">//tab å½“å‰æ•£åˆ—è¡¨</span></span><br><span class="line">        <span class="comment">//p å½“å‰æ•£åˆ—è¡¨å…ƒç´ </span></span><br><span class="line">        <span class="comment">//n å½“å‰æ•£åˆ—è¡¨æ•°ç»„é•¿åº¦</span></span><br><span class="line">        <span class="comment">//i è·¯ç”±å¯»å€ç»“æœ</span></span><br><span class="line">        Node&lt;K,V&gt;[] tab; Node&lt;K,V&gt; p; <span class="keyword">int</span> n, i;</span><br><span class="line">        <span class="comment">//å»¶è¿Ÿåˆå§‹åŒ–ï¼Œç¬¬ä¸€æ¬¡è°ƒç”¨putValæ—¶ä¼šåˆå§‹åŒ–hashMapå¯¹è±¡ä¸­æœ€æ¶ˆè€—å†…å­˜çš„æ•£åˆ—è¡¨</span></span><br><span class="line">        <span class="keyword">if</span> ((tab = table) == <span class="keyword">null</span> || (n = tab.length) == <span class="number">0</span>)</span><br><span class="line">            n = (tab = resize()).length;</span><br><span class="line">        <span class="comment">//æœ€ç®€å•æƒ…å†µï¼Œå¯»å€æ‰¾åˆ°çš„æ¡¶ä½ä¸ºnullï¼Œç›´æ¥æ”¾å…¥æ•°æ®</span></span><br><span class="line">        <span class="keyword">if</span> ((p = tab[i = (n - <span class="number">1</span>) &amp; hash]) == <span class="keyword">null</span>)</span><br><span class="line">            tab[i] = newNode(hash, key, value, <span class="keyword">null</span>);</span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">//e ä¸ä¸ºnull æ‰¾åˆ°äº†ä¸€ä¸ªä¸å½“å‰è¦æ’å…¥çš„key-valueä¸€è‡´çš„ keyå…ƒç´ </span></span><br><span class="line">            Node&lt;K,V&gt; e; K k;</span><br><span class="line">            <span class="comment">//è¡¨ç¤ºæ¡¶ä½ä¸­çš„è¯¥å…ƒç´ ä¸å½“å‰æ’å…¥å…ƒç´ keyå®Œå…¨ä¸€è‡´ï¼Œåç»­å°†æ›¿æ¢</span></span><br><span class="line">            <span class="keyword">if</span> (p.hash == hash &amp;&amp;</span><br><span class="line">                ((k = p.key) == key || (key != <span class="keyword">null</span> &amp;&amp; key.equals(k))))</span><br><span class="line">                e = p;</span><br><span class="line">            <span class="comment">//è¯¥å…ƒç´ å·²ç»æ ‘åŒ–æ—¶</span></span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span> (p <span class="keyword">instanceof</span> TreeNode)</span><br><span class="line">                e = ((TreeNode&lt;K,V&gt;)p).putTreeVal(<span class="keyword">this</span>, tab, hash, key, value);</span><br><span class="line">            <span class="comment">//é“¾è¡¨æ—¶ä¸”ä¸ç­‰äºå¤´å…ƒç´ ï¼Œå…ƒç´ ä¾æ¬¡æ¯”è¾ƒ</span></span><br><span class="line">            <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">for</span> (<span class="keyword">int</span> binCount = <span class="number">0</span>; ; ++binCount) &#123;</span><br><span class="line">                    <span class="comment">//æœ€åä¸€ä¸ªå…ƒç´ è¿˜æ‰¾ä¸åˆ°åŒæ’å…¥keyç›¸åŒçš„node</span></span><br><span class="line">                    <span class="keyword">if</span> ((e = p.next) == <span class="keyword">null</span>) &#123;</span><br><span class="line">                        <span class="comment">//æ’å…¥æœ€å</span></span><br><span class="line">                        p.next = newNode(hash, key, value, <span class="keyword">null</span>);</span><br><span class="line">                        <span class="comment">//é“¾è¡¨å…ƒç´ æ•°é‡å¤§äº8ï¼Œæ ‘åŒ–</span></span><br><span class="line">                        <span class="keyword">if</span> (binCount &gt;= TREEIFY_THRESHOLD - <span class="number">1</span>) <span class="comment">// -1 for 1st</span></span><br><span class="line">                            treeifyBin(tab, hash);</span><br><span class="line">                        <span class="keyword">break</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="comment">//é“¾è¡¨ä¸­æ‰¾åˆ°åŒæ’å…¥keyçš„nodeï¼Œæ›¿æ¢</span></span><br><span class="line">                    <span class="keyword">if</span> (e.hash == hash &amp;&amp;</span><br><span class="line">                        ((k = e.key) == key || (key != <span class="keyword">null</span> &amp;&amp; key.equals(k))))</span><br><span class="line">                        <span class="keyword">break</span>;</span><br><span class="line">                    p = e;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">//ä¸Šé¢çš„eå­˜åœ¨æ›¿æ¢å€¼</span></span><br><span class="line">            <span class="keyword">if</span> (e != <span class="keyword">null</span>) &#123; <span class="comment">// existing mapping for key</span></span><br><span class="line">                V oldValue = e.value;</span><br><span class="line">                <span class="keyword">if</span> (!onlyIfAbsent || oldValue == <span class="keyword">null</span>)</span><br><span class="line">                    e.value = value;</span><br><span class="line">                afterNodeAccess(e);</span><br><span class="line">                <span class="keyword">return</span> oldValue;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//è®°å½•ä¿®æ”¹æ¬¡æ•°ï¼Œæ›¿æ¢ä¸ç®—</span></span><br><span class="line">        ++modCount;</span><br><span class="line">        <span class="comment">//æ’å…¥åå®¹é‡å¤§äºæ‰©å®¹é˜ˆå€¼åˆ™æ‰©å®¹</span></span><br><span class="line">        <span class="keyword">if</span> (++size &gt; threshold)</span><br><span class="line">            resize();</span><br><span class="line">        afterNodeInsertion(evict);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<h4 id="get()" id="GET">GET()</h4>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Returns the value to which the specified key is mapped,</span></span><br><span class="line"><span class="comment"> * or &#123;<span class="doctag">@code</span> null&#125; if this map contains no mapping for the key.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;More formally, if this map contains a mapping from a key</span></span><br><span class="line"><span class="comment"> * &#123;<span class="doctag">@code</span> k&#125; to a value &#123;<span class="doctag">@code</span> v&#125; such that &#123;<span class="doctag">@code</span> (key==null ? k==null :</span></span><br><span class="line"><span class="comment"> * key.equals(k))&#125;, then this method returns &#123;<span class="doctag">@code</span> v&#125;; otherwise</span></span><br><span class="line"><span class="comment"> * it returns &#123;<span class="doctag">@code</span> null&#125;.  (There can be at most one such mapping.)</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;A return value of &#123;<span class="doctag">@code</span> null&#125; does not &lt;i&gt;necessarily&lt;/i&gt;</span></span><br><span class="line"><span class="comment"> * indicate that the map contains no mapping for the key; it&#x27;s also</span></span><br><span class="line"><span class="comment"> * possible that the map explicitly maps the key to &#123;<span class="doctag">@code</span> null&#125;.</span></span><br><span class="line"><span class="comment"> * The &#123;<span class="doctag">@link</span> #containsKey containsKey&#125; operation may be used to</span></span><br><span class="line"><span class="comment"> * distinguish these two cases.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@see</span> #put(Object, Object)</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> V <span class="title">get</span><span class="params">(Object key)</span> </span>&#123;</span><br><span class="line">    Node&lt;K,V&gt; e;</span><br><span class="line">    <span class="keyword">return</span> (e = getNode(hash(key), key)) == <span class="keyword">null</span> ? <span class="keyword">null</span> : e.value;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Implements Map.get and related methods.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> hash hash for key</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> key the key</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> the node, or null if none</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">final</span> Node&lt;K,V&gt; <span class="title">getNode</span><span class="params">(<span class="keyword">int</span> hash, Object key)</span> </span>&#123;</span><br><span class="line">    <span class="comment">//tab:å¼•ç”¨å½“å‰ hashmapçš„æ•£åˆ—è¡¨</span></span><br><span class="line">    <span class="comment">//first:æ¡¶ä½ä¸­çš„å¤´å…ƒç´ </span></span><br><span class="line">    <span class="comment">//e:ä¸´æ—¶nodeå…ƒç´ </span></span><br><span class="line">    <span class="comment">//n: tableæ•°ç»„é•¿åº¦</span></span><br><span class="line">    Node&lt;K,V&gt;[] tab; Node&lt;K,V&gt; first, e; <span class="keyword">int</span> n; K k;</span><br><span class="line">    <span class="keyword">if</span> ((tab = table) != <span class="keyword">null</span> &amp;&amp; (n = tab.length) &gt; <span class="number">0</span> &amp;&amp;</span><br><span class="line">        (first = tab[(n - <span class="number">1</span>) &amp; hash]) != <span class="keyword">null</span>) &#123;</span><br><span class="line">        <span class="comment">//ç¬¬ä¸€ç§æƒ…å†µï¼šå®šä½å‡ºæ¥çš„æ¡¶ä½å…ƒç´ å³ä¸ºå’±ä»¬è¦getçš„æ•°æ®</span></span><br><span class="line">        <span class="keyword">if</span> (first.hash == hash &amp;&amp; <span class="comment">// always check first node</span></span><br><span class="line">            ((k = first.key) == key || (key != <span class="keyword">null</span> &amp;&amp; key.equals(k))))</span><br><span class="line">            <span class="keyword">return</span> first;</span><br><span class="line">        <span class="comment">//è¯´æ˜å½“å‰æ¡¶ä½ä¸æ­¢ä¸€ä¸ªå…ƒç´ ï¼Œå¯èƒ½æ˜¯é“¾è¡¨ä¹Ÿå¯èƒ½æ˜¯çº¢é»‘æ ‘</span></span><br><span class="line">        <span class="keyword">if</span> ((e = first.next) != <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="comment">//ç¬¬äºŒç§æƒ…å†µï¼Œæ¡¶å‡çº§æˆäº†çº¢é»‘æ ‘</span></span><br><span class="line">            <span class="keyword">if</span> (first <span class="keyword">instanceof</span> TreeNode)</span><br><span class="line">                <span class="keyword">return</span> ((TreeNode&lt;K,V&gt;)first).getTreeNode(hash, key);</span><br><span class="line">            <span class="comment">//æ¡¶å½¢æˆäº†é“¾è¡¨</span></span><br><span class="line">            <span class="keyword">do</span> &#123;</span><br><span class="line">                <span class="keyword">if</span> (e.hash == hash &amp;&amp;</span><br><span class="line">                    ((k = e.key) == key || (key != <span class="keyword">null</span> &amp;&amp; key.equals(k))))</span><br><span class="line">                    <span class="keyword">return</span> e;</span><br><span class="line">            &#125; <span class="keyword">while</span> ((e = e.next) != <span class="keyword">null</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="remove%EF%BC%88%EF%BC%89" id="Removeï¼ˆï¼‰">Removeï¼ˆï¼‰</h4>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Implements Map.remove and related methods.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> hash hash for key</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> key the key</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> value the value to match if matchValue, else ignored</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> matchValue if true only remove if value is equal</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> movable if false do not move other nodes while removing</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> the node, or null if none</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">final</span> Node&lt;K,V&gt; <span class="title">removeNode</span><span class="params">(<span class="keyword">int</span> hash, Object key, Object value,</span></span></span><br><span class="line"><span class="function"><span class="params">                           <span class="keyword">boolean</span> matchValue, <span class="keyword">boolean</span> movable)</span> </span>&#123;</span><br><span class="line">    <span class="comment">//tab:å¼•ç”¨å½“å‰ hashmapä¸­çš„æ•£åˆ—è¡¨</span></span><br><span class="line">    <span class="comment">//p:å½“å‰nodeå…ƒç´ </span></span><br><span class="line">    <span class="comment">//n:è¡¨ç¤ºæ•£åˆ—è¡¨æ•°ç»„é•¿åº¦</span></span><br><span class="line">    <span class="comment">//index:è¡¨ç¤ºå¯»å€ç»“æœ</span></span><br><span class="line">    Node&lt;K,V&gt;[] tab; Node&lt;K,V&gt; p; <span class="keyword">int</span> n, index;</span><br><span class="line">    <span class="keyword">if</span> ((tab = table) != <span class="keyword">null</span> &amp;&amp; (n = tab.length) &gt; <span class="number">0</span> &amp;&amp;</span><br><span class="line">        (p = tab[index = (n - <span class="number">1</span>) &amp; hash]) != <span class="keyword">null</span>) &#123;</span><br><span class="line">        <span class="comment">//è¯´æ˜è·¯ç”±çš„æ¡¶ä½æ˜¯æœ‰æ•°æ®çš„ï¼Œéœ€è¦è¿›è¡ŒæŸ¥æ‰¾æ“ä½œï¼Œå¹¶ä¸”åˆ é™¤</span></span><br><span class="line">        <span class="comment">//node:æŸ¥æ‰¾åˆ°çš„ç»“æœ</span></span><br><span class="line">        <span class="comment">//e:å½“å‰Nodeçš„ä¸‹ä¸€ä¸ªå…ƒç´ </span></span><br><span class="line">        Node&lt;K,V&gt; node = <span class="keyword">null</span>, e; K k; V v;</span><br><span class="line">        <span class="keyword">if</span> (p.hash == hash &amp;&amp;</span><br><span class="line">            ((k = p.key) == key || (key != <span class="keyword">null</span> &amp;&amp; key.equals(k))))</span><br><span class="line">            node = p;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> ((e = p.next) != <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="comment">//è¯´æ˜ï¼Œå½“å‰æ¡¶ä½è¦ä¹ˆæ˜¯é“¾è¡¨è¦ä¹ˆæ˜¯çº¢é»‘æ ‘</span></span><br><span class="line">            <span class="keyword">if</span> (p <span class="keyword">instanceof</span> TreeNode)<span class="comment">//åˆ¤æ–­å½“å‰æ¡¶ä½æ˜¯å¦å‡çº§ä¸ºçº¢é»‘æ ‘äº†</span></span><br><span class="line">                <span class="comment">//ç¬¬äºŒç§æƒ…å†µï¼šçº¢é»‘æ ‘æŸ¥æ‰¾</span></span><br><span class="line">                node = ((TreeNode&lt;K,V&gt;)p).getTreeNode(hash, key);</span><br><span class="line">            <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="comment">//ç¬¬ä¸‰ç§é“¾è¡¨</span></span><br><span class="line">                <span class="keyword">do</span> &#123;</span><br><span class="line">                    <span class="keyword">if</span> (e.hash == hash &amp;&amp;</span><br><span class="line">                        ((k = e.key) == key ||</span><br><span class="line">                         (key != <span class="keyword">null</span> &amp;&amp; key.equals(k)))) &#123;</span><br><span class="line">                        node = e;</span><br><span class="line">                        <span class="keyword">break</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                    p = e;</span><br><span class="line">                &#125; <span class="keyword">while</span> ((e = e.next) != <span class="keyword">null</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//åˆ¤æ–­nodeä¸ä¸ºç©ºçš„è¯ï¼Œè¯´æ˜æŒ‰ç…§keyæŸ»æ‰¾åˆ°éœ€è¦åˆ é™¤çš„æ•°æ®äº†</span></span><br><span class="line">        <span class="keyword">if</span> (node != <span class="keyword">null</span> &amp;&amp; (!matchValue || (v = node.value) == value ||</span><br><span class="line">                             (value != <span class="keyword">null</span> &amp;&amp; value.equals(v)))) &#123;</span><br><span class="line">            <span class="comment">//ç¬¬ä¸€ç§æƒ…æ³ï¼šnodeæ˜¯æ ‘èŠ‚ç‚¹ï¼Œè¯´æ˜éœ€è¦è¿›è¡Œæ ‘èŠ‚ç‚¹ç§»é™¤æ“ä½œ</span></span><br><span class="line">            <span class="keyword">if</span> (node <span class="keyword">instanceof</span> TreeNode)</span><br><span class="line">                ((TreeNode&lt;K,V&gt;)node).removeTreeNode(<span class="keyword">this</span>, tab, movable);</span><br><span class="line">            <span class="comment">//ç¬¬äºŒç§æƒ…æ³ï¼šæ¡¶ä½å…ƒç´ å³ä¸ºæŸ»æ‰¾ç»“æœï¼Œåˆ™å°†è¯¥å…ƒç´ çš„ä¸‹ä¸€ä¸ªå…ƒç´ æ”¾è‡³æ¡¶ä½ä¸­</span></span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span> (node == p)</span><br><span class="line">                tab[index] = node.next;</span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">                <span class="comment">//ç¬¬ä¸‰ç§æƒ…æ³ï¼šå°†å½“å‰å…ƒç´ pçš„ä¸‹ä¸€ä¸ªå…ƒç´ è®¾ç½®æˆè¦åˆ é™¤å…ƒç´ çš„ä¸‹ä¸€ä¸ªå…ƒç´ </span></span><br><span class="line">                p.next = node.next;</span><br><span class="line">            ++modCount;</span><br><span class="line">            --size;</span><br><span class="line">            afterNodeRemoval(node);</span><br><span class="line">            <span class="keyword">return</span> node;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="%E6%9E%84%E9%80%A0%E6%96%B9%E6%B3%95" id="æ„é€ æ–¹æ³•">æ„é€ æ–¹æ³•</h4>
<p>ï¼š&gt;&gt;&gt;æ— ç¬¦å·å³ç§»ï¼Œå¿½ç•¥ç¬¦å·ä½ï¼Œç©ºä½éƒ½ä»¥0è¡¥é½</p>
<p><img src="https://gitee.com/mychimei/picture/raw/master/work/image-20211206204016669.png" alt="image-20211206204016669" /></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* ---------------- Public operations -------------- */</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Constructs an empty &lt;tt&gt;HashMap&lt;/tt&gt; with the specified initial</span></span><br><span class="line"><span class="comment">     * capacity and load factor.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span>  initialCapacity the initial capacity</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span>  loadFactor      the load factor</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> IllegalArgumentException if the initial capacity is negative</span></span><br><span class="line"><span class="comment">     *         or the load factor is nonpositive</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">HashMap</span><span class="params">(<span class="keyword">int</span> initialCapacity, <span class="keyword">float</span> loadFactor)</span> </span>&#123;</span><br><span class="line">        <span class="comment">//é™åˆ¶æ•°ç»„ä¸loadFactor 0&lt;initialCapacity&lt;MAXIMUM_CAPACITY</span></span><br><span class="line">        <span class="comment">// loadFactor&gt;0</span></span><br><span class="line">        <span class="keyword">if</span> (initialCapacity &lt; <span class="number">0</span>)</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(<span class="string">&quot;Illegal initial capacity: &quot;</span> +</span><br><span class="line">                                               initialCapacity);</span><br><span class="line">        <span class="keyword">if</span> (initialCapacity &gt; MAXIMUM_CAPACITY)</span><br><span class="line">            initialCapacity = MAXIMUM_CAPACITY;</span><br><span class="line">        <span class="keyword">if</span> (loadFactor &lt;= <span class="number">0</span> || Float.isNaN(loadFactor))</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(<span class="string">&quot;Illegal load factor: &quot;</span> +</span><br><span class="line">                                               loadFactor);</span><br><span class="line">        <span class="keyword">this</span>.loadFactor = loadFactor;</span><br><span class="line">        <span class="comment">//tableSizeFor è¿”å›ä¸€ä¸ªå¤§äºç­‰äºå½“å‰capçš„ä¸€ä¸ªæ•°å­—ï¼Œå¹¶ä¸”è¿™ä¸ªæ•°å­—ä¸€å®šæ˜¯2çš„æ¬¡æ–¹æ•°ï¼Œæºç å¦‚ä¸‹ï¼š</span></span><br><span class="line">        <span class="keyword">this</span>.threshold = tableSizeFor(initialCapacity);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**è¿”å›ä¸€ä¸ªå¤§äºç­‰äºå½“å‰capçš„ä¸€ä¸ªæ•°å­—ï¼Œå¹¶ä¸”è¿™ä¸ªæ•°å­—ä¸€å®šæ˜¯2çš„æ¬¡æ–¹æ•°ï¼š</span></span><br><span class="line"><span class="comment">     * &gt;&gt;&gt;ï¼šæ— ç¬¦å·å³ç§»ï¼Œå¿½ç•¥ç¬¦å·ä½ï¼Œç©ºä½éƒ½ä»¥0è¡¥é½</span></span><br><span class="line"><span class="comment">     * Returns a power of two size for the given target capacity.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> <span class="title">tableSizeFor</span><span class="params">(<span class="keyword">int</span> cap)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> n = cap - <span class="number">1</span>;</span><br><span class="line">        n |= n &gt;&gt;&gt; <span class="number">1</span>;</span><br><span class="line">        n |= n &gt;&gt;&gt; <span class="number">2</span>;</span><br><span class="line">        n |= n &gt;&gt;&gt; <span class="number">4</span>;</span><br><span class="line">        n |= n &gt;&gt;&gt; <span class="number">8</span>;</span><br><span class="line">        n |= n &gt;&gt;&gt; <span class="number">16</span>;</span><br><span class="line">        <span class="keyword">return</span> (n &lt; <span class="number">0</span>) ? <span class="number">1</span> : (n &gt;= MAXIMUM_CAPACITY) ? MAXIMUM_CAPACITY : n + <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Constructs an empty &lt;tt&gt;HashMap&lt;/tt&gt; with the specified initial</span></span><br><span class="line"><span class="comment">     * capacity and the default load factor (0.75).</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span>  initialCapacity the initial capacity.</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> IllegalArgumentException if the initial capacity is negative.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">HashMap</span><span class="params">(<span class="keyword">int</span> initialCapacity)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>(initialCapacity, DEFAULT_LOAD_FACTOR);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Constructs an empty &lt;tt&gt;HashMap&lt;/tt&gt; with the default initial capacity</span></span><br><span class="line"><span class="comment">     * (16) and the default load factor (0.75).</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">HashMap</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.loadFactor = DEFAULT_LOAD_FACTOR; <span class="comment">// all other fields defaulted</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Constructs a new &lt;tt&gt;HashMap&lt;/tt&gt; with the same mappings as the</span></span><br><span class="line"><span class="comment">     * specified &lt;tt&gt;Map&lt;/tt&gt;.  The &lt;tt&gt;HashMap&lt;/tt&gt; is created with</span></span><br><span class="line"><span class="comment">     * default load factor (0.75) and an initial capacity sufficient to</span></span><br><span class="line"><span class="comment">     * hold the mappings in the specified &lt;tt&gt;Map&lt;/tt&gt;.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span>   m the map whose mappings are to be placed in this map</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span>  NullPointerException if the specified map is null</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">HashMap</span><span class="params">(Map&lt;? extends K, ? extends V&gt; m)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.loadFactor = DEFAULT_LOAD_FACTOR;</span><br><span class="line">        putMapEntries(m, <span class="keyword">false</span>);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<h3 id="linkedhashmap" id="LinkedHashMap">LinkedHashMap</h3>
<table>
<thead>
<tr>
<th>ç‰¹ç‚¹</th>
<th>åŸå› ï¼ˆæºç ï¼‰</th>
<th></th>
</tr>
</thead>
<tbody>
<tr>
<td>åº•å±‚å“ˆå¸Œè¡¨+åŒå‘é“¾è¡¨ï¼ŒHashMapå­ç±»</td>
<td><a href="#%E5%BA%95%E5%B1%82">åº•å±‚</a></td>
<td></td>
</tr>
<tr>
<td>çº¿ç¨‹ä¸å®‰å…¨</td>
<td>æ–¹æ³•ä¸­æ²¡æœ‰synchronized</td>
<td></td>
</tr>
<tr>
<td><strong>æœ‰åº</strong></td>
<td><a href="#%E6%9C%89%E5%BA%8F">æœ‰åº</a></td>
<td></td>
</tr>
<tr>
<td>å¤šç©ºé”®å€¼æˆ–å•ç©ºé”®æˆ–å€¼</td>
<td>åŒHashMap</td>
<td></td>
</tr>
<tr>
<td>æ‰©å®¹ä¸¤å€</td>
<td>åŒhashmap</td>
<td></td>
</tr>
</tbody>
</table>
<h4 id="%E5%BA%95%E5%B1%82-2" id="åº•å±‚-v3">åº•å±‚</h4>
<p>putã€resizeæ‰©å®¹å‡ä½¿ç”¨HashMapçš„æ–¹æ³•ï¼Œæ‹¥æœ‰HashMapæ‰€æœ‰ç‰¹æ€§ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LinkedHashMap</span>&lt;<span class="title">K</span>,<span class="title">V</span>&gt;</span></span><br><span class="line"><span class="class">    <span class="keyword">extends</span> <span class="title">HashMap</span>&lt;<span class="title">K</span>,<span class="title">V</span>&gt;</span></span><br><span class="line"><span class="class">    <span class="keyword">implements</span> <span class="title">Map</span>&lt;<span class="title">K</span>,<span class="title">V</span>&gt;</span></span><br><span class="line"><span class="class"></span>&#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * HashMap.Node subclass for normal LinkedHashMap entries.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">Entry</span>&lt;<span class="title">K</span>,<span class="title">V</span>&gt; <span class="keyword">extends</span> <span class="title">HashMap</span>.<span class="title">Node</span>&lt;<span class="title">K</span>,<span class="title">V</span>&gt; </span>&#123;</span><br><span class="line">        Entry&lt;K,V&gt; before, after;</span><br><span class="line">        Entry(<span class="keyword">int</span> hash, K key, V value, Node&lt;K,V&gt; next) &#123;</span><br><span class="line">            <span class="keyword">super</span>(hash, key, value, next);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/**åŒå‘é“¾è¡¨å¤´</span></span><br><span class="line"><span class="comment">     * The head (eldest) of the doubly linked list.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">transient</span> LinkedHashMap.Entry&lt;K,V&gt; head;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**åŒå‘é“¾è¡¨å°¾</span></span><br><span class="line"><span class="comment">     * The tail (youngest) of the doubly linked list.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">transient</span> LinkedHashMap.Entry&lt;K,V&gt; tail;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * The iteration ordering method for this linked hash map: &lt;tt&gt;true&lt;/tt&gt;</span></span><br><span class="line"><span class="comment">     * for access-order, &lt;tt&gt;false&lt;/tt&gt; for insertion-order.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@serial</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">final</span> <span class="keyword">boolean</span> accessOrder;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Constructs an empty insertion-ordered &lt;tt&gt;LinkedHashMap&lt;/tt&gt; instance</span></span><br><span class="line"><span class="comment">     * with the specified initial capacity and a default load factor (0.75).</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span>  initialCapacity the initial capacity</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> IllegalArgumentException if the initial capacity is negative</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">LinkedHashMap</span><span class="params">(<span class="keyword">int</span> initialCapacity)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>(initialCapacity);</span><br><span class="line">        accessOrder = <span class="keyword">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Constructs an empty insertion-ordered &lt;tt&gt;LinkedHashMap&lt;/tt&gt; instance</span></span><br><span class="line"><span class="comment">     * with the default initial capacity (16) and load factor (0.75).</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">LinkedHashMap</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>();</span><br><span class="line">        accessOrder = <span class="keyword">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Constructs an insertion-ordered &lt;tt&gt;LinkedHashMap&lt;/tt&gt; instance with</span></span><br><span class="line"><span class="comment">     * the same mappings as the specified map.  The &lt;tt&gt;LinkedHashMap&lt;/tt&gt;</span></span><br><span class="line"><span class="comment">     * instance is created with a default load factor (0.75) and an initial</span></span><br><span class="line"><span class="comment">     * capacity sufficient to hold the mappings in the specified map.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span>  m the map whose mappings are to be placed in this map</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> NullPointerException if the specified map is null</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">LinkedHashMap</span><span class="params">(Map&lt;? extends K, ? extends V&gt; m)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>();</span><br><span class="line">        accessOrder = <span class="keyword">false</span>;</span><br><span class="line">        putMapEntries(m, <span class="keyword">false</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Constructs an empty &lt;tt&gt;LinkedHashMap&lt;/tt&gt; instance with the</span></span><br><span class="line"><span class="comment">     * specified initial capacity, load factor and ordering mode.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span>  initialCapacity the initial capacity</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span>  loadFactor      the load factor</span></span><br><span class="line"><span class="comment">     *=====æ­¤æ„é€ æ–¹æ³•accessOrderä¸ºtrueæ—¶å®ç°äº†æŒ‰è®¿é—®é¡ºåºå­˜å‚¨å…ƒç´ ======</span></span><br><span class="line"><span class="comment">     *<span class="doctag">@param</span>  accessOrder     the ordering mode - &lt;tt&gt;true&lt;/tt&gt; for access-order, &lt;tt&gt;false&lt;/tt&gt; for insertion-order</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> IllegalArgumentException if the initial capacity is negative</span></span><br><span class="line"><span class="comment">     *         or the load factor is nonpositive</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">LinkedHashMap</span><span class="params">(<span class="keyword">int</span> initialCapacity,</span></span></span><br><span class="line"><span class="function"><span class="params">                         <span class="keyword">float</span> loadFactor,</span></span></span><br><span class="line"><span class="function"><span class="params">                         <span class="keyword">boolean</span> accessOrder)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>(initialCapacity, loadFactor);</span><br><span class="line">        <span class="keyword">this</span>.accessOrder = accessOrder;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h4 id="%E6%9C%89%E5%BA%8F" id="æœ‰åº">æœ‰åº</h4>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br></pre></td><td class="code"><pre><span class="line">     <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * HashMap.Node subclass for normal LinkedHashMap entries.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">Entry</span>&lt;<span class="title">K</span>,<span class="title">V</span>&gt; <span class="keyword">extends</span> <span class="title">HashMap</span>.<span class="title">Node</span>&lt;<span class="title">K</span>,<span class="title">V</span>&gt; </span>&#123;</span><br><span class="line">        <span class="comment">//è®°å½•ç›¸é‚»ä¸¤ä¸ªkey-valueå¯¹è±¡</span></span><br><span class="line">        Entry&lt;K,V&gt; before, after;</span><br><span class="line">        Entry(<span class="keyword">int</span> hash, K key, V value, Node&lt;K,V&gt; next) &#123;</span><br><span class="line">            <span class="keyword">super</span>(hash, key, value, next);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/**åŒå‘é“¾è¡¨å¤´</span></span><br><span class="line"><span class="comment">     * The head (eldest) of the doubly linked list.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">transient</span> LinkedHashMap.Entry&lt;K,V&gt; head;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**åŒå‘é“¾è¡¨å°¾</span></span><br><span class="line"><span class="comment">     * The tail (youngest) of the doubly linked list.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">transient</span> LinkedHashMap.Entry&lt;K,V&gt; tail;</span><br><span class="line"><span class="comment">/**====falseåˆ™æŒ‰æ’å…¥é¡ºåºå­˜å‚¨å…ƒç´ ï¼Œå¦‚æœæ˜¯trueåˆ™æŒ‰è®¿é—®é¡ºåºå­˜å‚¨å…ƒç´ </span></span><br><span class="line"><span class="comment">     * The iteration ordering method for this linked hash map: &lt;tt&gt;true&lt;/tt&gt;</span></span><br><span class="line"><span class="comment">     * for access-order, &lt;tt&gt;false&lt;/tt&gt; for insertion-order.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@serial</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">final</span> <span class="keyword">boolean</span> accessOrder;</span><br><span class="line"></span><br><span class="line">    <span class="function">Node&lt;K,V&gt; <span class="title">newNode</span><span class="params">(<span class="keyword">int</span> hash, K key, V value, Node&lt;K,V&gt; e)</span> </span>&#123;</span><br><span class="line">        LinkedHashMap.Entry&lt;K,V&gt; p =</span><br><span class="line">            <span class="keyword">new</span> LinkedHashMap.Entry&lt;K,V&gt;(hash, key, value, e);</span><br><span class="line">        linkNodeLast(p);</span><br><span class="line">        <span class="keyword">return</span> p;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * The iteration ordering method for this linked hash map: &lt;tt&gt;true&lt;/tt&gt;</span></span><br><span class="line"><span class="comment">     * for access-order, &lt;tt&gt;false&lt;/tt&gt; for insertion-order.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@serial</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">final</span> <span class="keyword">boolean</span> accessOrder;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// internal utilities</span></span><br><span class="line"><span class="comment">//å®ç°æœ‰åºçš„æ–¹æ³•</span></span><br><span class="line"><span class="comment">//ä¸¾ä¾‹:æ”¾å…¥1,2,3</span></span><br><span class="line"><span class="comment">//1è¿›ï¼šhead=tail=1  last=null  </span></span><br><span class="line"><span class="comment">//    3è¿›ï¼štail=last=1--ã€‹tail=3  3.before=1 --ã€‹ 1.after=3</span></span><br><span class="line"> <span class="comment">//   	2è¿›ï¼štail=last=3--ã€‹tail=2  2.before=3 --ã€‹ 3.after=2</span></span><br><span class="line">    <span class="comment">// link at the end of list</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">linkNodeLast</span><span class="params">(LinkedHashMap.Entry&lt;K,V&gt; p)</span> </span>&#123;</span><br><span class="line">        LinkedHashMap.Entry&lt;K,V&gt; last = tail;</span><br><span class="line">        tail = p;</span><br><span class="line">        <span class="keyword">if</span> (last == <span class="keyword">null</span>)</span><br><span class="line">            head = p;</span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">            p.before = last;</span><br><span class="line">            last.after = p;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//HashMapçš„Node===============</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Basic hash bin node, used for most entries.  (See below for</span></span><br><span class="line"><span class="comment">     * TreeNode subclass, and in LinkedHashMap for its Entry subclass.)</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">Node</span>&lt;<span class="title">K</span>,<span class="title">V</span>&gt; <span class="keyword">implements</span> <span class="title">Map</span>.<span class="title">Entry</span>&lt;<span class="title">K</span>,<span class="title">V</span>&gt; </span>&#123;</span><br><span class="line">        <span class="keyword">final</span> <span class="keyword">int</span> hash;</span><br><span class="line">        <span class="keyword">final</span> K key;</span><br><span class="line">        V value;</span><br><span class="line">        Node&lt;K,V&gt; next;</span><br><span class="line"></span><br><span class="line">        Node(<span class="keyword">int</span> hash, K key, V value, Node&lt;K,V&gt; next) &#123;</span><br><span class="line">            <span class="keyword">this</span>.hash = hash;</span><br><span class="line">            <span class="keyword">this</span>.key = key;</span><br><span class="line">            <span class="keyword">this</span>.value = value;</span><br><span class="line">            <span class="keyword">this</span>.next = next;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">final</span> K <span class="title">getKey</span><span class="params">()</span>        </span>&#123; <span class="keyword">return</span> key; &#125;</span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">final</span> V <span class="title">getValue</span><span class="params">()</span>      </span>&#123; <span class="keyword">return</span> value; &#125;</span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">final</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123; <span class="keyword">return</span> key + <span class="string">&quot;=&quot;</span> + value; &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">int</span> <span class="title">hashCode</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> Objects.hashCode(key) ^ Objects.hashCode(value);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">final</span> V <span class="title">setValue</span><span class="params">(V newValue)</span> </span>&#123;</span><br><span class="line">            V oldValue = value;</span><br><span class="line">            value = newValue;</span><br><span class="line">            <span class="keyword">return</span> oldValue;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">boolean</span> <span class="title">equals</span><span class="params">(Object o)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">if</span> (o == <span class="keyword">this</span>)</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">            <span class="keyword">if</span> (o <span class="keyword">instanceof</span> Map.Entry) &#123;</span><br><span class="line">                Map.Entry&lt;?,?&gt; e = (Map.Entry&lt;?,?&gt;)o;</span><br><span class="line">                <span class="keyword">if</span> (Objects.equals(key, e.getKey()) &amp;&amp;</span><br><span class="line">                    Objects.equals(value, e.getValue()))</span><br><span class="line">                    <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<h3 id="treemap" id="TreeMap">TreeMap</h3>
<table>
<thead>
<tr>
<th>ç‰¹ç‚¹</th>
<th>åŸå› ï¼ˆæºç ï¼‰</th>
<th></th>
</tr>
</thead>
<tbody>
<tr>
<td>åº•å±‚äºŒå‰æ ‘ã€çº¢é»‘æ ‘ã€‘</td>
<td><a href="#%E5%BA%95%E5%B1%82%E7%BA%A2%E9%BB%91%E6%A0%91">åº•å±‚çº¢é»‘æ ‘</a></td>
<td></td>
</tr>
<tr>
<td>çº¿ç¨‹ä¸å®‰å…¨</td>
<td>æ–¹æ³•ä¸­æ²¡æœ‰synchronized</td>
<td></td>
</tr>
<tr>
<td>æœ‰åºï¼Œæ¯”è¾ƒé€šè¿‡key</td>
<td><a href="#%E5%BA%95%E5%B1%82%E7%BA%A2%E9%BB%91%E6%A0%91">åº•å±‚çº¢é»‘æ ‘</a></td>
<td></td>
</tr>
<tr>
<td>å¤šå€¼å¯ç©º</td>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
</tr>
</tbody>
</table>
<h4 id="%E5%BA%95%E5%B1%82%E7%BA%A2%E9%BB%91%E6%A0%91" id="åº•å±‚çº¢é»‘æ ‘">åº•å±‚çº¢é»‘æ ‘</h4>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//NavigableMapæ¥å£æä¾›é’ˆå¯¹Keyçš„æœ‰åºè®¿é—®ï¼Œ</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TreeMap</span>&lt;<span class="title">K</span>,<span class="title">V</span>&gt;</span></span><br><span class="line"><span class="class">    <span class="keyword">extends</span> <span class="title">AbstractMap</span>&lt;<span class="title">K</span>,<span class="title">V</span>&gt;</span></span><br><span class="line"><span class="class">    <span class="keyword">implements</span> <span class="title">NavigableMap</span>&lt;<span class="title">K</span>,<span class="title">V</span>&gt;, <span class="title">Cloneable</span>, <span class="title">java</span>.<span class="title">io</span>.<span class="title">Serializable</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * The comparator used to maintain order in this tree map, or</span></span><br><span class="line"><span class="comment">     * null if it uses the natural ordering of its keys.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@serial</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Comparator&lt;? <span class="keyword">super</span> K&gt; comparator;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">transient</span> Entry&lt;K,V&gt; root;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * The number of entries in the tree</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">transient</span> <span class="keyword">int</span> size = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * The number of structural modifications to the tree.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">transient</span> <span class="keyword">int</span> modCount = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"> <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Node in the Tree.  Doubles as a means to pass key-value pairs back to</span></span><br><span class="line"><span class="comment">     * user (see Map.Entry).</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">Entry</span>&lt;<span class="title">K</span>,<span class="title">V</span>&gt; <span class="keyword">implements</span> <span class="title">Map</span>.<span class="title">Entry</span>&lt;<span class="title">K</span>,<span class="title">V</span>&gt; </span>&#123;</span><br><span class="line">        K key;</span><br><span class="line">        V value;</span><br><span class="line">        Entry&lt;K,V&gt; left;</span><br><span class="line">        Entry&lt;K,V&gt; right;</span><br><span class="line">        Entry&lt;K,V&gt; parent;</span><br><span class="line">        <span class="keyword">boolean</span> color = BLACK;</span><br><span class="line"></span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * Make a new cell with given key, value, and parent, and with</span></span><br><span class="line"><span class="comment">         * &#123;<span class="doctag">@code</span> null&#125; child links, and BLACK color.</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        Entry(K key, V value, Entry&lt;K,V&gt; parent) &#123;</span><br><span class="line">            <span class="keyword">this</span>.key = key;</span><br><span class="line">            <span class="keyword">this</span>.value = value;</span><br><span class="line">            <span class="keyword">this</span>.parent = parent;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * Returns the key.</span></span><br><span class="line"><span class="comment">         *</span></span><br><span class="line"><span class="comment">         * <span class="doctag">@return</span> the key</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> K <span class="title">getKey</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> key;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * Returns the value associated with the key.</span></span><br><span class="line"><span class="comment">         *</span></span><br><span class="line"><span class="comment">         * <span class="doctag">@return</span> the value associated with the key</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> V <span class="title">getValue</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> value;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * Replaces the value currently associated with the key with the given</span></span><br><span class="line"><span class="comment">         * value.</span></span><br><span class="line"><span class="comment">         *</span></span><br><span class="line"><span class="comment">         * <span class="doctag">@return</span> the value associated with the key before this method was</span></span><br><span class="line"><span class="comment">         *         called</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> V <span class="title">setValue</span><span class="params">(V value)</span> </span>&#123;</span><br><span class="line">            V oldValue = <span class="keyword">this</span>.value;</span><br><span class="line">            <span class="keyword">this</span>.value = value;</span><br><span class="line">            <span class="keyword">return</span> oldValue;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">equals</span><span class="params">(Object o)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">if</span> (!(o <span class="keyword">instanceof</span> Map.Entry))</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">            Map.Entry&lt;?,?&gt; e = (Map.Entry&lt;?,?&gt;)o;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">return</span> valEquals(key,e.getKey()) &amp;&amp; valEquals(value,e.getValue());</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">hashCode</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            <span class="keyword">int</span> keyHash = (key==<span class="keyword">null</span> ? <span class="number">0</span> : key.hashCode());</span><br><span class="line">            <span class="keyword">int</span> valueHash = (value==<span class="keyword">null</span> ? <span class="number">0</span> : value.hashCode());</span><br><span class="line">            <span class="keyword">return</span> keyHash ^ valueHash;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> key + <span class="string">&quot;=&quot;</span> + value;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;&#125;</span><br></pre></td></tr></table></figure>
<h3 id="hashtable" id="HashTable">HashTable</h3>
<p>çº¿ç¨‹å®‰å…¨ï¼Œå†…éƒ¨çš„æ–¹æ³•åŸºæœ¬éƒ½ç»è¿‡ synchronizedï¼Œä¿ç•™ç±»ä¸å»ºè®®ä½¿ç”¨</p>
<h3 id="concurrenthashmap" id="ConcurrentHashMap"><strong>ConcurrentHashMap</strong></h3>
<table>
<thead>
<tr>
<th>ç‰¹ç‚¹</th>
<th>åŸå› ï¼ˆæºç ï¼‰</th>
<th></th>
</tr>
</thead>
<tbody>
<tr>
<td>åº•å±‚æ•°ç»„ã€é“¾è¡¨ã€çº¢é»‘æ ‘</td>
<td><a href="#%E5%BA%95%E5%B1%82">åº•å±‚</a></td>
<td></td>
</tr>
<tr>
<td>çº¿ç¨‹å®‰å…¨</td>
<td>çº¿ç¨‹å®‰å…¨</td>
<td></td>
</tr>
<tr>
<td>åŠ¨æ€æ‰©å®¹ä¸ºåŸæ¥çš„2å€</td>
<td><a href="#%E6%89%A9%E5%AE%B9%E4%B8%BA%E5%8E%9F%E6%9D%A5%E4%B8%A4%E5%80%8D">int newCapacity = oldCapacity + ((capacityIncrement &gt; 0) ? capacityIncrement : oldCapacity);</a></td>
<td></td>
</tr>
<tr>
<td>éƒ½å®‰å…¨ä½†æ˜¯ConcurrentHashMap æ¯” HashTable æ•ˆç‡è¦é«˜</td>
<td>ConcurrentHashMap é”ç²’åº¦æ›´ç»†</td>
<td></td>
</tr>
<tr>
<td>éç©º</td>
<td></td>
<td></td>
</tr>
</tbody>
</table>
<p>JDK1.7 : ã€æ•°ç»„ï¼ˆSegmentï¼‰ + æ•°ç»„ï¼ˆHashEntryï¼‰ + é“¾è¡¨ï¼ˆHashEntryèŠ‚ç‚¹ï¼‰ã€‘<br />
ConcurrentHashMapï¼ˆåˆ†æ®µé”ï¼‰ å¯¹æ•´ä¸ªæ¡¶æ•°ç»„è¿›è¡Œäº†åˆ†å‰²åˆ†æ®µ(Segment)ï¼Œæ¯ä¸€æŠŠé”åªé”å®¹å™¨å…¶ä¸­ä¸€éƒ¨åˆ†æ•°æ®ï¼Œå¤šçº¿ç¨‹è®¿é—®å®¹å™¨é‡Œä¸åŒæ•°æ®æ®µçš„æ•°æ®ï¼Œå°±ä¸ä¼šå­˜åœ¨é”ç«äº‰ï¼Œæé«˜å¹¶å‘è®¿é—®ç‡ã€‚Segmentæ˜¯ä¸€ç§å¯é‡å…¥é”ReentrantLockï¼Œåœ¨ConcurrentHashMapé‡Œæ‰®æ¼”é”çš„è§’è‰²ï¼ŒHashEntryåˆ™ç”¨äºå­˜å‚¨é”®å€¼å¯¹æ•°æ®ã€‚<br />
JDK1.8 : Nodeæ•°ç»„+é“¾è¡¨ / çº¢é»‘æ ‘<br />
åˆ©ç”¨CAS+Synchronizedæ¥ä¿è¯å¹¶å‘æ›´æ–°çš„å®‰å…¨ï¼Œåº•å±‚ä¾ç„¶é‡‡ç”¨æ•°ç»„+é“¾è¡¨+çº¢é»‘æ ‘çš„å­˜å‚¨ç»“æ„ã€‚</p>
<hr />
<h4 id="%E5%BA%95%E5%B1%82-3" id="åº•å±‚-v4">åº•å±‚</h4>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">     * The array of bins. Lazily initialized upon first insertion.</span></span><br><span class="line"><span class="comment">     * Size is always a power of two. Accessed directly by iterators.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">transient</span> <span class="keyword">volatile</span> Node&lt;K,V&gt;[] table;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * The next table to use; non-null only while resizing.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">transient</span> <span class="keyword">volatile</span> Node&lt;K,V&gt;[] nextTable;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Base counter value, used mainly when there is no contention,</span></span><br><span class="line"><span class="comment">     * but also as a fallback during table initialization</span></span><br><span class="line"><span class="comment">     * races. Updated via CAS.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">transient</span> <span class="keyword">volatile</span> <span class="keyword">long</span> baseCount;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * hashè¡¨åˆå§‹åŒ–æˆ–æ‰©å®¹æ—¶çš„ä¸€ä¸ªæ§åˆ¶ä½æ ‡è¯†é‡ã€‚</span></span><br><span class="line"><span class="comment">     * è´Ÿæ•°ä»£è¡¨æ­£åœ¨è¿›è¡Œåˆå§‹åŒ–æˆ–æ‰©å®¹æ“ä½œ</span></span><br><span class="line"><span class="comment">     * -1ä»£è¡¨æ­£åœ¨åˆå§‹åŒ–</span></span><br><span class="line"><span class="comment">     * -N è¡¨ç¤ºæœ‰N-1ä¸ªçº¿ç¨‹æ­£åœ¨è¿›è¡Œæ‰©å®¹æ“ä½œ</span></span><br><span class="line"><span class="comment">     * æ­£æ•°æˆ–0ä»£è¡¨hashè¡¨è¿˜æ²¡æœ‰è¢«åˆå§‹åŒ–ï¼Œè¿™ä¸ªæ•°å€¼è¡¨ç¤ºåˆå§‹åŒ–æˆ–ä¸‹ä¸€æ¬¡è¿›è¡Œæ‰©å®¹çš„å¤§å°</span></span><br><span class="line"><span class="comment">     * Table initialization and resizing control.  When negative, the</span></span><br><span class="line"><span class="comment">     * table is being initialized or resized: -1 for initialization,</span></span><br><span class="line"><span class="comment">     * else -(1 + the number of active resizing threads).  Otherwise,</span></span><br><span class="line"><span class="comment">     * when table is null, holds the initial table size to use upon</span></span><br><span class="line"><span class="comment">     * creation, or 0 for default. After initialization, holds the</span></span><br><span class="line"><span class="comment">     * next element count value upon which to resize the table.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">transient</span> <span class="keyword">volatile</span> <span class="keyword">int</span> sizeCtl;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * The next table index (plus one) to split while resizing.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">transient</span> <span class="keyword">volatile</span> <span class="keyword">int</span> transferIndex;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Spinlock (locked via CAS) used when resizing and/or creating CounterCells.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">transient</span> <span class="keyword">volatile</span> <span class="keyword">int</span> cellsBusy;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Table of counter cells. When non-null, size is a power of 2.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">transient</span> <span class="keyword">volatile</span> CounterCell[] counterCells;</span><br></pre></td></tr></table></figure>
<h2 id="queue" id="Queue">Queue</h2>
<blockquote>
<p>å…ˆè¿›å…ˆå‡º</p>
</blockquote>
<h3 id="priorityqueue" id="PriorityQueue"><strong>PriorityQueue</strong></h3>
<table>
<thead>
<tr>
<th>ç‰¹ç‚¹</th>
<th>åŸå› ï¼ˆæºç ï¼‰</th>
<th></th>
</tr>
</thead>
<tbody>
<tr>
<td>åº•å±‚äºŒå‰å°é¡¶å †</td>
<td></td>
<td></td>
</tr>
<tr>
<td>ä¿è¯æ¯æ¬¡å–å‡ºçš„å…ƒç´ æ˜¯é˜Ÿåˆ—ä¸­æƒå€¼æœ€å°çš„</td>
<td>æ–¹æ³•ä¸­æœ‰synchronizedï¼Œ<strong>æ‰€ä»¥æ€§èƒ½ä¸å¦‚ArrayList</strong></td>
<td></td>
</tr>
<tr>
<td>énull</td>
<td><a href="#%E6%89%A9%E5%AE%B9%E4%B8%BA%E5%8E%9F%E6%9D%A5%E4%B8%A4%E5%80%8D">int newCapacity = oldCapacity + ((capacityIncrement &gt; 0) ? capacityIncrement : oldCapacity);</a></td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
</tr>
</tbody>
</table>
<h2 id="%E5%B7%A5%E5%85%B7%E7%B1%BB" id="å·¥å…·ç±»">å·¥å…·ç±»</h2>
<h3 id="collections" id="Collections">Collections</h3>
<p>ç¡®ä¿å†…å®¹ä¸è¢«ä¿®æ”¹</p>
<ul>
<li>unmodifiableMap</li>
<li>unmodifiableList</li>
<li>unmodifiableSet</li>
</ul>
<h3 id="arrays" id="Arrays">Arrays</h3>
<h3 id="comparable%E5%92%8Ccomparator" id="Comparableå’ŒComparator">Comparableå’ŒComparator</h3>
<p>â€‹		Comparableæ˜¯æ’åºæ¥å£ï¼›è‹¥ä¸€ä¸ªç±»å®ç°äº†Comparableæ¥å£ï¼Œå°±æ„å‘³ç€â€œè¯¥ç±»æ”¯æŒæ’åºâ€ã€‚è€ŒComparatoræ˜¯æ¯”è¾ƒå™¨ï¼›æˆ‘ä»¬è‹¥éœ€è¦æ§åˆ¶æŸä¸ªç±»çš„æ¬¡åºï¼Œå¯ä»¥å»ºç«‹ä¸€ä¸ªâ€œè¯¥ç±»çš„æ¯”è¾ƒå™¨â€æ¥è¿›è¡Œæ’åºã€‚Comparableç›¸å½“äºâ€œå†…éƒ¨æ¯”è¾ƒå™¨â€ï¼Œè€ŒComparatorç›¸å½“äºâ€œå¤–éƒ¨æ¯”è¾ƒå™¨â€ã€‚</p>
<h2 id="%E5%AE%B9%E5%99%A8%E7%BB%BC%E5%90%88%E9%97%AE%E9%A2%98" id="å®¹å™¨ç»¼åˆé—®é¢˜">å®¹å™¨ç»¼åˆé—®é¢˜</h2>
<h1 id="juc">JUC</h1>
<blockquote>
<p><strong>é—®é¢˜ï¼šä»€ä¹ˆæ—¶å€™è¯¥ç”¨å¤šçº¿ç¨‹ï¼Ÿ</strong></p>
</blockquote>
<p>â€‹	åœ¨Javaä¸­ï¼Œçº¿ç¨‹éƒ¨åˆ†æ˜¯ä¸€ä¸ªé‡ç‚¹ï¼Œæœ¬ç¯‡æ–‡ç« è¯´çš„JUCä¹Ÿæ˜¯å…³äºçº¿ç¨‹çš„ã€‚JUCå°±æ˜¯java.util .concurrentå·¥å…·åŒ…çš„ç®€ç§°ã€‚è¿™æ˜¯ä¸€ä¸ªå¤„ç†çº¿ç¨‹çš„å·¥å…·åŒ…ï¼ŒJDK 1.5å¼€å§‹å‡ºç°çš„ã€‚</p>
<h2 id="%E5%A4%9A%E7%BA%BF%E7%A8%8B%E5%9F%BA%E7%A1%80" id="å¤šçº¿ç¨‹åŸºç¡€">å¤šçº¿ç¨‹åŸºç¡€</h2>
<ul>
<li>
<p>è¿›ç¨‹(Process)</p>
<ul>
<li>
<p>æŠŠä¸€ä¸ªä»»åŠ¡ç§°ä¸ºä¸€ä¸ªè¿›ç¨‹</p>
<ul>
<li>è¿›ç¨‹å†…éƒ¨è¿˜éœ€è¦åŒæ—¶æ‰§è¡Œå¤šä¸ªå­ä»»åŠ¡ç§°ä¸ºçº¿ç¨‹</li>
</ul>
</li>
<li>
<p>è¿›ç¨‹å’Œçº¿ç¨‹çš„å…³ç³»å°±æ˜¯ï¼šä¸€ä¸ªè¿›ç¨‹å¯ä»¥åŒ…å«ä¸€ä¸ªæˆ–å¤šä¸ªçº¿ç¨‹ï¼ˆThreadï¼‰ï¼Œä½†è‡³å°‘ä¼šæœ‰ä¸€ä¸ªçº¿ç¨‹ã€‚</p>
</li>
<li>
<p>å¤šè¿›ç¨‹æ¨¡å¼ï¼ˆæ¯ä¸ªè¿›ç¨‹åªæœ‰ä¸€ä¸ªçº¿ç¨‹ï¼‰</p>
</li>
<li>
<p>å¤šçº¿ç¨‹æ¨¡å¼ï¼ˆä¸€ä¸ªè¿›ç¨‹æœ‰å¤šä¸ªçº¿ç¨‹ï¼‰</p>
</li>
<li>
<p>å¤šè¿›ç¨‹ï¼‹å¤šçº¿ç¨‹æ¨¡å¼ï¼ˆå¤æ‚åº¦æœ€é«˜ï¼‰</p>
</li>
</ul>
</li>
<li>
<p>å’Œå¤šçº¿ç¨‹ç›¸æ¯”ï¼Œ<br />
<strong>å¤šè¿›ç¨‹ç¼ºç‚¹åœ¨äº</strong>ï¼šåˆ›å»ºè¿›ç¨‹æ¯”åˆ›å»ºçº¿ç¨‹å¼€é”€å¤§ï¼Œå°¤å…¶æ˜¯åœ¨Windowsç³»ç»Ÿä¸Šï¼›è¿›ç¨‹é—´é€šä¿¡æ¯”çº¿ç¨‹é—´é€šä¿¡è¦æ…¢ï¼Œå› ä¸ºçº¿ç¨‹é—´é€šä¿¡å°±æ˜¯è¯»å†™åŒä¸€ä¸ªå˜é‡ï¼Œé€Ÿåº¦å¾ˆå¿«ã€‚<br />
<strong>å¤šè¿›ç¨‹çš„ä¼˜ç‚¹åœ¨äº</strong>ï¼šå¤šè¿›ç¨‹ç¨³å®šæ€§æ¯”å¤šçº¿ç¨‹é«˜ï¼Œå› ä¸ºåœ¨å¤šè¿›ç¨‹çš„æƒ…å†µä¸‹ï¼Œä¸€ä¸ªè¿›ç¨‹å´©æºƒä¸ä¼šå½±å“å…¶ä»–è¿›ç¨‹ï¼Œè€Œåœ¨å¤šçº¿ç¨‹çš„æƒ…å†µä¸‹ï¼Œä»»ä½•ä¸€ä¸ªçº¿ç¨‹å´©æºƒä¼šç›´æ¥å¯¼è‡´æ•´ä¸ªè¿›ç¨‹å´©æºƒã€‚</p>
</li>
<li>
<p>å¤šçº¿ç¨‹</p>
<ul>
<li>Javaè¯­è¨€å†…ç½®äº†å¤šçº¿ç¨‹æ”¯æŒï¼šä¸€ä¸ªJavaç¨‹åºå®é™…ä¸Šæ˜¯ä¸€ä¸ªJVMè¿›ç¨‹ï¼ŒJVMè¿›ç¨‹ç”¨ä¸€ä¸ªä¸»çº¿ç¨‹æ¥æ‰§è¡Œmain()æ–¹æ³•ï¼Œåœ¨main()æ–¹æ³•å†…éƒ¨ï¼Œæˆ‘ä»¬åˆå¯ä»¥å¯åŠ¨å¤šä¸ªçº¿ç¨‹ã€‚æ­¤å¤–ï¼ŒJVMè¿˜æœ‰è´Ÿè´£åƒåœ¾å›æ”¶çš„å…¶ä»–å·¥ä½œçº¿ç¨‹ç­‰ã€‚</li>
</ul>
</li>
</ul>
<p>å› æ­¤ï¼Œå¯¹äºå¤§å¤šæ•°Javaç¨‹åºæ¥è¯´ï¼Œæˆ‘ä»¬è¯´å¤šä»»åŠ¡ï¼Œå®é™…ä¸Šæ˜¯è¯´å¦‚ä½•ä½¿ç”¨å¤šçº¿ç¨‹å®ç°å¤šä»»åŠ¡ã€‚</p>
<p>â€‹		å’Œå•çº¿ç¨‹ç›¸æ¯”ï¼Œå¤šçº¿ç¨‹ç¼–ç¨‹çš„ç‰¹ç‚¹åœ¨äºï¼šå¤šçº¿ç¨‹ç»å¸¸éœ€è¦è¯»å†™å…±äº«æ•°æ®ï¼Œå¹¶ä¸”éœ€è¦åŒæ­¥ã€‚ä¾‹å¦‚ï¼Œæ’­æ”¾ç”µå½±æ—¶ï¼Œå°±å¿…é¡»ç”±ä¸€ä¸ªçº¿ç¨‹æ’­æ”¾è§†é¢‘ï¼Œå¦ä¸€ä¸ªçº¿ç¨‹æ’­æ”¾éŸ³é¢‘ï¼Œä¸¤ä¸ªçº¿ç¨‹éœ€è¦åè°ƒè¿è¡Œï¼Œå¦åˆ™ç”»é¢å’Œå£°éŸ³å°±ä¸åŒæ­¥ã€‚å› æ­¤ï¼Œå¤šçº¿ç¨‹ç¼–ç¨‹çš„å¤æ‚åº¦é«˜ï¼Œè°ƒè¯•æ›´å›°éš¾ã€‚</p>
<p>â€‹		Javaå¤šçº¿ç¨‹ç¼–ç¨‹çš„ç‰¹ç‚¹åˆåœ¨äºï¼šå¤šçº¿ç¨‹æ¨¡å‹æ˜¯Javaç¨‹åºæœ€åŸºæœ¬çš„å¹¶å‘æ¨¡å‹ï¼›åç»­è¯»å†™ç½‘ç»œã€æ•°æ®åº“ã€Webå¼€å‘ç­‰éƒ½ä¾èµ–Javaå¤šçº¿ç¨‹æ¨¡å‹ã€‚</p>
<h2 id="%E7%AE%A1%E7%A8%8B" id="ç®¡ç¨‹">ç®¡ç¨‹</h2>
<p>â€‹	ç®¡ç¨‹(monitor)æ˜¯ä¿è¯äº†<strong>åŒä¸€æ—¶åˆ»åªæœ‰ä¸€ä¸ªè¿›ç¨‹åœ¨ç®¡ç¨‹</strong>å†…æ´»åŠ¨,å³ç®¡ç¨‹å†…å®šä¹‰çš„æ“ä½œåœ¨åŒä¸€æ—¶åˆ»åªè¢«ä¸€ä¸ªè¿›ç¨‹è°ƒç”¨(ç”±ç¼–è¯‘å™¨å®ç°).ä½†æ˜¯è¿™æ ·å¹¶ä¸èƒ½ä¿è¯è¿›ç¨‹ä»¥è®¾è®¡çš„é¡ºåºæ‰§è¡Œã€‚JVMä¸­åŒæ­¥æ˜¯åŸºäºè¿›å…¥å’Œé€€å‡ºç®¡ç¨‹(monitor)å¯¹è±¡å®ç°çš„ï¼Œæ¯ä¸ªå¯¹è±¡éƒ½ä¼šæœ‰ä¸€ä¸ªç®¡ç¨‹(monitor)å¯¹è±¡ï¼Œç®¡ç¨‹(monitor)ä¼šéšç€javaå¯¹è±¡ä¸€åŒåˆ›å»ºå’Œé”€æ¯ã€‚æ‰§è¡Œçº¿ç¨‹é¦–å…ˆè¦æŒæœ‰ç®¡ç¨‹å¯¹è±¡ï¼Œç„¶åæ‰èƒ½æ‰§è¡Œæ–¹æ³•ï¼Œå½“æ–¹æ³•å®Œæˆä¹‹åä¼šé‡Šæ”¾ç®¡ç¨‹ï¼Œæ–¹æ³•åœ¨æ‰§è¡Œæ—¶å€™ä¼šæŒæœ‰ç®¡ç¨‹ï¼Œå…¶ä»–çº¿ç¨‹æ— æ³•å†è·å–åŒä¸€ä¸ªç®¡ç¨‹</p>
<h2 id="%E6%98%BE%E5%BC%8F%E5%88%9B%E5%BB%BA%E6%96%B0%E7%BA%BF%E7%A8%8B" id="æ˜¾å¼åˆ›å»ºæ–°çº¿ç¨‹">æ˜¾å¼åˆ›å»ºæ–°çº¿ç¨‹</h2>
<ul>
<li><strong>ç»§æ‰¿Threadç±»</strong>ï¼Œå®ä¾‹åŒ–ä¸€ä¸ªThreadå®ä¾‹å¹¶é‡å†™runï¼ˆï¼‰ï¼Œç„¶åè°ƒç”¨å®ƒçš„start()æ–¹æ³•ï¼š
<ul>
<li>
<p>å¸Œæœ›æ–°çº¿ç¨‹èƒ½æ‰§è¡ŒæŒ‡å®šçš„ä»£ç </p>
<ul>
<li>æ–¹æ³•ä¸€ï¼šä»Threadæ´¾ç”Ÿä¸€ä¸ªè‡ªå®šä¹‰ç±»ï¼Œç„¶åè¦†å†™run()æ–¹æ³•ï¼š</li>
<li>æ–¹æ³•äºŒï¼šåˆ›å»ºThreadå®ä¾‹æ—¶ï¼Œä¼ å…¥ä¸€ä¸ªRunnableå®ä¾‹ï¼š</li>
<li>çº¿ç¨‹çš„ä¼˜å…ˆçº§<br />
å¯ä»¥å¯¹çº¿ç¨‹è®¾å®šä¼˜å…ˆçº§ï¼Œè®¾å®šä¼˜å…ˆçº§çš„æ–¹æ³•æ˜¯ï¼š</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>Thread.setPriority(int n) // 1~10, é»˜è®¤å€¼5</p>
<ul>
<li><strong>å®ç°Runnableæ¥å£</strong></li>
<li>ä¸Callableä¸åŒ
<ul>
<li>æ— è¿”å›å€¼</li>
<li>æ— è¿”å›å¼‚å¸¸</li>
<li>å®ç°run()</li>
</ul>
</li>
<li><strong>å®ç°Callableæ¥å£</strong>ï¼ˆjdk1.5ï¼‰
<ul>
<li>å®ç° Callableæ¥å£<br />
1.å®ç° Callableæ¥å£,éœ€è¦è¿”å›å€¼ç±»å‹<br />
2.é‡å†™<strong>call</strong>æ–¹æ³•,éœ€è¦æŠ›å‡ºå¼‚å¸¸<br />
3.åˆ›å»ºç›®æ ‡å¯¹è±¡<br />
4.åˆ›å»ºæ‰§è¡ŒæœåŠ¡: Executorservice ser= Executors. newfixed Threadpool(1)<br />
5.æäº¤æ‰§è¡Œ: Future&lt; Boolean&gt; result1=ser. submit(t1);<br />
6.è·å–<strong>ç»“æœ</strong>: boolean r1= result1.get()<br />
7.å…³é—­æœåŠ¡:ser. shutdownNow()</li>
</ul>
</li>
</ul>
<p>æ€»ç»“ï¼šThreadä¸ºåŸºï¼Œå¦å¤–ä¸¤ä¸ªé€šè¿‡Thread å®ä¾‹å®ç°ï¼Œé€šè¿‡æ¥å£é¿å…å•ç»§æ‰¿å±€é™æ€§ï¼Œçµæ´»æ–¹ä¾¿åŒä¸€ä¸ªå¯¹è±¡è¢«å¤šä¸ªçº¿ç¨‹ä½¿ç”¨ï¼ŒåŒºåˆ«åœ¨Callable æœ‰<strong>è¿”å›å€¼</strong>ï¼Œè¿”å›å€¼é€šè¿‡<strong>FutureTask</strong>å°è£…å†ç»™Threadå®ä¾‹ï¼Œè€ŒRunnableå®ä¾‹ç›´æ¥ç»™Thread å®ä¾‹å®ç°ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> pers.lxl.mylearnproject.javase.thread;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.Callable;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.ExecutionException;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.FutureTask;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * å¿«é€Ÿäº¤æ›¿æ‰§è¡Œçœ‹èµ·æ¥åƒæ˜¯åŒæ—¶æ‰§è¡Œ</span></span><br><span class="line"><span class="comment"> * è¿›ç¨‹å’Œçº¿ç¨‹çš„å…³ç³»ï¼šä¸€ä¸ªè¿›ç¨‹å¯ä»¥åŒ…å«ä¸€ä¸ªæˆ–å¤šä¸ªçº¿ç¨‹ï¼Œä½†è‡³å°‘ä¼šæœ‰ä¸€ä¸ªçº¿ç¨‹</span></span><br><span class="line"><span class="comment"> * å¤šè¿›ç¨‹æ¨¡å¼ï¼ˆæ¯ä¸ªè¿›ç¨‹åªæœ‰ä¸€ä¸ªçº¿ç¨‹ï¼‰</span></span><br><span class="line"><span class="comment"> * å¤šçº¿ç¨‹æ¨¡å¼ï¼ˆä¸€ä¸ªè¿›ç¨‹æœ‰å¤šä¸ªçº¿ç¨‹ï¼‰</span></span><br><span class="line"><span class="comment"> * å¤šè¿›ç¨‹ï¼‹å¤šçº¿ç¨‹æ¨¡å¼ï¼ˆå¤æ‚åº¦æœ€é«˜ï¼‰</span></span><br><span class="line"><span class="comment"> * å’Œå¤šçº¿ç¨‹ç›¸æ¯”ï¼Œå¤šè¿›ç¨‹çš„ç¼ºç‚¹åœ¨äºï¼š</span></span><br><span class="line"><span class="comment"> * åˆ›å»ºè¿›ç¨‹æ¯”åˆ›å»ºçº¿ç¨‹å¼€é”€å¤§ï¼Œå°¤å…¶æ˜¯åœ¨Windowsç³»ç»Ÿä¸Šï¼›</span></span><br><span class="line"><span class="comment"> * è¿›ç¨‹é—´é€šä¿¡æ¯”çº¿ç¨‹é—´é€šä¿¡è¦æ…¢ï¼Œå› ä¸ºçº¿ç¨‹é—´é€šä¿¡å°±æ˜¯è¯»å†™åŒä¸€ä¸ªå˜é‡ï¼Œé€Ÿåº¦å¾ˆå¿«ã€‚</span></span><br><span class="line"><span class="comment"> * å¤šè¿›ç¨‹çš„ä¼˜ç‚¹åœ¨äºï¼š</span></span><br><span class="line"><span class="comment"> * å¤šè¿›ç¨‹ç¨³å®šæ€§æ¯”å¤šçº¿ç¨‹é«˜ï¼Œå› ä¸ºåœ¨å¤šè¿›ç¨‹çš„æƒ…å†µä¸‹ï¼Œä¸€ä¸ªè¿›ç¨‹å´©æºƒä¸ä¼šå½±å“å…¶ä»–è¿›ç¨‹ï¼Œè€Œåœ¨å¤šçº¿ç¨‹çš„æƒ…å†µä¸‹ï¼Œä»»ä½•ä¸€ä¸ªçº¿ç¨‹å´©æºƒä¼šç›´æ¥å¯¼è‡´æ•´ä¸ªè¿›ç¨‹å´©æºƒã€‚</span></span><br><span class="line"><span class="comment"> * Javaè¯­è¨€å†…ç½®äº†å¤šçº¿ç¨‹æ”¯æŒï¼šä¸€ä¸ªJavaç¨‹åºå®é™…ä¸Šæ˜¯ä¸€ä¸ªJVMè¿›ç¨‹ï¼ŒJVMè¿›ç¨‹ç”¨ä¸€ä¸ªä¸»çº¿ç¨‹æ¥æ‰§è¡Œmain()æ–¹æ³•ï¼Œåœ¨main()æ–¹æ³•å†…éƒ¨ï¼Œæˆ‘ä»¬åˆå¯ä»¥å¯åŠ¨å¤šä¸ªçº¿ç¨‹ã€‚æ­¤å¤–ï¼ŒJVMè¿˜æœ‰è´Ÿè´£åƒåœ¾å›æ”¶çš„å…¶ä»–å·¥ä½œçº¿ç¨‹ç­‰ã€‚</span></span><br><span class="line"><span class="comment"> * å› æ­¤ï¼Œå¯¹äºå¤§å¤šæ•°Javaç¨‹åºæ¥è¯´ï¼Œæˆ‘ä»¬è¯´å¤šä»»åŠ¡ï¼Œå®é™…ä¸Šæ˜¯è¯´å¦‚ä½•ä½¿ç”¨å¤šçº¿ç¨‹å®ç°å¤šä»»åŠ¡ã€‚</span></span><br><span class="line"><span class="comment"> * å’Œå•çº¿ç¨‹ç›¸æ¯”ï¼Œå¤šçº¿ç¨‹ç¼–ç¨‹çš„ç‰¹ç‚¹åœ¨äºï¼šå¤šçº¿ç¨‹ç»å¸¸éœ€è¦è¯»å†™å…±äº«æ•°æ®ï¼Œå¹¶ä¸”éœ€è¦åŒæ­¥ã€‚ä¾‹å¦‚ï¼Œæ’­æ”¾ç”µå½±æ—¶ï¼Œå°±å¿…é¡»ç”±ä¸€ä¸ªçº¿ç¨‹æ’­æ”¾è§†é¢‘ï¼Œå¦ä¸€ä¸ªçº¿ç¨‹æ’­æ”¾éŸ³é¢‘ï¼Œä¸¤ä¸ªçº¿ç¨‹éœ€è¦åè°ƒè¿è¡Œï¼Œå¦åˆ™ç”»é¢å’Œå£°éŸ³å°±ä¸åŒæ­¥ã€‚å› æ­¤ï¼Œå¤šçº¿ç¨‹ç¼–ç¨‹çš„å¤æ‚åº¦é«˜ï¼Œè°ƒè¯•æ›´å›°éš¾ã€‚</span></span><br><span class="line"><span class="comment"> * Javaå¤šçº¿ç¨‹ç¼–ç¨‹çš„ç‰¹ç‚¹åˆåœ¨äºï¼š</span></span><br><span class="line"><span class="comment"> * å¤šçº¿ç¨‹æ¨¡å‹æ˜¯Javaç¨‹åºæœ€åŸºæœ¬çš„å¹¶å‘æ¨¡å‹ï¼›</span></span><br><span class="line"><span class="comment"> * åç»­è¯»å†™ç½‘ç»œã€æ•°æ®åº“ã€Webå¼€å‘ç­‰éƒ½ä¾èµ–Javaå¤šçº¿ç¨‹æ¨¡å‹ã€‚</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> lxl</span></span><br><span class="line"><span class="comment"> **/</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HelloClass</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//å¸Œæœ›æ–°çº¿ç¨‹èƒ½æ‰§è¡ŒæŒ‡å®šçš„ä»£ç ï¼Œæœ‰ä»¥ä¸‹å‡ ç§æ–¹æ³•ï¼š</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ–¹æ³•ä¸€ï¼šä»Threadæ´¾ç”Ÿä¸€ä¸ªè‡ªå®šä¹‰ç±»ï¼Œç„¶åè¦†å†™run()æ–¹æ³•ï¼Œå¯åŠ¨ï¼šå­ç±»å¯¹è±¡.start(),ä¸ºé¿å…OOPå•ç»§æ‰¿å±€é™æ€§ï¼Œä¸å»ºè®®ä½¿ç”¨</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">MyThread</span> <span class="keyword">extends</span> <span class="title">Thread</span> </span>&#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;start new thread!extends Thread&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ–¹æ³•äºŒï¼šåˆ›å»ºThreadå®ä¾‹æ—¶ï¼Œä¼ å…¥ä¸€ä¸ªRunnableå®ä¾‹ï¼šå¯åŠ¨ï¼šä¼ å…¥ç›®æ ‡å¯¹è±¡+Threadå¯¹è±¡.start()ï¼Œå»ºè®®ä½¿ç”¨:é¿å…å•ç»§æ‰¿å±€é™æ€§ï¼Œçµæ´»æ–¹ä¾¿åŒä¸€ä¸ªå¯¹è±¡è¢«å¤šä¸ªçº¿ç¨‹ä½¿ç”¨</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">MyRunnable</span> <span class="keyword">implements</span> <span class="title">Runnable</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;start new thread!implements Runnable&quot;</span>);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                Thread.sleep(<span class="number">10</span>);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">            &#125;</span><br><span class="line">            System.out.println(<span class="string">&quot;thread end.&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ–¹æ³•ä¸‰ï¼šå®ç°Callableæ¥å£,ä¸Runnableç›¸æ¯”,Callableå¯ä»¥æœ‰è¿”å›å€¼,è¿”å›å€¼é€šè¿‡FutureTaskã€æœªæ¥ä»»åŠ¡ã€‘è¿›è¡Œå°è£…</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">MyCallable</span> <span class="keyword">implements</span> <span class="title">Callable</span>&lt;<span class="title">Integer</span>&gt; </span>&#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> Integer <span class="title">call</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="number">123</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="comment">//ç›¸æ¯”ä¹‹ä¸‹,æ¥å£å¯ä»¥å®ç°å¤šä¸ª,è€ŒThreadåªèƒ½å•ç»§æ‰¿,</span></span><br><span class="line"><span class="comment">// ç»§æ‰¿æ•´ä¸ªThreaç±»å¼€é”€è¿‡å¤§,æ‰€ä»¥å®ç°æ¥å£æ–¹å¼æ›´å¥½ä¸€äº›</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å½“Javaç¨‹åºå¯åŠ¨çš„æ—¶å€™ï¼Œå®é™…ä¸Šæ˜¯å¯åŠ¨äº†ä¸€ä¸ªJVMè¿›ç¨‹ï¼Œç„¶åï¼ŒJVMå¯åŠ¨ä¸»çº¿ç¨‹æ¥æ‰§è¡Œmain()æ–¹æ³•ã€‚åœ¨main()æ–¹æ³•ä¸­ï¼Œæˆ‘ä»¬åˆå¯ä»¥å¯åŠ¨å…¶ä»–çº¿ç¨‹ã€‚</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> ExecutionException, InterruptedException </span>&#123;</span><br><span class="line">        <span class="comment">//åˆ›å»ºæ–°çº¿ç¨‹</span></span><br><span class="line">        System.out.println(<span class="string">&quot;main start...&quot;</span>);</span><br><span class="line">        <span class="comment">//Thread thread = new Thread();//ä¸èƒ½æ‰§è¡ŒæŒ‡å®šä»£ç </span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//extends Thread==============</span></span><br><span class="line">        <span class="comment">// Thread thread = new MyThread();</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//implements Callable=============</span></span><br><span class="line">        MyCallable mc = <span class="keyword">new</span> MyCallable();</span><br><span class="line">        FutureTask&lt;Integer&gt; ft = <span class="keyword">new</span> FutureTask&lt;&gt;(mc);</span><br><span class="line">        Thread thread1 = <span class="keyword">new</span> Thread(ft);</span><br><span class="line">        thread1.start();</span><br><span class="line">        System.out.println(ft.get());</span><br><span class="line"><span class="comment">//lambda Callbale</span></span><br><span class="line">        FutureTask&lt;Integer&gt; futureTask2 = <span class="keyword">new</span> FutureTask&lt;&gt;(()-&gt;&#123;</span><br><span class="line">             System.out.println(Thread.currentThread().getName()+<span class="string">&quot;come in callbale&quot;</span>);</span><br><span class="line">            <span class="keyword">return</span> <span class="number">111</span>;</span><br><span class="line">        &#125;);</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">new</span> thread(futureTask2,<span class="string">&quot;hahha&quot;</span>).start();<span class="comment">//hahha come in callbale</span></span><br><span class="line">	    </span><br><span class="line">        <span class="keyword">while</span>(!futuretask2.isDone())&#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;wait....&quot;</span>)</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println(futureTask2.get());<span class="comment">//111</span></span><br><span class="line"><span class="comment">//implements Runnable===============</span></span><br><span class="line">        Thread thread = <span class="keyword">new</span> Thread(<span class="keyword">new</span> MyRunnable());</span><br><span class="line">        <span class="comment">//Thread thread = new Thread(() -&gt; &#123;System.out.println(&quot;start new thread!&quot;); &#125;);//Java8å¼•å…¥çš„lambdaå†™æ³•</span></span><br><span class="line">        thread.start();<span class="comment">// å¯åŠ¨æ–°çº¿ç¨‹ï¼Œç›´æ¥è°ƒç”¨Threadå®ä¾‹çš„run()æ–¹æ³•æ˜¯æ— æ•ˆçš„ï¼Œçº¿ç¨‹å¼€å¯ä¸ä¸€å®šç«‹å³æ‰§è¡Œï¼Œç”±CPUè°ƒåº¦å†³å®š</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//        Thread.setPriority(int n) // 1~10, é»˜è®¤å€¼5</span></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            Thread.sleep(<span class="number">20</span>);</span><br><span class="line"><span class="comment">//            sleep() å¯èƒ½ä¼šæŠ›å‡º InterruptedExceptionï¼Œå› ä¸ºå¼‚å¸¸ä¸èƒ½è·¨çº¿ç¨‹ä¼ æ’­å› main() ä¸­ï¼Œå› æ­¤å¿…é¡»åœ¨æœ¬åœ°è¿›è¡Œå¤„ç†ã€‚çº¿ç¨‹ä¸­æŠ›å‡ºçš„å…¶å®ƒå¼‚å¸¸ä¹ŸåŒæ ·éœ€è¦åœ¨æœ¬åœ°è¿›è¡Œå¤„ç†ã€‚</span></span><br><span class="line">        &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println(<span class="string">&quot;main end...&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h2 id="%E7%BA%BF%E7%A8%8B%E7%9A%84%E7%8A%B6%E6%80%81" id="çº¿ç¨‹çš„çŠ¶æ€">çº¿ç¨‹çš„çŠ¶æ€</h2>
<ul>
<li>åœ¨Javaç¨‹åºä¸­ï¼Œä¸€ä¸ªçº¿ç¨‹å¯¹è±¡åªèƒ½è°ƒç”¨ä¸€æ¬¡start()æ–¹æ³•å¯åŠ¨æ–°çº¿ç¨‹ï¼Œå¹¶åœ¨æ–°çº¿ç¨‹ä¸­æ‰§è¡Œrun()æ–¹æ³•ã€‚ä¸€æ—¦run()æ–¹æ³•æ‰§è¡Œå®Œæ¯•ï¼Œçº¿ç¨‹å°±ç»“æŸäº†ã€‚å› æ­¤ï¼ŒJavaçº¿ç¨‹çš„çŠ¶æ€æœ‰ä»¥ä¸‹å‡ ç§ï¼š</li>
</ul>
<p>Newï¼šæ–°åˆ›å»ºçš„çº¿ç¨‹ï¼Œå°šæœªæ‰§è¡Œï¼›<br />
Runnableï¼šè¿è¡Œä¸­çš„çº¿ç¨‹ï¼Œæ­£åœ¨æ‰§è¡Œrun()æ–¹æ³•çš„Javaä»£ç ï¼›<br />
Blockedï¼šè¿è¡Œä¸­çš„çº¿ç¨‹ï¼Œå› ä¸ºæŸäº›æ“ä½œè¢«é˜»å¡è€ŒæŒ‚èµ·ï¼›<br />
Waitingï¼ˆ<strong>ä¸è§ä¸æ•£</strong>ï¼‰ï¼šè¿è¡Œä¸­çš„çº¿ç¨‹ï¼Œå› ä¸ºæŸäº›æ“ä½œåœ¨ç­‰å¾…ä¸­ï¼›<br />
Timed Waitingï¼ˆ<strong>è¿‡æ—¶ä¸å€™</strong>ï¼‰ï¼šè¿è¡Œä¸­çš„çº¿ç¨‹ï¼Œå› ä¸ºæ‰§è¡Œsleep()æ–¹æ³•æ­£åœ¨è®¡æ—¶ç­‰å¾…ï¼›<br />
Terminatedï¼šçº¿ç¨‹å·²ç»ˆæ­¢ï¼Œå› ä¸ºrun()æ–¹æ³•æ‰§è¡Œå®Œæ¯•ã€‚</p>
<img src="https://gitee.com/mychimei/picture/raw/master/image-20220305164846160.png" alt="image-20220305164846160" style="zoom:80%;" />
<p><img src="https://gitee.com/mychimei/picture/raw/master/image-20220305200131513.png" alt="image-20220305200131513" /></p>
<ul>
<li>çº¿ç¨‹ç»ˆæ­¢çš„åŸå› æœ‰ï¼š</li>
</ul>
<p>çº¿ç¨‹æ­£å¸¸ç»ˆæ­¢ï¼šrun()æ–¹æ³•æ‰§è¡Œåˆ°returnè¯­å¥è¿”å›ï¼›<br />
çº¿ç¨‹æ„å¤–ç»ˆæ­¢ï¼šrun()æ–¹æ³•å› ä¸ºæœªæ•è·çš„å¼‚å¸¸å¯¼è‡´çº¿ç¨‹ç»ˆæ­¢ï¼›<br />
å¯¹æŸä¸ªçº¿ç¨‹çš„Threadå®ä¾‹è°ƒç”¨stop()æ–¹æ³•å¼ºåˆ¶ç»ˆæ­¢ï¼ˆå¼ºçƒˆä¸æ¨èä½¿ç”¨ï¼‰ã€‚</p>
<ul>
<li>é€šè¿‡å¯¹å¦ä¸€ä¸ªçº¿ç¨‹å¯¹è±¡è°ƒç”¨join()æ–¹æ³•å¯ä»¥ç­‰å¾…å…¶æ‰§è¡Œç»“æŸï¼›</li>
</ul>
<p>å¯ä»¥æŒ‡å®šç­‰å¾…æ—¶é—´ï¼Œè¶…è¿‡ç­‰å¾…æ—¶é—´çº¿ç¨‹ä»ç„¶æ²¡æœ‰ç»“æŸå°±ä¸å†ç­‰å¾…ï¼›</p>
<p>å¯¹å·²ç»è¿è¡Œç»“æŸçš„çº¿ç¨‹è°ƒç”¨join()æ–¹æ³•ä¼šç«‹åˆ»è¿”å›ã€‚</p>
<ul>
<li>
<p>ä¸­æ–­çº¿ç¨‹</p>
<ul>
<li>å¯¹ç›®æ ‡çº¿ç¨‹è°ƒç”¨interrupt()æ–¹æ³•å¯ä»¥è¯·æ±‚ä¸­æ–­ä¸€ä¸ªçº¿ç¨‹ï¼Œç›®æ ‡çº¿ç¨‹é€šè¿‡æ£€æµ‹isInterrupted()æ ‡å¿—è·å–è‡ªèº«æ˜¯å¦å·²ä¸­æ–­ã€‚å¦‚æœç›®æ ‡çº¿ç¨‹å¤„äºç­‰å¾…çŠ¶æ€ï¼Œè¯¥çº¿ç¨‹ä¼šæ•è·åˆ°InterruptedExceptionï¼›<br />
ç›®æ ‡çº¿ç¨‹æ£€æµ‹åˆ°isInterrupted()ä¸ºtrueæˆ–è€…æ•è·äº†InterruptedExceptionéƒ½åº”è¯¥ç«‹åˆ»ç»“æŸè‡ªèº«çº¿ç¨‹ï¼›<br />
é€šè¿‡æ ‡å¿—ä½åˆ¤æ–­éœ€è¦æ­£ç¡®ä½¿ç”¨volatileå…³é”®å­—ï¼›<br />
volatileå…³é”®å­—è§£å†³äº†å…±äº«å˜é‡åœ¨çº¿ç¨‹é—´çš„å¯è§æ€§é—®é¢˜ã€‚</li>
</ul>
</li>
</ul>
<h2 id="%E7%BA%BF%E7%A8%8B%E5%B1%9E%E6%80%A7" id="çº¿ç¨‹å±æ€§">çº¿ç¨‹å±æ€§</h2>
<h3 id="%E7%BA%BF%E7%A8%8B%E4%BC%98%E5%85%88%E7%BA%A7" id="çº¿ç¨‹ä¼˜å…ˆçº§">çº¿ç¨‹ä¼˜å…ˆçº§</h3>
<ul>
<li>setPriority</li>
</ul>
<h3 id="%E5%AE%88%E6%8A%A4%E7%BA%BF%E7%A8%8B" id="å®ˆæŠ¤çº¿ç¨‹">å®ˆæŠ¤çº¿ç¨‹</h3>
<ul>
<li>
<p><strong>å®ˆæŠ¤çº¿ç¨‹æ˜¯æŒ‡ä¸ºå…¶ä»–çº¿ç¨‹æœåŠ¡çš„çº¿ç¨‹</strong>ã€‚åœ¨JVMä¸­ï¼Œæ‰€æœ‰éå®ˆæŠ¤çº¿ç¨‹éƒ½æ‰§è¡Œå®Œæ¯•åï¼Œæ— è®ºæœ‰æ²¡æœ‰å®ˆæŠ¤çº¿ç¨‹ï¼Œè™šæ‹Ÿæœºéƒ½ä¼šè‡ªåŠ¨é€€å‡ºã€‚å› æ­¤ï¼ŒJVMé€€å‡ºæ—¶ï¼Œä¸å¿…å…³å¿ƒå®ˆæŠ¤çº¿ç¨‹æ˜¯å¦å·²ç»“æŸã€‚å¦‚ä½•åˆ›å»ºå®ˆæŠ¤çº¿ç¨‹å‘¢ï¼Ÿæ–¹æ³•å’Œæ™®é€šçº¿ç¨‹ä¸€æ ·ï¼Œåªæ˜¯åœ¨è°ƒç”¨start()æ–¹æ³•å‰ï¼Œè°ƒç”¨setDaemon(true)æŠŠè¯¥çº¿ç¨‹æ ‡è®°ä¸ºå®ˆæŠ¤çº¿ç¨‹ï¼š</p>
</li>
<li>
<p>å®ˆæŠ¤çº¿ç¨‹ä¸èƒ½æŒæœ‰ä»»ä½•éœ€è¦å…³é—­çš„èµ„æºï¼Œä¾‹å¦‚æ‰“å¼€æ–‡ä»¶ç­‰ï¼Œå› ä¸ºè™šæ‹Ÿæœºé€€å‡ºæ—¶ï¼Œå®ˆæŠ¤çº¿ç¨‹æ²¡æœ‰ä»»ä½•æœºä¼šæ¥å…³é—­æ–‡ä»¶ï¼Œè¿™ä¼šå¯¼è‡´æ•°æ®ä¸¢å¤±ã€‚</p>
</li>
<li>
<p>åº”ç”¨ï¼šJVMåƒåœ¾å›æ”¶ã€äº‹ä»¶ç›‘å¬ã€å¿ƒè·³ç›‘æµ‹</p>
</li>
<li>
<pre><code class="language-java">        Thread t = new MyThread();
        //è°ƒç”¨start()æ–¹æ³•å‰ï¼Œè°ƒç”¨setDaemon(true)æŠŠè¯¥çº¿ç¨‹æ ‡è®°ä¸ºå®ˆæŠ¤çº¿ç¨‹
        t.setDaemon(true);
        //å®ˆæŠ¤çº¿ç¨‹ä¸èƒ½æŒæœ‰ä»»ä½•éœ€è¦å…³é—­çš„èµ„æºï¼Œä¾‹å¦‚æ‰“å¼€æ–‡ä»¶ç­‰ï¼Œå› ä¸ºè™šæ‹Ÿæœºé€€å‡ºæ—¶ï¼Œå®ˆæŠ¤çº¿ç¨‹æ²¡æœ‰ä»»ä½•æœºä¼šæ¥å…³é—­æ–‡ä»¶ï¼Œè¿™ä¼šå¯¼è‡´æ•°æ®ä¸¢å¤±ã€‚
        t.start();
      		//åˆ¤æ–­æ˜¯å¦ä¸ºå®ˆæŠ¤çº¿ç¨‹
        System.out.println(t.isDaemon());
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">### çº¿ç¨‹ç»„</span><br><span class="line"></span><br><span class="line">### å¤„ç†æœªæ•è·å¼‚å¸¸å¤„ç†å™¨</span><br><span class="line"></span><br><span class="line">## å¤šçº¿ç¨‹ç¼–ç¨‹æ­¥éª¤</span><br><span class="line"></span><br><span class="line">1. åˆ›å»ºèµ„æºç±»ï¼Œåœ¨èµ„æºç±»åˆ›å»ºå±æ€§å’Œæ“ä½œæ–¹æ³•</span><br><span class="line">2. åœ¨èµ„æºç±»ä¸­æ·»åŠ æ“ä½œæ–¹æ³•ã€åˆ¤æ–­ã€å¹²æ´»ã€é€šçŸ¥ã€‘</span><br><span class="line">3. åˆ›å»ºå¤šä¸ªçº¿ç¨‹ï¼Œè°ƒç”¨èµ„æºç±»çš„æ“ä½œæ–¹æ³•</span><br><span class="line"></span><br><span class="line">## synchronized</span><br><span class="line"></span><br><span class="line">synchronizedæ˜¯Javaä¸­çš„å…³é”®å­—ï¼Œæ˜¯ä¸€ç§**åŒæ­¥é”**ã€‚å®ƒä¿®é¥°çš„å¯¹è±¡æœ‰ä»¥ä¸‹å‡ ç§ï¼š</span><br><span class="line">1. ä¿®é¥°ä¸€ä¸ª**ä»£ç å—**ï¼Œè¢«ä¿®é¥°çš„ä»£ç å—ç§°ä¸ºåŒæ­¥è¯­å¥å—ï¼Œå…¶ä½œç”¨çš„èŒƒå›´æ˜¯å¤§æ‹¬å·&#123;&#125;æ‹¬èµ·æ¥çš„ä»£ç ï¼Œä½œç”¨çš„å¯¹è±¡æ˜¯è°ƒç”¨è¿™ä¸ªä»£ç å—çš„å¯¹è±¡ï¼›</span><br><span class="line">2. ä¿®é¥°ä¸€ä¸ª**æ–¹æ³•**ï¼Œè¢«ä¿®é¥°çš„æ–¹æ³•ç§°ä¸ºåŒæ­¥æ–¹æ³•ï¼Œå…¶ä½œç”¨çš„èŒƒå›´æ˜¯æ•´ä¸ªæ–¹æ³•ï¼Œä½œç”¨çš„å¯¹è±¡æ˜¯è°ƒç”¨è¿™ä¸ªæ–¹æ³•çš„å¯¹è±¡ï¼›è™½ç„¶å¯ä»¥ä½¿ç”¨synchronizedæ¥å®šä¹‰æ–¹æ³•ï¼Œä½†synchronizedå¹¶ä¸å±äºæ–¹æ³•å®šä¹‰çš„ä¸€éƒ¨åˆ†ï¼Œå› æ­¤ï¼Œsynchronizedå…³é”®å­—**ä¸èƒ½è¢«ç»§æ‰¿**ã€‚å¦‚æœåœ¨çˆ¶ç±»ä¸­çš„æŸä¸ªæ–¹æ³•ä½¿ç”¨äº†synchronizedå…³é”®å­—ï¼Œè€Œåœ¨å­ç±»ä¸­è¦†ç›–äº†è¿™ä¸ªæ–¹æ³•ï¼Œåœ¨å­ç±»ä¸­çš„è¿™ä¸ªæ–¹æ³•é»˜è®¤æƒ…å†µä¸‹å¹¶ä¸æ˜¯åŒæ­¥çš„ï¼Œè€Œå¿…é¡»æ˜¾å¼åœ°åœ¨å­ç±»çš„è¿™ä¸ªæ–¹æ³•ä¸­åŠ ä¸Šsynchronizedå…³é”®å­—æ‰å¯ä»¥ã€‚å½“ç„¶ï¼Œè¿˜å¯ä»¥åœ¨å­ç±»æ–¹æ³•ä¸­è°ƒç”¨çˆ¶ç±»ä¸­ç›¸åº”çš„æ–¹æ³•ï¼Œè¿™æ ·è™½ç„¶å­ç±»ä¸­çš„æ–¹æ³•ä¸æ˜¯åŒæ­¥çš„ï¼Œä½†å­ç±»è°ƒç”¨äº†çˆ¶ç±»çš„åŒæ­¥æ–¹æ³•ï¼Œå› æ­¤ï¼Œå­ç±»çš„æ–¹æ³•ä¹Ÿå°±ç›¸å½“äºåŒæ­¥äº†ã€‚</span><br><span class="line">3. ä¿®é¥°ä¸€ä¸ª**é™æ€çš„æ–¹æ³•**ï¼Œå…¶ä½œç”¨çš„èŒƒå›´æ˜¯æ•´ä¸ªé™æ€æ–¹æ³•ï¼Œä½œç”¨çš„å¯¹è±¡æ˜¯è¿™ä¸ªç±»çš„æ‰€æœ‰å¯¹è±¡ï¼›</span><br><span class="line">4. ä¿®é¥°ä¸€ä¸ª**ç±»**ï¼Œå…¶ä½œç”¨çš„èŒƒå›´æ˜¯synchronizedåé¢æ‹¬å·æ‹¬èµ·æ¥çš„éƒ¨åˆ†ï¼Œä½œç”¨ä¸»çš„å¯¹è±¡æ˜¯è¿™ä¸ªç±»çš„æ‰€æœ‰å¯¹è±¡ã€‚</span><br><span class="line"></span><br><span class="line">â€‹		ä¸€ä¸ªå¯¹è±¡é‡Œé¢å¦‚æœæœ‰å¤šä¸ªsynchronizedæ–¹æ³•ï¼ŒæŸä¸€ä¸ªæ—¶åˆ»å†…ï¼Œåªè¦ä¸€ä¸ªçº¿ç¨‹å»è°ƒç”¨å…¶ä¸­çš„ä¸€ä¸ªsynchronizedæ–¹æ³•äº†ï¼Œå…¶å®ƒçš„çº¿ç¨‹éƒ½åªèƒ½ç­‰å¾…ï¼Œæ¢å¥è¯è¯´ï¼ŒæŸä¸€ä¸ªæ—¶åˆ»å†…ï¼Œåªèƒ½æœ‰å”¯ä¸€ä¸€ä¸ªçº¿ç¨‹å»è®¿é—®è¿™äº›synchronizedæ–¹æ³•ï¼Œé”çš„æ˜¯å½“å‰å¯¹è±¡thisï¼Œè¢«é”å®šåï¼Œå…¶å®ƒçš„çº¿ç¨‹éƒ½ä¸èƒ½è¿›å…¥åˆ°å½“å‰å¯¹è±¡çš„å…¶å®ƒçš„synchronizedæ–¹æ³•ï¼ŒåŠ ä¸ªæ™®é€šæ–¹æ³•åå‘ç°å’ŒåŒæ­¥é”æ— å…³ï¼Œæ¢æˆä¸¤ä¸ªå¯¹è±¡åï¼Œä¸æ˜¯åŒä¸€æŠŠé”äº†ï¼Œæƒ…å†µç«‹åˆ»å˜åŒ–ã€‚</span><br><span class="line">synchronizedå®ç°åŒæ­¥çš„åŸºç¡€ï¼šJavaä¸­çš„æ¯ä¸€ä¸ªå¯¹è±¡éƒ½å¯ä»¥ä½œä¸ºé”ã€‚</span><br><span class="line">**å…·ä½“è¡¨ç°ä¸ºä»¥ä¸‹3ç§å½¢å¼ã€‚**</span><br><span class="line">**å¯¹äºæ™®é€šåŒæ­¥æ–¹æ³•ï¼Œé”æ˜¯å½“å‰å®ä¾‹å¯¹è±¡ã€‚**</span><br><span class="line">**å¯¹äºé™æ€åŒæ­¥æ–¹æ³•ï¼Œé”æ˜¯å½“å‰ç±»çš„Classå¯¹è±¡ã€‚**</span><br><span class="line">**å¯¹äºåŒæ­¥æ–¹æ³•å—ï¼Œé”æ˜¯Synchonizedæ‹¬å·é‡Œé…ç½®çš„å¯¹è±¡**</span><br><span class="line">â€‹		å½“ä¸€ä¸ªçº¿ç¨‹è¯•å›¾è®¿é—®åŒæ­¥ä»£ç å—æ—¶ï¼Œå®ƒé¦–å…ˆå¿…é¡»å¾—åˆ°é”ï¼Œé€€å‡ºæˆ–æŠ›å‡ºå¼‚å¸¸æ—¶å¿…é¡»é‡Šæ”¾é”ã€‚ä¹Ÿå°±æ˜¯è¯´å¦‚æœä¸€ä¸ªå®ä¾‹å¯¹è±¡çš„éé™æ€åŒæ­¥æ–¹æ³•è·å–é”åï¼Œè¯¥å®ä¾‹å¯¹è±¡çš„å…¶ä»–éé™æ€åŒæ­¥æ–¹æ³•å¿…é¡»ç­‰å¾…è·å–é”çš„æ–¹æ³•é‡Šæ”¾é”åæ‰èƒ½è·å–é”ï¼Œå¯æ˜¯åˆ«çš„å®ä¾‹å¯¹è±¡çš„éé™æ€åŒæ­¥æ–¹æ³•å› ä¸ºè·Ÿè¯¥å®ä¾‹å¯¹è±¡çš„éé™æ€åŒæ­¥æ–¹æ³•ç”¨çš„æ˜¯ä¸åŒçš„é”ï¼Œæ‰€ä»¥æ¯‹é¡»ç­‰å¾…è¯¥å®ä¾‹å¯¹è±¡å·²è·å–é”çš„éé™æ€åŒæ­¥æ–¹æ³•é‡Šæ”¾é”å°±å¯ä»¥è·å–ä»–ä»¬è‡ªå·±çš„é”ã€‚æ‰€æœ‰çš„é™æ€åŒæ­¥æ–¹æ³•ç”¨çš„ä¹Ÿæ˜¯åŒä¸€æŠŠé”â€”â€”ç±»å¯¹è±¡æœ¬èº«ï¼Œè¿™ä¸¤æŠŠé”æ˜¯ä¸¤ä¸ªä¸åŒçš„å¯¹è±¡ï¼Œæ‰€ä»¥**é™æ€åŒæ­¥æ–¹æ³•ä¸éé™æ€åŒæ­¥æ–¹æ³•ä¹‹é—´æ˜¯ä¸ä¼šæœ‰ç«æ€æ¡ä»¶çš„ã€‚**</span><br><span class="line">â€‹		ä½†æ˜¯ä¸€æ—¦ä¸€ä¸ªé™æ€åŒæ­¥æ–¹æ³•è·å–é”åï¼Œå…¶ä»–çš„é™æ€åŒæ­¥æ–¹æ³•éƒ½å¿…é¡»ç­‰å¾…è¯¥æ–¹æ³•é‡Šæ”¾é”åæ‰èƒ½è·å–é”ï¼Œè€Œä¸ç®¡æ˜¯åŒä¸€ä¸ªå®ä¾‹å¯¹è±¡çš„é™æ€åŒæ­¥æ–¹æ³•ä¹‹é—´ï¼Œè¿˜æ˜¯ä¸åŒçš„å®ä¾‹å¯¹è±¡çš„é™æ€åŒæ­¥æ–¹æ³•ä¹‹é—´ï¼Œåªè¦å®ƒä»¬åŒä¸€ä¸ªç±»çš„å®ä¾‹å¯¹è±¡ï¼</span><br><span class="line"></span><br><span class="line">## çº¿ç¨‹åŒæ­¥</span><br><span class="line"></span><br><span class="line">- å¤šçº¿ç¨‹åŒæ—¶è¯»å†™å…±äº«å˜é‡æ—¶ï¼Œä¼šé€ æˆé€»è¾‘é”™è¯¯ï¼Œå› æ­¤éœ€è¦é€šè¿‡synchronizedåŒæ­¥ï¼›åŒæ­¥çš„æœ¬è´¨å°±æ˜¯ç»™æŒ‡å®šå¯¹è±¡åŠ é”ï¼ŒåŠ é”åæ‰èƒ½ç»§ç»­æ‰§è¡Œåç»­ä»£ç ï¼›æ³¨æ„åŠ é”å¯¹è±¡å¿…é¡»æ˜¯åŒä¸€ä¸ªå®ä¾‹ï¼›å¯¹JVMå®šä¹‰çš„å•ä¸ªåŸå­æ“ä½œä¸éœ€è¦åŒæ­¥ã€‚</span><br><span class="line"></span><br><span class="line">## åŒæ­¥æ–¹æ³•</span><br><span class="line"></span><br><span class="line">- ç”¨synchronizedä¿®é¥°æ–¹æ³•å¯ä»¥æŠŠæ•´ä¸ªæ–¹æ³•å˜ä¸ºåŒæ­¥ä»£ç å—ï¼Œsynchronizedæ–¹æ³•åŠ é”å¯¹è±¡æ˜¯thisï¼›</span><br><span class="line">  é€šè¿‡åˆç†çš„è®¾è®¡å’Œæ•°æ®å°è£…å¯ä»¥è®©ä¸€ä¸ªç±»å˜ä¸ºâ€œçº¿ç¨‹å®‰å…¨â€ï¼›</span><br><span class="line">  ä¸€ä¸ªç±»æ²¡æœ‰ç‰¹æ®Šè¯´æ˜ï¼Œé»˜è®¤ä¸æ˜¯thread-safeï¼›</span><br><span class="line">  å¤šçº¿ç¨‹èƒ½å¦å®‰å…¨è®¿é—®æŸä¸ªéçº¿ç¨‹å®‰å…¨çš„å®ä¾‹ï¼Œéœ€è¦å…·ä½“é—®é¢˜å…·ä½“åˆ†æã€‚</span><br><span class="line"></span><br><span class="line">## æ­»é”</span><br><span class="line"></span><br><span class="line">- Javaçš„synchronizedé”æ˜¯éšå¼ã€è‡ªåŠ¨ä¸Šé”è§£é”ã€‘çš„**å¯é‡å…¥é”ï¼ˆé€’å½’é”ï¼‰**ï¼ŒLockæ˜¯æ˜¾å¼çš„å¯é‡å…¥é”ï¼›æ­»é”äº§ç”Ÿçš„æ¡ä»¶æ˜¯å¤šçº¿ç¨‹å„è‡ªæŒæœ‰ä¸åŒçš„é”ï¼Œå¹¶äº’ç›¸è¯•å›¾è·å–å¯¹æ–¹å·²æŒæœ‰çš„é”ï¼Œå¯¼è‡´æ— é™ç­‰å¾…ï¼›é¿å…æ­»é”çš„æ–¹æ³•æ˜¯å¤šçº¿ç¨‹è·å–é”çš„é¡ºåºè¦ä¸€è‡´ã€‚</span><br><span class="line"></span><br><span class="line">&#96;&#96;&#96;java</span><br><span class="line">package com.atguigu.sync;</span><br><span class="line"></span><br><span class="line">import java.util.concurrent.TimeUnit;</span><br><span class="line"></span><br><span class="line">&#x2F;**</span><br><span class="line"> * æ¼”ç¤ºæ­»é”</span><br><span class="line"> *&#x2F;</span><br><span class="line">public class DeadLock &#123;</span><br><span class="line"></span><br><span class="line">    &#x2F;&#x2F;åˆ›å»ºä¸¤ä¸ªå¯¹è±¡</span><br><span class="line">    static Object a &#x3D; new Object();</span><br><span class="line">    static Object b &#x3D; new Object();</span><br><span class="line"></span><br><span class="line">    public static void main(String[] args) &#123;</span><br><span class="line">        new Thread(()-&gt;&#123;</span><br><span class="line">            synchronized (a) &#123;</span><br><span class="line">                System.out.println(Thread.currentThread().getName()+&quot; æŒæœ‰é”aï¼Œè¯•å›¾è·å–é”b&quot;);</span><br><span class="line">                try &#123;</span><br><span class="line">                    TimeUnit.SECONDS.sleep(1);</span><br><span class="line">                &#125; catch (InterruptedException e) &#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line">                synchronized (b) &#123;</span><br><span class="line">                    System.out.println(Thread.currentThread().getName()+&quot; è·å–é”b&quot;);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,&quot;A&quot;).start();</span><br><span class="line"></span><br><span class="line">        new Thread(()-&gt;&#123;</span><br><span class="line">            synchronized (b) &#123;</span><br><span class="line">                System.out.println(Thread.currentThread().getName()+&quot; æŒæœ‰é”bï¼Œè¯•å›¾è·å–é”a&quot;);</span><br><span class="line">                try &#123;</span><br><span class="line">                    TimeUnit.SECONDS.sleep(1);</span><br><span class="line">                &#125; catch (InterruptedException e) &#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line">                synchronized (a) &#123;</span><br><span class="line">                    System.out.println(Thread.currentThread().getName()+&quot; è·å–é”a&quot;);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,&quot;B&quot;).start();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
</code></pre>
</li>
</ul>
<h3 id="%E9%AA%8C%E8%AF%81%E6%98%AF%E5%90%A6%E4%B8%BA%E6%AD%BB%E9%94%81" id="éªŒè¯æ˜¯å¦ä¸ºæ­»é”">éªŒè¯æ˜¯å¦ä¸ºæ­»é”</h3>
<p>é…ç½®JDKç¯å¢ƒå˜é‡</p>
<p>é¡¹ç›®ä¸­æ‰“å¼€ç»ˆç«¯</p>
<p>è¾“å…¥jps -l æŸ¥çœ‹å½“å‰ç±»çš„è¿›ç¨‹å·</p>
<p>jstack -è¿›ç¨‹å·å¯æŸ¥çœ‹æ˜¯å¦æœ‰æ­»é”åŠç›¸å…³ä¿¡æ¯</p>
<h2 id="%E4%BD%BF%E7%94%A8wait%E5%92%8Cnotify" id="ä½¿ç”¨waitå’Œnotify">ä½¿ç”¨waitå’Œnotify</h2>
<ul>
<li>
<p>waitå’Œnotifyç”¨äºå¤šçº¿ç¨‹åè°ƒè¿è¡Œï¼š<br />
åœ¨synchronizedå†…éƒ¨å¯ä»¥è°ƒç”¨wait()ä½¿çº¿ç¨‹è¿›å…¥ç­‰å¾…çŠ¶æ€ï¼›<br />
å¿…é¡»åœ¨å·²è·å¾—çš„é”å¯¹è±¡ä¸Šè°ƒç”¨wait()æ–¹æ³•ï¼›<br />
åœ¨synchronizedå†…éƒ¨å¯ä»¥è°ƒç”¨notify()æˆ–notifyAll()å”¤é†’å…¶ä»–ç­‰å¾…çº¿ç¨‹ï¼›<br />
å¿…é¡»åœ¨å·²è·å¾—çš„é”å¯¹è±¡ä¸Šè°ƒç”¨notify()æˆ–notifyAll()æ–¹æ³•ï¼›<br />
å·²å”¤é†’çš„çº¿ç¨‹è¿˜éœ€è¦é‡æ–°è·å¾—é”åæ‰èƒ½ç»§ç»­æ‰§è¡Œã€‚</p>
</li>
<li>
<p>è™šå‡å”¤é†’</p>
<p>wait()åœ¨å“ªé‡Œç¡å°±åœ¨é‚£é‡Œé†’ä½¿ç”¨æ—¶åº”ä½¿ç”¨whileè€Œä¸æ˜¯if</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(num!=<span class="number">1</span>)&#123;</span><br><span class="line">    <span class="keyword">this</span>.wait();  <span class="comment">//notifyAllï¼ˆï¼‰å”¤é†’ä¹‹åä¼šç›´æ¥ä»this.waitï¼ˆï¼‰è¯­å¥å¼€å§‹æ‰§è¡Œï¼Œè·³è¿‡äº†ifåˆ¤æ–­</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">while</span>(num!=<span class="number">1</span>)&#123;</span><br><span class="line">    <span class="keyword">this</span>.wait();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h2 id="%E4%BD%BF%E7%94%A8reentrantlock" id="ä½¿ç”¨ReentrantLock">ä½¿ç”¨ReentrantLock</h2>
<ul>
<li>ReentrantLockå¯ä»¥æ›¿ä»£synchronizedè¿›è¡ŒåŒæ­¥ï¼›</li>
</ul>
<p>ReentrantLockè·å–é”æ›´å®‰å…¨ï¼›</p>
<p>å¿…é¡»å…ˆè·å–åˆ°é”ï¼Œå†è¿›å…¥try {...}ä»£ç å—ï¼Œæœ€åä½¿ç”¨finallyä¿è¯é‡Šæ”¾é”ï¼›</p>
<p>å¯ä»¥ä½¿ç”¨tryLock()å°è¯•è·å–é”ã€‚</p>
<p>è®¾ç½®ä¸ºReentrantLockï¼ˆtrueï¼‰ä½¿å…¶æˆä¸ºå…¬å¹³é”</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">Lock lock = <span class="keyword">new</span> ReentrantLock();</span><br><span class="line"></span><br><span class="line">     Thread t1 = <span class="keyword">new</span> Thread() &#123;</span><br><span class="line">         <span class="meta">@Override</span></span><br><span class="line">         <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">             <span class="keyword">try</span> &#123;</span><br><span class="line">                 log(<span class="string">&quot;çº¿ç¨‹å¯åŠ¨&quot;</span>);</span><br><span class="line">                 log(<span class="string">&quot;è¯•å›¾å æœ‰å¯¹è±¡ï¼šlock&quot;</span>);</span><br><span class="line">	<span class="comment">//lockåŒæ­¥</span></span><br><span class="line">                 lock.lock();</span><br><span class="line"></span><br><span class="line">                 log(<span class="string">&quot;å æœ‰å¯¹è±¡ï¼šlock&quot;</span>);</span><br><span class="line">                 log(<span class="string">&quot;è¿›è¡Œ5ç§’çš„ä¸šåŠ¡æ“ä½œ&quot;</span>);</span><br><span class="line">                 Thread.sleep(<span class="number">5000</span>);</span><br><span class="line"></span><br><span class="line">             &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                 e.printStackTrace();</span><br><span class="line">             &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">                 log(<span class="string">&quot;é‡Šæ”¾å¯¹è±¡ï¼šlock&quot;</span>);</span><br><span class="line">                 <span class="comment">//æ‰‹åŠ¨é‡Šæ”¾</span></span><br><span class="line">                 lock.unlock();</span><br><span class="line">             &#125;</span><br><span class="line">             log(<span class="string">&quot;çº¿ç¨‹ç»“æŸ&quot;</span>);</span><br><span class="line">         &#125;</span><br><span class="line">     &#125;;</span><br><span class="line">     t1.setName(<span class="string">&quot;t1&quot;</span>);</span><br><span class="line">     t1.start();</span><br></pre></td></tr></table></figure>
<h2 id="%E4%BD%BF%E7%94%A8condition" id="ä½¿ç”¨Condition">ä½¿ç”¨Condition</h2>
<ul>
<li>Conditionå¯ä»¥æ›¿ä»£waitå’Œnotifyï¼›</li>
</ul>
<p>Conditionå¯¹è±¡å¿…é¡»ä»Lockå¯¹è±¡è·å–ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> Lock lock=<span class="keyword">new</span> ReentrantLock();</span><br><span class="line"><span class="keyword">private</span> Condition condition=lock.newCondition();</span><br></pre></td></tr></table></figure>
<h2 id="%E9%94%81" id="é”"><a target="_blank" rel="noopener" href="https://tech.meituan.com/2018/11/15/java-lock.html"><strong>é”</strong></a></h2>
<p>ä¸€ç§è®¾è®¡æ€æƒ³ã€ä¸åŒç¯å¢ƒä½¿ç”¨ä¸åŒçš„é”ä»¥è¾¾åˆ°èµ„æºæœ€ä¼˜åˆ©ç”¨ã€‚</p>
<img src="https://gitee.com/mychimei/picture/raw/master/image-20220313114343901.png" alt="image-20220313114343901" style="zoom:80%;" />
<h3 id="%E4%B9%90%E8%A7%82%E9%94%81-vs-%E6%82%B2%E8%A7%82%E9%94%81" id="ä¹è§‚é”-VS-æ‚²è§‚é”">ä¹è§‚é” VS æ‚²è§‚é”</h3>
<p><strong>æ‚²è§‚é”å…ˆåŠ é”å†æ“ä½œèµ„æºï¼Œä¹è§‚é”ç›´æ¥æ“ä½œèµ„æºã€‚</strong></p>
<p>ä¸ºä½•ä¹è§‚é”èƒ½å¤Ÿåšåˆ°ä¸é”å®šåŒæ­¥èµ„æºä¹Ÿå¯ä»¥æ­£ç¡®çš„å®ç°çº¿ç¨‹åŒæ­¥å‘¢ï¼Ÿæˆ‘ä»¬é€šè¿‡ä»‹ç»ä¹è§‚é”çš„ä¸»è¦å®ç°æ–¹å¼ â€œCASâ€ çš„æŠ€æœ¯åŸç†æ¥ä¸ºå¤§å®¶è§£æƒ‘ã€‚</p>
<p><strong>CAS</strong>å…¨ç§° Compare And Swapï¼ˆæ¯”è¾ƒä¸äº¤æ¢ï¼‰ï¼Œæ˜¯ä¸€ç§æ— é”ç®—æ³•ã€‚åœ¨ä¸ä½¿ç”¨é”ï¼ˆæ²¡æœ‰çº¿ç¨‹è¢«é˜»å¡ï¼‰çš„æƒ…å†µä¸‹å®ç°å¤šçº¿ç¨‹ä¹‹é—´çš„å˜é‡åŒæ­¥ã€‚java.util.concurrentåŒ…ä¸­çš„åŸå­ç±»å°±æ˜¯é€šè¿‡CASæ¥å®ç°äº†ä¹è§‚é”ã€‚</p>
<p>CASç®—æ³•æ¶‰åŠåˆ°ä¸‰ä¸ªæ“ä½œæ•°ï¼š</p>
<ul>
<li>éœ€è¦è¯»å†™çš„å†…å­˜å€¼ Vã€‚</li>
<li>è¿›è¡Œæ¯”è¾ƒçš„å€¼ Aã€‚</li>
<li>è¦å†™å…¥çš„æ–°å€¼ Bã€‚</li>
</ul>
<p>å½“ä¸”ä»…å½“ V çš„å€¼ç­‰äº A æ—¶ï¼ŒCASé€šè¿‡åŸå­æ–¹å¼ç”¨æ–°å€¼Bæ¥æ›´æ–°Vçš„å€¼ï¼ˆâ€œæ¯”è¾ƒ+æ›´æ–°â€æ•´ä½“æ˜¯ä¸€ä¸ªåŸå­æ“ä½œï¼‰ï¼Œå¦åˆ™ä¸ä¼šæ‰§è¡Œä»»ä½•æ“ä½œã€‚ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œâ€œæ›´æ–°â€æ˜¯ä¸€ä¸ªä¸æ–­é‡è¯•çš„æ“ä½œã€‚</p>
<p><strong>CASé—®é¢˜</strong>ï¼š</p>
<ol>
<li>
<p>ABAé—®é¢˜</p>
<p>ã€‚CASéœ€è¦åœ¨æ“ä½œå€¼çš„æ—¶å€™æ£€æŸ¥å†…å­˜å€¼æ˜¯å¦å‘ç”Ÿå˜åŒ–ï¼Œæ²¡æœ‰å‘ç”Ÿå˜åŒ–æ‰ä¼šæ›´æ–°å†…å­˜å€¼ã€‚ä½†æ˜¯å¦‚æœå†…å­˜å€¼åŸæ¥æ˜¯Aï¼Œåæ¥å˜æˆäº†Bï¼Œç„¶ååˆå˜æˆäº†Aï¼Œé‚£ä¹ˆCASè¿›è¡Œæ£€æŸ¥æ—¶ä¼šå‘ç°å€¼æ²¡æœ‰å‘ç”Ÿå˜åŒ–ï¼Œä½†æ˜¯å®é™…ä¸Šæ˜¯æœ‰å˜åŒ–çš„ã€‚ABAé—®é¢˜çš„è§£å†³æ€è·¯å°±æ˜¯åœ¨å˜é‡å‰é¢æ·»åŠ ç‰ˆæœ¬å·ï¼Œæ¯æ¬¡å˜é‡æ›´æ–°çš„æ—¶å€™éƒ½æŠŠç‰ˆæœ¬å·åŠ ä¸€ï¼Œè¿™æ ·å˜åŒ–è¿‡ç¨‹å°±ä»â€œAï¼Bï¼Aâ€å˜æˆäº†â€œ1Aï¼2Bï¼3Aâ€ã€‚</p>
<ul>
<li>JDKä»1.5å¼€å§‹æä¾›äº†AtomicStampedReferenceç±»æ¥è§£å†³ABAé—®é¢˜ï¼Œå…·ä½“æ“ä½œå°è£…åœ¨compareAndSet()ä¸­ã€‚compareAndSet()é¦–å…ˆæ£€æŸ¥å½“å‰å¼•ç”¨å’Œå½“å‰æ ‡å¿—ä¸é¢„æœŸå¼•ç”¨å’Œé¢„æœŸæ ‡å¿—æ˜¯å¦ç›¸ç­‰ï¼Œå¦‚æœéƒ½ç›¸ç­‰ï¼Œåˆ™ä»¥åŸå­æ–¹å¼å°†å¼•ç”¨å€¼å’Œæ ‡å¿—çš„å€¼è®¾ç½®ä¸ºç»™å®šçš„æ›´æ–°å€¼ã€‚</li>
</ul>
</li>
<li>
<p><strong>å¾ªç¯æ—¶é—´é•¿å¼€é”€å¤§</strong>ã€‚CASæ“ä½œå¦‚æœé•¿æ—¶é—´ä¸æˆåŠŸï¼Œä¼šå¯¼è‡´å…¶ä¸€ç›´è‡ªæ—‹ï¼Œç»™CPUå¸¦æ¥éå¸¸å¤§çš„å¼€é”€ã€‚</p>
</li>
<li>
<p>åªèƒ½ä¿è¯ä¸€ä¸ªå…±äº«å˜é‡çš„åŸå­æ“ä½œ</p>
<ul>
<li>
<p>å¯¹ä¸€ä¸ªå…±äº«å˜é‡æ‰§è¡Œæ“ä½œæ—¶ï¼ŒCASèƒ½å¤Ÿä¿è¯åŸå­æ“ä½œï¼Œä½†æ˜¯å¯¹å¤šä¸ªå…±äº«å˜é‡æ“ä½œæ—¶ï¼ŒCASæ˜¯æ— æ³•ä¿è¯æ“ä½œçš„åŸå­æ€§çš„ã€‚</p>
</li>
<li>
<p>Javaä»1.5å¼€å§‹JDKæä¾›äº†AtomicReferenceç±»æ¥ä¿è¯å¼•ç”¨å¯¹è±¡ä¹‹é—´çš„åŸå­æ€§ï¼Œå¯ä»¥æŠŠå¤šä¸ªå˜é‡æ”¾åœ¨ä¸€ä¸ªå¯¹è±¡é‡Œæ¥è¿›è¡ŒCASæ“ä½œã€‚</p>
</li>
</ul>
</li>
</ol>
<h3 id="%E8%87%AA%E6%97%8B%E9%94%81-vs-%E9%80%82%E5%BA%94%E6%80%A7%E8%87%AA%E6%97%8B%E9%94%81" id="è‡ªæ—‹é”-VS-é€‚åº”æ€§è‡ªæ—‹é”">è‡ªæ—‹é” VS é€‚åº”æ€§è‡ªæ—‹é”</h3>
<p>â€‹		è‡ªæ—‹é”ä¸æ”¾å¼ƒCPUæ—¶é—´ç‰‡ï¼Œè‡ªæ—‹ç­‰å¾…é”é‡Šæ”¾ï¼Œå¦‚æœè‡ªæ—‹è¶…è¿‡äº†é™å®šæ¬¡æ•°ï¼ˆé»˜è®¤æ˜¯10æ¬¡ï¼Œå¯ä»¥ä½¿ç”¨-XX:PreBlockSpinæ¥æ›´æ”¹ï¼‰æ²¡æœ‰æˆåŠŸè·å¾—é”ï¼Œå°±åº”å½“æŒ‚èµ·çº¿ç¨‹ã€‚<br />
â€‹		é€‚åº”æ€§è‡ªæ—‹é”çš„è‡ªé€‚åº”æ„å‘³ç€è‡ªæ—‹çš„æ—¶é—´ï¼ˆæ¬¡æ•°ï¼‰ä¸å†å›ºå®šï¼Œè€Œæ˜¯ç”±å‰ä¸€æ¬¡åœ¨åŒä¸€ä¸ªé”ä¸Šçš„è‡ªæ—‹æ—¶é—´åŠé”çš„æ‹¥æœ‰è€…çš„çŠ¶æ€æ¥å†³å®šã€‚å¦‚æœåœ¨åŒä¸€ä¸ªé”å¯¹è±¡ä¸Šï¼Œè‡ªæ—‹ç­‰å¾…åˆšåˆšæˆåŠŸè·å¾—è¿‡é”ï¼Œå¹¶ä¸”æŒæœ‰é”çš„çº¿ç¨‹æ­£åœ¨è¿è¡Œä¸­ï¼Œé‚£ä¹ˆè™šæ‹Ÿæœºå°±ä¼šè®¤ä¸ºè¿™æ¬¡è‡ªæ—‹ä¹Ÿæ˜¯å¾ˆæœ‰å¯èƒ½å†æ¬¡æˆåŠŸï¼Œè¿›è€Œå®ƒå°†å…è®¸è‡ªæ—‹ç­‰å¾…æŒç»­ç›¸å¯¹æ›´é•¿çš„æ—¶é—´ã€‚å¦‚æœå¯¹äºæŸä¸ªé”ï¼Œè‡ªæ—‹å¾ˆå°‘æˆåŠŸè·å¾—è¿‡ï¼Œé‚£åœ¨ä»¥åå°è¯•è·å–è¿™ä¸ªé”æ—¶å°†å¯èƒ½çœç•¥æ‰è‡ªæ—‹è¿‡ç¨‹ï¼Œç›´æ¥é˜»å¡çº¿ç¨‹ï¼Œé¿å…æµªè´¹å¤„ç†å™¨èµ„æºã€‚åœ¨è‡ªæ—‹é”ä¸­ å¦æœ‰ä¸‰ç§å¸¸è§çš„é”å½¢å¼:TicketLockã€CLHlockå’ŒMCSlock</p>
<h3 id="%E6%97%A0%E9%94%81-vs-%E5%81%8F%E5%90%91%E9%94%81-vs-%E8%BD%BB%E9%87%8F%E7%BA%A7%E9%94%81-vs-%E9%87%8D%E9%87%8F%E7%BA%A7%E9%94%81" id="æ— é”-VS-åå‘é”-VS-è½»é‡çº§é”-VS-é‡é‡çº§é”">æ— é” VS åå‘é” VS è½»é‡çº§é” VS é‡é‡çº§é”</h3>
<p><strong>æ— é”</strong>ï¼Œæ²¡æœ‰å¯¹èµ„æºè¿›è¡Œé”å®šï¼Œæ‰€æœ‰çš„çº¿ç¨‹éƒ½èƒ½è®¿é—®å¹¶ä¿®æ”¹åŒä¸€ä¸ªèµ„æºï¼Œä½†<strong>åŒæ—¶åªæœ‰ä¸€ä¸ªçº¿ç¨‹èƒ½ä¿®æ”¹æˆåŠŸ</strong>ã€‚</p>
<p><strong>åå‘é”</strong>ï¼Œä¸€æ®µä»£ç <strong>ä¸€ç›´</strong>è¢«ä¸€ä¸ªçº¿ç¨‹è®¿é—®ï¼Œé‚£ä¹ˆè¯¥çº¿ç¨‹ä¼š<strong>è‡ªåŠ¨è·å–é”</strong>ï¼Œé™ä½è·å–é”çš„ä»£ä»·ã€‚</p>
<p>åå‘é”æ—¶ï¼Œè¢«<strong>å¦å¤–çš„çº¿ç¨‹æ‰€è®¿é—®</strong>ï¼Œåå‘é”å°±ä¼šå‡çº§ä¸º<strong>è½»é‡çº§é”</strong>ï¼Œå…¶ä»–çº¿ç¨‹ä¼šé€šè¿‡è‡ªæ—‹çš„å½¢å¼å°è¯•è·å–é”ï¼Œä¸ä¼šé˜»å¡ï¼Œä»è€Œæé«˜æ€§èƒ½ã€‚</p>
<p>è‹¥å½“å‰åªæœ‰ä¸€ä¸ªç­‰å¾…çº¿ç¨‹ï¼Œåˆ™è¯¥çº¿ç¨‹é€šè¿‡è‡ªæ—‹è¿›è¡Œç­‰å¾…ã€‚ä½†æ˜¯å½“<strong>è‡ªæ—‹è¶…è¿‡ä¸€å®šçš„æ¬¡æ•°</strong>ï¼Œæˆ–è€…ä¸€ä¸ªçº¿ç¨‹åœ¨æŒæœ‰é”ï¼Œä¸€ä¸ªåœ¨è‡ªæ—‹ï¼Œåˆæœ‰ç¬¬ä¸‰ä¸ªæ¥è®¿æ—¶ï¼ˆ<strong>æˆ–è½»é‡çº§é”æ—¶æœ‰ç¬¬ä¸‰è€…</strong>ï¼‰ï¼Œè½»é‡çº§é”å‡çº§ä¸º<strong>é‡é‡çº§é”</strong>ã€‚</p>
<h3 id="%E5%85%AC%E5%B9%B3%E9%94%81-vs-%E9%9D%9E%E5%85%AC%E5%B9%B3%E9%94%81" id="å…¬å¹³é”-VS-éå…¬å¹³é”">å…¬å¹³é” VS éå…¬å¹³é”</h3>
<p><strong>å…¬å¹³é”</strong>é€šè¿‡ç”³è¯·é”çš„é¡ºåºæ¥è·å–é”<br />
<strong>éå…¬å¹³é”</strong>ç›´æ¥è·å–é”ï¼Œè·å–ä¸åˆ°ä¼šåˆ°ç­‰å¾…é˜Ÿåˆ—æœ«å°¾ç­‰å¾…ï¼ŒèŠ‚çº¦å”¤èµ·çº¿ç¨‹çš„å¼€é”€ï¼Œæé«˜ååç‡ï¼Œä½†æ˜¯éƒ¨åˆ†çº¿ç¨‹å¯èƒ½ä¼šè¢«é¥¿æ­»ï¼Œæˆ–ç­‰å¾…æ—¶é—´å¾ˆé•¿ã€‚</p>
<h3 id="%E5%8F%AF%E9%87%8D%E5%85%A5%E9%94%81-vs-%E9%9D%9E%E5%8F%AF%E9%87%8D%E5%85%A5%E9%94%81" id="å¯é‡å…¥é”-VS-éå¯é‡å…¥é”">å¯é‡å…¥é” VS éå¯é‡å…¥é”</h3>
<p><strong>å¯é‡å…¥é”ï¼ˆé€’å½’é”ï¼‰</strong>ï¼Œæ˜¯æŒ‡åœ¨åŒä¸€ä¸ªçº¿ç¨‹åœ¨å¤–å±‚æ–¹æ³•è·å–é”çš„æ—¶å€™ï¼Œå†è¿›å…¥è¯¥çº¿ç¨‹çš„å†…å±‚æ–¹æ³•ä¼šè‡ªåŠ¨è·å–é”ï¼ˆå‰æé”å¯¹è±¡å¾—æ˜¯åŒä¸€ä¸ªå¯¹è±¡æˆ–è€…classï¼‰ï¼Œä¸ä¼šå› ä¸ºä¹‹å‰å·²ç»è·å–è¿‡è¿˜æ²¡é‡Šæ”¾è€Œé˜»å¡ã€‚</p>
<p><strong>éå¯é‡å…¥é”</strong>ï¼Œåä¹‹åŒçº¿ç¨‹åœ¨å¤–å±‚è·å–é”æ—¶åœ¨è¿›å…¥å†…å±‚éœ€è¦å…ˆé‡Šæ”¾é”ï¼Œé‡å¤è°ƒç”¨åŒæ­¥æ•°æ®æ—¶å¯èƒ½ä¼šå¯¼è‡´æ­»é”ã€‚</p>
<h3 id="%E7%8B%AC%E4%BA%AB%E9%94%81-vs-%E5%85%B1%E4%BA%AB%E9%94%81" id="ç‹¬äº«é”-VS-å…±äº«é”">ç‹¬äº«é” VS å…±äº«é”</h3>
<p><strong>ç‹¬äº«é”ï¼ˆæ’ä»–é”ï¼‰</strong>ï¼Œè¯¥é”ä¸€æ¬¡åªèƒ½è¢«ä¸€ä¸ªçº¿ç¨‹æ‹¥æœ‰ï¼ŒåŠ é”åä¸èƒ½å†åŠ å…¶ä»–é”ï¼Œçº¿ç¨‹æ‹¥æœ‰åå¯è¯»ä¸æ”¹ã€‚<br />
<strong>å…±äº«é”</strong>ï¼Œè¯¥é”èƒ½è¢«å¤šä¸ªçº¿ç¨‹æ‰€æ‹¥æœ‰çš„ï¼Œæ‹¥æœ‰ååªèƒ½è¯»ä¸å¯æ”¹ï¼Œå…¶ä»–çº¿ç¨‹å¯ä»¥åŠ å…±äº«é”ä¸èƒ½åŠ ç‹¬äº«é”ï¼ˆæ’å®ƒé”ï¼‰ã€‚</p>
<h3 id="%E8%AF%BB%E9%94%81%E5%86%99%E9%94%81" id="è¯»é”å†™é”">è¯»é”å†™é”</h3>
<h3 id="reentrantreadwritelock-%E9%87%8C%E7%9A%84%E4%B8%A4%E6%8A%8A%E9%94%81-readlock-%E5%92%8C-writelock%EF%BC%8C%E8%AF%BB%E9%94%81%E6%98%AF%E5%85%B1%E4%BA%AB%E9%94%81%EF%BC%8C%E5%86%99%E9%94%81%E6%98%AF%E7%8B%AC%E4%BA%AB%E9%94%81%EF%BC%8C%E9%83%BD%E4%BC%9A%E5%8F%91%E7%94%9F%E6%AD%BB%E9%94%81%E3%80%82" id="ReentrantReadWriteLock-é‡Œçš„ä¸¤æŠŠé”-ReadLock-å’Œ-WriteLockï¼Œè¯»é”æ˜¯å…±äº«é”ï¼Œå†™é”æ˜¯ç‹¬äº«é”ï¼Œéƒ½ä¼šå‘ç”Ÿæ­»é”ã€‚">ReentrantReadWriteLock é‡Œçš„ä¸¤æŠŠé” ReadLock å’Œ WriteLockï¼Œè¯»é”æ˜¯å…±äº«é”ï¼Œå†™é”æ˜¯ç‹¬äº«é”ï¼Œéƒ½ä¼šå‘ç”Ÿæ­»é”ã€‚</h3>
<img src="https://gitee.com/mychimei/picture/raw/master/work/14-%E8%AF%BB%E5%86%99%E9%94%81%E6%BC%94%E5%8F%98.png" alt="14-è¯»å†™é”æ¼”å˜" style="zoom: 80%;" />
<p>ç°å®ä¸­æœ‰è¿™æ ·ä¸€ç§åœºæ™¯ï¼šå¯¹å…±äº«èµ„æºæœ‰è¯»å’Œå†™çš„æ“ä½œï¼Œä¸”å†™æ“ä½œæ²¡æœ‰è¯»æ“ä½œé‚£ä¹ˆé¢‘ç¹ã€‚åœ¨æ²¡æœ‰å†™æ“ä½œçš„æ—¶å€™ï¼Œå¤šä¸ªçº¿ç¨‹åŒæ—¶è¯»ä¸€ä¸ªèµ„æºæ²¡æœ‰ä»»ä½•é—®é¢˜ï¼Œæ‰€ä»¥åº”è¯¥å…è®¸å¤šä¸ªçº¿ç¨‹åŒæ—¶è¯»å–å…±äº«èµ„æºï¼›ä½†æ˜¯å¦‚æœä¸€ä¸ªçº¿ç¨‹æƒ³å»å†™è¿™äº›å…±äº«èµ„æºï¼Œå°±ä¸åº”è¯¥å…è®¸å…¶ä»–çº¿ç¨‹å¯¹è¯¥èµ„æºè¿›è¡Œè¯»å’Œå†™çš„æ“ä½œäº†ã€‚<br />
é’ˆå¯¹è¿™ç§åœºæ™¯ï¼ŒJAVAçš„å¹¶å‘åŒ…æä¾›äº†è¯»å†™é”ReentrantReadWriteLockï¼Œå®ƒè¡¨ç¤ºä¸¤ä¸ªé”ï¼Œä¸€ä¸ªæ˜¯è¯»æ“ä½œç›¸å…³çš„é”ï¼Œç§°ä¸ºå…±äº«é”ï¼›ä¸€ä¸ªæ˜¯å†™ç›¸å…³çš„é”ï¼Œç§°ä¸ºæ’ä»–é”</p>
<ol>
<li>çº¿ç¨‹è¿›å…¥è¯»é”çš„å‰ææ¡ä»¶ï¼š<br />
â€¢ æ²¡æœ‰å…¶ä»–çº¿ç¨‹çš„å†™é”<br />
â€¢ æ²¡æœ‰å†™è¯·æ±‚, æˆ–è€…<mark>æœ‰å†™è¯·æ±‚ï¼Œä½†è°ƒç”¨çº¿ç¨‹å’ŒæŒæœ‰é”çš„çº¿ç¨‹æ˜¯åŒä¸€ä¸ª(å¯é‡å…¥é”)ã€‚</mark></li>
<li>çº¿ç¨‹è¿›å…¥å†™é”çš„å‰ææ¡ä»¶ï¼š<br />
â€¢ æ²¡æœ‰å…¶ä»–çº¿ç¨‹çš„è¯»é”<br />
â€¢ æ²¡æœ‰å…¶ä»–çº¿ç¨‹çš„å†™é”<br />
è€Œè¯»å†™é”æœ‰ä»¥ä¸‹ä¸‰ä¸ªé‡è¦çš„ç‰¹æ€§ï¼š<br />
ï¼ˆ1ï¼‰å…¬å¹³é€‰æ‹©æ€§ï¼šæ”¯æŒéå…¬å¹³ï¼ˆé»˜è®¤ï¼‰å’Œå…¬å¹³çš„é”è·å–æ–¹å¼ï¼Œååé‡è¿˜æ˜¯éå…¬å¹³ä¼˜äºå…¬å¹³ã€‚<br />
ï¼ˆ2ï¼‰é‡è¿›å…¥ï¼šè¯»é”å’Œå†™é”éƒ½æ”¯æŒçº¿ç¨‹é‡è¿›å…¥ã€‚<br />
ï¼ˆ3ï¼‰é”é™çº§ï¼šéµå¾ªè·å–å†™é”ã€è·å–è¯»é”å†é‡Šæ”¾å†™é”çš„æ¬¡åºï¼Œå†™é”èƒ½å¤Ÿé™çº§æˆä¸ºè¯»é”ã€‚</li>
</ol>
<img src="https://gitee.com/mychimei/picture/raw/master/work/15-%E8%AF%BB%E5%86%99%E9%94%81%E9%99%8D%E7%BA%A7.png" alt="15-è¯»å†™é”é™çº§" style="zoom: 67%;" />
<h3 id="%E8%A1%A8%E9%94%81%E8%A1%8C%E9%94%81" id="è¡¨é”è¡Œé”">è¡¨é”è¡Œé”</h3>
<p>è¡¨é”æ•´å¼ è¡¨ï¼Œè€Œè¡Œé”é”å•æ¡æ•°æ®ä¸”å¯èƒ½å‘ç”Ÿæ­»é”ã€‚</p>
<h4 id="%E4%BD%BF%E7%94%A8readwritelock" id="ä½¿ç”¨ReadWriteLock">ä½¿ç”¨ReadWriteLock</h4>
<ul>
<li>ä½¿ç”¨ReadWriteLockå¯ä»¥æé«˜è¯»å–æ•ˆç‡ï¼š<br />
ReadWriteLockåªå…è®¸ä¸€ä¸ªçº¿ç¨‹å†™å…¥ï¼›<br />
ReadWriteLockå…è®¸å¤šä¸ªçº¿ç¨‹åœ¨æ²¡æœ‰å†™å…¥æ—¶åŒæ—¶è¯»å–ï¼›<br />
ReadWriteLocké€‚åˆè¯»å¤šå†™å°‘çš„åœºæ™¯ã€‚</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.atguigu.readwrite;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.HashMap;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.TimeUnit;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.locks.Lock;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.locks.ReadWriteLock;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.locks.ReentrantReadWriteLock;</span><br><span class="line"></span><br><span class="line"><span class="comment">//èµ„æºç±»</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyCache</span> </span>&#123;</span><br><span class="line">    <span class="comment">//åˆ›å»ºmapé›†åˆ</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">volatile</span> Map&lt;String,Object&gt; map = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="comment">//åˆ›å»ºè¯»å†™é”å¯¹è±¡</span></span><br><span class="line">    <span class="keyword">private</span> ReadWriteLock rwLock = <span class="keyword">new</span> ReentrantReadWriteLock();</span><br><span class="line"></span><br><span class="line">    <span class="comment">//æ”¾æ•°æ®</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">put</span><span class="params">(String key,Object value)</span> </span>&#123;</span><br><span class="line">        <span class="comment">//æ·»åŠ å†™é”</span></span><br><span class="line">        rwLock.writeLock().lock();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            System.out.println(Thread.currentThread().getName()+<span class="string">&quot; æ­£åœ¨å†™æ“ä½œ&quot;</span>+key);</span><br><span class="line">            <span class="comment">//æš‚åœä¸€ä¼š</span></span><br><span class="line">            TimeUnit.MICROSECONDS.sleep(<span class="number">300</span>);</span><br><span class="line">            <span class="comment">//æ”¾æ•°æ®</span></span><br><span class="line">            map.put(key,value);</span><br><span class="line">            System.out.println(Thread.currentThread().getName()+<span class="string">&quot; å†™å®Œäº†&quot;</span>+key);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            <span class="comment">//é‡Šæ”¾å†™é”</span></span><br><span class="line">            rwLock.writeLock().unlock();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//å–æ•°æ®</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Object <span class="title">get</span><span class="params">(String key)</span> </span>&#123;</span><br><span class="line">        <span class="comment">//æ·»åŠ è¯»é”</span></span><br><span class="line">        rwLock.readLock().lock();</span><br><span class="line">        Object result = <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            System.out.println(Thread.currentThread().getName()+<span class="string">&quot; æ­£åœ¨è¯»å–æ“ä½œ&quot;</span>+key);</span><br><span class="line">            <span class="comment">//æš‚åœä¸€ä¼š</span></span><br><span class="line">            TimeUnit.MICROSECONDS.sleep(<span class="number">300</span>);</span><br><span class="line">            result = map.get(key);</span><br><span class="line">            System.out.println(Thread.currentThread().getName()+<span class="string">&quot; å–å®Œäº†&quot;</span>+key);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            <span class="comment">//é‡Šæ”¾è¯»é”</span></span><br><span class="line">            rwLock.readLock().unlock();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ReadWriteLockDemo</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> InterruptedException </span>&#123;</span><br><span class="line">        MyCache myCache = <span class="keyword">new</span> MyCache();</span><br><span class="line">        <span class="comment">//åˆ›å»ºçº¿ç¨‹æ”¾æ•°æ®</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;=<span class="number">5</span>; i++) &#123;</span><br><span class="line">            <span class="keyword">final</span> <span class="keyword">int</span> num = i;</span><br><span class="line">            <span class="keyword">new</span> Thread(()-&gt;&#123;</span><br><span class="line">                myCache.put(num+<span class="string">&quot;&quot;</span>,num+<span class="string">&quot;&quot;</span>);</span><br><span class="line">            &#125;,String.valueOf(i)).start();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        TimeUnit.MICROSECONDS.sleep(<span class="number">300</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//åˆ›å»ºçº¿ç¨‹å–æ•°æ®</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;=<span class="number">5</span>; i++) &#123;</span><br><span class="line">            <span class="keyword">final</span> <span class="keyword">int</span> num = i;</span><br><span class="line">            <span class="keyword">new</span> Thread(()-&gt;&#123;</span><br><span class="line">                myCache.get(num+<span class="string">&quot;&quot;</span>);</span><br><span class="line">            &#125;,String.valueOf(i)).start();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h4 id="%E4%BD%BF%E7%94%A8stampedlock" id="ä½¿ç”¨StampedLock">ä½¿ç”¨StampedLock</h4>
<ul>
<li>StampedLockæä¾›äº†ä¹è§‚è¯»é”ï¼Œå¯å–ä»£ReadWriteLockä»¥è¿›ä¸€æ­¥æå‡å¹¶å‘æ€§èƒ½ï¼›StampedLockæ˜¯ä¸å¯é‡å…¥é”ã€‚</li>
</ul>
<h2 id="%E4%BD%BF%E7%94%A8concurrent%E9%9B%86%E5%90%88" id="ä½¿ç”¨Concurrenté›†åˆ">ä½¿ç”¨Concurrenté›†åˆ</h2>
<ul>
<li>ä½¿ç”¨java.util.concurrentåŒ…æä¾›çš„çº¿ç¨‹å®‰å…¨çš„å¹¶å‘é›†åˆå¯ä»¥å¤§å¤§ç®€åŒ–å¤šçº¿ç¨‹ç¼–ç¨‹ï¼š</li>
</ul>
<p>å¤šçº¿ç¨‹åŒæ—¶è¯»å†™å¹¶å‘é›†åˆæ˜¯å®‰å…¨çš„ï¼›</p>
<p>å°½é‡ä½¿ç”¨Javaæ ‡å‡†åº“æä¾›çš„å¹¶å‘é›†åˆï¼Œé¿å…è‡ªå·±ç¼–å†™åŒæ­¥ä»£ç ã€‚</p>
<h2 id="%E4%BD%BF%E7%94%A8atomic" id="ä½¿ç”¨Atomic">ä½¿ç”¨Atomic</h2>
<ul>
<li>ä½¿ç”¨java.util.concurrent.atomicæä¾›çš„åŸå­æ“ä½œå¯ä»¥ç®€åŒ–å¤šçº¿ç¨‹ç¼–ç¨‹ï¼š</li>
</ul>
<p>åŸå­æ“ä½œå®ç°äº†æ— é”çš„çº¿ç¨‹å®‰å…¨ï¼›</p>
<p>é€‚ç”¨äºè®¡æ•°å™¨ï¼Œç´¯åŠ å™¨ç­‰ã€‚</p>
<ul>
<li>å¢åŠ å€¼å¹¶è¿”å›æ–°å€¼ï¼šint addAndGet(int delta)<br />
åŠ 1åè¿”å›æ–°å€¼ï¼šint incrementAndGet()<br />
è·å–å½“å‰å€¼ï¼šint get()<br />
ç”¨CASæ–¹å¼è®¾ç½®ï¼šint compareAndSet(int expect, int update)</li>
</ul>
<h2 id="%E4%BD%BF%E7%94%A8-future" id="ä½¿ç”¨-Future">ä½¿ç”¨ Future</h2>
<ul>
<li>å¯¹çº¿ç¨‹æ± æäº¤ä¸€ä¸ªCallableä»»åŠ¡ï¼Œå¯ä»¥è·å¾—ä¸€ä¸ªFutureå¯¹è±¡ï¼›</li>
</ul>
<p>å¯ä»¥ç”¨Futureåœ¨å°†æ¥æŸä¸ªæ—¶åˆ»è·å–ç»“æœã€‚</p>
<h2 id="%E4%BD%BF%E7%94%A8-completablefuture" id="ä½¿ç”¨-CompletableFuture">ä½¿ç”¨ CompletableFuture</h2>
<ul>
<li>CompletableFutureå¯ä»¥æŒ‡å®šå¼‚æ­¥å¤„ç†æµç¨‹ï¼š<br />
thenAccept()å¤„ç†æ­£å¸¸ç»“æœï¼›<br />
exceptional()å¤„ç†å¼‚å¸¸ç»“æœï¼›<br />
thenApplyAsync()ç”¨äºä¸²è¡ŒåŒ–å¦ä¸€ä¸ªCompletableFutureï¼›<br />
anyOf()å’ŒallOf()ç”¨äºå¹¶è¡ŒåŒ–å¤šä¸ªCompletableFutureã€‚</li>
</ul>
<h2 id="%E4%BD%BF%E7%94%A8-forkjoin" id="ä½¿ç”¨-ForkJoin">ä½¿ç”¨ ForkJoin</h2>
<ul>
<li>Fork/Joinæ˜¯ä¸€ç§åŸºäºâ€œåˆ†æ²»â€çš„ç®—æ³•ï¼šé€šè¿‡åˆ†è§£ä»»åŠ¡ï¼Œå¹¶è¡Œæ‰§è¡Œï¼Œæœ€ååˆå¹¶ç»“æœå¾—åˆ°æœ€ç»ˆç»“æœã€‚</li>
</ul>
<p>ForkJoinPoolçº¿ç¨‹æ± å¯ä»¥æŠŠä¸€ä¸ªå¤§ä»»åŠ¡åˆ†æ‹†æˆå°ä»»åŠ¡å¹¶è¡Œæ‰§è¡Œï¼Œä»»åŠ¡ç±»å¿…é¡»ç»§æ‰¿è‡ªRecursiveTaskæˆ–RecursiveActionã€‚</p>
<p>ä½¿ç”¨Fork/Joinæ¨¡å¼å¯ä»¥è¿›è¡Œå¹¶è¡Œè®¡ç®—ä»¥æé«˜æ•ˆç‡ã€‚</p>
<h2 id="%E4%BD%BF%E7%94%A8-threadlocal" id="ä½¿ç”¨-ThreadLocal">ä½¿ç”¨ ThreadLocal</h2>
<ul>
<li>ThreadLocalè¡¨ç¤º<strong>çº¿ç¨‹çš„â€œå±€éƒ¨å˜é‡â€</strong>ï¼Œå®ƒç¡®ä¿æ¯ä¸ªçº¿ç¨‹çš„ThreadLocalå˜é‡éƒ½æ˜¯å„è‡ªç‹¬ç«‹çš„ï¼›</li>
</ul>
<p>ThreadLocalé€‚åˆåœ¨ä¸€ä¸ªçº¿ç¨‹çš„å¤„ç†æµç¨‹ä¸­ä¿æŒä¸Šä¸‹æ–‡ï¼ˆé¿å…äº†åŒä¸€å‚æ•°åœ¨æ‰€æœ‰æ–¹æ³•ä¸­ä¼ é€’ï¼‰ï¼›</p>
<p>ä½¿ç”¨ThreadLocalè¦ç”¨try ... finallyç»“æ„ï¼Œå¹¶åœ¨finallyä¸­æ¸…é™¤ã€‚</p>
<h2 id="%E9%9B%86%E5%90%88%E7%BA%BF%E7%A8%8B%E5%AE%89%E5%85%A8" id="é›†åˆçº¿ç¨‹å®‰å…¨">é›†åˆçº¿ç¨‹å®‰å…¨</h2>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="comment">//åˆ›å»ºArrayListé›†åˆ</span></span><br><span class="line"><span class="comment">//        List&lt;String&gt; list = new ArrayList&lt;&gt;();</span></span><br><span class="line">        <span class="comment">// Vectorè§£å†³</span></span><br><span class="line"><span class="comment">//        List&lt;String&gt; list = new Vector&lt;&gt;();</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">//Collectionsè§£å†³</span></span><br><span class="line"><span class="comment">//        List&lt;String&gt; list = Collections.synchronizedList(new ArrayList&lt;&gt;());</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// CopyOnWriteArrayListå†™æ—¶å¤åˆ¶æŠ€æœ¯è§£å†³</span></span><br><span class="line"><span class="comment">//        List&lt;String&gt; list = new CopyOnWriteArrayList&lt;&gt;();</span></span><br><span class="line"><span class="comment">//        for (int i = 0; i &lt;30; i++) &#123;</span></span><br><span class="line"><span class="comment">//            new Thread(()-&gt;&#123;</span></span><br><span class="line"><span class="comment">//                //å‘é›†åˆæ·»åŠ å†…å®¹</span></span><br><span class="line"><span class="comment">//                list.add(UUID.randomUUID().toString().substring(0,8));</span></span><br><span class="line"><span class="comment">//                //ä»é›†åˆè·å–å†…å®¹</span></span><br><span class="line"><span class="comment">//                System.out.println(list);</span></span><br><span class="line"><span class="comment">//            &#125;,String.valueOf(i)).start();</span></span><br><span class="line"><span class="comment">//        &#125;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">//æ¼”ç¤ºHashset</span></span><br><span class="line"><span class="comment">//        Set&lt;String&gt; set = new HashSet&lt;&gt;();</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//        Set&lt;String&gt; set = new CopyOnWriteArraySet&lt;&gt;();</span></span><br><span class="line"><span class="comment">//        for (int i = 0; i &lt;30; i++) &#123;</span></span><br><span class="line"><span class="comment">//            new Thread(()-&gt;&#123;</span></span><br><span class="line"><span class="comment">//                //å‘é›†åˆæ·»åŠ å†…å®¹</span></span><br><span class="line"><span class="comment">//                set.add(UUID.randomUUID().toString().substring(0,8));</span></span><br><span class="line"><span class="comment">//                //ä»é›†åˆè·å–å†…å®¹</span></span><br><span class="line"><span class="comment">//                System.out.println(set);</span></span><br><span class="line"><span class="comment">//            &#125;,String.valueOf(i)).start();</span></span><br><span class="line"><span class="comment">//        &#125;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">//æ¼”ç¤ºHashMap</span></span><br><span class="line"><span class="comment">//        Map&lt;String,String&gt; map = new HashMap&lt;&gt;();</span></span><br><span class="line"></span><br><span class="line">        Map&lt;String,String&gt; map = <span class="keyword">new</span> ConcurrentHashMap&lt;&gt;();</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt;<span class="number">30</span>; i++) &#123;</span><br><span class="line">            String key = String.valueOf(i);</span><br><span class="line">            <span class="keyword">new</span> Thread(()-&gt;&#123;</span><br><span class="line">                <span class="comment">//å‘é›†åˆæ·»åŠ å†…å®¹</span></span><br><span class="line">                map.put(key,UUID.randomUUID().toString().substring(<span class="number">0</span>,<span class="number">8</span>));</span><br><span class="line">                <span class="comment">//ä»é›†åˆè·å–å†…å®¹</span></span><br><span class="line">                System.out.println(map);</span><br><span class="line">            &#125;,String.valueOf(i)).start();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<h2 id="juc%E4%B8%89%E5%A4%A7%E8%BE%85%E5%8A%A9%E7%B1%BB" id="JUCä¸‰å¤§è¾…åŠ©ç±»">JUCä¸‰å¤§è¾…åŠ©ç±»</h2>
<p>JUCä¸­æä¾›äº†ä¸‰ç§å¸¸ç”¨çš„è¾…åŠ©ç±»ï¼Œé€šè¿‡è¿™äº›è¾…åŠ©ç±»å¯ä»¥å¾ˆå¥½çš„è§£å†³çº¿ç¨‹æ•°é‡è¿‡å¤šæ—¶Locké”çš„é¢‘ç¹æ“ä½œã€‚è¿™ä¸‰ç§è¾…åŠ©ç±»ä¸ºï¼š<br />
â€¢ CountDownLatch: å‡å°‘è®¡æ•°<br />
â€¢ CyclicBarrier: å¾ªç¯æ …æ <br />
â€¢ Semaphore: ä¿¡å·ç¯</p>
<h3 id="countdownlatch%3A%E5%87%8F%E5%B0%91%E8%AE%A1%E6%95%B0" id="CountDownLatch-å‡å°‘è®¡æ•°">CountDownLatch:å‡å°‘è®¡æ•°</h3>
<p>CountDownLatchç±»å¯ä»¥è®¾ç½®ä¸€ä¸ª<strong>è®¡æ•°å™¨</strong>ï¼Œç„¶åé€šè¿‡<strong>countDownæ–¹æ³•</strong>æ¥è¿›è¡Œå‡1çš„æ“ä½œï¼Œä½¿ç”¨awaitæ–¹æ³•ç­‰å¾…è®¡æ•°å™¨ä¸å¤§äº0ï¼Œç„¶åç»§ç»­æ‰§è¡Œawaitæ–¹æ³•ä¹‹åçš„è¯­å¥ã€‚<br />
â€¢ CountDownLatchä¸»è¦æœ‰ä¸¤ä¸ªæ–¹æ³•ï¼Œå½“ä¸€ä¸ªæˆ–å¤šä¸ªçº¿ç¨‹è°ƒç”¨awaitæ–¹æ³•æ—¶ï¼Œè¿™äº›çº¿ç¨‹ä¼šé˜»å¡<br />
â€¢ å…¶å®ƒçº¿ç¨‹è°ƒç”¨countDownæ–¹æ³•ä¼šå°†è®¡æ•°å™¨å‡1(è°ƒç”¨countDownæ–¹æ³•çš„çº¿ç¨‹ä¸ä¼šé˜»å¡)<br />
â€¢ å½“è®¡æ•°å™¨çš„å€¼å˜ä¸º0æ—¶ï¼Œå› awaitæ–¹æ³•é˜»å¡çš„çº¿ç¨‹ä¼šè¢«å”¤é†’ï¼Œç»§ç»­æ‰§è¡Œ</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.atguigu.juc;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.CountDownLatch;</span><br><span class="line"></span><br><span class="line"><span class="comment">//æ¼”ç¤º CountDownLatch</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CountDownLatchDemo</span> </span>&#123;</span><br><span class="line">    <span class="comment">//6ä¸ªåŒå­¦é™†ç»­ç¦»å¼€æ•™å®¤ä¹‹åï¼Œç­é•¿é”é—¨</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> InterruptedException </span>&#123;   </span><br><span class="line"><span class="comment">//åˆ›å»ºCountDownLatchå¯¹è±¡ï¼Œè®¾ç½®åˆå§‹å€¼</span></span><br><span class="line">    CountDownLatch countDownLatch = <span class="keyword">new</span> CountDownLatch(<span class="number">6</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//6ä¸ªåŒå­¦é™†ç»­ç¦»å¼€æ•™å®¤ä¹‹å</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;=<span class="number">6</span>; i++) &#123;</span><br><span class="line">        <span class="keyword">new</span> Thread(()-&gt;&#123;</span><br><span class="line">            System.out.println(Thread.currentThread().getName()+<span class="string">&quot; å·åŒå­¦ç¦»å¼€äº†æ•™å®¤&quot;</span>);</span><br><span class="line"></span><br><span class="line">            <span class="comment">//è®¡æ•°  -1</span></span><br><span class="line">            countDownLatch.countDown();</span><br><span class="line"></span><br><span class="line">        &#125;,String.valueOf(i)).start();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//ç­‰å¾…</span></span><br><span class="line">    countDownLatch.await();</span><br><span class="line"></span><br><span class="line">    System.out.println(Thread.currentThread().getName()+<span class="string">&quot; ç­é•¿é”é—¨èµ°äººäº†&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="cyclicbarrier%3A-%E5%BE%AA%E7%8E%AF%E6%A0%85%E6%A0%8F" id="CyclicBarrier-å¾ªç¯æ …æ ">CyclicBarrier: å¾ªç¯æ …æ </h3>
<p>â€‹		CyclicBarrierçœ‹è‹±æ–‡å•è¯å¯ä»¥çœ‹å‡ºå¤§æ¦‚å°±æ˜¯å¾ªç¯é˜»å¡çš„æ„æ€ï¼Œåœ¨ä½¿ç”¨ä¸­CyclicBarrierçš„æ„é€ æ–¹æ³•ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯ç›®æ ‡éšœç¢æ•°ï¼Œæ¯æ¬¡æ‰§è¡ŒCyclicBarrierä¸€æ¬¡éšœç¢æ•°ä¼šåŠ ä¸€ï¼Œå¦‚æœ<strong>è¾¾åˆ°äº†ç›®æ ‡éšœç¢æ•°ï¼Œæ‰ä¼šæ‰§è¡ŒcyclicBarrier.await()ä¹‹åçš„è¯­å¥</strong>ã€‚å¯ä»¥å°†CyclicBarrierç†è§£ä¸ºåŠ 1æ“ä½œ</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.atguigu.juc;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.BrokenBarrierException;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.CyclicBarrier;</span><br><span class="line"></span><br><span class="line"><span class="comment">//é›†é½7é¢—é¾™ç å°±å¯ä»¥å¬å”¤ç¥é¾™</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CyclicBarrierDemo</span> </span>&#123;</span><br><span class="line"><span class="comment">//åˆ›å»ºå›ºå®šå€¼</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> NUMBER = <span class="number">7</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">    <span class="comment">//åˆ›å»ºCyclicBarrier</span></span><br><span class="line">    CyclicBarrier cyclicBarrier =</span><br><span class="line">            <span class="keyword">new</span> CyclicBarrier(NUMBER,()-&gt;&#123;</span><br><span class="line">                System.out.println(<span class="string">&quot;*****é›†é½7é¢—é¾™ç å°±å¯ä»¥å¬å”¤ç¥é¾™&quot;</span>);</span><br><span class="line">            &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//é›†é½ä¸ƒé¢—é¾™ç è¿‡ç¨‹</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;=<span class="number">7</span>; i++) &#123;</span><br><span class="line">        <span class="keyword">new</span> Thread(()-&gt;&#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                System.out.println(Thread.currentThread().getName()+<span class="string">&quot; æ˜Ÿé¾™è¢«æ”¶é›†åˆ°äº†&quot;</span>);</span><br><span class="line">                <span class="comment">//ç­‰å¾…</span></span><br><span class="line">                cyclicBarrier.await();</span><br><span class="line">            &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,String.valueOf(i)).start();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="semaphore%3A-%E4%BF%A1%E5%8F%B7%E7%81%AF" id="Semaphore-ä¿¡å·ç¯">Semaphore: ä¿¡å·ç¯</h3>
<p>â€‹		Semaphoreçš„æ„é€ æ–¹æ³•ä¸­ä¼ å…¥çš„ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯<strong>æœ€å¤§ä¿¡å·é‡ï¼ˆå¯ä»¥çœ‹æˆæœ€å¤§çº¿ç¨‹æ± ï¼‰</strong>ï¼Œæ¯ä¸ªä¿¡å·é‡åˆå§‹åŒ–ä¸ºä¸€ä¸ªæœ€å¤šåªèƒ½åˆ†å‘ä¸€ä¸ªè®¸å¯è¯ã€‚ä½¿ç”¨<strong>acquireæ–¹æ³•è·å¾—è®¸å¯è¯ï¼Œreleaseæ–¹æ³•é‡Šæ”¾è®¸å¯</strong>ã€‚åœºæ™¯: æŠ¢è½¦ä½, 6éƒ¨æ±½è½¦3ä¸ªåœè½¦ä½</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.atguigu.juc;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Random;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.Semaphore;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.TimeUnit;</span><br><span class="line"></span><br><span class="line"><span class="comment">//6è¾†æ±½è½¦ï¼Œåœ3ä¸ªè½¦ä½</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SemaphoreDemo</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="comment">//åˆ›å»ºSemaphoreï¼Œè®¾ç½®è®¸å¯æ•°é‡</span></span><br><span class="line">        Semaphore semaphore = <span class="keyword">new</span> Semaphore(<span class="number">3</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//æ¨¡æ‹Ÿ6è¾†æ±½è½¦</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;=<span class="number">6</span>; i++) &#123;</span><br><span class="line">            <span class="keyword">new</span> Thread(()-&gt;&#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    <span class="comment">//æŠ¢å </span></span><br><span class="line">                    semaphore.acquire();</span><br><span class="line"></span><br><span class="line">                    System.out.println(Thread.currentThread().getName()+<span class="string">&quot; æŠ¢åˆ°äº†è½¦ä½&quot;</span>);</span><br><span class="line"></span><br><span class="line">                    <span class="comment">//è®¾ç½®éšæœºåœè½¦æ—¶é—´</span></span><br><span class="line">                    TimeUnit.SECONDS.sleep(<span class="keyword">new</span> Random().nextInt(<span class="number">5</span>));</span><br><span class="line"></span><br><span class="line">                    System.out.println(Thread.currentThread().getName()+<span class="string">&quot; ------ç¦»å¼€äº†è½¦ä½&quot;</span>);</span><br><span class="line">                &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">                    <span class="comment">//é‡Šæ”¾</span></span><br><span class="line">                    semaphore.release();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;,String.valueOf(i)).start();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h2 id="%E9%98%BB%E5%A1%9E%E9%98%9F%E5%88%97" id="é˜»å¡é˜Ÿåˆ—">é˜»å¡é˜Ÿåˆ—</h2>
<h3 id="blockingqueue" id="BlockingQueue">BlockingQueue</h3>
<p>ConcurrentåŒ…ä¸­ï¼ŒBlockingQueueå¾ˆå¥½çš„è§£å†³äº†å¤šçº¿ç¨‹ä¸­ï¼Œå¦‚ä½•é«˜æ•ˆå®‰å…¨â€œä¼ è¾“â€æ•°æ®çš„é—®é¢˜ã€‚é€šè¿‡è¿™äº›é«˜æ•ˆå¹¶ä¸”çº¿ç¨‹å®‰å…¨çš„é˜Ÿåˆ—ç±»ï¼Œä¸ºæˆ‘ä»¬å¿«é€Ÿæ­å»ºé«˜è´¨é‡çš„å¤šçº¿ç¨‹ç¨‹åºå¸¦æ¥æå¤§çš„ä¾¿åˆ©ã€‚æœ¬æ–‡è¯¦ç»†ä»‹ç»äº†BlockingQueueå®¶åº­ä¸­çš„æ‰€æœ‰æˆå‘˜ï¼ŒåŒ…æ‹¬ä»–ä»¬å„è‡ªçš„åŠŸèƒ½ä»¥åŠå¸¸è§ä½¿ç”¨åœºæ™¯ã€‚<br />
é˜»å¡é˜Ÿåˆ—ï¼Œé¡¾åæ€ä¹‰ï¼Œé¦–å…ˆå®ƒæ˜¯ä¸€ä¸ªé˜Ÿåˆ—, é€šè¿‡ä¸€ä¸ªå…±äº«çš„é˜Ÿåˆ—ï¼Œå¯ä»¥ä½¿å¾—æ•°æ®ç”±é˜Ÿåˆ—çš„ä¸€ç«¯è¾“å…¥ï¼Œä»å¦å¤–ä¸€ç«¯è¾“å‡ºï¼›</p>
<p>å½“é˜Ÿåˆ—æ˜¯ç©ºçš„ï¼Œä»é˜Ÿåˆ—ä¸­è·å–å…ƒç´ çš„æ“ä½œå°†ä¼šè¢«é˜»å¡<br />
å½“é˜Ÿåˆ—æ˜¯æ»¡çš„ï¼Œä»é˜Ÿåˆ—ä¸­æ·»åŠ å…ƒç´ çš„æ“ä½œå°†ä¼šè¢«é˜»å¡<br />
è¯•å›¾ä»ç©ºçš„é˜Ÿåˆ—ä¸­è·å–å…ƒç´ çš„çº¿ç¨‹å°†ä¼šè¢«é˜»å¡ï¼Œç›´åˆ°å…¶ä»–çº¿ç¨‹å¾€ç©ºçš„é˜Ÿåˆ—æ’å…¥æ–°çš„å…ƒç´ <br />
è¯•å›¾å‘å·²æ»¡çš„é˜Ÿåˆ—ä¸­æ·»åŠ æ–°å…ƒç´ çš„çº¿ç¨‹å°†ä¼šè¢«é˜»å¡ï¼Œç›´åˆ°å…¶ä»–çº¿ç¨‹ä»é˜Ÿåˆ—ä¸­ç§»é™¤ä¸€ä¸ªæˆ–å¤šä¸ªå…ƒç´ æˆ–è€…å®Œå…¨æ¸…ç©ºï¼Œä½¿é˜Ÿåˆ—å˜å¾—ç©ºé—²èµ·æ¥å¹¶åç»­æ–°å¢<br />
å¸¸ç”¨çš„é˜Ÿåˆ—ä¸»è¦æœ‰ä»¥ä¸‹ä¸¤ç§ï¼š<br />
â€¢ å…ˆè¿›å…ˆå‡ºï¼ˆFIFOï¼‰ï¼šå…ˆæ’å…¥çš„é˜Ÿåˆ—çš„å…ƒç´ ä¹Ÿæœ€å…ˆå‡ºé˜Ÿåˆ—ï¼Œç±»ä¼¼äºæ’é˜Ÿçš„åŠŸèƒ½ã€‚ä»æŸç§ç¨‹åº¦ä¸Šæ¥è¯´è¿™ç§é˜Ÿåˆ—ä¹Ÿä½“ç°äº†ä¸€ç§å…¬å¹³æ€§<br />
â€¢ åè¿›å…ˆå‡ºï¼ˆLIFOï¼‰ï¼šåæ’å…¥é˜Ÿåˆ—çš„å…ƒç´ æœ€å…ˆå‡ºé˜Ÿåˆ—ï¼Œè¿™ç§é˜Ÿåˆ—ä¼˜å…ˆå¤„ç†æœ€è¿‘å‘ç”Ÿçš„äº‹ä»¶(æ ˆ)<br />
åœ¨å¤šçº¿ç¨‹é¢†åŸŸï¼šæ‰€è°“é˜»å¡ï¼Œåœ¨æŸäº›æƒ…å†µä¸‹ä¼šæŒ‚èµ·çº¿ç¨‹ï¼ˆå³é˜»å¡ï¼‰ï¼Œä¸€æ—¦æ¡ä»¶æ»¡è¶³ï¼Œè¢«æŒ‚èµ·çš„çº¿ç¨‹åˆä¼šè‡ªåŠ¨è¢«å”¤èµ·</p>
<h4 id="%E4%B8%BA%E4%BB%80%E4%B9%88%E9%9C%80%E8%A6%81blockingqueue" id="ä¸ºä»€ä¹ˆéœ€è¦BlockingQueue">ä¸ºä»€ä¹ˆéœ€è¦BlockingQueue</h4>
<p>å¥½å¤„æ˜¯æˆ‘ä»¬ä¸éœ€è¦å…³å¿ƒä»€ä¹ˆæ—¶å€™éœ€è¦é˜»å¡çº¿ç¨‹ï¼Œä»€ä¹ˆæ—¶å€™éœ€è¦å”¤é†’çº¿ç¨‹ï¼Œå› ä¸ºè¿™ä¸€åˆ‡BlockingQueueéƒ½ç»™ä½ ä¸€æ‰‹åŒ…åŠäº†<br />
åœ¨concurrentåŒ…å‘å¸ƒä»¥å‰ï¼Œåœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸‹ï¼Œæˆ‘ä»¬å¿…é¡»å»è‡ªå·±æ§åˆ¶è¿™äº›ç»†èŠ‚ï¼Œå°¤å…¶è¿˜è¦å…¼é¡¾æ•ˆç‡å’Œçº¿ç¨‹å®‰å…¨ï¼Œè€Œè¿™ä¼šç»™æˆ‘ä»¬çš„ç¨‹åºå¸¦æ¥ä¸å°çš„å¤æ‚åº¦ã€‚<br />
å¤šçº¿ç¨‹ç¯å¢ƒä¸­ï¼Œé€šè¿‡é˜Ÿåˆ—å¯ä»¥å¾ˆå®¹æ˜“å®ç°æ•°æ®å…±äº«ï¼Œæ¯”å¦‚ç»å…¸çš„â€œç”Ÿäº§è€…â€å’Œâ€œæ¶ˆè´¹è€…â€æ¨¡å‹ä¸­ï¼Œé€šè¿‡é˜Ÿåˆ—å¯ä»¥å¾ˆä¾¿åˆ©åœ°å®ç°ä¸¤è€…ä¹‹é—´çš„æ•°æ®å…±äº«ã€‚å‡è®¾æˆ‘ä»¬æœ‰è‹¥å¹²ç”Ÿäº§è€…çº¿ç¨‹ï¼Œå¦å¤–åˆæœ‰è‹¥å¹²ä¸ªæ¶ˆè´¹è€…çº¿ç¨‹ã€‚å¦‚æœç”Ÿäº§è€…çº¿ç¨‹éœ€è¦æŠŠå‡†å¤‡å¥½çš„æ•°æ®å…±äº«ç»™æ¶ˆè´¹è€…çº¿ç¨‹ï¼Œåˆ©ç”¨é˜Ÿåˆ—çš„æ–¹å¼æ¥ä¼ é€’æ•°æ®ï¼Œå°±å¯ä»¥å¾ˆæ–¹ä¾¿åœ°è§£å†³ä»–ä»¬ä¹‹é—´çš„æ•°æ®å…±äº«é—®é¢˜ã€‚ä½†å¦‚æœç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…åœ¨æŸä¸ªæ—¶é—´æ®µå†…ï¼Œä¸‡ä¸€å‘ç”Ÿæ•°æ®å¤„ç†é€Ÿåº¦ä¸åŒ¹é…çš„æƒ…å†µå‘¢ï¼Ÿç†æƒ³æƒ…å†µä¸‹ï¼Œå¦‚æœç”Ÿäº§è€…äº§å‡ºæ•°æ®çš„é€Ÿåº¦å¤§äºæ¶ˆè´¹è€…æ¶ˆè´¹çš„é€Ÿåº¦ï¼Œå¹¶ä¸”å½“ç”Ÿäº§å‡ºæ¥çš„æ•°æ®ç´¯ç§¯åˆ°ä¸€å®šç¨‹åº¦çš„æ—¶å€™ï¼Œé‚£ä¹ˆç”Ÿäº§è€…å¿…é¡»æš‚åœç­‰å¾…ä¸€ä¸‹ï¼ˆé˜»å¡ç”Ÿäº§è€…çº¿ç¨‹ï¼‰ï¼Œä»¥ä¾¿ç­‰å¾…æ¶ˆè´¹è€…çº¿ç¨‹æŠŠç´¯ç§¯çš„æ•°æ®å¤„ç†å®Œæ¯•ï¼Œåä¹‹äº¦ç„¶ã€‚<br />
â€¢ å½“é˜Ÿåˆ—ä¸­æ²¡æœ‰æ•°æ®çš„æƒ…å†µä¸‹ï¼Œæ¶ˆè´¹è€…ç«¯çš„æ‰€æœ‰çº¿ç¨‹éƒ½ä¼šè¢«è‡ªåŠ¨é˜»å¡ï¼ˆæŒ‚èµ·ï¼‰ï¼Œç›´åˆ°æœ‰æ•°æ®æ”¾å…¥é˜Ÿåˆ—<br />
â€¢ å½“é˜Ÿåˆ—ä¸­å¡«æ»¡æ•°æ®çš„æƒ…å†µä¸‹ï¼Œç”Ÿäº§è€…ç«¯çš„æ‰€æœ‰çº¿ç¨‹éƒ½ä¼šè¢«è‡ªåŠ¨é˜»å¡ï¼ˆæŒ‚èµ·ï¼‰ï¼Œç›´åˆ°é˜Ÿåˆ—ä¸­æœ‰ç©ºçš„ä½ç½®ï¼Œçº¿ç¨‹è¢«è‡ªåŠ¨å”¤é†’</p>
<h3 id="blockingqueue%E6%A0%B8%E5%BF%83%E6%96%B9%E6%B3%95" id="BlockingQueueæ ¸å¿ƒæ–¹æ³•">BlockingQueueæ ¸å¿ƒæ–¹æ³•</h3>
<p><img src="https://gitee.com/mychimei/picture/raw/master/work/image-20220216205945389.png" alt="image-20220216205945389" /></p>
<h4 id="1.%E6%94%BE%E5%85%A5%E6%95%B0%E6%8D%AE" id="1-æ”¾å…¥æ•°æ®">1.æ”¾å…¥æ•°æ®</h4>
<p>â€¢ offer(anObject):è¡¨ç¤ºå¦‚æœå¯èƒ½çš„è¯,å°†anObjectåŠ åˆ°BlockingQueueé‡Œ,å³å¦‚æœBlockingQueueå¯ä»¥å®¹çº³,åˆ™è¿”å›true,å¦åˆ™è¿”å›false.ï¼ˆæœ¬æ–¹æ³•ä¸é˜»å¡å½“å‰æ‰§è¡Œæ–¹æ³•çš„çº¿ç¨‹ï¼‰<br />
â€¢ offer(E o, long timeout, TimeUnit unit)ï¼šå¯ä»¥è®¾å®šç­‰å¾…çš„æ—¶é—´ï¼Œå¦‚æœåœ¨æŒ‡å®šçš„æ—¶é—´å†…ï¼Œè¿˜ä¸èƒ½å¾€é˜Ÿåˆ—ä¸­åŠ å…¥BlockingQueueï¼Œåˆ™è¿”å›å¤±è´¥<br />
â€¢ put(anObject):æŠŠanObjectåŠ åˆ°BlockingQueueé‡Œ,å¦‚æœBlockQueueæ²¡æœ‰ç©ºé—´,åˆ™è°ƒç”¨æ­¤æ–¹æ³•çš„çº¿ç¨‹è¢«é˜»æ–­ç›´åˆ°BlockingQueueé‡Œé¢æœ‰ç©ºé—´å†ç»§ç»­.</p>
<h4 id="2.%E8%8E%B7%E5%8F%96%E6%95%B0%E6%8D%AE" id="2-è·å–æ•°æ®">2.è·å–æ•°æ®</h4>
<p>â€¢ poll(time): å–èµ°BlockingQueueé‡Œæ’åœ¨é¦–ä½çš„å¯¹è±¡,è‹¥ä¸èƒ½ç«‹å³å–å‡º,åˆ™å¯ä»¥ç­‰timeå‚æ•°è§„å®šçš„æ—¶é—´,å–ä¸åˆ°æ—¶è¿”å›null<br />
â€¢ poll(long timeout, TimeUnit unit)ï¼šä»BlockingQueueå–å‡ºä¸€ä¸ªé˜Ÿé¦–çš„å¯¹è±¡ï¼Œå¦‚æœåœ¨æŒ‡å®šæ—¶é—´å†…ï¼Œé˜Ÿåˆ—ä¸€æ—¦æœ‰æ•°æ®å¯å–ï¼Œåˆ™ç«‹å³è¿”å›é˜Ÿåˆ—ä¸­çš„æ•°æ®ã€‚å¦åˆ™çŸ¥é“æ—¶é—´è¶…æ—¶è¿˜æ²¡æœ‰æ•°æ®å¯å–ï¼Œè¿”å›å¤±è´¥ã€‚<br />
â€¢ take(): å–èµ°BlockingQueueé‡Œæ’åœ¨é¦–ä½çš„å¯¹è±¡,è‹¥BlockingQueueä¸ºç©º,é˜»æ–­è¿›å…¥ç­‰å¾…çŠ¶æ€ç›´åˆ°BlockingQueueæœ‰æ–°çš„æ•°æ®è¢«åŠ å…¥;<br />
â€¢ drainTo(): ä¸€æ¬¡æ€§ä»BlockingQueueè·å–æ‰€æœ‰å¯ç”¨çš„æ•°æ®å¯¹è±¡ï¼ˆè¿˜å¯ä»¥æŒ‡å®šè·å–æ•°æ®çš„ä¸ªæ•°ï¼‰ï¼Œé€šè¿‡è¯¥æ–¹æ³•ï¼Œå¯ä»¥æå‡è·å–æ•°æ®æ•ˆç‡ï¼›ä¸éœ€è¦å¤šæ¬¡åˆ†æ‰¹åŠ é”æˆ–é‡Šæ”¾é”ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.atguigu.queue;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.ArrayBlockingQueue;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.BlockingQueue;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.Executors;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.TimeUnit;</span><br><span class="line"></span><br><span class="line"><span class="comment">//é˜»å¡é˜Ÿåˆ—</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BlockingQueueDemo</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> InterruptedException </span>&#123;</span><br><span class="line">        <span class="comment">//åˆ›å»ºé˜»å¡é˜Ÿåˆ—</span></span><br><span class="line">        BlockingQueue&lt;String&gt; blockingQueue = <span class="keyword">new</span> ArrayBlockingQueue&lt;&gt;(<span class="number">3</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//ç¬¬ä¸€ç»„</span></span><br><span class="line"><span class="comment">//        System.out.println(blockingQueue.add(&quot;a&quot;));</span></span><br><span class="line"><span class="comment">////        System.out.println(blockingQueue.add(&quot;b&quot;));</span></span><br><span class="line"><span class="comment">////        System.out.println(blockingQueue.add(&quot;c&quot;));</span></span><br><span class="line"><span class="comment">////        //System.out.println(blockingQueue.element());</span></span><br><span class="line"><span class="comment">////</span></span><br><span class="line"><span class="comment">////        //System.out.println(blockingQueue.add(&quot;w&quot;));</span></span><br><span class="line"><span class="comment">////        System.out.println(blockingQueue.remove());</span></span><br><span class="line"><span class="comment">////        System.out.println(blockingQueue.remove());</span></span><br><span class="line"><span class="comment">////        System.out.println(blockingQueue.remove());</span></span><br><span class="line"><span class="comment">////        System.out.println(blockingQueue.remove());</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">//ç¬¬äºŒç»„</span></span><br><span class="line"><span class="comment">//        System.out.println(blockingQueue.offer(&quot;a&quot;));</span></span><br><span class="line"><span class="comment">//        System.out.println(blockingQueue.offer(&quot;b&quot;));</span></span><br><span class="line"><span class="comment">//        System.out.println(blockingQueue.offer(&quot;c&quot;));</span></span><br><span class="line"><span class="comment">//        System.out.println(blockingQueue.offer(&quot;www&quot;));</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//        System.out.println(blockingQueue.poll());</span></span><br><span class="line"><span class="comment">//        System.out.println(blockingQueue.poll());</span></span><br><span class="line"><span class="comment">//        System.out.println(blockingQueue.poll());</span></span><br><span class="line"><span class="comment">//        System.out.println(blockingQueue.poll());</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">//ç¬¬ä¸‰ç»„  put æ²¡ç©ºé—´é˜»å¡  take æ²¡æ•°æ®é˜»å¡</span></span><br><span class="line"><span class="comment">//        blockingQueue.put(&quot;a&quot;);</span></span><br><span class="line"><span class="comment">//        blockingQueue.put(&quot;b&quot;);</span></span><br><span class="line"><span class="comment">//        blockingQueue.put(&quot;c&quot;);</span></span><br><span class="line"><span class="comment">//        //blockingQueue.put(&quot;w&quot;);</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//        System.out.println(blockingQueue.take());</span></span><br><span class="line"><span class="comment">//        System.out.println(blockingQueue.take());</span></span><br><span class="line"><span class="comment">//        System.out.println(blockingQueue.take());</span></span><br><span class="line"><span class="comment">//        System.out.println(blockingQueue.take());</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">//ç¬¬å››ç»„</span></span><br><span class="line">        System.out.println(blockingQueue.offer(<span class="string">&quot;a&quot;</span>));</span><br><span class="line">        System.out.println(blockingQueue.offer(<span class="string">&quot;b&quot;</span>));</span><br><span class="line">        System.out.println(blockingQueue.offer(<span class="string">&quot;c&quot;</span>));</span><br><span class="line">        System.out.println(blockingQueue.offer(<span class="string">&quot;w&quot;</span>,<span class="number">3L</span>, TimeUnit.SECONDS));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h4 id="arrayblockingqueue(%E5%B8%B8%E7%94%A8)" id="ArrayBlockingQueue-å¸¸ç”¨">ArrayBlockingQueue(å¸¸ç”¨)</h4>
<p>åŸºäºæ•°ç»„çš„é˜»å¡é˜Ÿåˆ—å®ç°ï¼Œåœ¨ArrayBlockingQueueå†…éƒ¨ï¼Œç»´æŠ¤äº†ä¸€ä¸ªå®šé•¿æ•°ç»„ï¼Œä»¥ä¾¿ç¼“å­˜é˜Ÿåˆ—ä¸­çš„æ•°æ®å¯¹è±¡ï¼Œè¿™æ˜¯ä¸€ä¸ªå¸¸ç”¨çš„é˜»å¡é˜Ÿåˆ—ï¼Œé™¤äº†ä¸€ä¸ªå®šé•¿æ•°ç»„å¤–ï¼ŒArrayBlockingQueueå†…éƒ¨è¿˜ä¿å­˜ç€ä¸¤ä¸ªæ•´å½¢å˜é‡ï¼Œåˆ†åˆ«æ ‡è¯†ç€é˜Ÿåˆ—çš„å¤´éƒ¨å’Œå°¾éƒ¨åœ¨æ•°ç»„ä¸­çš„ä½ç½®ã€‚<br />
ArrayBlockingQueueåœ¨ç”Ÿäº§è€…æ”¾å…¥æ•°æ®å’Œæ¶ˆè´¹è€…è·å–æ•°æ®ï¼Œéƒ½æ˜¯å…±ç”¨åŒä¸€ä¸ªé”å¯¹è±¡ï¼Œç”±æ­¤ä¹Ÿæ„å‘³ç€ä¸¤è€…æ— æ³•çœŸæ­£å¹¶è¡Œè¿è¡Œï¼Œè¿™ç‚¹å°¤å…¶ä¸åŒäºLinkedBlockingQueueï¼›æŒ‰ç…§å®ç°åŸç†æ¥åˆ†æï¼ŒArrayBlockingQueueå®Œå…¨å¯ä»¥é‡‡ç”¨åˆ†ç¦»é”ï¼Œä»è€Œå®ç°ç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…æ“ä½œçš„å®Œå…¨å¹¶è¡Œè¿è¡Œã€‚Doug Leaä¹‹æ‰€ä»¥æ²¡è¿™æ ·å»åšï¼Œä¹Ÿè®¸æ˜¯å› ä¸ºArrayBlockingQueueçš„æ•°æ®å†™å…¥å’Œè·å–æ“ä½œå·²ç»è¶³å¤Ÿè½»å·§ï¼Œä»¥è‡³äºå¼•å…¥ç‹¬ç«‹çš„é”æœºåˆ¶ï¼Œé™¤äº†ç»™ä»£ç å¸¦æ¥é¢å¤–çš„å¤æ‚æ€§å¤–ï¼Œå…¶åœ¨æ€§èƒ½ä¸Šå®Œå…¨å ä¸åˆ°ä»»ä½•ä¾¿å®œã€‚ ArrayBlockingQueueå’ŒLinkedBlockingQueueé—´è¿˜æœ‰ä¸€ä¸ªæ˜æ˜¾çš„ä¸åŒä¹‹å¤„åœ¨äºï¼Œå‰è€…åœ¨æ’å…¥æˆ–åˆ é™¤å…ƒç´ æ—¶ä¸ä¼šäº§ç”Ÿæˆ–é”€æ¯ä»»ä½•é¢å¤–çš„å¯¹è±¡å®ä¾‹ï¼Œè€Œåè€…åˆ™ä¼šç”Ÿæˆä¸€ä¸ªé¢å¤–çš„Nodeå¯¹è±¡ã€‚è¿™åœ¨é•¿æ—¶é—´å†…éœ€è¦é«˜æ•ˆå¹¶å‘åœ°å¤„ç†å¤§æ‰¹é‡æ•°æ®çš„ç³»ç»Ÿä¸­ï¼Œå…¶å¯¹äºGCçš„å½±å“è¿˜æ˜¯å­˜åœ¨ä¸€å®šçš„åŒºåˆ«ã€‚è€Œåœ¨åˆ›å»ºArrayBlockingQueueæ—¶ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥æ§åˆ¶å¯¹è±¡çš„å†…éƒ¨é”æ˜¯å¦é‡‡ç”¨å…¬å¹³é”ï¼Œé»˜è®¤é‡‡ç”¨éå…¬å¹³é”ã€‚<br />
<strong>ä¸€å¥è¯æ€»ç»“: ç”±æ•°ç»„ç»“æ„ç»„æˆçš„æœ‰ç•Œé˜»å¡é˜Ÿåˆ—ã€‚</strong></p>
<h4 id="linkedblockingqueue(%E5%B8%B8%E7%94%A8)" id="LinkedBlockingQueue-å¸¸ç”¨">LinkedBlockingQueue(å¸¸ç”¨)</h4>
<p>åŸºäºé“¾è¡¨çš„é˜»å¡é˜Ÿåˆ—ï¼ŒåŒArrayListBlockingQueueç±»ä¼¼ï¼Œå…¶å†…éƒ¨ä¹Ÿç»´æŒç€ä¸€ä¸ªæ•°æ®ç¼“å†²é˜Ÿåˆ—ï¼ˆè¯¥é˜Ÿåˆ—ç”±ä¸€ä¸ªé“¾è¡¨æ„æˆï¼‰ï¼Œå½“ç”Ÿäº§è€…å¾€é˜Ÿåˆ—ä¸­æ”¾å…¥ä¸€ä¸ªæ•°æ®æ—¶ï¼Œé˜Ÿåˆ—ä¼šä»ç”Ÿäº§è€…æ‰‹ä¸­è·å–æ•°æ®ï¼Œå¹¶ç¼“å­˜åœ¨é˜Ÿåˆ—å†…éƒ¨ï¼Œè€Œç”Ÿäº§è€…ç«‹å³è¿”å›ï¼›åªæœ‰å½“é˜Ÿåˆ—ç¼“å†²åŒºè¾¾åˆ°æœ€å¤§å€¼ç¼“å­˜å®¹é‡æ—¶ï¼ˆLinkedBlockingQueueå¯ä»¥é€šè¿‡æ„é€ å‡½æ•°æŒ‡å®šè¯¥å€¼ï¼‰ï¼Œæ‰ä¼šé˜»å¡ç”Ÿäº§è€…é˜Ÿåˆ—ï¼Œç›´åˆ°æ¶ˆè´¹è€…ä»é˜Ÿåˆ—ä¸­æ¶ˆè´¹æ‰ä¸€ä»½<br />
æ•°æ®ï¼Œç”Ÿäº§è€…çº¿ç¨‹ä¼šè¢«å”¤é†’ï¼Œåä¹‹å¯¹äºæ¶ˆè´¹è€…è¿™ç«¯çš„å¤„ç†ä¹ŸåŸºäºåŒæ ·çš„åŸç†ã€‚è€ŒLinkedBlockingQueueä¹‹æ‰€ä»¥èƒ½å¤Ÿé«˜æ•ˆçš„å¤„ç†å¹¶å‘æ•°æ®ï¼Œè¿˜å› ä¸ºå…¶å¯¹äºç”Ÿäº§è€…ç«¯å’Œæ¶ˆè´¹è€…ç«¯åˆ†åˆ«é‡‡ç”¨äº†ç‹¬ç«‹çš„é”æ¥æ§åˆ¶æ•°æ®åŒæ­¥ï¼Œè¿™ä¹Ÿæ„å‘³ç€åœ¨é«˜å¹¶å‘çš„æƒ…å†µä¸‹ç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…å¯ä»¥å¹¶è¡Œåœ°æ“ä½œé˜Ÿåˆ—ä¸­çš„æ•°æ®ï¼Œä»¥æ­¤æ¥æé«˜æ•´ä¸ªé˜Ÿåˆ—çš„å¹¶å‘æ€§èƒ½ã€‚<br />
ArrayBlockingQueueå’ŒLinkedBlockingQueueæ˜¯ä¸¤ä¸ªæœ€æ™®é€šä¹Ÿæ˜¯æœ€å¸¸ç”¨çš„é˜»å¡é˜Ÿåˆ—ï¼Œä¸€èˆ¬æƒ…å†µä¸‹ï¼Œåœ¨å¤„ç†å¤šçº¿ç¨‹é—´çš„ç”Ÿäº§è€…æ¶ˆè´¹è€…é—®é¢˜ï¼Œä½¿ç”¨è¿™ä¸¤ä¸ªç±»è¶³ä»¥ã€‚<br />
<strong>ä¸€å¥è¯æ€»ç»“: ç”±é“¾è¡¨ç»“æ„ç»„æˆçš„æœ‰ç•Œï¼ˆä½†å¤§å°é»˜è®¤å€¼ä¸ºinteger.MAX_VALUEï¼‰é˜»å¡é˜Ÿåˆ—ã€‚</strong></p>
<h4 id="delayqueue" id="DelayQueue">DelayQueue</h4>
<p>DelayQueueä¸­çš„å…ƒç´ åªæœ‰å½“å…¶æŒ‡å®šçš„å»¶è¿Ÿæ—¶é—´åˆ°äº†ï¼Œæ‰èƒ½å¤Ÿä»é˜Ÿåˆ—ä¸­è·å–åˆ°è¯¥å…ƒç´ ã€‚DelayQueueæ˜¯ä¸€ä¸ªæ²¡æœ‰å¤§å°é™åˆ¶çš„é˜Ÿåˆ—ï¼Œå› æ­¤å¾€é˜Ÿåˆ—ä¸­æ’å…¥æ•°æ®çš„æ“ä½œï¼ˆç”Ÿäº§è€…ï¼‰æ°¸è¿œä¸ä¼šè¢«é˜»å¡ï¼Œè€Œåªæœ‰è·å–æ•°æ®çš„æ“ä½œï¼ˆæ¶ˆè´¹è€…ï¼‰æ‰ä¼šè¢«é˜»å¡ã€‚<br />
<strong>ä¸€å¥è¯æ€»ç»“: ä½¿ç”¨ä¼˜å…ˆçº§é˜Ÿåˆ—å®ç°çš„å»¶è¿Ÿæ— ç•Œé˜»å¡é˜Ÿåˆ—ã€‚</strong></p>
<h4 id="priorityblockingqueue" id="PriorityBlockingQueue">PriorityBlockingQueue</h4>
<p>åŸºäºä¼˜å…ˆçº§çš„é˜»å¡é˜Ÿåˆ—ï¼ˆä¼˜å…ˆçº§çš„åˆ¤æ–­é€šè¿‡æ„é€ å‡½æ•°ä¼ å…¥çš„Compatorå¯¹è±¡æ¥å†³å®šï¼‰ï¼Œä½†éœ€è¦æ³¨æ„çš„æ˜¯PriorityBlockingQueueå¹¶ä¸ä¼šé˜»å¡æ•°æ®ç”Ÿäº§è€…ï¼Œè€Œåªä¼šåœ¨æ²¡æœ‰å¯æ¶ˆè´¹çš„æ•°æ®æ—¶ï¼Œé˜»å¡æ•°æ®çš„æ¶ˆè´¹è€…ã€‚<br />
å› æ­¤ä½¿ç”¨çš„æ—¶å€™è¦ç‰¹åˆ«æ³¨æ„ï¼Œç”Ÿäº§è€…ç”Ÿäº§æ•°æ®çš„é€Ÿåº¦ç»å¯¹ä¸èƒ½å¿«äºæ¶ˆè´¹è€…æ¶ˆè´¹æ•°æ®çš„é€Ÿåº¦ï¼Œå¦åˆ™æ—¶é—´ä¸€é•¿ï¼Œä¼šæœ€ç»ˆè€—å°½æ‰€æœ‰çš„å¯ç”¨å †å†…å­˜ç©ºé—´ã€‚<br />
åœ¨å®ç°PriorityBlockingQueueæ—¶ï¼Œå†…éƒ¨æ§åˆ¶çº¿ç¨‹åŒæ­¥çš„é”é‡‡ç”¨çš„æ˜¯å…¬å¹³é”ã€‚<br />
<strong>ä¸€å¥è¯æ€»ç»“: æ”¯æŒä¼˜å…ˆçº§æ’åºçš„æ— ç•Œé˜»å¡é˜Ÿåˆ—ã€‚</strong></p>
<h4 id="synchronousqueue" id="SynchronousQueue">SynchronousQueue</h4>
<p>ä¸€ç§æ— ç¼“å†²çš„ç­‰å¾…é˜Ÿåˆ—ï¼Œç±»ä¼¼äºæ— ä¸­ä»‹çš„ç›´æ¥äº¤æ˜“ï¼Œæœ‰ç‚¹åƒåŸå§‹ç¤¾ä¼šä¸­çš„ç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…ï¼Œç”Ÿäº§è€…æ‹¿ç€äº§å“å»é›†å¸‚é”€å”®ç»™äº§å“çš„æœ€ç»ˆæ¶ˆè´¹è€…ï¼Œè€Œæ¶ˆè´¹è€…å¿…é¡»äº²è‡ªå»é›†å¸‚æ‰¾åˆ°æ‰€è¦å•†å“çš„ç›´æ¥ç”Ÿäº§è€…ï¼Œå¦‚æœä¸€æ–¹æ²¡æœ‰æ‰¾åˆ°åˆé€‚çš„ç›®æ ‡ï¼Œé‚£ä¹ˆå¯¹ä¸èµ·ï¼Œå¤§å®¶éƒ½åœ¨é›†å¸‚ç­‰å¾…ã€‚ç›¸å¯¹äºæœ‰ç¼“å†²çš„BlockingQueueæ¥è¯´ï¼Œå°‘äº†ä¸€ä¸ªä¸­é—´ç»é”€å•†çš„ç¯èŠ‚ï¼ˆç¼“å†²åŒºï¼‰ï¼Œå¦‚æœæœ‰ç»é”€å•†ï¼Œç”Ÿäº§è€…ç›´æ¥æŠŠäº§å“æ‰¹å‘ç»™ç»é”€å•†ï¼Œè€Œæ— éœ€åœ¨æ„ç»é”€å•†æœ€ç»ˆä¼šå°†è¿™äº›äº§å“å–ç»™é‚£äº›æ¶ˆè´¹è€…ï¼Œç”±äºç»é”€å•†å¯ä»¥åº“å­˜ä¸€éƒ¨åˆ†å•†å“ï¼Œå› æ­¤ç›¸å¯¹äºç›´æ¥äº¤æ˜“æ¨¡å¼ï¼Œæ€»ä½“æ¥è¯´é‡‡ç”¨ä¸­é—´ç»é”€å•†çš„æ¨¡å¼ä¼šååé‡é«˜ä¸€äº›ï¼ˆå¯ä»¥æ‰¹é‡ä¹°å–ï¼‰ï¼›ä½†å¦ä¸€æ–¹é¢ï¼Œåˆå› ä¸ºç»é”€å•†çš„å¼•å…¥ï¼Œä½¿å¾—äº§å“ä»ç”Ÿäº§è€…åˆ°æ¶ˆè´¹è€…ä¸­é—´å¢åŠ äº†é¢å¤–çš„äº¤æ˜“ç¯èŠ‚ï¼Œå•ä¸ªäº§å“çš„åŠæ—¶å“åº”æ€§èƒ½å¯èƒ½ä¼šé™ä½ã€‚<br />
å£°æ˜ä¸€ä¸ªSynchronousQueueæœ‰ä¸¤ç§ä¸åŒçš„æ–¹å¼ï¼Œå®ƒä»¬ä¹‹é—´æœ‰ç€ä¸å¤ªä¸€æ ·çš„è¡Œä¸ºã€‚<br />
å…¬å¹³æ¨¡å¼å’Œéå…¬å¹³æ¨¡å¼çš„åŒºåˆ«:<br />
â€¢ å…¬å¹³æ¨¡å¼ï¼šSynchronousQueueä¼šé‡‡ç”¨å…¬å¹³é”ï¼Œå¹¶é…åˆä¸€ä¸ªFIFOé˜Ÿåˆ—æ¥é˜»å¡å¤šä½™çš„ç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…ï¼Œä»è€Œä½“ç³»æ•´ä½“çš„å…¬å¹³ç­–ç•¥ï¼›<br />
â€¢ éå…¬å¹³æ¨¡å¼ï¼ˆSynchronousQueueé»˜è®¤ï¼‰ï¼šSynchronousQueueé‡‡ç”¨éå…¬å¹³é”ï¼ŒåŒæ—¶é…åˆä¸€ä¸ªLIFOé˜Ÿåˆ—æ¥ç®¡ç†å¤šä½™çš„ç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…ï¼Œè€Œåä¸€ç§æ¨¡å¼ï¼Œå¦‚æœç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…çš„å¤„ç†é€Ÿåº¦æœ‰å·®è·ï¼Œåˆ™å¾ˆå®¹æ˜“å‡ºç°é¥¥æ¸´çš„æƒ…å†µï¼Œå³å¯èƒ½æœ‰æŸäº›ç”Ÿäº§è€…æˆ–è€…æ˜¯æ¶ˆè´¹è€…çš„æ•°æ®æ°¸è¿œéƒ½å¾—ä¸åˆ°å¤„ç†ã€‚<br />
<strong>ä¸€å¥è¯æ€»ç»“: ä¸å­˜å‚¨å…ƒç´ çš„é˜»å¡é˜Ÿåˆ—ï¼Œä¹Ÿå³å•ä¸ªå…ƒç´ çš„é˜Ÿåˆ—ã€‚</strong></p>
<h4 id="linkedtransferqueue" id="LinkedTransferQueue">LinkedTransferQueue</h4>
<p>LinkedTransferQueueæ˜¯ä¸€ä¸ªç”±é“¾è¡¨ç»“æ„ç»„æˆçš„æ— ç•Œé˜»å¡TransferQueueé˜Ÿåˆ—ã€‚ç›¸å¯¹äºå…¶ä»–é˜»å¡é˜Ÿåˆ—ï¼ŒLinkedTransferQueueå¤šäº†tryTransferå’Œtransferæ–¹æ³•ã€‚<br />
LinkedTransferQueueé‡‡ç”¨ä¸€ç§é¢„å æ¨¡å¼ã€‚æ„æ€å°±æ˜¯æ¶ˆè´¹è€…çº¿ç¨‹å–å…ƒç´ æ—¶ï¼Œå¦‚æœé˜Ÿåˆ—ä¸ä¸ºç©ºï¼Œåˆ™ç›´æ¥å–èµ°æ•°æ®ï¼Œè‹¥é˜Ÿåˆ—ä¸ºç©ºï¼Œé‚£å°±ç”Ÿæˆä¸€ä¸ªèŠ‚ç‚¹ï¼ˆèŠ‚ç‚¹å…ƒç´ ä¸ºnullï¼‰å…¥é˜Ÿï¼Œç„¶åæ¶ˆè´¹è€…çº¿ç¨‹è¢«ç­‰å¾…åœ¨è¿™ä¸ªèŠ‚ç‚¹ä¸Šï¼Œåé¢ç”Ÿäº§è€…çº¿ç¨‹å…¥é˜Ÿæ—¶å‘ç°æœ‰ä¸€ä¸ªå…ƒç´ ä¸ºnullçš„èŠ‚ç‚¹ï¼Œç”Ÿäº§è€…çº¿ç¨‹å°±ä¸å…¥é˜Ÿäº†ï¼Œç›´æ¥å°±å°†å…ƒç´ å¡«å……åˆ°è¯¥èŠ‚ç‚¹ï¼Œå¹¶å”¤é†’è¯¥èŠ‚ç‚¹ç­‰å¾…çš„çº¿ç¨‹ï¼Œè¢«å”¤é†’çš„æ¶ˆè´¹è€…çº¿ç¨‹å–èµ°å…ƒç´ ï¼Œä»è°ƒç”¨çš„æ–¹æ³•è¿”å›ã€‚<br />
<strong>ä¸€å¥è¯æ€»ç»“: ç”±é“¾è¡¨ç»„æˆçš„æ— ç•Œé˜»å¡é˜Ÿåˆ—ã€‚</strong></p>
<h4 id="linkedblockingdeque" id="LinkedBlockingDeque">LinkedBlockingDeque</h4>
<p>LinkedBlockingDequeæ˜¯ä¸€ä¸ªç”±é“¾è¡¨ç»“æ„ç»„æˆçš„åŒå‘é˜»å¡é˜Ÿåˆ—ï¼Œå³å¯ä»¥ä»é˜Ÿåˆ—çš„ä¸¤ç«¯æ’å…¥å’Œç§»é™¤å…ƒç´ ã€‚<br />
å¯¹äºä¸€äº›æŒ‡å®šçš„æ“ä½œï¼Œåœ¨æ’å…¥æˆ–è€…è·å–é˜Ÿåˆ—å…ƒç´ æ—¶å¦‚æœé˜Ÿåˆ—çŠ¶æ€ä¸å…è®¸è¯¥æ“ä½œå¯èƒ½ä¼šé˜»å¡ä½è¯¥çº¿ç¨‹ç›´åˆ°é˜Ÿåˆ—çŠ¶æ€å˜æ›´ä¸ºå…è®¸æ“ä½œï¼Œè¿™é‡Œçš„é˜»å¡ä¸€èˆ¬æœ‰ä¸¤ç§æƒ…å†µ<br />
â€¢ æ’å…¥å…ƒç´ æ—¶: å¦‚æœå½“å‰é˜Ÿåˆ—å·²æ»¡å°†ä¼šè¿›å…¥é˜»å¡çŠ¶æ€ï¼Œä¸€ç›´ç­‰åˆ°é˜Ÿåˆ—æœ‰ç©ºçš„ä½ç½®æ—¶å†è®²è¯¥å…ƒç´ æ’å…¥ï¼Œè¯¥æ“ä½œå¯ä»¥é€šè¿‡è®¾ç½®è¶…æ—¶å‚æ•°ï¼Œè¶…æ—¶åè¿”å› false è¡¨ç¤ºæ“ä½œå¤±è´¥ï¼Œä¹Ÿå¯ä»¥ä¸è®¾ç½®è¶…æ—¶å‚æ•°ä¸€ç›´é˜»å¡ï¼Œä¸­æ–­åæŠ›å‡ºInterruptedExceptionå¼‚å¸¸<br />
â€¢ è¯»å–å…ƒç´ æ—¶: å¦‚æœå½“å‰é˜Ÿåˆ—ä¸ºç©ºä¼šé˜»å¡ä½ç›´åˆ°é˜Ÿåˆ—ä¸ä¸ºç©ºç„¶åè¿”å›å…ƒç´ ï¼ŒåŒæ ·å¯ä»¥é€šè¿‡è®¾ç½®è¶…æ—¶å‚æ•°<br />
<strong>ä¸€å¥è¯æ€»ç»“: ç”±é“¾è¡¨ç»„æˆçš„åŒå‘é˜»å¡é˜Ÿåˆ—</strong></p>
<h3 id="%E5%B0%8F%E7%BB%93" id="å°ç»“">å°ç»“</h3>
<ol>
<li>åœ¨å¤šçº¿ç¨‹é¢†åŸŸï¼šæ‰€è°“é˜»å¡ï¼Œåœ¨æŸäº›æƒ…å†µä¸‹ä¼šæŒ‚èµ·çº¿ç¨‹ï¼ˆå³é˜»å¡ï¼‰ï¼Œä¸€æ—¦æ¡ä»¶æ»¡è¶³ï¼Œè¢«æŒ‚èµ·çš„çº¿ç¨‹åˆä¼šè‡ªåŠ¨è¢«å”¤èµ·</li>
<li>ä¸ºä»€ä¹ˆéœ€è¦BlockingQueue? åœ¨concurrentåŒ…å‘å¸ƒä»¥å‰ï¼Œåœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸‹ï¼Œæˆ‘ä»¬æ¯ä¸ªç¨‹åºå‘˜éƒ½å¿…é¡»å»è‡ªå·±æ§åˆ¶è¿™äº›ç»†èŠ‚ï¼Œå°¤å…¶è¿˜è¦å…¼é¡¾æ•ˆç‡å’Œçº¿ç¨‹å®‰å…¨ï¼Œè€Œè¿™ä¼šç»™æˆ‘ä»¬çš„ç¨‹åºå¸¦æ¥ä¸å°çš„å¤æ‚åº¦ã€‚ä½¿ç”¨åæˆ‘ä»¬ä¸éœ€è¦å…³å¿ƒä»€ä¹ˆæ—¶å€™éœ€è¦é˜»å¡çº¿ç¨‹ï¼Œä»€ä¹ˆæ—¶å€™éœ€è¦å”¤é†’çº¿ç¨‹ï¼Œå› ä¸ºè¿™ä¸€åˆ‡BlockingQueueéƒ½ç»™ä½ ä¸€æ‰‹åŒ…åŠäº†</li>
</ol>
<h2 id="%E7%BA%BF%E7%A8%8B%E6%B1%A0" id="çº¿ç¨‹æ± "><a target="_blank" rel="noopener" href="https://www.jianshu.com/p/7726c70cdc40">çº¿ç¨‹æ± </a></h2>
<p>â€‹		çº¿ç¨‹æ± ï¼ˆThread Poolï¼‰ï¼šä¸€ç§çº¿ç¨‹ä½¿ç”¨æ¨¡å¼ã€‚çº¿ç¨‹è¿‡å¤šä¼šå¸¦æ¥è°ƒåº¦å¼€é”€ï¼Œè¿›è€Œå½±å“ç¼“å­˜å±€éƒ¨æ€§å’Œæ•´ä½“æ€§èƒ½ã€‚è€Œçº¿ç¨‹æ± ç»´æŠ¤ç€å¤šä¸ªçº¿ç¨‹ï¼Œç­‰å¾…ç€ç›‘ç£ç®¡ç†è€…åˆ†é…å¯å¹¶å‘æ‰§è¡Œçš„ä»»åŠ¡ã€‚è¿™é¿å…äº†åœ¨å¤„ç†çŸ­æ—¶é—´ä»»åŠ¡æ—¶åˆ›å»ºä¸é”€æ¯çº¿ç¨‹çš„ä»£ä»·ã€‚çº¿ç¨‹æ± ä¸ä»…èƒ½å¤Ÿä¿è¯å†…æ ¸çš„å……åˆ†åˆ©ç”¨ï¼Œè¿˜èƒ½é˜²æ­¢è¿‡åˆ†è°ƒåº¦ã€‚<br />
â€‹		ä¾‹å­ï¼šä»¥å‰å•æ ¸CPUç”µè„‘ï¼Œå‡çš„å¤šçº¿ç¨‹ï¼Œåƒé©¬æˆå›¢å°ä¸‘ç©å¤šä¸ªçƒï¼ŒCPUéœ€è¦æ¥å›åˆ‡æ¢ã€‚ ç°åœ¨å¤šæ ¸ç”µè„‘ï¼Œå¤šä¸ªçº¿ç¨‹å„è‡ªè·‘åœ¨ç‹¬ç«‹çš„CPUä¸Šï¼Œä¸ç”¨åˆ‡æ¢æ•ˆç‡é«˜ã€‚<br />
<strong>ä¼˜åŠ¿</strong>ï¼š<br />
çº¿ç¨‹æ± åšçš„å·¥ä½œåªè¦æ˜¯æ§åˆ¶è¿è¡Œçš„çº¿ç¨‹æ•°é‡ï¼Œå¤„ç†è¿‡ç¨‹ä¸­å°†ä»»åŠ¡æ”¾å…¥é˜Ÿåˆ—ï¼Œç„¶ååœ¨çº¿ç¨‹åˆ›å»ºåå¯åŠ¨è¿™äº›ä»»åŠ¡ï¼Œå¦‚æœçº¿ç¨‹æ•°é‡è¶…è¿‡äº†æœ€å¤§æ•°é‡ï¼Œè¶…å‡ºæ•°é‡çš„çº¿ç¨‹æ’é˜Ÿç­‰å€™ï¼Œç­‰å…¶ä»–çº¿ç¨‹æ‰§è¡Œå®Œæ¯•ï¼Œå†ä»é˜Ÿåˆ—ä¸­å–å‡ºä»»åŠ¡æ¥æ‰§è¡Œã€‚<br />
<strong>ç‰¹ç‚¹</strong>ï¼š<br />
â€¢ é™ä½èµ„æºæ¶ˆè€—: é€šè¿‡é‡å¤åˆ©ç”¨å·²åˆ›å»ºçš„çº¿ç¨‹<strong>é™ä½çº¿ç¨‹åˆ›å»ºå’Œé”€æ¯é€ æˆçš„é”€è€—</strong>ã€‚<br />
â€¢ <strong>æé«˜å“åº”é€Ÿåº¦</strong>: å½“ä»»åŠ¡åˆ°è¾¾æ—¶ï¼Œä»»åŠ¡å¯ä»¥ä¸éœ€è¦ç­‰å¾…çº¿ç¨‹åˆ›å»ºå°±èƒ½ç«‹å³æ‰§è¡Œã€‚<br />
â€¢ <strong>æé«˜çº¿ç¨‹çš„å¯ç®¡ç†æ€§</strong>: çº¿ç¨‹æ˜¯ç¨€ç¼ºèµ„æºï¼Œå¦‚æœæ— é™åˆ¶çš„åˆ›å»ºï¼Œå¯èƒ½ä¼šå¯¼è‡´å†…å­˜å ç”¨è¿‡å¤šè€Œäº§ç”ŸOOMï¼Œå¹¶ä¸”ä¼šé€ æˆcpuè¿‡åº¦åˆ‡æ¢ï¼ˆcpuåˆ‡æ¢çº¿ç¨‹æ˜¯æœ‰æ—¶é—´æˆæœ¬çš„ï¼ˆéœ€è¦ä¿æŒå½“å‰æ‰§è¡Œçº¿ç¨‹çš„ç°åœºï¼Œå¹¶æ¢å¤è¦æ‰§è¡Œçº¿ç¨‹çš„ç°åœºï¼‰ï¼‰,ä¸ä»…ä¼šé”€è€—ç³»ç»Ÿèµ„æºï¼Œè¿˜ä¼šé™ä½ç³»ç»Ÿçš„ç¨³å®šæ€§ï¼Œä½¿ç”¨çº¿ç¨‹æ± å¯ä»¥è¿›è¡Œç»Ÿä¸€çš„åˆ†é…ï¼Œè°ƒä¼˜å’Œç›‘æ§ã€‚æ–¹ä¾¿çº¿ç¨‹<strong>å¹¶å‘æ•°çš„ç®¡æ§</strong>ã€‚<br />
â€¢ æä¾›æ›´å¼ºå¤§çš„åŠŸèƒ½ï¼Œ<strong>å»¶æ—¶å®šæ—¶çº¿ç¨‹æ± </strong>ã€‚<br />
â€¢ Javaä¸­çš„çº¿ç¨‹æ± æ˜¯é€šè¿‡<strong>Executoræ¡†æ¶</strong>å®ç°çš„ï¼Œè¯¥æ¡†æ¶ä¸­ç”¨åˆ°äº†<strong>Executorï¼ŒExecutorsï¼ŒExecutorServiceï¼ŒThreadPoolExecutor</strong>è¿™å‡ ä¸ªç±»ã€‚</p>
<p><img src="https://gitee.com/mychimei/picture/raw/master/work/image-20220216210901755.png" alt="image-20220216210901755" /></p>
<h3 id="%E5%88%9B%E5%BB%BA%E5%B8%B8%E7%94%A8%E4%B8%89%E7%A7%8D%E7%BA%BF%E7%A8%8B%E6%B1%A0%E7%9A%84%E6%96%B9%E5%BC%8F" id="åˆ›å»ºå¸¸ç”¨ä¸‰ç§çº¿ç¨‹æ± çš„æ–¹å¼">åˆ›å»ºå¸¸ç”¨ä¸‰ç§çº¿ç¨‹æ± çš„æ–¹å¼</h3>
<p><img src="https:////upload-images.jianshu.io/upload_images/6024478-26abbf2238c2d4ba.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1200/format/webp" alt="img" /></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.atguigu.pool;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.ExecutorService;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.Executors;</span><br><span class="line"></span><br><span class="line"><span class="comment">//æ¼”ç¤ºçº¿ç¨‹æ± ä¸‰ç§å¸¸ç”¨åˆ†ç±»</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ThreadPoolDemo1</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="comment">//ä¸€æ± äº”çº¿ç¨‹</span></span><br><span class="line">        ExecutorService threadPool1 = Executors.newFixedThreadPool(<span class="number">5</span>); <span class="comment">//5ä¸ªçª—å£</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">//ä¸€æ± ä¸€çº¿ç¨‹</span></span><br><span class="line">        ExecutorService threadPool2 = Executors.newSingleThreadExecutor(); <span class="comment">//ä¸€ä¸ªçª—å£</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">//ä¸€æ± å¯æ‰©å®¹çº¿ç¨‹</span></span><br><span class="line">        ExecutorService threadPool3 = Executors.newCachedThreadPool();</span><br><span class="line">        <span class="comment">//10ä¸ªé¡¾å®¢è¯·æ±‚</span></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;=<span class="number">10</span>; i++) &#123;</span><br><span class="line">                <span class="comment">//æ‰§è¡Œ</span></span><br><span class="line">                threadPool3.execute(()-&gt;&#123;</span><br><span class="line">                    System.out.println(Thread.currentThread().getName()+<span class="string">&quot; åŠç†ä¸šåŠ¡&quot;</span>);</span><br><span class="line">                &#125;);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;<span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;<span class="keyword">finally</span> &#123;</span><br><span class="line">            <span class="comment">//å…³é—­</span></span><br><span class="line">            threadPool3.shutdown();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="%E5%B8%B8%E7%94%A8%E5%8F%82%E6%95%B0-(%E9%87%8D%E7%82%B9)" id="å¸¸ç”¨å‚æ•°-é‡ç‚¹">å¸¸ç”¨å‚æ•° (é‡ç‚¹)</h3>
<p>â€‹		å½“æäº¤ä»»åŠ¡æ•°å¤§äº corePoolSize çš„æ—¶å€™ï¼Œä¼šä¼˜å…ˆå°†ä»»åŠ¡æ”¾åˆ° workQueue é˜»å¡é˜Ÿåˆ—ä¸­ã€‚å½“é˜»å¡é˜Ÿåˆ—é¥±å’Œåï¼Œä¼šæ‰©å……çº¿ç¨‹æ± ä¸­çº¿ç¨‹æ•°ï¼Œç›´åˆ°è¾¾åˆ° maximumPoolSize æœ€å¤§çº¿ç¨‹æ•°é…ç½®ã€‚æ­¤æ—¶ï¼Œå†å¤šä½™çš„ä»»åŠ¡ï¼Œåˆ™ä¼šè§¦å‘çº¿ç¨‹æ± çš„æ‹’ç»ç­–ç•¥äº†ã€‚</p>
<p>â€‹		å³ï¼Œ<strong>å½“æäº¤çš„ä»»åŠ¡æ•°å¤§äºï¼ˆworkQueue.size() + maximumPoolSize ï¼‰ï¼Œå°±ä¼šè§¦å‘çº¿ç¨‹æ± çš„æ‹’ç»ç­–ç•¥ã€‚</strong></p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">ThreadPoolExecutor</span><span class="params">(<span class="keyword">int</span> corePoolSize, <span class="keyword">int</span> maximumPoolSize, <span class="keyword">long</span> keepAliveTime, TimeUnit unit, BlockingQueue&lt;Runnable&gt; workQueue)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>(corePoolSize, maximumPoolSize, keepAliveTime, unit, workQueue,</span><br><span class="line">         Executors.defaultThreadFactory(), defaultHandler);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>1ã€corePoolSizeï¼ˆçº¿ç¨‹æ± åŸºæœ¬å¤§å°ï¼‰ï¼šå½“å‘çº¿ç¨‹æ± æäº¤ä¸€ä¸ªä»»åŠ¡æ—¶ï¼Œè‹¥çº¿ç¨‹æ± å·²åˆ›å»ºçš„çº¿ç¨‹æ•°å°äºcorePoolSizeï¼Œå³ä¾¿æ­¤æ—¶å­˜åœ¨ç©ºé—²çº¿ç¨‹ï¼Œä¹Ÿä¼šé€šè¿‡åˆ›å»ºä¸€ä¸ªæ–°çº¿ç¨‹æ¥æ‰§è¡Œè¯¥ä»»åŠ¡ï¼Œç›´åˆ°å·²åˆ›å»ºçš„çº¿ç¨‹æ•°å¤§äºæˆ–ç­‰äºcorePoolSizeæ—¶ï¼Œï¼ˆé™¤äº†åˆ©ç”¨æäº¤æ–°ä»»åŠ¡æ¥åˆ›å»ºå’Œå¯åŠ¨çº¿ç¨‹ï¼ˆæŒ‰éœ€æ„é€ ï¼‰ï¼Œä¹Ÿå¯ä»¥é€šè¿‡ prestartCoreThread() æˆ– prestartAllCoreThreads() æ–¹æ³•æ¥æå‰å¯åŠ¨çº¿ç¨‹æ± ä¸­çš„åŸºæœ¬çº¿ç¨‹ã€‚ï¼‰</p>
<p>2ã€maximumPoolSizeï¼ˆçº¿ç¨‹æ± æœ€å¤§å¤§å°ï¼‰ï¼šçº¿ç¨‹æ± æ‰€å…è®¸çš„æœ€å¤§çº¿ç¨‹ä¸ªæ•°ã€‚å½“é˜Ÿåˆ—æ»¡äº†ï¼Œä¸”å·²åˆ›å»ºçš„çº¿ç¨‹æ•°å°äºmaximumPoolSizeï¼Œåˆ™çº¿ç¨‹æ± ä¼šåˆ›å»ºæ–°çš„çº¿ç¨‹æ¥æ‰§è¡Œä»»åŠ¡ã€‚å¦å¤–ï¼Œå¯¹äºæ— ç•Œé˜Ÿåˆ—ï¼Œå¯å¿½ç•¥è¯¥å‚æ•°ã€‚</p>
<p>3ã€keepAliveTimeï¼ˆçº¿ç¨‹å­˜æ´»ä¿æŒæ—¶é—´ï¼‰ï¼ˆç§’ï¼‰å½“çº¿ç¨‹æ± ä¸­çº¿ç¨‹æ•°å¤§äºæ ¸å¿ƒçº¿ç¨‹æ•°æ—¶ï¼Œçº¿ç¨‹çš„ç©ºé—²æ—¶é—´å¦‚æœè¶…è¿‡çº¿ç¨‹å­˜æ´»æ—¶é—´ï¼Œé‚£ä¹ˆè¿™ä¸ªçº¿ç¨‹å°±ä¼šè¢«é”€æ¯ï¼Œç›´åˆ°çº¿ç¨‹æ± ä¸­çš„çº¿ç¨‹æ•°å°äºç­‰äºæ ¸å¿ƒçº¿ç¨‹æ•°ã€‚</p>
<p>4ã€workQueueï¼ˆä»»åŠ¡é˜Ÿåˆ—ï¼‰ï¼šç”¨äºä¼ è¾“å’Œä¿å­˜ç­‰å¾…æ‰§è¡Œä»»åŠ¡çš„é˜»å¡é˜Ÿåˆ—ã€‚</p>
<p>5ã€threadFactoryï¼ˆçº¿ç¨‹å·¥å‚ï¼‰ï¼šç”¨äºåˆ›å»ºæ–°çº¿ç¨‹ã€‚threadFactoryåˆ›å»ºçš„çº¿ç¨‹ä¹Ÿæ˜¯é‡‡ç”¨new Thread()æ–¹å¼ï¼ŒthreadFactoryåˆ›å»ºçš„çº¿ç¨‹åéƒ½å…·æœ‰ç»Ÿä¸€çš„é£æ ¼ï¼špool-m-thread-nï¼ˆmä¸ºçº¿ç¨‹æ± çš„ç¼–å·ï¼Œnä¸ºçº¿ç¨‹æ± å†…çš„çº¿ç¨‹ç¼–å·ï¼‰ã€‚</p>
<p>6ã€handlerï¼ˆçº¿ç¨‹é¥±å’Œç­–ç•¥ï¼‰ï¼šå½“çº¿ç¨‹æ± å’Œé˜Ÿåˆ—éƒ½æ»¡äº†ï¼Œå†åŠ å…¥çº¿ç¨‹ä¼šæ‰§è¡Œæ­¤ç­–ç•¥ã€‚</p>
<p>7ã€unit å­˜æ´»çš„æ—¶é—´å•ä½</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ThreadPoolExecutor threadPool = <span class="keyword">new</span> ThreadPoolExecutor(corePoolSizeï¼š<span class="number">10</span>, maximumPoolSizeï¼š<span class="number">15</span>, keepAliveTimeï¼š<span class="number">6060</span>, TimeUnit.SECONDS, <span class="keyword">new</span> LinkedBlockingQueue&lt;Runnable&gt;());</span><br></pre></td></tr></table></figure>
<blockquote>
<p><strong>å³åˆå§‹åŒ–10ä¸ªï¼Œæœ€å¤§15ä¸ªï¼Œå­˜æ´»6060ï¼Œå•ä½ä¸ºç§’ï¼Œæœ‰å“ªäº›å¾…æ‰§è¡Œä»»åŠ¡ã€‚</strong></p>
</blockquote>
<h3 id="%E6%8B%92%E7%BB%9D%E7%AD%96%E7%95%A5(%E9%87%8D%E7%82%B9)" id="æ‹’ç»ç­–ç•¥-é‡ç‚¹">æ‹’ç»ç­–ç•¥(é‡ç‚¹)</h3>
<p>CallerRunsPolicy: å½“è§¦å‘æ‹’ç»ç­–ç•¥ï¼Œåªè¦çº¿ç¨‹æ± æ²¡æœ‰å…³é—­çš„è¯ï¼Œåˆ™ä½¿ç”¨è°ƒç”¨çº¿ç¨‹ç›´æ¥è¿è¡Œä»»åŠ¡ã€‚ä¸€èˆ¬å¹¶å‘æ¯”è¾ƒå°ï¼Œæ€§èƒ½è¦æ±‚ä¸é«˜ï¼Œä¸å…è®¸å¤±è´¥ã€‚ä½†æ˜¯ï¼Œç”±äºè°ƒç”¨è€…è‡ªå·±è¿è¡Œä»»åŠ¡ï¼Œå¦‚æœä»»åŠ¡æäº¤é€Ÿåº¦è¿‡å¿«ï¼Œå¯èƒ½å¯¼è‡´ç¨‹åºé˜»å¡ï¼Œæ€§èƒ½æ•ˆç‡ä¸Šå¿…ç„¶çš„æŸå¤±è¾ƒå¤§<br />
AbortPolicy: ä¸¢å¼ƒä»»åŠ¡ï¼Œå¹¶æŠ›å‡ºæ‹’ç»æ‰§è¡Œ RejectedExecutionException å¼‚å¸¸ä¿¡æ¯ã€‚çº¿ç¨‹æ± é»˜è®¤çš„æ‹’ç»ç­–ç•¥ã€‚å¿…é¡»å¤„ç†å¥½æŠ›å‡ºçš„å¼‚å¸¸ï¼Œå¦åˆ™ä¼šæ‰“æ–­å½“å‰çš„æ‰§è¡Œæµç¨‹ï¼Œå½±å“åç»­çš„ä»»åŠ¡æ‰§è¡Œã€‚<br />
DiscardPolicy: ç›´æ¥ä¸¢å¼ƒï¼Œå…¶ä»–å•¥éƒ½æ²¡æœ‰<br />
DiscardOldestPolicy: å½“è§¦å‘æ‹’ç»ç­–ç•¥ï¼Œåªè¦çº¿ç¨‹æ± æ²¡æœ‰å…³é—­çš„è¯ï¼Œä¸¢å¼ƒé˜»å¡é˜Ÿåˆ— workQueue ä¸­æœ€è€çš„ä¸€ä¸ªä»»åŠ¡ï¼Œå¹¶å°†æ–°ä»»åŠ¡åŠ å…¥</p>
<h3 id="%E7%BA%BF%E7%A8%8B%E6%B1%A0%E7%9A%84%E7%A7%8D%E7%B1%BB%E4%B8%8E%E5%88%9B%E5%BB%BA" id="çº¿ç¨‹æ± çš„ç§ç±»ä¸åˆ›å»º">çº¿ç¨‹æ± çš„ç§ç±»ä¸åˆ›å»º</h3>
<h4 id="%E7%BA%BF%E7%A8%8B%E6%B1%A0%E6%80%BB%E5%AF%B9%E6%AF%94" id="çº¿ç¨‹æ± æ€»å¯¹æ¯”">çº¿ç¨‹æ± æ€»å¯¹æ¯”</h4>
<p>1ã€new<strong>Cached</strong>ThreadPoolï¼šç”¨æ¥åˆ›å»ºä¸€ä¸ªå¯ä»¥<strong>æ— é™æ‰©å¤§</strong>çš„çº¿ç¨‹æ± ï¼Œ<strong>é€‚ç”¨äºè´Ÿè½½è¾ƒè½»</strong>çš„åœºæ™¯ï¼Œæ‰§è¡Œ<strong>çŸ­æœŸå¼‚æ­¥</strong>ä»»åŠ¡ã€‚ï¼ˆå¯ä»¥ä½¿å¾—ä»»åŠ¡å¿«é€Ÿå¾—åˆ°æ‰§è¡Œï¼Œå› ä¸ºä»»åŠ¡æ—¶é—´æ‰§è¡ŒçŸ­ï¼Œå¯ä»¥å¾ˆå¿«ç»“æŸï¼Œä¹Ÿä¸ä¼šé€ æˆcpuè¿‡åº¦åˆ‡æ¢ï¼‰<br />
2ã€new<strong>Fixed</strong>ThreadPoolï¼šåˆ›å»ºä¸€ä¸ª<strong>å›ºå®šå¤§å°</strong>çš„çº¿ç¨‹æ± ï¼Œå› ä¸ºé‡‡ç”¨æ— ç•Œçš„é˜»å¡é˜Ÿåˆ—ï¼Œæ‰€ä»¥å®é™…çº¿ç¨‹æ•°é‡æ°¸è¿œä¸ä¼šå˜åŒ–ï¼Œé€‚ç”¨äº<strong>è´Ÿè½½è¾ƒé‡</strong>çš„åœºæ™¯ï¼Œå¯¹å½“å‰<strong>çº¿ç¨‹æ•°é‡è¿›è¡Œé™åˆ¶</strong>ã€‚ï¼ˆä¿è¯çº¿ç¨‹æ•°å¯æ§ï¼Œä¸ä¼šé€ æˆçº¿ç¨‹è¿‡å¤šï¼Œå¯¼è‡´ç³»ç»Ÿè´Ÿè½½æ›´ä¸ºä¸¥é‡ï¼‰<br />
3ã€new<strong>Single</strong>ThreadExecutorï¼šåˆ›å»ºä¸€ä¸ª<strong>å•çº¿ç¨‹</strong>çš„çº¿ç¨‹æ± ï¼Œé€‚ç”¨äºéœ€è¦ä¿è¯<strong>é¡ºåºæ‰§è¡Œ</strong>å„ä¸ªä»»åŠ¡ã€‚<br />
4ã€new<strong>Scheduled</strong>ThreadPoolï¼šé€‚ç”¨äºæ‰§è¡Œ<strong>å»¶æ—¶æˆ–è€…å‘¨æœŸæ€§</strong>ä»»åŠ¡ã€‚</p>
<h4 id="newcachedthreadpool(%E5%B8%B8%E7%94%A8)" id="newCachedThreadPool-å¸¸ç”¨">newCachedThreadPool(å¸¸ç”¨)</h4>
<p>ä½œç”¨ï¼šåˆ›å»ºä¸€ä¸ªå¯ç¼“å­˜çº¿ç¨‹æ± ï¼Œå¦‚æœçº¿ç¨‹æ± é•¿åº¦è¶…è¿‡å¤„ç†éœ€è¦ï¼Œå¯çµæ´»å›æ”¶ç©ºé—²çº¿ç¨‹ï¼Œè‹¥æ— å¯å›æ”¶ï¼Œåˆ™æ–°å»ºçº¿ç¨‹.<br />
ç‰¹ç‚¹:<br />
â€¢ çº¿ç¨‹æ± ä¸­æ•°é‡æ²¡æœ‰å›ºå®šï¼Œå¯è¾¾åˆ°æœ€å¤§å€¼ï¼ˆInterger. MAX_VALUEï¼‰<br />
â€¢ çº¿ç¨‹æ± ä¸­çš„çº¿ç¨‹å¯è¿›è¡Œç¼“å­˜é‡å¤åˆ©ç”¨å’Œå›æ”¶ï¼ˆå›æ”¶é»˜è®¤æ—¶é—´ä¸º1åˆ†é’Ÿï¼‰<br />
â€¢ å½“çº¿ç¨‹æ± ä¸­ï¼Œæ²¡æœ‰å¯ç”¨çº¿ç¨‹ï¼Œä¼šé‡æ–°åˆ›å»ºä¸€ä¸ªçº¿ç¨‹<br />
åˆ›å»ºæ–¹å¼ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/** * å¯ç¼“å­˜çº¿ç¨‹æ±  * <span class="doctag">@return</span> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> ExecutorService <span class="title">newCachedThreadPool</span><span class="params">()</span></span>&#123; </span><br><span class="line">    <span class="comment">/** * corePoolSizeçº¿ç¨‹æ± çš„æ ¸å¿ƒçº¿ç¨‹æ•° </span></span><br><span class="line"><span class="comment">    * maximumPoolSizeèƒ½å®¹çº³çš„æœ€å¤§çº¿ç¨‹æ•° </span></span><br><span class="line"><span class="comment">    * keepAliveTimeç©ºé—²çº¿ç¨‹å­˜æ´»æ—¶é—´ </span></span><br><span class="line"><span class="comment">    * unit å­˜æ´»çš„æ—¶é—´å•ä½ </span></span><br><span class="line"><span class="comment">    * workQueue å­˜æ”¾æäº¤ä½†æœªæ‰§è¡Œä»»åŠ¡çš„é˜Ÿåˆ— </span></span><br><span class="line"><span class="comment">    * threadFactory åˆ›å»ºçº¿ç¨‹çš„å·¥å‚ç±»:å¯ä»¥çœç•¥ </span></span><br><span class="line"><span class="comment">    * handler ç­‰å¾…é˜Ÿåˆ—æ»¡åçš„æ‹’ç»ç­–ç•¥:å¯ä»¥çœç•¥ */</span> </span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> ThreadPoolExecutor(<span class="number">0</span>, Integer.MAX_VALUE, <span class="number">60L</span>, TimeUnit.SECONDS, <span class="keyword">new</span> SynchronousQueue&lt;&gt;(), </span><br><span class="line">                                  Executors.defaultThreadFactory(), <span class="keyword">new</span> ThreadPoolExecutor.AbortPolicy()); &#125;</span><br></pre></td></tr></table></figure>
<h4 id="newfixedthreadpool(%E5%B8%B8%E7%94%A8)" id="newFixedThreadPool-å¸¸ç”¨">newFixedThreadPool(å¸¸ç”¨)</h4>
<p>ä½œç”¨ï¼šåˆ›å»ºä¸€ä¸ªå¯é‡ç”¨å›ºå®šçº¿ç¨‹æ•°çš„çº¿ç¨‹æ± ï¼Œä»¥å…±äº«çš„æ— ç•Œé˜Ÿåˆ—æ–¹å¼æ¥è¿è¡Œè¿™äº›çº¿ç¨‹ã€‚åœ¨ä»»æ„ç‚¹ï¼Œåœ¨å¤§å¤šæ•°çº¿ç¨‹ä¼šå¤„äºå¤„ç†ä»»åŠ¡çš„æ´»åŠ¨çŠ¶æ€ã€‚å¦‚æœåœ¨æ‰€æœ‰çº¿ç¨‹å¤„äºæ´»åŠ¨çŠ¶æ€æ—¶æäº¤é™„åŠ ä»»åŠ¡ï¼Œåˆ™åœ¨æœ‰å¯ç”¨çº¿ç¨‹ä¹‹å‰ï¼Œé™„åŠ ä»»åŠ¡å°†åœ¨é˜Ÿåˆ—ä¸­ç­‰å¾…ã€‚å¦‚æœåœ¨å…³é—­å‰çš„æ‰§è¡ŒæœŸé—´ç”±äºå¤±è´¥è€Œå¯¼è‡´ä»»ä½•çº¿ç¨‹ç»ˆæ­¢ï¼Œé‚£ä¹ˆä¸€ä¸ªæ–°çº¿ç¨‹å°†ä»£æ›¿å®ƒæ‰§è¡Œåç»­çš„ä»»åŠ¡ï¼ˆå¦‚æœéœ€è¦ï¼‰ã€‚åœ¨æŸä¸ªçº¿ç¨‹è¢«æ˜¾å¼åœ°å…³é—­ä¹‹å‰ï¼Œæ± ä¸­çš„çº¿ç¨‹å°†ä¸€ç›´å­˜åœ¨ã€‚åœºæ™¯: é€‚ç”¨äºå¯ä»¥é¢„æµ‹çº¿ç¨‹æ•°é‡çš„ä¸šåŠ¡ä¸­ï¼Œæˆ–è€…æœåŠ¡å™¨è´Ÿè½½è¾ƒé‡ï¼Œå¯¹çº¿ç¨‹æ•°æœ‰ä¸¥æ ¼é™åˆ¶çš„åœºæ™¯<br />
ç‰¹å¾ï¼š<br />
â€¢ çº¿ç¨‹æ± ä¸­çš„çº¿ç¨‹å¤„äºä¸€å®šçš„é‡ï¼Œå¯ä»¥å¾ˆå¥½çš„æ§åˆ¶çº¿ç¨‹çš„å¹¶å‘é‡<br />
â€¢ çº¿ç¨‹å¯ä»¥é‡å¤è¢«ä½¿ç”¨ï¼Œåœ¨æ˜¾ç¤ºå…³é—­ä¹‹å‰ï¼Œéƒ½å°†ä¸€ç›´å­˜åœ¨<br />
â€¢ è¶…å‡ºä¸€å®šé‡çš„çº¿ç¨‹è¢«æäº¤æ—¶å€™éœ€åœ¨é˜Ÿåˆ—ä¸­ç­‰å¾…<br />
åˆ›å»ºæ–¹å¼ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/** * å›ºå®šé•¿åº¦çº¿ç¨‹æ±  * <span class="doctag">@return</span> */</span> </span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> ExecutorService <span class="title">newFixedThreadPool</span><span class="params">()</span></span>&#123; </span><br><span class="line">    <span class="comment">/** * corePoolSizeçº¿ç¨‹æ± çš„æ ¸å¿ƒçº¿ç¨‹æ•° </span></span><br><span class="line"><span class="comment">    * maximumPoolSizeèƒ½å®¹çº³çš„æœ€å¤§çº¿ç¨‹æ•° </span></span><br><span class="line"><span class="comment">    * keepAliveTimeç©ºé—²çº¿ç¨‹å­˜æ´»æ—¶é—´ </span></span><br><span class="line"><span class="comment">    * unit å­˜æ´»çš„æ—¶é—´å•ä½ </span></span><br><span class="line"><span class="comment">    * workQueue å­˜æ”¾æäº¤ä½†æœªæ‰§è¡Œä»»åŠ¡çš„é˜Ÿåˆ— </span></span><br><span class="line"><span class="comment">    * threadFactory åˆ›å»ºçº¿ç¨‹çš„å·¥å‚ç±»:å¯ä»¥çœç•¥ </span></span><br><span class="line"><span class="comment">    * handler ç­‰å¾…é˜Ÿåˆ—æ»¡åçš„æ‹’ç»ç­–ç•¥:å¯ä»¥çœç•¥ */</span> </span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> ThreadPoolExecutor(<span class="number">10</span>, <span class="number">10</span>, <span class="number">0L</span>, TimeUnit.SECONDS, <span class="keyword">new</span> LinkedBlockingQueue&lt;&gt;(), </span><br><span class="line">                                  Executors.defaultThreadFactory(), <span class="keyword">new</span> ThreadPoolExecutor.AbortPolicy()); &#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h4 id="newsinglethreadexecutor(%E5%B8%B8%E7%94%A8)" id="newSingleThreadExecutor-å¸¸ç”¨">newSingleThreadExecutor(å¸¸ç”¨)</h4>
<p>ä½œç”¨ï¼šåˆ›å»ºä¸€ä¸ªä½¿ç”¨å•ä¸ª worker çº¿ç¨‹çš„ Executorï¼Œä»¥æ— ç•Œé˜Ÿåˆ—æ–¹å¼æ¥è¿è¡Œè¯¥çº¿ç¨‹ã€‚ï¼ˆæ³¨æ„ï¼Œå¦‚æœå› ä¸ºåœ¨å…³é—­å‰çš„æ‰§è¡ŒæœŸé—´å‡ºç°å¤±è´¥è€Œç»ˆæ­¢äº†æ­¤å•ä¸ªçº¿ç¨‹ï¼Œé‚£ä¹ˆå¦‚æœéœ€è¦ï¼Œä¸€ä¸ªæ–°çº¿ç¨‹å°†ä»£æ›¿å®ƒæ‰§è¡Œåç»­çš„ä»»åŠ¡ï¼‰ã€‚å¯ä¿è¯é¡ºåºåœ°æ‰§è¡Œå„ä¸ªä»»åŠ¡ï¼Œå¹¶ä¸”åœ¨ä»»æ„ç»™å®šçš„æ—¶é—´ä¸ä¼šæœ‰å¤šä¸ªçº¿ç¨‹æ˜¯æ´»åŠ¨çš„ã€‚ä¸å…¶ä»–ç­‰æ•ˆçš„newFixedThreadPoolä¸åŒï¼Œå¯ä¿è¯æ— éœ€é‡æ–°é…ç½®æ­¤æ–¹æ³•æ‰€è¿”å›çš„æ‰§è¡Œç¨‹åºå³å¯ä½¿ç”¨å…¶ä»–çš„çº¿ç¨‹ã€‚åœºæ™¯: é€‚ç”¨äºéœ€è¦ä¿è¯é¡ºåºæ‰§è¡Œå„ä¸ªä»»åŠ¡ï¼Œå¹¶ä¸”åœ¨ä»»æ„æ—¶é—´ç‚¹ï¼Œä¸ä¼šåŒæ—¶æœ‰å¤šä¸ªçº¿ç¨‹çš„åœºæ™¯ã€‚<br />
ç‰¹å¾ï¼š çº¿ç¨‹æ± ä¸­æœ€å¤šæ‰§è¡Œ1ä¸ªçº¿ç¨‹ï¼Œä¹‹åæäº¤çš„çº¿ç¨‹æ´»åŠ¨å°†ä¼šæ’åœ¨é˜Ÿåˆ—ä¸­ä»¥æ­¤æ‰§è¡Œ<br />
åˆ›å»ºæ–¹å¼ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/** * å•ä¸€çº¿ç¨‹æ±  * <span class="doctag">@return</span> */</span> </span><br><span class="line"><span class="comment">/** * corePoolSizeçº¿ç¨‹æ± çš„æ ¸å¿ƒçº¿ç¨‹æ•° </span></span><br><span class="line"><span class="comment">* maximumPoolSizeèƒ½å®¹çº³çš„æœ€å¤§çº¿ç¨‹æ•° </span></span><br><span class="line"><span class="comment">* keepAliveTimeç©ºé—²çº¿ç¨‹å­˜æ´»æ—¶é—´ </span></span><br><span class="line"><span class="comment">* unit å­˜æ´»çš„æ—¶é—´å•ä½ </span></span><br><span class="line"><span class="comment">* workQueue å­˜æ”¾æäº¤ä½†æœªæ‰§è¡Œä»»åŠ¡çš„é˜Ÿåˆ— </span></span><br><span class="line"><span class="comment">* threadFactory åˆ›å»ºçº¿ç¨‹çš„å·¥å‚ç±»:å¯ä»¥çœç•¥ </span></span><br><span class="line"><span class="comment">* handler ç­‰å¾…é˜Ÿåˆ—æ»¡åçš„æ‹’ç»ç­–ç•¥:å¯ä»¥çœç•¥ */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> ExecutorService <span class="title">newSingleThreadExecutor</span><span class="params">()</span></span>&#123; </span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> ThreadPoolExecutor(<span class="number">1</span>, <span class="number">1</span>, <span class="number">0L</span>, TimeUnit.SECONDS, <span class="keyword">new</span> LinkedBlockingQueue&lt;&gt;(), </span><br><span class="line">                                  Executors.defaultThreadFactory(), <span class="keyword">new</span> ThreadPoolExecutor.AbortPolicy()); &#125;</span><br></pre></td></tr></table></figure>
<h4 id="newschedulethreadpool(%E4%BA%86%E8%A7%A3)" id="newScheduleThreadPool-äº†è§£">newScheduleThreadPool(äº†è§£)</h4>
<p>ä½œç”¨: çº¿ç¨‹æ± æ”¯æŒå®šæ—¶ä»¥åŠå‘¨æœŸæ€§æ‰§è¡Œä»»åŠ¡ï¼Œåˆ›å»ºä¸€ä¸ªcorePoolSizeä¸ºä¼ å…¥å‚æ•°ï¼Œæœ€å¤§çº¿ç¨‹æ•°ä¸ºæ•´å½¢çš„æœ€å¤§æ•°çš„çº¿ç¨‹æ± ã€‚åœºæ™¯: é€‚ç”¨äºéœ€è¦å¤šä¸ªåå°çº¿ç¨‹æ‰§è¡Œå‘¨æœŸä»»åŠ¡çš„åœºæ™¯ã€‚<br />
ç‰¹å¾:<br />
ï¼ˆ1ï¼‰çº¿ç¨‹æ± ä¸­å…·æœ‰æŒ‡å®šæ•°é‡çš„çº¿ç¨‹ï¼Œå³ä¾¿æ˜¯ç©ºçº¿ç¨‹ä¹Ÿå°†ä¿ç•™ ï¼ˆ2ï¼‰å¯å®šæ—¶æˆ–è€…å»¶è¿Ÿæ‰§è¡Œçº¿ç¨‹æ´»åŠ¨<br />
åˆ›å»ºæ–¹å¼:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> ScheduledExecutorService <span class="title">newScheduledThreadPool</span><span class="params">(<span class="keyword">int</span> corePoolSize, ThreadFactory threadFactory)</span> </span>&#123; </span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> ScheduledThreadPoolExecutor(corePoolSize, threadFactory); &#125;</span><br></pre></td></tr></table></figure>
<h4 id="newworkstealingpool" id="newWorkStealingPool">newWorkStealingPool</h4>
<p>jdk1.8æä¾›çš„çº¿ç¨‹æ± ï¼Œåº•å±‚ä½¿ç”¨çš„æ˜¯ForkJoinPoolå®ç°ï¼Œåˆ›å»ºä¸€ä¸ªæ‹¥æœ‰å¤šä¸ªä»»åŠ¡é˜Ÿåˆ—çš„çº¿ç¨‹æ± ï¼Œå¯ä»¥å‡å°‘è¿æ¥æ•°ï¼Œåˆ›å»ºå½“å‰å¯ç”¨cpuæ ¸æ•°çš„çº¿ç¨‹æ¥å¹¶è¡Œæ‰§è¡Œä»»åŠ¡ã€‚åœºæ™¯: é€‚ç”¨äºå¤§è€—æ—¶ï¼Œå¯å¹¶è¡Œæ‰§è¡Œçš„åœºæ™¯<br />
åˆ›å»ºæ–¹å¼:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> ExecutorService <span class="title">newWorkStealingPool</span><span class="params">(<span class="keyword">int</span> parallelism)</span> </span>&#123; </span><br><span class="line">    <span class="comment">/** </span></span><br><span class="line"><span class="comment">    * parallelismï¼šå¹¶è¡Œçº§åˆ«ï¼Œé€šå¸¸é»˜è®¤ä¸ºJVMå¯ç”¨çš„å¤„ç†å™¨ä¸ªæ•° </span></span><br><span class="line"><span class="comment">    * factoryï¼šç”¨äºåˆ›å»ºForkJoinPoolä¸­ä½¿ç”¨çš„çº¿ç¨‹ã€‚ </span></span><br><span class="line"><span class="comment">    * handlerï¼šç”¨äºå¤„ç†å·¥ä½œçº¿ç¨‹æœªå¤„ç†çš„å¼‚å¸¸ï¼Œé»˜è®¤ä¸ºnull </span></span><br><span class="line"><span class="comment">    * asyncModeï¼šç”¨äºæ§åˆ¶WorkQueueçš„å·¥ä½œæ¨¡å¼:é˜Ÿåˆ—---åé˜Ÿåˆ—</span></span><br><span class="line"><span class="comment">*/</span> </span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> ForkJoinPool(parallelism, ForkJoinPool.defaultForkJoinWorkerThreadFactory, <span class="keyword">null</span>, <span class="keyword">true</span>); &#125;</span><br></pre></td></tr></table></figure>
<h3 id="%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86" id="åº•å±‚åŸç†">åº•å±‚åŸç†</h3>
<p><img src="https://gitee.com/mychimei/picture/raw/master/work/image-20220216212625652.png" alt="image-20220216212625652" /></p>
<ol>
<li>åœ¨åˆ›å»ºäº†çº¿ç¨‹æ± åï¼Œçº¿ç¨‹æ± ä¸­çš„çº¿ç¨‹æ•°ä¸ºé›¶</li>
<li>å½“è°ƒç”¨execute()æ–¹æ³•æ·»åŠ ä¸€ä¸ªè¯·æ±‚ä»»åŠ¡æ—¶ï¼Œçº¿ç¨‹æ± ä¼šåšå‡ºå¦‚ä¸‹åˆ¤æ–­ï¼š
<ul>
<li>2.1 å¦‚æœæ­£åœ¨è¿è¡Œçš„çº¿ç¨‹æ•°é‡å°äºcorePoolSizeï¼Œé‚£ä¹ˆé©¬ä¸Šåˆ›å»ºçº¿ç¨‹è¿è¡Œè¿™ä¸ªä»»åŠ¡ï¼›</li>
<li>2.2 å¦‚æœæ­£åœ¨è¿è¡Œçš„çº¿ç¨‹æ•°é‡å¤§äºæˆ–ç­‰äºcorePoolSizeï¼Œé‚£ä¹ˆå°†è¿™ä¸ªä»»åŠ¡æ”¾å…¥é˜Ÿåˆ—ï¼›</li>
<li>2.3 å¦‚æœè¿™ä¸ªæ—¶å€™é˜Ÿåˆ—æ»¡äº†ä¸”æ­£åœ¨è¿è¡Œçš„çº¿ç¨‹æ•°é‡è¿˜å°äºmaximumPoolSizeï¼Œé‚£ä¹ˆè¿˜æ˜¯è¦åˆ›å»ºéæ ¸å¿ƒçº¿ç¨‹ç«‹åˆ»è¿è¡Œè¿™ä¸ªä»»åŠ¡ï¼›</li>
<li>2.4 å¦‚æœé˜Ÿåˆ—æ»¡äº†ä¸”æ­£åœ¨è¿è¡Œçš„çº¿ç¨‹æ•°é‡å¤§äºæˆ–ç­‰äºmaximumPoolSizeï¼Œé‚£ä¹ˆçº¿ç¨‹æ± ä¼šå¯åŠ¨é¥±å’Œæ‹’ç»ç­–ç•¥æ¥æ‰§è¡Œã€‚</li>
</ul>
</li>
<li>å½“ä¸€ä¸ªçº¿ç¨‹å®Œæˆä»»åŠ¡æ—¶ï¼Œå®ƒä¼šä»é˜Ÿåˆ—ä¸­å–ä¸‹ä¸€ä¸ªä»»åŠ¡æ¥æ‰§è¡Œ</li>
<li>å½“ä¸€ä¸ªçº¿ç¨‹æ— äº‹å¯åšè¶…è¿‡ä¸€å®šçš„æ—¶é—´ï¼ˆkeepAliveTimeï¼‰æ—¶ï¼Œçº¿ç¨‹ä¼šåˆ¤æ–­ï¼š
<ul>
<li>4.1 å¦‚æœå½“å‰è¿è¡Œçš„çº¿ç¨‹æ•°å¤§äºcorePoolSizeï¼Œé‚£ä¹ˆè¿™ä¸ªçº¿ç¨‹å°±è¢«åœæ‰ã€‚</li>
<li>4.2 æ‰€ä»¥çº¿ç¨‹æ± çš„æ‰€æœ‰ä»»åŠ¡å®Œæˆåï¼Œå®ƒæœ€ç»ˆä¼šæ”¶ç¼©åˆ°corePoolSizeçš„å¤§å°ã€‚</li>
</ul>
</li>
</ol>
<p><img src="https://gitee.com/mychimei/picture/raw/master/work/image-20220216212644963.png" alt="image-20220216212644963" /></p>
<h3 id="%E6%B3%A8%E6%84%8F%E4%BA%8B%E9%A1%B9(%E9%87%8D%E8%A6%81)" id="æ³¨æ„äº‹é¡¹-é‡è¦">æ³¨æ„äº‹é¡¹(é‡è¦)</h3>
<ol>
<li>é¡¹ç›®ä¸­åˆ›å»ºå¤šçº¿ç¨‹æ—¶ï¼Œä½¿ç”¨å¸¸è§çš„ä¸‰ç§çº¿ç¨‹æ± åˆ›å»ºæ–¹å¼ï¼Œå•ä¸€ã€å¯å˜ã€å®šé•¿éƒ½æœ‰ä¸€å®šé—®é¢˜ï¼ŒåŸå› æ˜¯FixedThreadPoolå’ŒSingleThreadExecutoråº•å±‚éƒ½æ˜¯ç”¨LinkedBlockingQueueå®ç°çš„ï¼Œè¿™ä¸ªé˜Ÿåˆ—æœ€å¤§é•¿åº¦ä¸ºInteger.MAX_VALUEï¼Œ<strong>å®¹æ˜“å¯¼è‡´OOM</strong>ã€‚æ‰€ä»¥<strong>å®é™…ç”Ÿäº§ä¸€èˆ¬è‡ªå·±é€šè¿‡ThreadPoolExecutorçš„7ä¸ªå‚æ•°ï¼Œè‡ªå®šä¹‰çº¿ç¨‹æ± </strong></li>
<li>åˆ›å»ºçº¿ç¨‹æ± æ¨èé€‚ç”¨ThreadPoolExecutoråŠå…¶7ä¸ªå‚æ•°æ‰‹åŠ¨åˆ›å»º<br />
corePoolSizeçº¿ç¨‹æ± çš„æ ¸å¿ƒçº¿ç¨‹æ•°<br />
maximumPoolSizeèƒ½å®¹çº³çš„æœ€å¤§çº¿ç¨‹æ•°<br />
keepAliveTimeç©ºé—²çº¿ç¨‹å­˜æ´»æ—¶é—´<br />
unit å­˜æ´»çš„æ—¶é—´å•ä½<br />
workQueue å­˜æ”¾æäº¤ä½†æœªæ‰§è¡Œä»»åŠ¡çš„é˜Ÿåˆ—<br />
threadFactory åˆ›å»ºçº¿ç¨‹çš„å·¥å‚ç±»<br />
handler ç­‰å¾…é˜Ÿåˆ—æ»¡åçš„æ‹’ç»ç­–ç•¥</li>
</ol>
<p>â€‹		æ‰‹åŠ¨åˆ›å»ºç¤ºä¾‹</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.atguigu.pool;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.*;</span><br><span class="line"></span><br><span class="line"><span class="comment">//è‡ªå®šä¹‰æ‰‹åŠ¨çº¿ç¨‹æ± åˆ›å»º</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ThreadPoolDemo2</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        ExecutorService threadPool = <span class="keyword">new</span> ThreadPoolExecutor(</span><br><span class="line">                <span class="number">2</span>,</span><br><span class="line">                <span class="number">5</span>,</span><br><span class="line">                <span class="number">2L</span>,</span><br><span class="line">                TimeUnit.SECONDS,</span><br><span class="line">                <span class="keyword">new</span> ArrayBlockingQueue&lt;&gt;(<span class="number">3</span>),</span><br><span class="line">                Executors.defaultThreadFactory(),</span><br><span class="line">                <span class="keyword">new</span> ThreadPoolExecutor.AbortPolicy()</span><br><span class="line">        );</span><br><span class="line"></span><br><span class="line">        <span class="comment">//10ä¸ªé¡¾å®¢è¯·æ±‚</span></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;=<span class="number">10</span>; i++) &#123;</span><br><span class="line">                <span class="comment">//æ‰§è¡Œ</span></span><br><span class="line">                threadPool.execute(()-&gt;&#123;</span><br><span class="line">                    System.out.println(Thread.currentThread().getName()+<span class="string">&quot; åŠç†ä¸šåŠ¡&quot;</span>);</span><br><span class="line">                &#125;);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;<span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;<span class="keyword">finally</span> &#123;</span><br><span class="line">            <span class="comment">//å…³é—­</span></span><br><span class="line">            threadPool.shutdown();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<ol>
<li>ä¸ºä»€ä¹ˆä¸å…è®¸é€‚ç”¨ä¸å…è®¸Executors.çš„æ–¹å¼æ‰‹åŠ¨åˆ›å»ºçº¿ç¨‹æ± ,å¦‚ä¸‹å›¾</li>
</ol>
<p><img src="https://gitee.com/mychimei/picture/raw/master/work/image-20220216212705278.png" alt="image-20220216212705278" /></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">    <span class="comment">/**ä½¿ç”¨Executorsåˆ›å»ºçº¿ç¨‹æ± ï¼Œå»ºè®®æ‰‹åŠ¨åˆ›å»ºçº¿ç¨‹æ± </span></span><br><span class="line"><span class="comment">     * çº¿ç¨‹æ± ä¸å…è®¸ä½¿ç”¨Executorså»åˆ›å»ºï¼Œè€Œæ˜¯é€šè¿‡ThreadPoolExecutorçš„æ–¹å¼ï¼Œè¿™æ ·çš„å¤„ç†æ–¹å¼è®©å†™çš„åŒå­¦æ›´åŠ æ˜ç¡®çº¿ç¨‹æ± çš„è¿è¡Œè§„åˆ™ï¼Œè§„é¿èµ„æºè€—å°½çš„é£é™©ã€‚ è¯´æ˜ï¼šExecutorsè¿”å›çš„çº¿ç¨‹æ± å¯¹è±¡çš„å¼Šç«¯å¦‚ä¸‹ï¼š</span></span><br><span class="line"><span class="comment">     * 1ï¼‰FixedThreadPoolå’ŒSingleThreadPool:</span></span><br><span class="line"><span class="comment">     * å…è®¸çš„è¯·æ±‚é˜Ÿåˆ—é•¿åº¦ä¸ºInteger.MAX_VALUEï¼Œå¯èƒ½ä¼šå †ç§¯å¤§é‡çš„è¯·æ±‚ï¼Œä»è€Œå¯¼è‡´OOMã€‚</span></span><br><span class="line"><span class="comment">     * 2ï¼‰CachedThreadPool:</span></span><br><span class="line"><span class="comment">     * å…è®¸çš„åˆ›å»ºçº¿ç¨‹æ•°é‡ä¸ºInteger.MAX_VALUEï¼Œå¯èƒ½ä¼šåˆ›å»ºå¤§é‡çš„çº¿ç¨‹ï¼Œä»è€Œå¯¼è‡´OOMã€‚*/</span></span><br><span class="line">            </span><br><span class="line">Positive example <span class="number">1</span>ï¼š</span><br><span class="line">    <span class="comment">//org.apache.commons.lang3.concurrent.BasicThreadFactory</span></span><br><span class="line">    ScheduledExecutorService executorService = <span class="keyword">new</span> ScheduledThreadPoolExecutor(<span class="number">1</span>,</span><br><span class="line">        <span class="keyword">new</span> BasicThreadFactory.Builder().namingPattern(<span class="string">&quot;example-schedule-pool-%d&quot;</span>).daemon(<span class="keyword">true</span>).build());</span><br><span class="line">       </span><br><span class="line">        </span><br><span class="line">            </span><br><span class="line">Positive example <span class="number">2</span>ï¼š</span><br><span class="line">    ThreadFactory namedThreadFactory = <span class="keyword">new</span> ThreadFactoryBuilder()</span><br><span class="line">        .setNameFormat(<span class="string">&quot;demo-pool-%d&quot;</span>).build();</span><br><span class="line"></span><br><span class="line">    <span class="comment">//Common Thread Pool</span></span><br><span class="line">    ExecutorService pool = <span class="keyword">new</span> ThreadPoolExecutor(<span class="number">5</span>, <span class="number">200</span>,</span><br><span class="line">        <span class="number">0L</span>, TimeUnit.MILLISECONDS,</span><br><span class="line">        <span class="keyword">new</span> LinkedBlockingQueue&lt;Runnable&gt;(<span class="number">1024</span>), namedThreadFactory, <span class="keyword">new</span> ThreadPoolExecutor.AbortPolicy());</span><br><span class="line"></span><br><span class="line">    pool.execute(()-&gt; System.out.println(Thread.currentThread().getName()));</span><br><span class="line">    pool.shutdown();<span class="comment">//gracefully shutdown</span></span><br><span class="line">       </span><br><span class="line">        </span><br><span class="line">            </span><br><span class="line">Positive example <span class="number">3</span>ï¼š</span><br><span class="line">    &lt;bean id=<span class="string">&quot;userThreadPool&quot;</span></span><br><span class="line">        <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;org.springframework.scheduling.concurrent.ThreadPoolTaskExecutor&quot;</span>&gt;</span><br><span class="line">        &lt;property name=<span class="string">&quot;corePoolSize&quot;</span> value=<span class="string">&quot;10&quot;</span> /&gt;</span><br><span class="line">        &lt;property name=<span class="string">&quot;maxPoolSize&quot;</span> value=<span class="string">&quot;100&quot;</span> /&gt;</span><br><span class="line">        &lt;property name=<span class="string">&quot;queueCapacity&quot;</span> value=<span class="string">&quot;2000&quot;</span> /&gt;</span><br><span class="line"></span><br><span class="line">    &lt;property name=<span class="string">&quot;threadFactory&quot;</span> value= threadFactory /&gt;</span><br><span class="line">        &lt;property name=<span class="string">&quot;rejectedExecutionHandler&quot;</span>&gt;</span><br><span class="line">            &lt;ref local=<span class="string">&quot;rejectedExecutionHandler&quot;</span> /&gt;</span><br><span class="line">        &lt;/property&gt;</span><br><span class="line">    &lt;/bean&gt;</span><br><span class="line">    <span class="comment">//in code</span></span><br><span class="line">    userThreadPool.execute(thread);</span><br></pre></td></tr></table></figure>
<h3 id="%E7%BA%BF%E7%A8%8B%E6%B1%A0%E6%B5%81%E7%A8%8B" id="çº¿ç¨‹æ± æµç¨‹">çº¿ç¨‹æ± æµç¨‹</h3>
<p><img src="https:////upload-images.jianshu.io/upload_images/6024478-88ee7b20f8f45825.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/937/format/webp" alt="img" /></p>
<p>çº¿ç¨‹æ± æµç¨‹</p>
<p>1ã€åˆ¤æ–­æ ¸å¿ƒçº¿ç¨‹æ± æ˜¯å¦å·²æ»¡ï¼Œæ²¡æ»¡åˆ™åˆ›å»ºä¸€ä¸ªæ–°çš„å·¥ä½œçº¿ç¨‹æ¥æ‰§è¡Œä»»åŠ¡ã€‚å·²æ»¡åˆ™ã€‚<br />
2ã€åˆ¤æ–­ä»»åŠ¡é˜Ÿåˆ—æ˜¯å¦å·²æ»¡ï¼Œæ²¡æ»¡åˆ™å°†æ–°æäº¤çš„ä»»åŠ¡æ·»åŠ åœ¨å·¥ä½œé˜Ÿåˆ—ï¼Œå·²æ»¡åˆ™ã€‚<br />
3ã€åˆ¤æ–­æ•´ä¸ªçº¿ç¨‹æ± æ˜¯å¦å·²æ»¡ï¼Œæ²¡æ»¡åˆ™åˆ›å»ºä¸€ä¸ªæ–°çš„å·¥ä½œçº¿ç¨‹æ¥æ‰§è¡Œä»»åŠ¡ï¼Œå·²æ»¡åˆ™æ‰§è¡Œé¥±å’Œç­–ç•¥ã€‚</p>
<p>ï¼ˆ1ã€åˆ¤æ–­çº¿ç¨‹æ± ä¸­å½“å‰çº¿ç¨‹æ•°æ˜¯å¦å¤§äºæ ¸å¿ƒçº¿ç¨‹æ•°ï¼Œå¦‚æœå°äºï¼Œåœ¨åˆ›å»ºä¸€ä¸ªæ–°çš„çº¿ç¨‹æ¥æ‰§è¡Œä»»åŠ¡ï¼Œå¦‚æœå¤§äºåˆ™<br />
2ã€åˆ¤æ–­ä»»åŠ¡é˜Ÿåˆ—æ˜¯å¦å·²æ»¡ï¼Œæ²¡æ»¡åˆ™å°†æ–°æäº¤çš„ä»»åŠ¡æ·»åŠ åœ¨å·¥ä½œé˜Ÿåˆ—ï¼Œå·²æ»¡åˆ™ã€‚<br />
3ã€åˆ¤æ–­çº¿ç¨‹æ± ä¸­å½“å‰çº¿ç¨‹æ•°æ˜¯å¦å¤§äºæœ€å¤§çº¿ç¨‹æ•°ï¼Œå¦‚æœå°äºï¼Œåˆ™åˆ›å»ºä¸€ä¸ªæ–°çš„çº¿ç¨‹æ¥æ‰§è¡Œä»»åŠ¡ï¼Œå¦‚æœå¤§äºï¼Œåˆ™æ‰§è¡Œé¥±å’Œç­–ç•¥ã€‚ï¼‰</p>
<h3 id="%E7%BA%BF%E7%A8%8B%E6%B1%A0%E4%B8%BA%E4%BB%80%E4%B9%88%E9%9C%80%E8%A6%81%E4%BD%BF%E7%94%A8%EF%BC%88%E9%98%BB%E5%A1%9E%EF%BC%89%E9%98%9F%E5%88%97%EF%BC%9F" id="çº¿ç¨‹æ± ä¸ºä»€ä¹ˆéœ€è¦ä½¿ç”¨ï¼ˆé˜»å¡ï¼‰é˜Ÿåˆ—ï¼Ÿ">çº¿ç¨‹æ± ä¸ºä»€ä¹ˆéœ€è¦ä½¿ç”¨ï¼ˆé˜»å¡ï¼‰é˜Ÿåˆ—ï¼Ÿ</h3>
<p>å›åˆ°äº†éçº¿ç¨‹æ± ç¼ºç‚¹ä¸­çš„ç¬¬3ç‚¹ï¼š<br />
1ã€å› ä¸ºçº¿ç¨‹è‹¥æ˜¯æ— é™åˆ¶çš„åˆ›å»ºï¼Œå¯èƒ½ä¼šå¯¼è‡´å†…å­˜å ç”¨è¿‡å¤šè€Œäº§ç”ŸOOMï¼Œå¹¶ä¸”ä¼šé€ æˆcpuè¿‡åº¦åˆ‡æ¢ã€‚</p>
<p>å¦å¤–å›åˆ°äº†éçº¿ç¨‹æ± ç¼ºç‚¹ä¸­çš„ç¬¬1ç‚¹ï¼š<br />
2ã€åˆ›å»ºçº¿ç¨‹çš„æ¶ˆè€—è¾ƒé«˜ã€‚<br />
æˆ–è€…ä¸‹é¢è¿™ä¸ªç½‘ä¸Šå¹¶ä¸é«˜æ˜çš„å›ç­”ï¼š<br />
2ã€çº¿ç¨‹æ± åˆ›å»ºçº¿ç¨‹éœ€è¦è·å–mainlockè¿™ä¸ªå…¨å±€é”ï¼Œå½±å“å¹¶å‘æ•ˆç‡ï¼Œé˜»å¡é˜Ÿåˆ—å¯ä»¥å¾ˆå¥½çš„ç¼“å†²ã€‚</p>
<h3 id="%E7%BA%BF%E7%A8%8B%E6%B1%A0%E4%B8%BA%E4%BB%80%E4%B9%88%E8%A6%81%E4%BD%BF%E7%94%A8%E9%98%BB%E5%A1%9E%E9%98%9F%E5%88%97%E8%80%8C%E4%B8%8D%E4%BD%BF%E7%94%A8%E9%9D%9E%E9%98%BB%E5%A1%9E%E9%98%9F%E5%88%97%EF%BC%9F" id="çº¿ç¨‹æ± ä¸ºä»€ä¹ˆè¦ä½¿ç”¨é˜»å¡é˜Ÿåˆ—è€Œä¸ä½¿ç”¨éé˜»å¡é˜Ÿåˆ—ï¼Ÿ">çº¿ç¨‹æ± ä¸ºä»€ä¹ˆè¦ä½¿ç”¨é˜»å¡é˜Ÿåˆ—è€Œä¸ä½¿ç”¨éé˜»å¡é˜Ÿåˆ—ï¼Ÿ</h3>
<p>é˜»å¡é˜Ÿåˆ—å¯ä»¥ä¿è¯ä»»åŠ¡é˜Ÿåˆ—ä¸­æ²¡æœ‰ä»»åŠ¡æ—¶é˜»å¡è·å–ä»»åŠ¡çš„çº¿ç¨‹ï¼Œä½¿å¾—çº¿ç¨‹è¿›å…¥waitçŠ¶æ€ï¼Œé‡Šæ”¾cpuèµ„æºã€‚<br />
å½“é˜Ÿåˆ—ä¸­æœ‰ä»»åŠ¡æ—¶æ‰å”¤é†’å¯¹åº”çº¿ç¨‹ä»é˜Ÿåˆ—ä¸­å–å‡ºæ¶ˆæ¯è¿›è¡Œæ‰§è¡Œã€‚<br />
ä½¿å¾—åœ¨çº¿ç¨‹ä¸è‡³äºä¸€ç›´å ç”¨cpuèµ„æºã€‚</p>
<p>ï¼ˆçº¿ç¨‹æ‰§è¡Œå®Œä»»åŠ¡åé€šè¿‡å¾ªç¯å†æ¬¡ä»ä»»åŠ¡é˜Ÿåˆ—ä¸­å–å‡ºä»»åŠ¡è¿›è¡Œæ‰§è¡Œï¼Œä»£ç ç‰‡æ®µå¦‚ä¸‹<br />
while (task != null || (task = getTask()) != null) {}ï¼‰ã€‚</p>
<p>ä¸ç”¨é˜»å¡é˜Ÿåˆ—ä¹Ÿæ˜¯å¯ä»¥çš„ï¼Œä¸è¿‡å®ç°èµ·æ¥æ¯”è¾ƒéº»çƒ¦è€Œå·²ï¼Œæœ‰å¥½ç”¨çš„ä¸ºå•¥ä¸ç”¨å‘¢ï¼Ÿ</p>
<h4 id="%E5%A6%82%E4%BD%95%E9%85%8D%E7%BD%AE%E7%BA%BF%E7%A8%8B%E6%B1%A0" id="å¦‚ä½•é…ç½®çº¿ç¨‹æ± ">å¦‚ä½•é…ç½®çº¿ç¨‹æ± </h4>
<p>CPUå¯†é›†å‹ä»»åŠ¡<br />
å°½é‡ä½¿ç”¨è¾ƒå°çš„çº¿ç¨‹æ± ï¼Œä¸€èˆ¬ä¸ºCPUæ ¸å¿ƒæ•°+1ã€‚ å› ä¸ºCPUå¯†é›†å‹ä»»åŠ¡ä½¿å¾—CPUä½¿ç”¨ç‡å¾ˆé«˜ï¼Œè‹¥å¼€è¿‡å¤šçš„çº¿ç¨‹æ•°ï¼Œä¼šé€ æˆCPUè¿‡åº¦åˆ‡æ¢ã€‚</p>
<p>IOå¯†é›†å‹ä»»åŠ¡<br />
å¯ä»¥ä½¿ç”¨ç¨å¤§çš„çº¿ç¨‹æ± ï¼Œä¸€èˆ¬ä¸º2*CPUæ ¸å¿ƒæ•°ã€‚ IOå¯†é›†å‹ä»»åŠ¡CPUä½¿ç”¨ç‡å¹¶ä¸é«˜ï¼Œå› æ­¤å¯ä»¥è®©CPUåœ¨ç­‰å¾…IOçš„æ—¶å€™æœ‰å…¶ä»–çº¿ç¨‹å»å¤„ç†åˆ«çš„ä»»åŠ¡ï¼Œå……åˆ†åˆ©ç”¨CPUæ—¶é—´ã€‚</p>
<p>æ··åˆå‹ä»»åŠ¡<br />
å¯ä»¥å°†ä»»åŠ¡åˆ†æˆIOå¯†é›†å‹å’ŒCPUå¯†é›†å‹ä»»åŠ¡ï¼Œç„¶ååˆ†åˆ«ç”¨ä¸åŒçš„çº¿ç¨‹æ± å»å¤„ç†ã€‚ åªè¦åˆ†å®Œä¹‹åä¸¤ä¸ªä»»åŠ¡çš„æ‰§è¡Œæ—¶é—´ç›¸å·®ä¸å¤§ï¼Œé‚£ä¹ˆå°±ä¼šæ¯”ä¸²è¡Œæ‰§è¡Œæ¥çš„é«˜æ•ˆã€‚<br />
å› ä¸ºå¦‚æœåˆ’åˆ†ä¹‹åä¸¤ä¸ªä»»åŠ¡æ‰§è¡Œæ—¶é—´æœ‰æ•°æ®çº§çš„å·®è·ï¼Œé‚£ä¹ˆæ‹†åˆ†æ²¡æœ‰æ„ä¹‰ã€‚<br />
å› ä¸ºå…ˆæ‰§è¡Œå®Œçš„ä»»åŠ¡å°±è¦ç­‰åæ‰§è¡Œå®Œçš„ä»»åŠ¡ï¼Œæœ€ç»ˆçš„æ—¶é—´ä»ç„¶å–å†³äºåæ‰§è¡Œå®Œçš„ä»»åŠ¡ï¼Œè€Œä¸”è¿˜è¦åŠ ä¸Šä»»åŠ¡æ‹†åˆ†ä¸åˆå¹¶çš„å¼€é”€ï¼Œå¾—ä¸å¿å¤±ã€‚</p>
<h3 id="execute()%E5%92%8Csubmit()%E6%96%B9%E6%B3%95" id="execute-å’Œsubmit-æ–¹æ³•">execute()å’Œsubmit()æ–¹æ³•</h3>
<p>1ã€execute()ï¼Œæ‰§è¡Œä¸€ä¸ªä»»åŠ¡ï¼Œæ²¡æœ‰è¿”å›å€¼ã€‚<br />
2ã€submit()ï¼Œæäº¤ä¸€ä¸ªçº¿ç¨‹ä»»åŠ¡ï¼Œæœ‰è¿”å›å€¼ã€‚<br />
submit(Callable<T> task)èƒ½è·å–åˆ°å®ƒçš„è¿”å›å€¼ï¼Œé€šè¿‡future.get()è·å–ï¼ˆé˜»å¡ç›´åˆ°ä»»åŠ¡æ‰§è¡Œå®Œï¼‰ã€‚ä¸€èˆ¬ä½¿ç”¨FutureTask+Callableé…åˆä½¿ç”¨ï¼ˆIntentServiceä¸­æœ‰ä½“ç°ï¼‰ã€‚</p>
<p>submit(Runnable task, T result)èƒ½é€šè¿‡ä¼ å…¥çš„è½½ä½“resulté—´æ¥è·å¾—çº¿ç¨‹çš„è¿”å›å€¼ã€‚<br />
submit(Runnable task)åˆ™æ˜¯æ²¡æœ‰è¿”å›å€¼çš„ï¼Œå°±ç®—è·å–å®ƒçš„è¿”å›å€¼ä¹Ÿæ˜¯nullã€‚</p>
<p>Future.getæ–¹æ³•ä¼šä½¿å–ç»“æœçš„çº¿ç¨‹è¿›å…¥é˜»å¡çŠ¶æ€ï¼ŒçŸ¥é“çº¿ç¨‹æ‰§è¡Œå®Œæˆä¹‹åï¼Œå”¤é†’å–ç»“æœçš„çº¿ç¨‹ï¼Œç„¶åè¿”å›ç»“æœã€‚</p>
<h2 id="fork%2Fjoin" id="Fork-Join">Fork/Join</h2>
<h3 id="fork%2Fjoin%E6%A1%86%E6%9E%B6%E7%AE%80%E4%BB%8B" id="Fork-Joinæ¡†æ¶ç®€ä»‹">Fork/Joinæ¡†æ¶ç®€ä»‹</h3>
<p>Fork/Joinå®ƒå¯ä»¥å°†ä¸€ä¸ªå¤§çš„ä»»åŠ¡æ‹†åˆ†æˆå¤šä¸ªå­ä»»åŠ¡è¿›è¡Œå¹¶è¡Œå¤„ç†ï¼Œæœ€åå°†å­ä»»åŠ¡ç»“æœåˆå¹¶æˆæœ€åçš„è®¡ç®—ç»“æœï¼Œå¹¶è¿›è¡Œè¾“å‡ºã€‚Fork/Joinæ¡†æ¶è¦å®Œæˆä¸¤ä»¶äº‹æƒ…ï¼š Forkï¼šæŠŠä¸€ä¸ªå¤æ‚ä»»åŠ¡è¿›è¡Œåˆ†æ‹†ï¼Œå¤§äº‹åŒ–å° Joinï¼šæŠŠåˆ†æ‹†ä»»åŠ¡çš„ç»“æœè¿›è¡Œåˆå¹¶</p>
<p><img src="https://gitee.com/mychimei/picture/raw/master/work/image-20220216213702462.png" alt="image-20220216213702462" /></p>
<ol>
<li>ä»»åŠ¡åˆ†å‰²ï¼šé¦–å…ˆFork/Joinæ¡†æ¶éœ€è¦æŠŠå¤§çš„ä»»åŠ¡åˆ†å‰²æˆè¶³å¤Ÿå°çš„å­ä»»åŠ¡ï¼Œå¦‚æœå­ä»»åŠ¡æ¯”è¾ƒå¤§çš„è¯è¿˜è¦å¯¹å­ä»»åŠ¡è¿›è¡Œç»§ç»­åˆ†å‰²</li>
<li>æ‰§è¡Œä»»åŠ¡å¹¶åˆå¹¶ç»“æœï¼šåˆ†å‰²çš„å­ä»»åŠ¡åˆ†åˆ«æ”¾åˆ°åŒç«¯é˜Ÿåˆ—é‡Œï¼Œç„¶åå‡ ä¸ªå¯åŠ¨çº¿ç¨‹åˆ†åˆ«ä»åŒç«¯é˜Ÿåˆ—é‡Œè·å–ä»»åŠ¡æ‰§è¡Œã€‚å­ä»»åŠ¡æ‰§è¡Œå®Œçš„ç»“æœéƒ½æ”¾åœ¨å¦å¤–ä¸€ä¸ªé˜Ÿåˆ—é‡Œï¼Œå¯åŠ¨ä¸€ä¸ªçº¿ç¨‹ä»é˜Ÿåˆ—é‡Œå–æ•°æ®ï¼Œç„¶ååˆå¹¶è¿™äº›æ•°æ®ã€‚<br />
åœ¨Javaçš„Fork/Joinæ¡†æ¶ä¸­ï¼Œä½¿ç”¨ä¸¤ä¸ªç±»å®Œæˆä¸Šè¿°æ“ä½œ</li>
</ol>
<p><strong>â€¢ ForkJoinTask</strong>:æˆ‘ä»¬è¦ä½¿ç”¨Fork/Joinæ¡†æ¶ï¼Œé¦–å…ˆéœ€è¦åˆ›å»ºä¸€ä¸ªForkJoinä»»åŠ¡ã€‚è¯¥ç±»æä¾›äº†åœ¨ä»»åŠ¡ä¸­æ‰§è¡Œforkå’Œjoinçš„æœºåˆ¶ã€‚é€šå¸¸æƒ…å†µä¸‹æˆ‘ä»¬ä¸éœ€è¦ç›´æ¥é›†æˆForkJoinTaskç±»ï¼Œåªéœ€è¦ç»§æ‰¿å®ƒçš„å­ç±»ï¼ŒFork/Joinæ¡†æ¶æä¾›äº†ä¸¤ä¸ªå­ç±»ï¼š<br />
a.RecursiveActionï¼šç”¨äºæ²¡æœ‰è¿”å›ç»“æœçš„ä»»åŠ¡<br />
b.RecursiveTask:ç”¨äºæœ‰è¿”å›ç»“æœçš„ä»»åŠ¡<br />
<strong>â€¢ ForkJoinPool</strong>:ForkJoinTaskéœ€è¦é€šè¿‡ForkJoinPoolæ¥æ‰§è¡Œ<br />
<strong>â€¢ RecursiveTask</strong>: ç»§æ‰¿åå¯ä»¥å®ç°é€’å½’(è‡ªå·±è°ƒè‡ªå·±)è°ƒç”¨çš„ä»»åŠ¡</p>
<h3 id="fork%2Fjoin%E6%A1%86%E6%9E%B6%E7%9A%84%E5%AE%9E%E7%8E%B0%E5%8E%9F%E7%90%86" id="Fork-Joinæ¡†æ¶çš„å®ç°åŸç†">Fork/Joinæ¡†æ¶çš„å®ç°åŸç†</h3>
<p>â€‹		ForkJoinPoolç”±ForkJoinTaskæ•°ç»„å’ŒForkJoinWorkerThreadæ•°ç»„ç»„æˆï¼ŒForkJoinTaskæ•°ç»„è´Ÿè´£å°†å­˜æ”¾ä»¥åŠå°†ç¨‹åºæäº¤ç»™ForkJoinPoolï¼Œè€ŒForkJoinWorkerThreadè´Ÿè´£æ‰§è¡Œè¿™äº›ä»»åŠ¡ã€‚</p>
<h3 id="fork%E6%96%B9%E6%B3%95" id="Forkæ–¹æ³•">Forkæ–¹æ³•</h3>
<p><img src="https://gitee.com/mychimei/picture/raw/master/work/image-20220216214000676.png" alt="image-20220216214000676" /></p>
<p><img src="https://gitee.com/mychimei/picture/raw/master/work/image-20220216214007548.png" alt="image-20220216214007548" /></p>
<p>â€‹		Forkæ–¹æ³•çš„å®ç°åŸç†ï¼š å½“æˆ‘ä»¬è°ƒç”¨ForkJoinTaskçš„forkæ–¹æ³•æ—¶ï¼Œç¨‹åºä¼šæŠŠä»»åŠ¡æ”¾åœ¨ForkJoinWorkerThreadçš„pushTaskçš„workQueueä¸­ï¼Œå¼‚æ­¥åœ°æ‰§è¡Œè¿™ä¸ªä»»åŠ¡ï¼Œç„¶åç«‹å³è¿”å›ç»“æœ</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">final</span> ForkJoinTask&lt;V&gt; <span class="title">fork</span><span class="params">()</span> </span>&#123; </span><br><span class="line">    Thread t; </span><br><span class="line">    <span class="keyword">if</span> ((t = Thread.currentThread()) <span class="keyword">instanceof</span> ForkJoinWorkerThread) ((ForkJoinWorkerThread)t).workQueue.push(<span class="keyword">this</span>); </span><br><span class="line">    <span class="keyword">else</span> ForkJoinPool.common.externalPush(<span class="keyword">this</span>); </span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span>; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>pushTaskæ–¹æ³•æŠŠå½“å‰ä»»åŠ¡å­˜æ”¾åœ¨ForkJoinTaskæ•°ç»„é˜Ÿåˆ—é‡Œã€‚ç„¶åå†è°ƒç”¨ForkJoinPoolçš„signalWork()æ–¹æ³•å”¤é†’æˆ–åˆ›å»ºä¸€ä¸ªå·¥ä½œçº¿ç¨‹æ¥æ‰§è¡Œä»»åŠ¡ã€‚ä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">final</span> <span class="keyword">void</span> <span class="title">push</span><span class="params">(ForkJoinTask&lt;?&gt; task)</span> </span>&#123; </span><br><span class="line">    ForkJoinTask&lt;?&gt;[] a; </span><br><span class="line">    ForkJoinPool p; </span><br><span class="line">    <span class="keyword">int</span> b = base, s = top, n; </span><br><span class="line">    <span class="keyword">if</span> ((a = array) != <span class="keyword">null</span>) &#123; </span><br><span class="line">        <span class="comment">// ignore if queue removed int m = a.length - 1; </span></span><br><span class="line">        <span class="comment">// fenced write for task visibility U.putOrderedObject(a, ((m &amp; s) &lt;&lt; ASHIFT) + ABASE, task);</span></span><br><span class="line">        U.putOrderedInt(<span class="keyword">this</span>, QTOP, s + <span class="number">1</span>); </span><br><span class="line">        <span class="keyword">if</span> ((n = s - b) &lt;= <span class="number">1</span>) &#123; <span class="keyword">if</span> ((p = pool) != <span class="keyword">null</span>) p.signalWork(p.workQueues, <span class="keyword">this</span>);<span class="comment">//æ‰§è¡Œ </span></span><br><span class="line">                              &#125; <span class="keyword">else</span> <span class="keyword">if</span> (n &gt;= m) growArray(); </span><br><span class="line">    &#125; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="join%E6%96%B9%E6%B3%95" id="joinæ–¹æ³•">joinæ–¹æ³•</h3>
<p>Joinæ–¹æ³•çš„ä¸»è¦ä½œç”¨æ˜¯é˜»å¡å½“å‰çº¿ç¨‹å¹¶ç­‰å¾…è·å–ç»“æœã€‚è®©æˆ‘ä»¬ä¸€èµ·çœ‹çœ‹ForkJoinTaskçš„joinæ–¹æ³•çš„å®ç°ï¼Œä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">final</span> V <span class="title">join</span><span class="params">()</span> </span>&#123; </span><br><span class="line">    <span class="keyword">int</span> s; </span><br><span class="line">    <span class="keyword">if</span> ((s = doJoin() &amp; DONE_MASK) != NORMAL) </span><br><span class="line">        reportException(s); </span><br><span class="line">    <span class="keyword">return</span> getRawResult(); </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å®ƒé¦–å…ˆè°ƒç”¨doJoinæ–¹æ³•ï¼Œé€šè¿‡doJoin()æ–¹æ³•å¾—åˆ°å½“å‰ä»»åŠ¡çš„çŠ¶æ€æ¥åˆ¤æ–­è¿”å›ä»€ä¹ˆç»“æœï¼Œä»»åŠ¡çŠ¶æ€æœ‰4ç§ï¼š<br />
<mark>å·²å®Œæˆï¼ˆNORMALï¼‰ã€è¢«å–æ¶ˆï¼ˆCANCELLEDï¼‰ã€ä¿¡å·ï¼ˆSIGNALï¼‰å’Œå‡ºç°å¼‚å¸¸ï¼ˆEXCEPTIONALï¼‰</mark><br />
â€¢ å¦‚æœä»»åŠ¡çŠ¶æ€æ˜¯å·²å®Œæˆï¼Œåˆ™ç›´æ¥è¿”å›ä»»åŠ¡ç»“æœã€‚<br />
â€¢ å¦‚æœä»»åŠ¡çŠ¶æ€æ˜¯è¢«å–æ¶ˆï¼Œåˆ™ç›´æ¥æŠ›å‡ºCancellationException<br />
â€¢ å¦‚æœä»»åŠ¡çŠ¶æ€æ˜¯æŠ›å‡ºå¼‚å¸¸ï¼Œåˆ™ç›´æ¥æŠ›å‡ºå¯¹åº”çš„å¼‚å¸¸<br />
è®©æˆ‘ä»¬åˆ†æä¸€ä¸‹doJoinæ–¹æ³•çš„å®ç°</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">int</span> <span class="title">doJoin</span><span class="params">()</span> </span>&#123; </span><br><span class="line">    <span class="keyword">int</span> s; </span><br><span class="line">    Thread t; </span><br><span class="line">    ForkJoinWorkerThread wt; </span><br><span class="line">    ForkJoinPool.WorkQueue w; </span><br><span class="line">    <span class="keyword">return</span> (s = status) &lt; <span class="number">0</span> ? s : </span><br><span class="line">    ((t = Thread.currentThread()) <span class="keyword">instanceof</span> ForkJoinWorkerThread) ? (w = (wt = (ForkJoinWorkerThread)t).workQueue). tryUnpush(<span class="keyword">this</span>) &amp;&amp; (s = doExec()) &lt; <span class="number">0</span> ? s : wt.pool.awaitJoin(w, <span class="keyword">this</span>, <span class="number">0L</span>) : externalAwaitDone(); </span><br><span class="line">&#125; </span><br><span class="line"><span class="function"><span class="keyword">final</span> <span class="keyword">int</span> <span class="title">doExec</span><span class="params">()</span> </span>&#123; </span><br><span class="line">    <span class="keyword">int</span> s; </span><br><span class="line">    <span class="keyword">boolean</span> completed; <span class="keyword">if</span> ((s = status) &gt;= <span class="number">0</span>) &#123; <span class="keyword">try</span> &#123; completed = exec(); </span><br><span class="line">                                                    &#125; <span class="keyword">catch</span> (Throwable rex) &#123; <span class="keyword">return</span> setExceptionalCompletion(rex); </span><br><span class="line">                                                                            &#125; </span><br><span class="line">                                               <span class="keyword">if</span> (completed) s = setCompletion(NORMAL); </span><br><span class="line">                                              &#125; <span class="keyword">return</span> s; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>åœ¨doJoin()æ–¹æ³•æµç¨‹å¦‚ä¸‹:</p>
<ol>
<li>
<p>é¦–å…ˆé€šè¿‡æŸ¥çœ‹ä»»åŠ¡çš„çŠ¶æ€ï¼Œçœ‹ä»»åŠ¡æ˜¯å¦å·²ç»æ‰§è¡Œå®Œæˆï¼Œå¦‚æœæ‰§è¡Œå®Œæˆï¼Œåˆ™ç›´æ¥è¿”å›ä»»åŠ¡çŠ¶æ€ï¼›</p>
</li>
<li>
<p>å¦‚æœæ²¡æœ‰æ‰§è¡Œå®Œï¼Œåˆ™ä»ä»»åŠ¡æ•°ç»„é‡Œå–å‡ºä»»åŠ¡å¹¶æ‰§è¡Œã€‚</p>
</li>
<li>
<p>å¦‚æœä»»åŠ¡é¡ºåˆ©æ‰§è¡Œå®Œæˆï¼Œåˆ™è®¾ç½®ä»»åŠ¡çŠ¶æ€ä¸ºNORMALï¼Œå¦‚æœå‡ºç°å¼‚å¸¸ï¼Œåˆ™è®°å½•å¼‚å¸¸ï¼Œå¹¶å°†ä»»åŠ¡çŠ¶æ€è®¾ç½®ä¸ºEXCEPTIONALã€‚</p>
</li>
</ol>
<h3 id="fork%2Fjoin%E6%A1%86%E6%9E%B6%E7%9A%84%E5%BC%82%E5%B8%B8%E5%A4%84%E7%90%86" id="Fork-Joinæ¡†æ¶çš„å¼‚å¸¸å¤„ç†">Fork/Joinæ¡†æ¶çš„å¼‚å¸¸å¤„ç†</h3>
<p>ForkJoinTaskåœ¨æ‰§è¡Œçš„æ—¶å€™å¯èƒ½ä¼šæŠ›å‡ºå¼‚å¸¸ï¼Œä½†æ˜¯æˆ‘ä»¬æ²¡åŠæ³•åœ¨ä¸»çº¿ç¨‹é‡Œç›´æ¥æ•è·å¼‚å¸¸ï¼Œæ‰€ä»¥ForkJoinTaskæä¾›äº†isCompletedAbnormally()æ–¹æ³•æ¥æ£€æŸ¥ä»»åŠ¡æ˜¯å¦å·²ç»æŠ›å‡ºå¼‚å¸¸æˆ–å·²ç»è¢«å–æ¶ˆäº†ï¼Œå¹¶ä¸”å¯ä»¥é€šè¿‡ForkJoinTaskçš„getExceptionæ–¹æ³•è·å–å¼‚å¸¸ã€‚<br />
getExceptionæ–¹æ³•è¿”å›Throwableå¯¹è±¡ï¼Œå¦‚æœä»»åŠ¡è¢«å–æ¶ˆäº†åˆ™è¿”å›CancellationExceptionã€‚å¦‚æœä»»åŠ¡æ²¡æœ‰å®Œæˆæˆ–è€…æ²¡æœ‰æŠ›å‡ºå¼‚å¸¸åˆ™è¿”å›nullã€‚</p>
<h3 id="%E5%85%A5%E9%97%A8%E6%A1%88%E4%BE%8B" id="å…¥é—¨æ¡ˆä¾‹">å…¥é—¨æ¡ˆä¾‹</h3>
<p>åœºæ™¯: ç”Ÿæˆä¸€ä¸ªè®¡ç®—ä»»åŠ¡ï¼Œè®¡ç®—1+2+3.........+1000,<mark>æ¯100ä¸ªæ•°åˆ‡åˆ†ä¸€ä¸ªå­ä»»åŠ¡</mark></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.atguigu.forkjoin;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.*;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyTask</span> <span class="keyword">extends</span> <span class="title">RecursiveTask</span>&lt;<span class="title">Integer</span>&gt; </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//æ‹†åˆ†å·®å€¼ä¸èƒ½è¶…è¿‡10ï¼Œè®¡ç®—10ä»¥å†…è¿ç®—</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Integer VALUE = <span class="number">10</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> begin ;<span class="comment">//æ‹†åˆ†å¼€å§‹å€¼</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> end;<span class="comment">//æ‹†åˆ†ç»“æŸå€¼</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> result ; <span class="comment">//è¿”å›ç»“æœ</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//åˆ›å»ºæœ‰å‚æ•°æ„é€ </span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">MyTask</span><span class="params">(<span class="keyword">int</span> begin,<span class="keyword">int</span> end)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.begin = begin;</span><br><span class="line">        <span class="keyword">this</span>.end = end;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//æ‹†åˆ†å’Œåˆå¹¶è¿‡ç¨‹</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> Integer <span class="title">compute</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">//åˆ¤æ–­ç›¸åŠ ä¸¤ä¸ªæ•°å€¼æ˜¯å¦å¤§äº10</span></span><br><span class="line">        <span class="keyword">if</span>((end-begin)&lt;=VALUE) &#123;</span><br><span class="line">            <span class="comment">//ç›¸åŠ æ“ä½œ</span></span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = begin; i &lt;=end; i++) &#123;</span><br><span class="line">                result = result+i;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;<span class="comment">//è¿›ä¸€æ­¥æ‹†åˆ†</span></span><br><span class="line">            <span class="comment">//è·å–ä¸­é—´å€¼</span></span><br><span class="line">            <span class="keyword">int</span> middle = (begin+end)/<span class="number">2</span>;</span><br><span class="line">            <span class="comment">//æ‹†åˆ†å·¦è¾¹</span></span><br><span class="line">            MyTask task01 = <span class="keyword">new</span> MyTask(begin,middle);</span><br><span class="line">            <span class="comment">//æ‹†åˆ†å³è¾¹</span></span><br><span class="line">            MyTask task02 = <span class="keyword">new</span> MyTask(middle+<span class="number">1</span>,end);</span><br><span class="line">            <span class="comment">//è°ƒç”¨æ–¹æ³•æ‹†åˆ†</span></span><br><span class="line">            task01.fork();</span><br><span class="line">            task02.fork();</span><br><span class="line">            <span class="comment">//åˆå¹¶ç»“æœ</span></span><br><span class="line">            result = task01.join()+task02.join();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ForkJoinDemo</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> ExecutionException, InterruptedException </span>&#123;</span><br><span class="line">        <span class="comment">//åˆ›å»ºMyTaskå¯¹è±¡</span></span><br><span class="line">        MyTask myTask = <span class="keyword">new</span> MyTask(<span class="number">0</span>,<span class="number">100</span>);</span><br><span class="line">        <span class="comment">//åˆ›å»ºåˆ†æ”¯åˆå¹¶æ± å¯¹è±¡</span></span><br><span class="line">        ForkJoinPool forkJoinPool = <span class="keyword">new</span> ForkJoinPool();</span><br><span class="line">        ForkJoinTask&lt;Integer&gt; forkJoinTask = forkJoinPool.submit(myTask);</span><br><span class="line">        <span class="comment">//è·å–æœ€ç»ˆåˆå¹¶ä¹‹åç»“æœ</span></span><br><span class="line">        Integer result = forkJoinTask.get();</span><br><span class="line">        System.out.println(result);</span><br><span class="line">        <span class="comment">//å…³é—­æ± å¯¹è±¡</span></span><br><span class="line">        forkJoinPool.shutdown();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h2 id="completablefuture" id="CompletableFuture">CompletableFuture</h2>
<h3 id="completablefuture%E7%AE%80%E4%BB%8B" id="CompletableFutureç®€ä»‹">CompletableFutureç®€ä»‹</h3>
<p>åŒæ­¥ã€ä¸åœ¨ç­‰å¾…ã€‘ã€å¼‚æ­¥ã€ä¸åœ¨å…ˆåšå…¶ä»–çš„ã€‘</p>
<p>CompletableFutureåœ¨Javaé‡Œé¢è¢«ç”¨äºå¼‚æ­¥ç¼–ç¨‹ï¼Œå¼‚æ­¥é€šå¸¸æ„å‘³ç€éé˜»å¡ï¼Œå¯ä»¥ä½¿å¾—æˆ‘ä»¬çš„ä»»åŠ¡å•ç‹¬è¿è¡Œåœ¨ä¸ä¸»çº¿ç¨‹åˆ†ç¦»çš„å…¶ä»–çº¿ç¨‹ä¸­ï¼Œå¹¶ä¸”é€šè¿‡å›è°ƒå¯ä»¥åœ¨ä¸»çº¿ç¨‹ä¸­å¾—åˆ°å¼‚æ­¥ä»»åŠ¡çš„æ‰§è¡ŒçŠ¶æ€ï¼Œæ˜¯å¦å®Œæˆï¼Œå’Œæ˜¯å¦å¼‚å¸¸ç­‰ä¿¡æ¯ã€‚<br />
CompletableFutureå®ç°äº†Future, CompletionStageæ¥å£ï¼Œå®ç°äº†Futureæ¥å£å°±å¯ä»¥å…¼å®¹ç°åœ¨æœ‰çº¿ç¨‹æ± æ¡†æ¶ï¼Œè€ŒCompletionStageæ¥å£æ‰æ˜¯å¼‚æ­¥ç¼–ç¨‹çš„æ¥å£æŠ½è±¡ï¼Œé‡Œé¢å®šä¹‰å¤šç§å¼‚æ­¥æ–¹æ³•ï¼Œé€šè¿‡è¿™ä¸¤è€…é›†åˆï¼Œä»è€Œæ‰“é€ å‡ºäº†å¼ºå¤§çš„CompletableFutureç±»ã€‚</p>
<h4 id="future%E4%B8%8Ecompletablefuture" id="Futureä¸CompletableFuture">Futureä¸CompletableFuture</h4>
<p>Futrueåœ¨Javaé‡Œé¢ï¼Œé€šå¸¸ç”¨æ¥è¡¨ç¤ºä¸€ä¸ªå¼‚æ­¥ä»»åŠ¡çš„å¼•ç”¨ï¼Œæ¯”å¦‚æˆ‘ä»¬å°†ä»»åŠ¡æäº¤åˆ°çº¿ç¨‹æ± é‡Œé¢ï¼Œç„¶åæˆ‘ä»¬ä¼šå¾—åˆ°ä¸€ä¸ªFutrueï¼Œåœ¨Futureé‡Œé¢æœ‰isDoneæ–¹æ³•æ¥ åˆ¤æ–­ä»»åŠ¡æ˜¯å¦å¤„ç†ç»“æŸï¼Œè¿˜æœ‰getæ–¹æ³•å¯ä»¥ä¸€ç›´é˜»å¡ç›´åˆ°ä»»åŠ¡ç»“æŸç„¶åè·å–ç»“æœï¼Œä½†æ•´ä½“æ¥è¯´è¿™ç§æ–¹å¼ï¼Œè¿˜æ˜¯åŒæ­¥çš„ï¼Œå› ä¸ºéœ€è¦å®¢æˆ·ç«¯ä¸æ–­é˜»å¡ç­‰å¾…æˆ–è€…ä¸æ–­è½®è¯¢æ‰èƒ½çŸ¥é“ä»»åŠ¡æ˜¯å¦å®Œæˆã€‚<br />
Futureçš„ä¸»è¦ç¼ºç‚¹å¦‚ä¸‹ï¼š<br />
ï¼ˆ1ï¼‰ä¸æ”¯æŒæ‰‹åŠ¨å®Œæˆ<br />
æˆ‘æäº¤äº†ä¸€ä¸ªä»»åŠ¡ï¼Œä½†æ˜¯æ‰§è¡Œå¤ªæ…¢äº†ï¼Œæˆ‘é€šè¿‡å…¶ä»–è·¯å¾„å·²ç»è·å–åˆ°äº†ä»»åŠ¡ç»“æœï¼Œç°åœ¨æ²¡æ³•æŠŠè¿™ä¸ªä»»åŠ¡ç»“æœé€šçŸ¥åˆ°æ­£åœ¨æ‰§è¡Œçš„çº¿ç¨‹ï¼Œæ‰€ä»¥å¿…é¡»ä¸»åŠ¨å–æ¶ˆæˆ–è€…ä¸€ç›´ç­‰å¾…å®ƒæ‰§è¡Œå®Œæˆ<br />
ï¼ˆ2ï¼‰ä¸æ”¯æŒè¿›ä¸€æ­¥çš„éé˜»å¡è°ƒç”¨<br />
é€šè¿‡Futureçš„getæ–¹æ³•ä¼šä¸€ç›´é˜»å¡åˆ°ä»»åŠ¡å®Œæˆï¼Œä½†æ˜¯æƒ³åœ¨è·å–ä»»åŠ¡ä¹‹åæ‰§è¡Œé¢å¤–çš„ä»»åŠ¡ï¼Œå› ä¸ºFutureä¸æ”¯æŒå›è°ƒå‡½æ•°ï¼Œæ‰€ä»¥æ— æ³•å®ç°è¿™ä¸ªåŠŸèƒ½<br />
ï¼ˆ3ï¼‰ä¸æ”¯æŒé“¾å¼è°ƒç”¨<br />
å¯¹äºFutureçš„æ‰§è¡Œç»“æœï¼Œæˆ‘ä»¬æƒ³ç»§ç»­ä¼ åˆ°ä¸‹ä¸€ä¸ªFutureå¤„ç†ä½¿ç”¨ï¼Œä»è€Œå½¢æˆä¸€ä¸ªé“¾å¼çš„piplineè°ƒç”¨ï¼Œè¿™åœ¨Futureä¸­æ˜¯æ²¡æ³•å®ç°çš„ã€‚<br />
ï¼ˆ4ï¼‰ä¸æ”¯æŒå¤šä¸ªFutureåˆå¹¶<br />
æ¯”å¦‚æˆ‘ä»¬æœ‰10ä¸ªFutureå¹¶è¡Œæ‰§è¡Œï¼Œæˆ‘ä»¬æƒ³åœ¨æ‰€æœ‰çš„Futureè¿è¡Œå®Œæ¯•ä¹‹åï¼Œæ‰§è¡ŒæŸäº›å‡½æ•°ï¼Œæ˜¯æ²¡æ³•é€šè¿‡Futureå®ç°çš„ã€‚<br />
ï¼ˆ5ï¼‰ä¸æ”¯æŒå¼‚å¸¸å¤„ç†<br />
Futureçš„APIæ²¡æœ‰ä»»ä½•çš„å¼‚å¸¸å¤„ç†çš„apiï¼Œæ‰€ä»¥åœ¨å¼‚æ­¥è¿è¡Œæ—¶ï¼Œå¦‚æœå‡ºäº†é—®é¢˜æ˜¯ä¸å¥½å®šä½çš„ã€‚</p>
<h3 id="completablefuture%E5%85%A5%E9%97%A8" id="CompletableFutureå…¥é—¨">CompletableFutureå…¥é—¨</h3>
<h4 id="%E4%BD%BF%E7%94%A8completablefuture" id="ä½¿ç”¨CompletableFuture">ä½¿ç”¨CompletableFuture</h4>
<p>åœºæ™¯:ä¸»çº¿ç¨‹é‡Œé¢åˆ›å»ºä¸€ä¸ªCompletableFutureï¼Œç„¶åä¸»çº¿ç¨‹è°ƒç”¨getæ–¹æ³•ä¼šé˜»å¡ï¼Œæœ€åæˆ‘ä»¬åœ¨ä¸€ä¸ªå­çº¿ç¨‹ä¸­ä½¿å…¶ç»ˆæ­¢ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/** * ä¸»çº¿ç¨‹é‡Œé¢åˆ›å»ºä¸€ä¸ªCompletableFutureï¼Œç„¶åä¸»çº¿ç¨‹è°ƒç”¨getæ–¹æ³•ä¼šé˜»å¡ï¼Œæœ€åæˆ‘ä»¬åœ¨ä¸€ä¸ªå­çº¿ç¨‹ä¸­ä½¿å…¶ç»ˆæ­¢ * <span class="doctag">@param</span> args */</span> </span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception</span>&#123; </span><br><span class="line">    CompletableFuture&lt;String&gt; future = <span class="keyword">new</span> CompletableFuture&lt;&gt;(); </span><br><span class="line">    <span class="keyword">new</span> Thread(() -&gt; &#123; </span><br><span class="line">        <span class="keyword">try</span>&#123; System.out.println(Thread.currentThread().getName() + <span class="string">&quot;å­çº¿ç¨‹å¼€å§‹å¹²æ´»&quot;</span>); </span><br><span class="line">            <span class="comment">//å­çº¿ç¨‹ç¡5ç§’ </span></span><br><span class="line">            Thread.sleep(<span class="number">5000</span>); </span><br><span class="line">            <span class="comment">//åœ¨å­çº¿ç¨‹ä¸­å®Œæˆä¸»çº¿ç¨‹ </span></span><br><span class="line">            future.complete(<span class="string">&quot;success&quot;</span>); </span><br><span class="line">           &#125;<span class="keyword">catch</span> (Exception e)&#123; e.printStackTrace(); </span><br><span class="line">                               &#125; &#125;, <span class="string">&quot;A&quot;</span>).start(); </span><br><span class="line">    <span class="comment">//ä¸»çº¿ç¨‹è°ƒç”¨getæ–¹æ³•é˜»å¡ </span></span><br><span class="line">    System.out.println(<span class="string">&quot;ä¸»çº¿ç¨‹è°ƒç”¨getæ–¹æ³•è·å–ç»“æœä¸º: &quot;</span> + future.get());</span><br><span class="line">    System.out.println(<span class="string">&quot;ä¸»çº¿ç¨‹å®Œæˆ,é˜»å¡ç»“æŸ!!!!!!&quot;</span>); </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="%E6%B2%A1%E6%9C%89%E8%BF%94%E5%9B%9E%E5%80%BC%E7%9A%84%E5%BC%82%E6%AD%A5%E4%BB%BB%E5%8A%A1" id="æ²¡æœ‰è¿”å›å€¼çš„å¼‚æ­¥ä»»åŠ¡">æ²¡æœ‰è¿”å›å€¼çš„å¼‚æ­¥ä»»åŠ¡</h4>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/** * æ²¡æœ‰è¿”å›å€¼çš„å¼‚æ­¥ä»»åŠ¡ * <span class="doctag">@param</span> args */</span> </span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception</span>&#123; </span><br><span class="line">    System.out.println(<span class="string">&quot;ä¸»çº¿ç¨‹å¼€å§‹&quot;</span>); </span><br><span class="line">    <span class="comment">//è¿è¡Œä¸€ä¸ªæ²¡æœ‰è¿”å›å€¼çš„å¼‚æ­¥ä»»åŠ¡ </span></span><br><span class="line">    CompletableFuture&lt;Void&gt; future = CompletableFuture.runAsync(() -&gt; &#123; <span class="keyword">try</span> &#123; </span><br><span class="line">        System.out.println(<span class="string">&quot;å­çº¿ç¨‹å¯åŠ¨å¹²æ´»&quot;</span>);                                                  </span><br><span class="line">       Thread.sleep(<span class="number">5000</span>); System.out.println(<span class="string">&quot;å­çº¿ç¨‹å®Œæˆ&quot;</span>); </span><br><span class="line">    &#125; <span class="keyword">catch</span> (Exception e) &#123; e.printStackTrace(); </span><br><span class="line">                          &#125;&#125;); </span><br><span class="line">    <span class="comment">//ä¸»çº¿ç¨‹é˜»å¡ </span></span><br><span class="line">    future.get(); </span><br><span class="line">    System.out.println(<span class="string">&quot;ä¸»çº¿ç¨‹ç»“æŸ&quot;</span>); </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="%E6%9C%89%E8%BF%94%E5%9B%9E%E5%80%BC%E7%9A%84%E5%BC%82%E6%AD%A5%E4%BB%BB%E5%8A%A1" id="æœ‰è¿”å›å€¼çš„å¼‚æ­¥ä»»åŠ¡">æœ‰è¿”å›å€¼çš„å¼‚æ­¥ä»»åŠ¡</h4>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ²¡æœ‰è¿”å›å€¼çš„å¼‚æ­¥ä»»åŠ¡ * <span class="doctag">@param</span> args</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;ä¸»çº¿ç¨‹å¼€å§‹&quot;</span>); <span class="comment">//è¿è¡Œä¸€ä¸ªæœ‰è¿”å›å€¼çš„å¼‚æ­¥ä»»åŠ¡ </span></span><br><span class="line">        CompletableFuture&lt;String&gt; future = CompletableFuture.supplyAsync(() -&gt; &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                System.out.println(<span class="string">&quot;å­çº¿ç¨‹å¼€å§‹ä»»åŠ¡&quot;</span>);</span><br><span class="line">                Thread.sleep(<span class="number">5000</span>);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;å­çº¿ç¨‹å®Œæˆäº†!&quot;</span>;</span><br><span class="line">        &#125;); <span class="comment">//ä¸»çº¿ç¨‹é˜»å¡ </span></span><br><span class="line">        String s = future.get();</span><br><span class="line">        System.out.println(<span class="string">&quot;ä¸»çº¿ç¨‹ç»“æŸ, å­çº¿ç¨‹çš„ç»“æœä¸º:&quot;</span> + s);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<h4 id="%E7%BA%BF%E7%A8%8B%E4%BE%9D%E8%B5%96" id="çº¿ç¨‹ä¾èµ–">çº¿ç¨‹ä¾èµ–</h4>
<p>å½“ä¸€ä¸ªçº¿ç¨‹ä¾èµ–å¦ä¸€ä¸ªçº¿ç¨‹æ—¶ï¼Œå¯ä»¥ä½¿ç”¨ thenApply æ–¹æ³•æ¥æŠŠè¿™ä¸¤ä¸ªçº¿ç¨‹ä¸²è¡ŒåŒ–ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> Integer num = <span class="number">10</span>;</span><br><span class="line"></span><br><span class="line">   <span class="comment">/**</span></span><br><span class="line"><span class="comment">    * å…ˆå¯¹ä¸€ä¸ªæ•°åŠ 10,ç„¶åå–å¹³æ–¹ * <span class="doctag">@param</span> args</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">       System.out.println(<span class="string">&quot;ä¸»çº¿ç¨‹å¼€å§‹&quot;</span>);</span><br><span class="line">       CompletableFuture&lt;Integer&gt; future = CompletableFuture.supplyAsync(() -&gt; &#123;</span><br><span class="line">           <span class="keyword">try</span> &#123;</span><br><span class="line">               System.out.println(<span class="string">&quot;åŠ 10ä»»åŠ¡å¼€å§‹&quot;</span>);</span><br><span class="line">               num += <span class="number">10</span>;</span><br><span class="line">           &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">               e.printStackTrace();</span><br><span class="line">           &#125;</span><br><span class="line">           <span class="keyword">return</span> num;</span><br><span class="line">       &#125;).thenApply(integer -&gt; &#123;</span><br><span class="line">           <span class="keyword">return</span> num * num;</span><br><span class="line">       &#125;);</span><br><span class="line">       Integer integer = future.get();</span><br><span class="line">       System.out.println(<span class="string">&quot;ä¸»çº¿ç¨‹ç»“æŸ, å­çº¿ç¨‹çš„ç»“æœä¸º:&quot;</span> + integer);</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>
<h4 id="%E6%B6%88%E8%B4%B9%E5%A4%84%E7%90%86%E7%BB%93%E6%9E%9C" id="æ¶ˆè´¹å¤„ç†ç»“æœ">æ¶ˆè´¹å¤„ç†ç»“æœ</h4>
<p>thenAccept æ¶ˆè´¹å¤„ç†ç»“æœ, æ¥æ”¶ä»»åŠ¡çš„å¤„ç†ç»“æœï¼Œå¹¶æ¶ˆè´¹å¤„ç†ï¼Œæ— è¿”å›ç»“æœã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">       System.out.println(<span class="string">&quot;ä¸»çº¿ç¨‹å¼€å§‹&quot;</span>);</span><br><span class="line">       CompletableFuture.supplyAsync(() -&gt; &#123;</span><br><span class="line">           <span class="keyword">try</span> &#123;</span><br><span class="line">               System.out.println(<span class="string">&quot;åŠ 10ä»»åŠ¡å¼€å§‹&quot;</span>);</span><br><span class="line">               num += <span class="number">10</span>;</span><br><span class="line">           &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">               e.printStackTrace();</span><br><span class="line">           &#125;</span><br><span class="line">           <span class="keyword">return</span> num;</span><br><span class="line">       &#125;).thenApply(integer -&gt; &#123;</span><br><span class="line">           <span class="keyword">return</span> num * num;</span><br><span class="line">       &#125;).thenAccept(<span class="keyword">new</span> Consumer&lt;Integer&gt;() &#123;</span><br><span class="line">           <span class="meta">@Override</span></span><br><span class="line">           <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">accept</span><span class="params">(Integer integer)</span> </span>&#123;</span><br><span class="line">               System.out.println(<span class="string">&quot;å­çº¿ç¨‹å…¨éƒ¨å¤„ç†å®Œæˆ,æœ€åè°ƒç”¨äº†accept,ç»“æœä¸º:&quot;</span> + integer);</span><br><span class="line">           &#125;</span><br><span class="line">       &#125;);</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>
<h4 id="%E5%BC%82%E5%B8%B8%E5%A4%84%E7%90%86" id="å¼‚å¸¸å¤„ç†">å¼‚å¸¸å¤„ç†</h4>
<p>exceptionallyå¼‚å¸¸å¤„ç†,å‡ºç°å¼‚å¸¸æ—¶è§¦å‘</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;ä¸»çº¿ç¨‹å¼€å§‹&quot;</span>);</span><br><span class="line">        CompletableFuture&lt;Integer&gt; future = CompletableFuture.supplyAsync(() -&gt; &#123;</span><br><span class="line">            <span class="keyword">int</span> i = <span class="number">1</span> / <span class="number">0</span>;</span><br><span class="line">            System.out.println(<span class="string">&quot;åŠ 10ä»»åŠ¡å¼€å§‹&quot;</span>);</span><br><span class="line">            num += <span class="number">10</span>;</span><br><span class="line">            <span class="keyword">return</span> num;</span><br><span class="line">        &#125;).exceptionally(ex -&gt; &#123;</span><br><span class="line">            System.out.println(ex.getMessage());</span><br><span class="line">            <span class="keyword">return</span> -<span class="number">1</span>;</span><br><span class="line">        &#125;);</span><br><span class="line">        System.out.println(future.get());</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>handleç±»ä¼¼äºthenAccept/thenRunæ–¹æ³•,æ˜¯æœ€åä¸€æ­¥çš„å¤„ç†è°ƒç”¨,ä½†æ˜¯åŒæ—¶å¯ä»¥å¤„ç†å¼‚å¸¸</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;ä¸»çº¿ç¨‹å¼€å§‹&quot;</span>);</span><br><span class="line">        CompletableFuture&lt;Integer&gt; future = CompletableFuture.supplyAsync(() -&gt; &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;åŠ 10ä»»åŠ¡å¼€å§‹&quot;</span>);</span><br><span class="line">            num += <span class="number">10</span>;</span><br><span class="line">            <span class="keyword">return</span> num;</span><br><span class="line">        &#125;).handle((i, ex) -&gt; &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;è¿›å…¥handleæ–¹æ³•&quot;</span>);</span><br><span class="line">            <span class="keyword">if</span> (ex != <span class="keyword">null</span>) &#123;</span><br><span class="line">                System.out.println(<span class="string">&quot;å‘ç”Ÿäº†å¼‚å¸¸,å†…å®¹ä¸º:&quot;</span> + ex.getMessage());</span><br><span class="line">                <span class="keyword">return</span> -<span class="number">1</span>;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                System.out.println(<span class="string">&quot;æ­£å¸¸å®Œæˆ,å†…å®¹ä¸º: &quot;</span> + i);</span><br><span class="line">                <span class="keyword">return</span> i;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">        System.out.println(future.get());</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<h4 id="%E7%BB%93%E6%9E%9C%E5%90%88%E5%B9%B6" id="ç»“æœåˆå¹¶">ç»“æœåˆå¹¶</h4>
<p>thenComposeåˆå¹¶ä¸¤ä¸ªæœ‰ä¾èµ–å…³ç³»çš„CompletableFuturesçš„æ‰§è¡Œç»“æœ</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;ä¸»çº¿ç¨‹å¼€å§‹&quot;</span>); <span class="comment">//ç¬¬ä¸€æ­¥åŠ 10 </span></span><br><span class="line">    CompletableFuture&lt;Integer&gt; future = CompletableFuture.supplyAsync(() -&gt; &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;åŠ 10ä»»åŠ¡å¼€å§‹&quot;</span>);</span><br><span class="line">        num += <span class="number">10</span>;</span><br><span class="line">        <span class="keyword">return</span> num;</span><br><span class="line">    &#125;); <span class="comment">//åˆå¹¶ </span></span><br><span class="line">    CompletableFuture&lt;Integer&gt; future1 = future.thenCompose(i -&gt; <span class="comment">//å†æ¥ä¸€ä¸ªCompletableFuture </span></span><br><span class="line">            CompletableFuture.supplyAsync(() -&gt; &#123;</span><br><span class="line">                <span class="keyword">return</span> i + <span class="number">1</span>;</span><br><span class="line">            &#125;));</span><br><span class="line">    System.out.println(future.get());</span><br><span class="line">    System.out.println(future1.get());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>thenCombineåˆå¹¶ä¸¤ä¸ªæ²¡æœ‰ä¾èµ–å…³ç³»çš„CompletableFuturesä»»åŠ¡</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;ä¸»çº¿ç¨‹å¼€å§‹&quot;</span>);</span><br><span class="line">        CompletableFuture&lt;Integer&gt; job1 = CompletableFuture.supplyAsync(() -&gt; &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;åŠ 10ä»»åŠ¡å¼€å§‹&quot;</span>);</span><br><span class="line">            num += <span class="number">10</span>;</span><br><span class="line">            <span class="keyword">return</span> num;</span><br><span class="line">        &#125;);</span><br><span class="line">        CompletableFuture&lt;Integer&gt; job2 = CompletableFuture.supplyAsync(() -&gt; &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;ä¹˜ä»¥10ä»»åŠ¡å¼€å§‹&quot;</span>);</span><br><span class="line">            num = num * <span class="number">10</span>;</span><br><span class="line">            <span class="keyword">return</span> num;</span><br><span class="line">        &#125;); <span class="comment">//åˆå¹¶ä¸¤ä¸ªç»“æœ </span></span><br><span class="line">        CompletableFuture&lt;Object&gt; future = job1.thenCombine(job2, <span class="keyword">new</span> BiFunction&lt;Integer, Integer, List&lt;Integer&gt;&gt;() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> List&lt;Integer&gt; <span class="title">apply</span><span class="params">(Integer a, Integer b)</span> </span>&#123;</span><br><span class="line">                List&lt;Integer&gt; list = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">                list.add(a);</span><br><span class="line">                list.add(b);</span><br><span class="line">                <span class="keyword">return</span> list;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">        System.out.println(<span class="string">&quot;åˆå¹¶ç»“æœä¸º:&quot;</span> + future.get());</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>åˆå¹¶å¤šä¸ªä»»åŠ¡çš„ç»“æœallOfä¸anyOf<br />
allOf: ä¸€ç³»åˆ—ç‹¬ç«‹çš„futureä»»åŠ¡ï¼Œç­‰å…¶æ‰€æœ‰çš„ä»»åŠ¡æ‰§è¡Œå®Œååšä¸€äº›äº‹æƒ…</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">    * å…ˆå¯¹ä¸€ä¸ªæ•°åŠ 10,ç„¶åå–å¹³æ–¹ * <span class="doctag">@param</span> args</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">       System.out.println(<span class="string">&quot;ä¸»çº¿ç¨‹å¼€å§‹&quot;</span>);</span><br><span class="line">       List&lt;CompletableFuture&gt; list = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">       CompletableFuture&lt;Integer&gt; job1 = CompletableFuture.supplyAsync(() -&gt; &#123;</span><br><span class="line">           System.out.println(<span class="string">&quot;åŠ 10ä»»åŠ¡å¼€å§‹&quot;</span>);</span><br><span class="line">           num += <span class="number">10</span>;</span><br><span class="line">           <span class="keyword">return</span> num;</span><br><span class="line">       &#125;);</span><br><span class="line">       list.add(job1);</span><br><span class="line">       CompletableFuture&lt;Integer&gt; job2 = CompletableFuture.supplyAsync(() -&gt; &#123;</span><br><span class="line">           System.out.println(<span class="string">&quot;ä¹˜ä»¥10ä»»åŠ¡å¼€å§‹&quot;</span>);</span><br><span class="line">           num = num * <span class="number">10</span>;</span><br><span class="line">           <span class="keyword">return</span> num;</span><br><span class="line">       &#125;);</span><br><span class="line">       list.add(job2);</span><br><span class="line">       CompletableFuture&lt;Integer&gt; job3 = CompletableFuture.supplyAsync(() -&gt; &#123;</span><br><span class="line">           System.out.println(<span class="string">&quot;å‡ä»¥10ä»»åŠ¡å¼€å§‹&quot;</span>);</span><br><span class="line">           num = num * <span class="number">10</span>;</span><br><span class="line">           <span class="keyword">return</span> num;</span><br><span class="line">       &#125;);</span><br><span class="line">       list.add(job3);</span><br><span class="line">       CompletableFuture&lt;Integer&gt; job4 = CompletableFuture.supplyAsync(() -&gt; &#123;</span><br><span class="line">           System.out.println(<span class="string">&quot;é™¤ä»¥10ä»»åŠ¡å¼€å§‹&quot;</span>);</span><br><span class="line">           num = num * <span class="number">10</span>;</span><br><span class="line">           <span class="keyword">return</span> num;</span><br><span class="line">       &#125;);</span><br><span class="line">       list.add(job4); <span class="comment">//å¤šä»»åŠ¡åˆå¹¶ </span></span><br><span class="line">       List&lt;Integer&gt; collect = list.stream().map(CompletableFuture&lt;Integer&gt;::join).collect(Collectors.toList());</span><br><span class="line">       System.out.println(collect);</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>
<p>anyOf: åªè¦åœ¨å¤šä¸ªfutureé‡Œé¢æœ‰ä¸€ä¸ªè¿”å›ï¼Œæ•´ä¸ªä»»åŠ¡å°±å¯ä»¥ç»“æŸï¼Œè€Œä¸éœ€è¦ç­‰åˆ°æ¯ä¸€ä¸ªfutureç»“æŸ</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">    * å…ˆå¯¹ä¸€ä¸ªæ•°åŠ 10,ç„¶åå–å¹³æ–¹ * <span class="doctag">@param</span> args</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">       System.out.println(<span class="string">&quot;ä¸»çº¿ç¨‹å¼€å§‹&quot;</span>);</span><br><span class="line">       CompletableFuture&lt;Integer&gt;[] futures = <span class="keyword">new</span> CompletableFuture[<span class="number">4</span>];</span><br><span class="line">       CompletableFuture&lt;Integer&gt; job1 = CompletableFuture.supplyAsync(() -&gt; &#123;</span><br><span class="line">           <span class="keyword">try</span> &#123;</span><br><span class="line">               Thread.sleep(<span class="number">5000</span>);</span><br><span class="line">               System.out.println(<span class="string">&quot;åŠ 10ä»»åŠ¡å¼€å§‹&quot;</span>);</span><br><span class="line">               num += <span class="number">10</span>;</span><br><span class="line">               <span class="keyword">return</span> num;</span><br><span class="line">           &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">               <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">           &#125;</span><br><span class="line">       &#125;);</span><br><span class="line">       futures[<span class="number">0</span>] = job1;</span><br><span class="line">       CompletableFuture&lt;Integer&gt; job2 = CompletableFuture.supplyAsync(() -&gt; &#123;</span><br><span class="line">           <span class="keyword">try</span> &#123;</span><br><span class="line">               Thread.sleep(<span class="number">2000</span>);</span><br><span class="line">               System.out.println(<span class="string">&quot;ä¹˜ä»¥10ä»»åŠ¡å¼€å§‹&quot;</span>);</span><br><span class="line">               num = num * <span class="number">10</span>;</span><br><span class="line">               <span class="keyword">return</span> num;</span><br><span class="line">           &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">               <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">           &#125;</span><br><span class="line">       &#125;);</span><br><span class="line">       futures[<span class="number">1</span>] = job2;</span><br><span class="line">       CompletableFuture&lt;Integer&gt; job3 = CompletableFuture.supplyAsync(() -&gt; &#123;</span><br><span class="line">           <span class="keyword">try</span> &#123;</span><br><span class="line">               Thread.sleep(<span class="number">3000</span>);</span><br><span class="line">               System.out.println(<span class="string">&quot;å‡ä»¥10ä»»åŠ¡å¼€å§‹&quot;</span>);</span><br><span class="line">               num = num * <span class="number">10</span>;</span><br><span class="line">               <span class="keyword">return</span> num;</span><br><span class="line">           &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">               <span class="keyword">return</span> <span class="number">2</span>;</span><br><span class="line">           &#125;</span><br><span class="line">       &#125;);</span><br><span class="line">       futures[<span class="number">2</span>] = job3;</span><br><span class="line">       CompletableFuture&lt;Integer&gt; job4 = CompletableFuture.supplyAsync(() -&gt; &#123;</span><br><span class="line">           <span class="keyword">try</span> &#123;</span><br><span class="line">               Thread.sleep(<span class="number">4000</span>);</span><br><span class="line">               System.out.println(<span class="string">&quot;é™¤ä»¥10ä»»åŠ¡å¼€å§‹&quot;</span>);</span><br><span class="line">               num = num * <span class="number">10</span>;</span><br><span class="line">               <span class="keyword">return</span> num;</span><br><span class="line">           &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">               <span class="keyword">return</span> <span class="number">3</span>;</span><br><span class="line">           &#125;</span><br><span class="line">       &#125;);</span><br><span class="line">       futures[<span class="number">3</span>] = job4;</span><br><span class="line">       CompletableFuture&lt;Object&gt; future = CompletableFuture.anyOf(futures);</span><br><span class="line">       System.out.println(future.get());</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>
<h1 id="%E5%8F%8D%E5%B0%84">åå°„</h1>
<h2 id="%E8%8E%B7%E5%8F%96%E7%B1%BB%E7%9A%84%E5%AD%97%E8%8A%82%E7%A0%81" id="è·å–ç±»çš„å­—èŠ‚ç ">è·å–ç±»çš„å­—èŠ‚ç </h2>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> pers.lxl.mylearnproject.javase.reflection;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Field;</span><br><span class="line"><span class="keyword">import</span> java.util.Arrays;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * ä¸çŸ¥å¯¹è±¡æƒ…å†µè°ƒç”¨å¯¹è±¡æ–¹æ³•ç­‰ï¼Œé€šè¿‡Classå®ä¾‹è·å–classä¿¡æ¯çš„æ–¹æ³•ç§°ä¸ºåå°„ï¼ˆReflectionï¼‰</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> lxl</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ReClass</span> </span>&#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line"><span class="comment">/** 1.è·å–ä¸€ä¸ªclassçš„Classå®ä¾‹çš„ä¸‰ä¸ªæ–¹æ³•ï¼š</span></span><br><span class="line"><span class="comment"> æ–¹æ³•ä¸€ï¼šclassçš„é™æ€å˜é‡.classï¼š</span></span><br><span class="line"><span class="comment"> Class cls = String.class;</span></span><br><span class="line"><span class="comment"> æ–¹æ³•äºŒï¼šå®ä¾‹å˜é‡.getClass()ï¼š</span></span><br><span class="line"><span class="comment"> String s = &quot;Hello&quot;;</span></span><br><span class="line"><span class="comment"> Class cls1 = s.getClass();</span></span><br><span class="line"><span class="comment"> æ–¹æ³•ä¸‰ï¼šé™æ€æ–¹æ³•Class.forName(classçš„å®Œæ•´ç±»å)ï¼š</span></span><br><span class="line"><span class="comment"> åªä¼šè®©é™æ€ä»£ç å—æ‰§è¡Œ</span></span><br><span class="line"><span class="comment"> Class cls2 = Class.forName(&quot;java.lang.String&quot;);</span></span><br><span class="line"><span class="comment"> ç”¨instanceofä¸ä½†åŒ¹é…æŒ‡å®šç±»å‹ï¼Œè¿˜åŒ¹é…æŒ‡å®šç±»å‹çš„å­ç±»ã€‚è€Œç”¨==åˆ¤æ–­classå®ä¾‹å¯ä»¥ç²¾ç¡®åœ°åˆ¤æ–­æ•°æ®ç±»å‹ï¼Œä½†ä¸èƒ½ä½œå­ç±»å‹æ¯”è¾ƒ*/</span></span><br><span class="line">        printClassInfo(<span class="string">&quot;&quot;</span>.getClass());</span><br><span class="line">        printClassInfo(Runnable.class);</span><br><span class="line">        printClassInfo(java.time.Month.class);</span><br><span class="line">        printClassInfo(String[].class);</span><br><span class="line">        printClassInfo(<span class="keyword">int</span>.class);</span><br><span class="line"><span class="comment">//        ReflectLearn reflectLearn=new ReflectLearn();</span></span><br><span class="line">        printClassInfo(ReflectLearn.class);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">printClassInfo</span><span class="params">(Class cls)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line"><span class="comment">//            å…ˆè·å–ç±»ä¹‹åæ‰èƒ½è·å–ç±»ä¿¡æ¯</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//        è·å–ç±»ä¿¡æ¯</span></span><br><span class="line">        System.out.println(<span class="string">&quot;[&quot;</span> + cls.getSimpleName() + <span class="string">&quot;]  begin ==================================&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;Class name: &quot;</span> + cls.getName());</span><br><span class="line">        System.out.println(<span class="string">&quot;Simple name: &quot;</span> + cls.getSimpleName());</span><br><span class="line">        <span class="keyword">if</span> (cls.getPackage() != <span class="keyword">null</span>) &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;Package name: &quot;</span> + cls.getPackage().getName());</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println(<span class="string">&quot;is interface: &quot;</span> + cls.isInterface());</span><br><span class="line">        System.out.println(<span class="string">&quot;is enum: &quot;</span> + cls.isEnum());</span><br><span class="line">        System.out.println(<span class="string">&quot;is array: &quot;</span> + cls.isArray());</span><br><span class="line">        System.out.println(<span class="string">&quot;is primitive: &quot;</span> + cls.isPrimitive());</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//        æ–¹æ³•ä¿¡æ¯</span></span><br><span class="line"><span class="comment">//        .newInstance() æ— å‚æ„é€ ï¼Œä¸å­˜åœ¨æŠ›å‡ºå¼‚å¸¸java.lang.InstantiationException</span></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;æ— å‚æ„é€ ï¼š   &quot;</span>+cls.newInstance());</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InstantiationException e) &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;æ²¡æœ‰æ— å‚æ„é€ é€ æˆInstantiationException&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IllegalAccessException e) &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;æ²¡æœ‰æ— å‚æ„é€ é€ æˆIllegalAccessException&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println(<span class="string">&quot;æ‰€æœ‰å®ä¾‹æ–¹æ³•ï¼š   &quot;</span>+cls.getDeclaredMethods());</span><br><span class="line"><span class="comment">//        System.out.println(&quot;æ ¹æ®åå­—è·å–æ–¹æ³•ï¼š   &quot;+ Arrays.toString(cls.getDeclaredMethods(&quot;methodShow&quot;)));</span></span><br><span class="line">        System.out.println(<span class="string">&quot;æ‰€æœ‰æ„é€ æ–¹æ³•ï¼š   &quot;</span>+ Arrays.toString(cls.getDeclaredConstructors()));</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//        å±æ€§ä¿¡æ¯</span></span><br><span class="line">        System.out.println(<span class="string">&quot;public Fields: &quot;</span> + Arrays.toString(cls.getFields()));</span><br><span class="line">        System.out.println(<span class="string">&quot;Fields public Name: &quot;</span> + cls.getName());</span><br><span class="line">        System.out.println(<span class="string">&quot;All Fields: &quot;</span> + Arrays.toString(cls.getDeclaredFields()));</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;Get Fields By Name: &quot;</span> + Arrays.toString(<span class="keyword">new</span> Field[]&#123;cls.getDeclaredField(<span class="string">&quot;publicFiled&quot;</span>)&#125;));</span><br><span class="line">        &#125; <span class="keyword">catch</span> (NoSuchFieldException e) &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;æ²¡æœ‰è¿™æ ·ä¸€ä¸ªå±æ€§æŠ¥NoSuchFieldException&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        System.out.println(<span class="string">&quot;[&quot;</span> + cls.getSimpleName() + <span class="string">&quot;]  end ==================================&quot;</span> + <span class="string">&quot;\n&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ReflectLearn</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> String publicFiled;</span><br><span class="line">    <span class="keyword">private</span> String privateFiled;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">methodShow</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="io"><a target="_blank" rel="noopener" href="https://www.processon.com/diagraming/622d9b0e0e3e7407da44cbd7">IO</a></h1>
<p><img src="https://gitee.com/mychimei/picture/raw/master/image-20220313171017053.png" alt="image-20220313171017053" /></p>
<h2 id="%E7%A3%81%E7%9B%98%E6%93%8D%E4%BD%9C" id="ç£ç›˜æ“ä½œ">ç£ç›˜æ“ä½œ</h2>
<h3 id="file%E5%AF%B9%E8%B1%A1" id="Fileå¯¹è±¡">Fileå¯¹è±¡</h3>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.io.File;</span><br><span class="line"><span class="keyword">import</span> java.io.FilenameFilter;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.nio.file.Path;</span><br><span class="line"><span class="keyword">import</span> java.nio.file.Paths;</span><br><span class="line"><span class="comment">/**ç£ç›˜æ“ä½œ**/</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">FileObject</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line"><span class="comment">//        å³ä½¿ä¼ å…¥çš„æ–‡ä»¶æˆ–ç›®å½•ä¸å­˜åœ¨ï¼Œä»£ç ä¹Ÿä¸ä¼šå‡ºé”™ï¼Œå› ä¸ºæ„é€ ä¸€ä¸ªFileå¯¹è±¡ï¼Œå¹¶ä¸ä¼šå¯¼è‡´ä»»ä½•ç£ç›˜æ“ä½œ,è°ƒç”¨æ–¹æ³•æ—¶æ‰ä¼šç£ç›˜æ“ä½œ</span></span><br><span class="line">        <span class="comment">//ç»å¯¹è·¯å¾„æ˜¯ä»¥æ ¹ç›®å½•å¼€å¤´çš„å®Œæ•´è·¯å¾„Javaå­—ç¬¦ä¸²ä¸­ä»¥//ä»£è¡¨/</span></span><br><span class="line"><span class="comment">//        Fileè¡¨ç¤ºæ–‡ä»¶æˆ–ç›®å½•</span></span><br><span class="line">        <span class="comment">//\u202Aç³»ç»Ÿå¤åˆ¶äº§ç”Ÿ</span></span><br><span class="line">        File file = <span class="keyword">new</span> File(<span class="string">&quot;C:\\Users\\Administrator\\Desktop\\lixianglun\\fileTest.txt&quot;</span>);</span><br><span class="line">        <span class="comment">//ç›¸å¯¹è·¯å¾„ï¼ˆå¯ä»¥ç”¨.è¡¨ç¤ºå½“å‰ç›®å½•ï¼Œ..è¡¨ç¤ºä¸Šçº§ç›®å½•ï¼‰ç»å¯¹è·¯å¾„å»æ‰å½“å‰ç›®å½•</span></span><br><span class="line">        File afile = <span class="keyword">new</span> File(<span class="string">&quot;..\\fileTest.txt&quot;</span>);</span><br><span class="line">        File catalog=<span class="keyword">new</span> File(<span class="string">&quot;C:\\Users\\Administrator\\Desktop&quot;</span>);</span><br><span class="line">        System.out.println(file);</span><br><span class="line">        <span class="comment">//è¿”å›æ„é€ æ–¹æ³•ä¼ å…¥çš„è·¯å¾„</span></span><br><span class="line">        System.out.println(file.getPath());</span><br><span class="line">        <span class="comment">//è¿”å›ç»å¯¹è·¯å¾„</span></span><br><span class="line">        System.out.println(file.getAbsolutePath());</span><br><span class="line">        <span class="comment">//è¿”å›çš„æ˜¯è§„èŒƒè·¯å¾„ã€‚</span></span><br><span class="line">        System.out.println(afile.getCanonicalPath());</span><br><span class="line">        <span class="comment">//æ ¹æ®å½“å‰å¹³å°æ‰“å°&quot;\&quot;æˆ–&quot;/&quot;</span></span><br><span class="line">        System.out.println(File.separator);</span><br><span class="line">        System.out.println(file.isFile());</span><br><span class="line">        <span class="comment">//åˆ¤æ–­å½“å‰æ–‡ä»¶ï¼Œç›®å½•æ˜¯å¦å­˜åœ¨</span></span><br><span class="line">        System.out.println(file.isDirectory());</span><br><span class="line">        System.out.println(file.canRead());</span><br><span class="line">        System.out.println(file.canWrite());</span><br><span class="line">        System.out.println(file.canExecute());</span><br><span class="line">        System.out.println(afile.length());</span><br><span class="line">        <span class="comment">//addã€delete</span></span><br><span class="line"><span class="comment">//        if (file.createNewFile()) &#123;</span></span><br><span class="line"><span class="comment">//            // æ–‡ä»¶åˆ›å»ºæˆåŠŸ:</span></span><br><span class="line"><span class="comment">//            // TOD O:TODOæäº¤ä»£ç ä¼šæé†’</span></span><br><span class="line"><span class="comment">//            if (file.delete()) &#123;</span></span><br><span class="line"><span class="comment">//                // åˆ é™¤æ–‡ä»¶æˆåŠŸ:</span></span><br><span class="line"><span class="comment">//            &#125;</span></span><br><span class="line"><span class="comment">//        &#125;</span></span><br><span class="line"><span class="comment">//        é€’å½’åˆ—å‡ºç›®å½•ä¸‹çš„æ‰€æœ‰æ–‡ä»¶</span></span><br><span class="line"><span class="comment">//        public static void listAllFiles(File dir) &#123;</span></span><br><span class="line"><span class="comment">//    if (dir == null || !dir.exists()) &#123;</span></span><br><span class="line"><span class="comment">//        return;</span></span><br><span class="line"><span class="comment">//    &#125;</span></span><br><span class="line"><span class="comment">//    if (dir.isFile()) &#123;</span></span><br><span class="line"><span class="comment">//        System.out.println(dir.getName());</span></span><br><span class="line"><span class="comment">//        return;</span></span><br><span class="line"><span class="comment">//    &#125;</span></span><br><span class="line"><span class="comment">//    for (File file : dir.listFiles()) &#123;</span></span><br><span class="line"><span class="comment">//        listAllFiles(file);</span></span><br><span class="line"><span class="comment">//    &#125;</span></span><br><span class="line"><span class="comment">//&#125;</span></span><br><span class="line"><span class="comment">//æœ‰äº›æ—¶å€™ï¼Œç¨‹åºéœ€è¦è¯»å†™ä¸€äº›ä¸´æ—¶æ–‡ä»¶ï¼ŒFileå¯¹è±¡æä¾›äº†createTempFile()æ¥åˆ›å»ºä¸€ä¸ªä¸´æ—¶æ–‡ä»¶ï¼Œä»¥åŠdeleteOnExit()åœ¨JVMé€€å‡ºæ—¶è‡ªåŠ¨åˆ é™¤è¯¥æ–‡ä»¶ã€‚</span></span><br><span class="line">        System.out.println(catalog.list());</span><br><span class="line">        <span class="comment">//ç›®å½•ä¸‹çš„æ–‡ä»¶å’Œå­ç›®å½•å</span></span><br><span class="line">        System.out.println(catalog.listFiles());</span><br><span class="line">        <span class="comment">//listFiles()æä¾›äº†ä¸€ç³»åˆ—é‡è½½æ–¹æ³•ï¼Œå¯ä»¥è¿‡æ»¤ä¸æƒ³è¦çš„æ–‡ä»¶å’Œç›®å½•</span></span><br><span class="line">        <span class="comment">// ä»…åˆ—å‡º.exeæ–‡ä»¶</span></span><br><span class="line">        File[] fs2 = catalog.listFiles(<span class="keyword">new</span> FilenameFilter() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">accept</span><span class="params">(File dir, String name)</span> </span>&#123;</span><br><span class="line">                <span class="keyword">return</span> name.endsWith(<span class="string">&quot;.exe&quot;</span>); <span class="comment">// è¿”å›trueè¡¨ç¤ºæ¥å—è¯¥æ–‡ä»¶</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">        printFiles(fs2);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/**boolean mkdir()ï¼šåˆ›å»ºå½“å‰Fileå¯¹è±¡è¡¨ç¤ºçš„ç›®å½•ï¼›</span></span><br><span class="line"><span class="comment">    //boolean mkdirs()ï¼šåˆ›å»ºå½“å‰Fileå¯¹è±¡è¡¨ç¤ºçš„ç›®å½•ï¼Œå¹¶åœ¨å¿…è¦æ—¶å°†ä¸å­˜åœ¨çš„çˆ¶ç›®å½•ä¹Ÿåˆ›å»ºå‡ºæ¥ï¼›</span></span><br><span class="line"><span class="comment">    //boolean delete()ï¼šåˆ é™¤å½“å‰Fileå¯¹è±¡è¡¨ç¤ºçš„ç›®å½•ï¼Œå½“å‰ç›®å½•å¿…é¡»ä¸ºç©ºæ‰èƒ½åˆ é™¤æˆåŠŸã€‚*/</span></span><br><span class="line">        <span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">printFiles</span><span class="params">(File[] files)</span> </span>&#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;==========&quot;</span>);</span><br><span class="line">            <span class="keyword">if</span> (files != <span class="keyword">null</span>) &#123;</span><br><span class="line">                <span class="keyword">for</span> (File f : files) &#123;</span><br><span class="line">                    System.out.println(f);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            System.out.println(<span class="string">&quot;==========&quot;</span>);</span><br><span class="line">            <span class="comment">// æ„é€ ä¸€ä¸ªPathå¯¹è±¡</span></span><br><span class="line">            Path p1 = Paths.get(<span class="string">&quot;.&quot;</span>, <span class="string">&quot;project&quot;</span>, <span class="string">&quot;study&quot;</span>);</span><br><span class="line">            System.out.println(p1);</span><br><span class="line">            <span class="comment">// è½¬æ¢ä¸ºç»å¯¹è·¯å¾„</span></span><br><span class="line">            Path p2 = p1.toAbsolutePath();</span><br><span class="line">            System.out.println(p2);</span><br><span class="line">            <span class="comment">// è½¬æ¢ä¸ºè§„èŒƒè·¯å¾„</span></span><br><span class="line">            Path p3 = p2.normalize();</span><br><span class="line">            System.out.println(p3);</span><br><span class="line">            <span class="comment">// è½¬æ¢ä¸ºFileå¯¹è±¡</span></span><br><span class="line">            File f = p3.toFile();</span><br><span class="line">            System.out.println(f);</span><br><span class="line">            <span class="comment">// å¯ä»¥ç›´æ¥éå†Path</span></span><br><span class="line">            <span class="keyword">for</span> (Path p : Paths.get(<span class="string">&quot;src/main&quot;</span>).toAbsolutePath()) &#123;</span><br><span class="line">                System.out.println(<span class="string">&quot;  &quot;</span> + p);</span><br><span class="line">            &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h2 id="%E5%AD%97%E8%8A%82%E6%93%8D%E4%BD%9C" id="å­—èŠ‚æ“ä½œ">å­—èŠ‚æ“ä½œ</h2>
<h3 id="inputstream" id="InputStream">InputStream</h3>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.io.File;</span><br><span class="line"><span class="keyword">import</span> java.io.FileInputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.io.InputStream;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**InputStreamå¹¶ä¸æ˜¯ä¸€ä¸ªæ¥å£ï¼Œè€Œæ˜¯ä¸€ä¸ªæŠ½è±¡ç±»ï¼Œå®ƒæ˜¯æ‰€æœ‰è¾“å…¥æµçš„è¶…ç±»ã€‚è¿™ä¸ªæŠ½è±¡ç±»å®šä¹‰çš„ä¸€ä¸ªæœ€é‡è¦çš„æ–¹æ³•å°±æ˜¯int read()ï¼Œç­¾åå¦‚ä¸‹ï¼š</span></span><br><span class="line"><span class="comment">public abstract int read() throws IOException;</span></span><br><span class="line"><span class="comment">è¿™ä¸ªæ–¹æ³•ä¼šè¯»å–è¾“å…¥æµçš„ä¸‹ä¸€ä¸ªå­—èŠ‚ï¼Œå¹¶è¿”å›å­—èŠ‚è¡¨ç¤ºçš„intå€¼ï¼ˆ0~255ï¼‰ã€‚å¦‚æœå·²è¯»åˆ°æœ«å°¾ï¼Œè¿”å›-1è¡¨ç¤ºä¸èƒ½ç»§ç»­è¯»å–äº†ã€‚</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> lxl*/</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">InputStreamL</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        <span class="comment">//inputStreamå­—èŠ‚è¾“å…¥æµï¼ŒæŠ½è±¡ç±»ï¼Œåªæä¾›æ–¹æ³•å£°æ˜ï¼Œä¸æä¾›å…·ä½“å®ç°</span></span><br><span class="line">        <span class="comment">// åˆ›å»ºä¸€ä¸ªFileInputStreamå¯¹è±¡:</span></span><br><span class="line">        InputStream inputStream = <span class="keyword">new</span> FileInputStream(<span class="string">&quot;fileTest.txt&quot;</span>);</span><br><span class="line">        <span class="keyword">for</span> (; ; ) &#123;<span class="comment">//æ­»å¾ªç¯ï¼Œæ¯”whileï¼ˆtrueï¼‰æ›´å¥½ï¼Œå› ä¸ºç¼–è¯‘åæŒ‡ä»¤æ›´å°‘ï¼Œè€Œä¸”æ²¡æœ‰åˆ¤æ–­è·³è½¬ï¼Œæ›´åŠ ç®€æ´</span></span><br><span class="line">            <span class="comment">// åå¤è°ƒç”¨read()æ–¹æ³•ï¼Œç›´åˆ°è¿”å›-1</span></span><br><span class="line">            <span class="keyword">int</span> n = inputStream.read();</span><br><span class="line">            <span class="keyword">if</span> (n == -<span class="number">1</span>) &#123;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// æ‰“å°byteçš„å€¼</span></span><br><span class="line">            System.out.println(n);</span><br><span class="line">        &#125;</span><br><span class="line">        inputStream.close(); <span class="comment">// å…³é—­æµé‡Šæ”¾å¯¹åº”çš„åº•å±‚èµ„æºï¼Œä¾¿è®©æ“ä½œç³»ç»ŸæŠŠèµ„æºé‡Šæ”¾æ‰ï¼Œå¦åˆ™ï¼Œåº”ç”¨ç¨‹åºå ç”¨çš„èµ„æºä¼šè¶Šæ¥è¶Šå¤šï¼Œä¸ä½†ç™½ç™½å ç”¨å†…å­˜ï¼Œè¿˜ä¼šå½±å“å…¶ä»–åº”ç”¨ç¨‹åºçš„è¿è¡Œã€‚</span></span><br><span class="line"><span class="comment">//        åˆ©ç”¨ç¼“å†²åŒºä¸€æ¬¡è¯»å–å¤šä¸ªå­—èŠ‚</span></span><br><span class="line">        <span class="keyword">try</span> (InputStream input = <span class="keyword">new</span> FileInputStream(<span class="string">&quot;fileTest.txt&quot;</span>)) &#123;</span><br><span class="line">            <span class="comment">// å®šä¹‰1000ä¸ªå­—èŠ‚å¤§å°çš„ç¼“å†²åŒº:</span></span><br><span class="line">            <span class="keyword">byte</span>[] buffer = <span class="keyword">new</span> <span class="keyword">byte</span>[<span class="number">1000</span>];</span><br><span class="line">            <span class="keyword">int</span> n;</span><br><span class="line">            <span class="comment">// è¯»å–åˆ°ç¼“å†²åŒº,read()æ–¹æ³•æ˜¯é˜»å¡çš„ï¼ˆBlockingï¼‰ï¼Œå¿…é¡»ç­‰å¾…read()æ–¹æ³•è¿”å›æ‰èƒ½æ‰§è¡Œä¸‹ä¸€è¡Œä»£ç </span></span><br><span class="line">            <span class="keyword">while</span> ((n = input.read(buffer)) != -<span class="number">1</span>) &#123;</span><br><span class="line">                System.out.println(<span class="string">&quot;read &quot;</span> + n + <span class="string">&quot; bytes.&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">//å‡†å¤‡æ–‡ä»¶lol.txtå…¶ä¸­çš„å†…å®¹æ˜¯ABï¼Œå¯¹åº”çš„ASCIIåˆ†åˆ«æ˜¯65 66</span></span><br><span class="line">            File f =<span class="keyword">new</span> File(<span class="string">&quot;fileTest.txt&quot;</span>);</span><br><span class="line">            <span class="comment">//åˆ›å»ºåŸºäºæ–‡ä»¶çš„è¾“å…¥æµ</span></span><br><span class="line">            FileInputStream fis =<span class="keyword">new</span> FileInputStream(f);</span><br><span class="line">            <span class="comment">//åˆ›å»ºå­—èŠ‚æ•°ç»„ï¼Œå…¶é•¿åº¦å°±æ˜¯æ–‡ä»¶çš„é•¿åº¦</span></span><br><span class="line">            <span class="keyword">byte</span>[] all =<span class="keyword">new</span> <span class="keyword">byte</span>[(<span class="keyword">int</span>) f.length()];</span><br><span class="line">            <span class="comment">//ä»¥å­—èŠ‚æµçš„å½¢å¼è¯»å–æ–‡ä»¶æ‰€æœ‰å†…å®¹</span></span><br><span class="line">            fis.read(all);</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">byte</span> b : all) &#123;</span><br><span class="line">                <span class="comment">//æ‰“å°å‡ºæ¥æ˜¯65 66</span></span><br><span class="line">                System.out.println(b);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="comment">//æ¯æ¬¡ä½¿ç”¨å®Œæµï¼Œéƒ½åº”è¯¥è¿›è¡Œå…³é—­</span></span><br><span class="line">            fis.close();</span><br><span class="line"></span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            <span class="comment">// TODO Auto-generated catch block</span></span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*è£…é¥°è€…æ¨¡å¼</span></span><br><span class="line"><span class="comment">Java I/O ä½¿ç”¨äº†è£…é¥°è€…æ¨¡å¼æ¥å®ç°ã€‚ä»¥ InputStream ä¸ºä¾‹ï¼Œ</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">InputStream æ˜¯æŠ½è±¡ç»„ä»¶ï¼›</span></span><br><span class="line"><span class="comment">FileInputStream æ˜¯ InputStream çš„å­ç±»ï¼Œå±äºå…·ä½“ç»„ä»¶ï¼Œæä¾›äº†å­—èŠ‚æµçš„è¾“å…¥æ“ä½œï¼›</span></span><br><span class="line"><span class="comment">FilterInputStream å±äºæŠ½è±¡è£…é¥°è€…ï¼Œè£…é¥°è€…ç”¨äºè£…é¥°ç»„ä»¶ï¼Œä¸ºç»„ä»¶æä¾›é¢å¤–çš„åŠŸèƒ½ã€‚ä¾‹å¦‚ BufferedInputStream ä¸º FileInputStream æä¾›ç¼“å­˜çš„åŠŸèƒ½ã€‚</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">å®ä¾‹åŒ–ä¸€ä¸ªå…·æœ‰ç¼“å­˜åŠŸèƒ½çš„å­—èŠ‚æµå¯¹è±¡æ—¶ï¼Œåªéœ€è¦åœ¨ FileInputStream å¯¹è±¡ä¸Šå†å¥—ä¸€å±‚ BufferedInputStream å¯¹è±¡å³å¯ã€‚</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">FileInputStream fileInputStream = new FileInputStream(filePath);</span></span><br><span class="line"><span class="comment">BufferedInputStream bufferedInputStream = new BufferedInputStream(fileInputStream);</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">DataInputStream è£…é¥°è€…æä¾›äº†å¯¹æ›´å¤šæ•°æ®ç±»å‹è¿›è¡Œè¾“å…¥çš„æ“ä½œï¼Œæ¯”å¦‚ intã€double ç­‰åŸºæœ¬ç±»å‹ã€‚*/</span></span><br></pre></td></tr></table></figure>
<h3 id="outputstream" id="OutputStream">OutputStream</h3>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.io.*;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**ä¸ºä»€ä¹ˆè¦æœ‰flush()ï¼Ÿå› ä¸ºå‘ç£ç›˜ã€ç½‘ç»œå†™å…¥æ•°æ®çš„æ—¶å€™ï¼Œå‡ºäºæ•ˆç‡çš„è€ƒè™‘ï¼Œ</span></span><br><span class="line"><span class="comment">æ“ä½œç³»ç»Ÿå¹¶ä¸æ˜¯è¾“å‡ºä¸€ä¸ªå­—èŠ‚å°±ç«‹åˆ»å†™å…¥åˆ°æ–‡ä»¶æˆ–è€…å‘é€åˆ°ç½‘ç»œï¼Œ</span></span><br><span class="line"><span class="comment">è€Œæ˜¯æŠŠè¾“å‡ºçš„å­—èŠ‚å…ˆæ”¾åˆ°å†…å­˜çš„ä¸€ä¸ªç¼“å†²åŒºé‡Œï¼ˆæœ¬è´¨ä¸Šå°±æ˜¯ä¸€ä¸ªbyte[]æ•°ç»„ï¼‰ï¼Œ</span></span><br><span class="line"><span class="comment">ç­‰åˆ°ç¼“å†²åŒºå†™æ»¡äº†ï¼Œå†ä¸€æ¬¡æ€§å†™å…¥æ–‡ä»¶æˆ–è€…ç½‘ç»œã€‚å¯¹äºå¾ˆå¤šIOè®¾å¤‡æ¥è¯´ï¼Œ</span></span><br><span class="line"><span class="comment">ä¸€æ¬¡å†™ä¸€ä¸ªå­—èŠ‚å’Œä¸€æ¬¡å†™1000ä¸ªå­—èŠ‚ï¼ŒèŠ±è´¹çš„æ—¶é—´å‡ ä¹æ˜¯å®Œå…¨ä¸€æ ·çš„ï¼Œ</span></span><br><span class="line"><span class="comment">æ‰€ä»¥OutputStreamæœ‰ä¸ªflush()æ–¹æ³•ï¼Œèƒ½å¼ºåˆ¶æŠŠç¼“å†²åŒºå†…å®¹è¾“å‡ºã€‚</span></span><br><span class="line"><span class="comment">é€šå¸¸æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬ä¸éœ€è¦è°ƒç”¨è¿™ä¸ªflush()æ–¹æ³•ï¼Œå› ä¸ºç¼“å†²åŒºå†™æ»¡äº†OutputStreamä¼šè‡ªåŠ¨è°ƒç”¨å®ƒ</span></span><br><span class="line"><span class="comment">å¹¶ä¸”ï¼Œåœ¨è°ƒç”¨close()æ–¹æ³•å…³é—­OutputStreamä¹‹å‰ï¼Œä¹Ÿä¼šè‡ªåŠ¨è°ƒç”¨flush()æ–¹æ³•ã€‚</span></span><br><span class="line"><span class="comment">ç‰¹åˆ«æƒ…å†µï¼Œç¼“å†²åŒºè¿‡å¤§ï¼Œéœ€é©¬ä¸Šå‘é€çš„æ—¶å€™æ‰‹åŠ¨flush</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> lxl*/</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">OutputStreamL</span> </span>&#123;</span><br><span class="line">    <span class="comment">/**å®ç°æ–‡ä»¶å¤åˆ¶*/</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">copyFile</span><span class="params">(String src, String dist)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        FileInputStream in = <span class="keyword">new</span> FileInputStream(src);</span><br><span class="line">        FileOutputStream out = <span class="keyword">new</span> FileOutputStream(dist);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">byte</span>[] buffer = <span class="keyword">new</span> <span class="keyword">byte</span>[<span class="number">20</span> * <span class="number">1024</span>];</span><br><span class="line">        <span class="keyword">int</span> cnt;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// read() æœ€å¤šè¯»å– buffer.length ä¸ªå­—èŠ‚</span></span><br><span class="line">        <span class="comment">// è¿”å›çš„æ˜¯å®é™…è¯»å–çš„ä¸ªæ•°</span></span><br><span class="line">        <span class="comment">// è¿”å› -1 çš„æ—¶å€™è¡¨ç¤ºè¯»åˆ° eofï¼Œå³æ–‡ä»¶å°¾</span></span><br><span class="line">        <span class="keyword">while</span> ((cnt = in.read(buffer, <span class="number">0</span>, buffer.length)) != -<span class="number">1</span>) &#123;</span><br><span class="line">            out.write(buffer, <span class="number">0</span>, cnt);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        in.close();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        <span class="comment">//æ–‡ä»¶å­˜åœ¨åˆ™è¦†ç›–ï¼Œä¸å­˜åœ¨åˆ›å»º</span></span><br><span class="line">        <span class="keyword">try</span>(OutputStream output = <span class="keyword">new</span> FileOutputStream(<span class="string">&quot;F:\\PROJECT\\IDEA\\mylearnproject\\src\\main\\resources\\fileTest.txt&quot;</span>))&#123;</span><br><span class="line">            <span class="keyword">byte</span>[] data = &#123;<span class="number">34</span>, <span class="number">35</span>&#125;;</span><br><span class="line">        <span class="comment">// H</span></span><br><span class="line">        output.write(<span class="number">72</span>);</span><br><span class="line">        <span class="comment">// e</span></span><br><span class="line">        output.write(<span class="number">101</span>);</span><br><span class="line">        <span class="comment">// l</span></span><br><span class="line">        output.write(<span class="number">108</span>);</span><br><span class="line">        <span class="comment">// l</span></span><br><span class="line">        output.write(<span class="number">108</span>);</span><br><span class="line">        <span class="comment">// o</span></span><br><span class="line">        output.write(data);</span><br><span class="line"><span class="comment">//        output.write(111); // o</span></span><br><span class="line">        <span class="comment">// ä¸€æ¬¡æ€§å†™å…¥è‹¥å¹²å­—èŠ‚</span></span><br><span class="line">        output.write(<span class="string">&quot;Helloç“¦è¾¾æ— å¤š&quot;</span>.getBytes(<span class="string">&quot;UTF-8&quot;</span>));</span><br><span class="line">            <span class="comment">// &#125;</span></span><br><span class="line">        output.close();<span class="comment">//tryä¹‹åç¼–è¯‘å™¨åœ¨æ­¤è‡ªåŠ¨ä¸ºæˆ‘ä»¬å†™å…¥finallyå¹¶è°ƒç”¨close()</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;&#125;</span><br></pre></td></tr></table></figure>
<h2 id="%E5%AD%97%E7%AC%A6%E6%93%8D%E4%BD%9C" id="å­—ç¬¦æ“ä½œ">å­—ç¬¦æ“ä½œ</h2>
<ul>
<li>
<p>Reader</p>
<ul>
<li>
<p>InputStreamæ˜¯ä¸€ä¸ªå­—èŠ‚æµï¼Œå³ä»¥byteä¸ºå•ä½è¯»å–ï¼Œè€ŒReaderæ˜¯ä¸€ä¸ªå­—ç¬¦æµï¼Œå³ä»¥charä¸ºå•ä½è¯»å–</p>
</li>
<li>
<p>InputStream			                                                     	Reader<br />
å­—èŠ‚æµï¼Œä»¥byteä¸ºå•ä½			                                     å­—ç¬¦æµï¼Œä»¥charä¸ºå•ä½<br />
è¯»å–å­—èŠ‚ï¼ˆ-1ï¼Œ0~255ï¼‰ï¼šint read()	                  è¯»å–å­—ç¬¦ï¼ˆ-1ï¼Œ0~65535ï¼‰ï¼šint read()<br />
è¯»åˆ°å­—èŠ‚æ•°ç»„ï¼šint read(byte[] b)	                               è¯»åˆ°å­—ç¬¦æ•°ç»„ï¼šint read(char[] c)</p>
</li>
<li>
<p>java.io.Readeræ˜¯æ‰€æœ‰å­—ç¬¦è¾“å…¥æµçš„è¶…ç±»ï¼Œå®ƒæœ€ä¸»è¦çš„æ–¹æ³•æ˜¯ï¼š<br />
public int read() throws IOException;<br />
è¿™ä¸ªæ–¹æ³•è¯»å–å­—ç¬¦æµçš„ä¸‹ä¸€ä¸ªå­—ç¬¦ï¼Œå¹¶è¿”å›å­—ç¬¦è¡¨ç¤ºçš„intï¼ŒèŒƒå›´æ˜¯0~65535ã€‚å¦‚æœå·²è¯»åˆ°æœ«å°¾ï¼Œè¿”å›-1ã€‚</p>
</li>
<li>
<p>FileReaderæ‰“å¼€æ–‡ä»¶å¹¶è·å–Reader</p>
<ul>
<li>// åˆ›å»ºä¸€ä¸ªFileReaderå¯¹è±¡:<br />
Reader reader = new FileReader(&quot;src/readme.txt&quot;); // å­—ç¬¦ç¼–ç æ˜¯???<br />
for (;ğŸ˜‰ {<br />
int n = reader.read(); // åå¤è°ƒç”¨read()æ–¹æ³•ï¼Œç›´åˆ°è¿”å›-1<br />
if (n == -1) {<br />
break;<br />
}<br />
System.out.println((char)n); // æ‰“å°char<br />
}<br />
reader.close(); // å…³é—­æµ</li>
</ul>
</li>
<li>
<p>é¿å…ä¹±ç é—®é¢˜ï¼Œæˆ‘ä»¬éœ€è¦åœ¨åˆ›å»ºFileReaderæ—¶æŒ‡å®šç¼–ç ï¼š</p>
</li>
</ul>
</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">	Reader reader = <span class="keyword">new</span> FileReader(<span class="string">&quot;src/readme.txt&quot;</span>, StandardCharsets.UTF_8);</span><br><span class="line">	- <span class="keyword">try</span> (resource)æ¥ä¿è¯Readeråœ¨æ— è®ºæœ‰æ²¡æœ‰IOé”™è¯¯çš„æ—¶å€™éƒ½èƒ½å¤Ÿæ­£ç¡®åœ°å…³é—­</span><br><span class="line">	- Readerè¿˜æä¾›äº†ä¸€æ¬¡æ€§è¯»å–è‹¥å¹²å­—ç¬¦å¹¶å¡«å……åˆ°<span class="keyword">char</span>[]æ•°ç»„çš„æ–¹æ³•ï¼š</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">read</span><span class="params">(<span class="keyword">char</span>[] c)</span> <span class="keyword">throws</span> IOException</span></span><br><span class="line"><span class="function">å®ƒè¿”å›å®é™…è¯»å…¥çš„å­—ç¬¦ä¸ªæ•°ï¼Œæœ€å¤§ä¸è¶…è¿‡<span class="keyword">char</span>[]æ•°ç»„çš„é•¿åº¦ã€‚è¿”å›-1è¡¨ç¤ºæµç»“æŸã€‚</span></span><br><span class="line"><span class="function">	- CharArrayReaderæŠŠä¸€ä¸ª<span class="keyword">char</span>[]æ•°ç»„å˜æˆä¸€ä¸ªReader</span></span><br><span class="line"><span class="function">	- <span class="title">try</span> <span class="params">(Reader reader = new CharArrayReader(<span class="string">&quot;Hello&quot;</span>.toCharArray()</span>)) </span>&#123;&#125;</span><br><span class="line"></span><br><span class="line">- StringReader</span><br><span class="line">- InputStreamReader</span><br><span class="line"></span><br><span class="line">	- é™¤äº†ç‰¹æ®Šçš„CharArrayReaderå’ŒStringReaderï¼Œæ™®é€šçš„Readerå®é™…ä¸Šæ˜¯åŸºäºInputStreamæ„é€ çš„ï¼Œå› ä¸ºReaderéœ€è¦ä»InputStreamä¸­è¯»å…¥å­—èŠ‚æµï¼ˆ<span class="keyword">byte</span>ï¼‰ï¼Œç„¶åï¼Œæ ¹æ®ç¼–ç è®¾ç½®ï¼Œå†è½¬æ¢ä¸º<span class="keyword">char</span>å°±å¯ä»¥å®ç°å­—ç¬¦æµã€‚å¦‚æœæˆ‘ä»¬æŸ¥çœ‹FileReaderçš„æºç ï¼Œå®ƒåœ¨å†…éƒ¨å®é™…ä¸ŠæŒæœ‰ä¸€ä¸ªFileInputStreamã€‚</span><br><span class="line">	æ—¢ç„¶Readeræœ¬è´¨ä¸Šæ˜¯ä¸€ä¸ªåŸºäºInputStreamçš„<span class="keyword">byte</span>åˆ°<span class="keyword">char</span>çš„è½¬æ¢å™¨ï¼Œé‚£ä¹ˆï¼Œå¦‚æœæˆ‘ä»¬å·²ç»æœ‰ä¸€ä¸ªInputStreamï¼Œæƒ³æŠŠå®ƒè½¬æ¢ä¸ºReaderï¼Œæ˜¯å®Œå…¨å¯è¡Œçš„ã€‚InputStreamReaderå°±æ˜¯è¿™æ ·ä¸€ä¸ªè½¬æ¢å™¨ï¼Œå®ƒå¯ä»¥æŠŠä»»ä½•InputStreamè½¬æ¢ä¸ºReaderã€‚</span><br><span class="line">		- <span class="comment">// æŒæœ‰InputStream:</span></span><br><span class="line">		InputStream input = <span class="keyword">new</span> FileInputStream(<span class="string">&quot;src/readme.txt&quot;</span>);</span><br><span class="line"><span class="comment">// å˜æ¢ä¸ºReader:</span></span><br><span class="line">Reader reader = <span class="keyword">new</span> InputStreamReader(input, <span class="string">&quot;UTF-8&quot;</span>);</span><br><span class="line">			- <span class="keyword">try</span> (Reader reader = <span class="keyword">new</span> InputStreamReader(<span class="keyword">new</span> FileInputStream(<span class="string">&quot;src/readme.txt&quot;</span>), <span class="string">&quot;UTF-8&quot;</span>)) &#123;</span><br><span class="line"><span class="comment">// <span class="doctag">TODO:</span></span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>
<p>Writer</p>
<ul>
<li>Writerå°±æ˜¯å¸¦ç¼–ç è½¬æ¢å™¨çš„OutputStreamï¼Œå®ƒæŠŠcharè½¬æ¢ä¸ºbyteå¹¶è¾“å‡º</li>
<li>OutputStream				Writer<br />
å­—èŠ‚æµï¼Œä»¥byteä¸ºå•ä½			å­—ç¬¦æµï¼Œä»¥charä¸ºå•ä½<br />
å†™å…¥å­—èŠ‚ï¼ˆ0~255ï¼‰ï¼švoid write(int b)	å†™å…¥å­—ç¬¦ï¼ˆ0~65535ï¼‰ï¼švoid write(int c)<br />
å†™å…¥å­—èŠ‚æ•°ç»„ï¼švoid write(byte[] b)	å†™å…¥å­—ç¬¦æ•°ç»„ï¼švoid write(char[] c)<br />
æ— å¯¹åº”æ–¹æ³•				å†™å…¥Stringï¼švoid write(String s)</li>
<li>Writeræ˜¯æ‰€æœ‰å­—ç¬¦è¾“å‡ºæµçš„è¶…ç±»ï¼Œå®ƒæä¾›çš„æ–¹æ³•ä¸»è¦æœ‰ï¼š</li>
</ul>
</li>
</ul>
<p>å†™å…¥ä¸€ä¸ªå­—ç¬¦ï¼ˆ0~65535ï¼‰ï¼švoid write(int c)ï¼›<br />
å†™å…¥å­—ç¬¦æ•°ç»„çš„æ‰€æœ‰å­—ç¬¦ï¼švoid write(char[] c)ï¼›<br />
å†™å…¥Stringè¡¨ç¤ºçš„æ‰€æœ‰å­—ç¬¦ï¼švoid write(String s)ã€‚<br />
- FileWriter</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">	- try (Writer writer &#x3D; new FileWriter(&quot;readme.txt&quot;, StandardCharsets.UTF_8)) &#123;</span><br><span class="line">writer.write(&#39;H&#39;); &#x2F;&#x2F; å†™å…¥å•ä¸ªå­—ç¬¦</span><br><span class="line">writer.write(&quot;Hello&quot;.toCharArray()); &#x2F;&#x2F; å†™å…¥char[]</span><br><span class="line">writer.write(&quot;Hello&quot;); &#x2F;&#x2F; å†™å…¥String</span><br><span class="line">&#125;</span><br><span class="line">- CharArrayWriter</span><br><span class="line">- StringWriter</span><br><span class="line">- OutputStreamWriter</span><br></pre></td></tr></table></figure>
<ul>
<li>
<p>String çš„ç¼–ç æ–¹å¼</p>
<ul>
<li>String å¯ä»¥çœ‹æˆä¸€ä¸ªå­—ç¬¦åºåˆ—ï¼Œå¯ä»¥æŒ‡å®šä¸€ä¸ªç¼–ç æ–¹å¼å°†å®ƒç¼–ç ä¸ºå­—èŠ‚åºåˆ—ï¼Œä¹Ÿå¯ä»¥æŒ‡å®šä¸€ä¸ªç¼–ç æ–¹å¼å°†ä¸€ä¸ªå­—èŠ‚åºåˆ—è§£ç ä¸º Stringã€‚</li>
</ul>
</li>
</ul>
<p>String str1 = &quot;ä¸­æ–‡&quot;; d<br />
byte[] bytes = str1.getBytes(&quot;UTF-8&quot;);<br />
String str2 = new String(bytes, &quot;UTF-8&quot;);<br />
System.out.println(str2);<br />
åœ¨è°ƒç”¨æ— å‚æ•° getBytes() æ–¹æ³•æ—¶ï¼Œé»˜è®¤çš„ç¼–ç æ–¹å¼ä¸æ˜¯ UTF-16beã€‚åŒå­—èŠ‚ç¼–ç çš„å¥½å¤„æ˜¯å¯ä»¥ä½¿ç”¨ä¸€ä¸ª char å­˜å‚¨ä¸­æ–‡å’Œè‹±æ–‡ï¼Œè€Œå°† String è½¬ä¸º bytes[] å­—èŠ‚æ•°ç»„å°±ä¸å†éœ€è¦è¿™ä¸ªå¥½å¤„ï¼Œå› æ­¤ä¹Ÿå°±ä¸å†éœ€è¦åŒå­—èŠ‚ç¼–ç ã€‚getBytes() çš„é»˜è®¤ç¼–ç æ–¹å¼ä¸å¹³å°æœ‰å…³ï¼Œä¸€èˆ¬ä¸º UTF-8ã€‚</p>
<p>byte[] bytes = str1.getBytes();</p>
<h2 id="%E5%AF%B9%E8%B1%A1%E6%93%8D%E4%BD%9C" id="å¯¹è±¡æ“ä½œ">å¯¹è±¡æ“ä½œ</h2>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">- åºåˆ—åŒ–æ˜¯æŒ‡æŠŠä¸€ä¸ªJavaå¯¹è±¡å˜æˆäºŒè¿›åˆ¶å†…å®¹ï¼Œæœ¬è´¨ä¸Šå°±æ˜¯ä¸€ä¸ªbyte[]æ•°ç»„,åºåˆ—åŒ–åå¯ä»¥æŠŠbyte[]ä¿å­˜åˆ°æ–‡ä»¶ä¸­ï¼Œæˆ–è€…æŠŠbyte[]é€šè¿‡ç½‘ç»œä¼ è¾“åˆ°è¿œç¨‹ï¼Œè¿™æ ·ï¼Œå°±ç›¸å½“äºæŠŠJavaå¯¹è±¡å­˜å‚¨åˆ°æ–‡ä»¶æˆ–è€…é€šè¿‡ç½‘ç»œä¼ è¾“å‡ºå»äº†</span><br><span class="line"></span><br><span class="line">  - ä¸€ä¸ªJavaå¯¹è±¡è¦èƒ½åºåˆ—åŒ–ï¼Œå¿…é¡»å®ç°ä¸€ä¸ªç‰¹æ®Šçš„java.io.Serializableæ¥å£</span><br><span class="line">  - æŠŠä¸€ä¸ªJavaå¯¹è±¡å˜ä¸ºbyte[]æ•°ç»„ï¼Œéœ€è¦ä½¿ç”¨ObjectOutputStreamã€‚å®ƒè´Ÿè´£æŠŠä¸€ä¸ªJavaå¯¹è±¡å†™å…¥ä¸€ä¸ªå­—èŠ‚æµ</span><br><span class="line">  - public class Main &#123;</span><br><span class="line">    public static void main(String[] args) throws IOException &#123;</span><br><span class="line">      ByteArrayOutputStream buffer &#x3D; new ByteArrayOutputStream();</span><br><span class="line">      try (ObjectOutputStream output &#x3D; new ObjectOutputStream(buffer)) &#123;</span><br><span class="line">          &#x2F;&#x2F; å†™å…¥int:</span><br><span class="line">          output.writeInt(12345);</span><br><span class="line">          &#x2F;&#x2F; å†™å…¥String:</span><br><span class="line">          output.writeUTF(&quot;Hello&quot;);</span><br><span class="line">          &#x2F;&#x2F; å†™å…¥Object:</span><br><span class="line">          output.writeObject(Double.valueOf(123.456));</span><br><span class="line">      &#125;</span><br><span class="line">      System.out.println(Arrays.toString(buffer.toByteArray()));</span><br><span class="line">    &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">- ååºåˆ—åŒ–ï¼Œå³æŠŠä¸€ä¸ªäºŒè¿›åˆ¶å†…å®¹ï¼ˆä¹Ÿå°±æ˜¯byte[]æ•°ç»„ï¼‰å˜å›Javaå¯¹è±¡ã€‚æœ‰äº†ååºåˆ—åŒ–ï¼Œä¿å­˜åˆ°æ–‡ä»¶ä¸­çš„byte[]æ•°ç»„åˆå¯ä»¥â€œå˜å›â€Javaå¯¹è±¡ï¼Œæˆ–è€…ä»ç½‘ç»œä¸Šè¯»å–byte[]å¹¶æŠŠå®ƒâ€œå˜å›â€Javaå¯¹è±¡ã€‚</span><br><span class="line"></span><br><span class="line">  - ObjectInputStreamè´Ÿè´£ä»ä¸€ä¸ªå­—èŠ‚æµè¯»å–Javaå¯¹è±¡</span><br><span class="line">  - try (ObjectInputStream input &#x3D; new ObjectInputStream(...)) &#123;</span><br><span class="line">    int n &#x3D; input.readInt();</span><br><span class="line">    String s &#x3D; input.readUTF();</span><br><span class="line">    Double d &#x3D; (Double) input.readObject();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    - readObject()å¯èƒ½æŠ›å‡ºçš„å¼‚å¸¸æœ‰ï¼š</span><br><span class="line"></span><br><span class="line">ClassNotFoundExceptionï¼šæ²¡æœ‰æ‰¾åˆ°å¯¹åº”çš„Classï¼›</span><br><span class="line">InvalidClassExceptionï¼šClassä¸åŒ¹é…ã€‚</span><br><span class="line">- å®‰å…¨æ€§</span><br><span class="line"></span><br><span class="line">	- Javaçš„åºåˆ—åŒ–æœºåˆ¶ä»…é€‚ç”¨äºJavaï¼Œå¦‚æœéœ€è¦ä¸å…¶å®ƒè¯­è¨€äº¤æ¢æ•°æ®ï¼Œå¿…é¡»ä½¿ç”¨é€šç”¨çš„åºåˆ—åŒ–æ–¹æ³•ï¼Œä¾‹å¦‚JSONã€‚</span><br></pre></td></tr></table></figure>
<h2 id="%E7%BD%91%E7%BB%9C%E6%93%8D%E4%BD%9C" id="ç½‘ç»œæ“ä½œ">ç½‘ç»œæ“ä½œ</h2>
<h2 id="nio" id="NIO">NIO</h2>
<h3 id="%E6%B5%81%E4%B8%8E%E5%9D%97" id="æµä¸å—">æµä¸å—</h3>
<ul>
<li>I/O ä¸ NIO æœ€é‡è¦çš„<strong>åŒºåˆ«</strong>æ˜¯æ•°æ®æ‰“åŒ…å’Œä¼ è¾“çš„æ–¹å¼ï¼ŒI/O ä»¥<strong>æµ</strong>çš„æ–¹å¼å¤„ç†æ•°æ®ï¼Œè€Œ NIO ä»¥<strong>å—</strong>çš„æ–¹å¼å¤„ç†æ•°æ®ã€‚</li>
</ul>
<p>é¢å‘æµçš„ I/O ä¸€æ¬¡å¤„ç†ä¸€ä¸ªå­—èŠ‚æ•°æ®ï¼šä¸€ä¸ªè¾“å…¥æµäº§ç”Ÿä¸€ä¸ªå­—èŠ‚æ•°æ®ï¼Œä¸€ä¸ªè¾“å‡ºæµæ¶ˆè´¹ä¸€ä¸ªå­—èŠ‚æ•°æ®ã€‚ä¸ºæµå¼æ•°æ®åˆ›å»ºè¿‡æ»¤å™¨éå¸¸å®¹æ˜“ï¼Œé“¾æ¥å‡ ä¸ªè¿‡æ»¤å™¨ï¼Œä»¥ä¾¿æ¯ä¸ªè¿‡æ»¤å™¨åªè´Ÿè´£å¤æ‚å¤„ç†æœºåˆ¶çš„ä¸€éƒ¨åˆ†ã€‚ä¸åˆ©çš„ä¸€é¢æ˜¯ï¼Œé¢å‘æµçš„ I/O é€šå¸¸ç›¸å½“æ…¢ã€‚</p>
<p>é¢å‘å—çš„ I/O ä¸€æ¬¡å¤„ç†ä¸€ä¸ªæ•°æ®å—ï¼ŒæŒ‰å—å¤„ç†æ•°æ®æ¯”æŒ‰æµå¤„ç†æ•°æ®è¦å¿«å¾—å¤šã€‚ä½†æ˜¯é¢å‘å—çš„ I/O ç¼ºå°‘ä¸€äº›é¢å‘æµçš„ I/O æ‰€å…·æœ‰çš„ä¼˜é›…æ€§å’Œç®€å•æ€§ã€‚</p>
<p>I/O åŒ…å’Œ NIO å·²ç»å¾ˆå¥½åœ°é›†æˆäº†ï¼Œ<a target="_blank" rel="noopener" href="http://java.io">java.io</a>.* å·²ç»ä»¥ NIO ä¸ºåŸºç¡€é‡æ–°å®ç°äº†ï¼Œæ‰€ä»¥ç°åœ¨å®ƒå¯ä»¥åˆ©ç”¨ NIO çš„ä¸€äº›ç‰¹æ€§ã€‚ä¾‹å¦‚ï¼Œ<a target="_blank" rel="noopener" href="http://java.io">java.io</a>.* åŒ…ä¸­çš„ä¸€äº›ç±»åŒ…å«ä»¥å—çš„å½¢å¼è¯»å†™æ•°æ®çš„æ–¹æ³•ï¼Œè¿™ä½¿å¾—å³ä½¿åœ¨é¢å‘æµçš„ç³»ç»Ÿä¸­ï¼Œå¤„ç†é€Ÿåº¦ä¹Ÿä¼šæ›´å¿«ã€‚</p>
<h3 id="%E9%80%9A%E9%81%93%E4%B8%8E%E7%BC%93%E5%86%B2%E5%8C%BA" id="é€šé“ä¸ç¼“å†²åŒº">é€šé“ä¸ç¼“å†²åŒº</h3>
<h4 id="%E9%80%9A%E9%81%93" id="é€šé“">é€šé“</h4>
<p>é€šé“ Channel æ˜¯å¯¹åŸ I/O åŒ…ä¸­çš„æµçš„æ¨¡æ‹Ÿï¼Œå¯ä»¥é€šè¿‡å®ƒè¯»å–å’Œå†™å…¥æ•°æ®ã€‚</p>
<p>é€šé“ä¸æµçš„ä¸åŒä¹‹å¤„åœ¨äºï¼Œæµåªèƒ½åœ¨ä¸€ä¸ªæ–¹å‘ä¸Šç§»åŠ¨(ä¸€ä¸ªæµå¿…é¡»æ˜¯ InputStream æˆ–è€… OutputStream çš„å­ç±»)ï¼Œè€Œé€šé“æ˜¯åŒå‘çš„ï¼Œå¯ä»¥ç”¨äºè¯»ã€å†™æˆ–è€…åŒæ—¶ç”¨äºè¯»å†™ã€‚</p>
<p>é€šé“åŒ…æ‹¬ä»¥ä¸‹ç±»å‹ï¼š<br />
FileChannelï¼šä»æ–‡ä»¶ä¸­è¯»å†™æ•°æ®ï¼›<br />
DatagramChannelï¼šé€šè¿‡ UDP è¯»å†™ç½‘ç»œä¸­æ•°æ®ï¼›<br />
SocketChannelï¼šé€šè¿‡ TCP è¯»å†™ç½‘ç»œä¸­æ•°æ®ï¼›<br />
ServerSocketChannelï¼šå¯ä»¥ç›‘å¬æ–°è¿›æ¥çš„ TCP è¿æ¥ï¼Œå¯¹æ¯ä¸€ä¸ªæ–°è¿›æ¥çš„è¿æ¥éƒ½ä¼šåˆ›å»ºä¸€ä¸ª SocketChannel,æœ¬èº«å¹¶ä¸ä¼ æ•°æ®ã€‚</p>
<h5 id="filechannel" id="FileChannel">FileChannel</h5>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> pers.lxl.mylearnproject.javase.io.nio.channel;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.io.RandomAccessFile;</span><br><span class="line"><span class="keyword">import</span> java.nio.ByteBuffer;</span><br><span class="line"><span class="keyword">import</span> java.nio.channels.FileChannel;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">FileChannelDemo</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        <span class="comment">// è¯»</span></span><br><span class="line"><span class="comment">//        éœ€è¦é€šè¿‡ä½¿ç”¨ä¸€ä¸ªInputStreamã€OutputStreamæˆ–RandomAccessFileæ¥è·å–ä¸€ä¸ªFileChannelå®ä¾‹</span></span><br><span class="line">        RandomAccessFile aFile = <span class="keyword">new</span> RandomAccessFile(<span class="string">&quot;src/main/resources/fileTest.txt&quot;</span>, <span class="string">&quot;rw&quot;</span>);</span><br><span class="line">        FileChannel inChannel = aFile.getChannel();</span><br><span class="line">        ByteBuffer buf = ByteBuffer.allocate(<span class="number">48</span>);</span><br><span class="line"><span class="comment">//        è·å–å½“å‰é€šé“ä½ç½®</span></span><br><span class="line">        <span class="keyword">long</span> pos = inChannel.position();</span><br><span class="line"><span class="comment">//        è®¾ç½®å½“å‰é€šé“ä½ç½®</span></span><br><span class="line">        inChannel.position(pos + <span class="number">6</span>);</span><br><span class="line"><span class="comment">//        è¿”å›é€šé“å½“å‰å¤§å°</span></span><br><span class="line">        System.out.println(<span class="string">&quot;æ­¤æ—¶é€šé“å¤§å°ï¼š&quot;</span>+inChannel.size());</span><br><span class="line"><span class="comment">//        æˆªå–(åˆ é™¤)æ–‡ä»¶7å­—èŠ‚åéƒ¨åˆ†</span></span><br><span class="line">        inChannel.truncate(<span class="number">7</span>);</span><br><span class="line">        <span class="keyword">int</span> bytesRead = inChannel.read(buf);</span><br><span class="line">        <span class="keyword">while</span> (bytesRead != -<span class="number">1</span>) &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;è¯»å–ï¼š &quot;</span> + bytesRead);</span><br><span class="line">            buf.flip();</span><br><span class="line">            <span class="keyword">while</span> (buf.hasRemaining()) &#123;</span><br><span class="line">                System.out.print((<span class="keyword">char</span>) buf.get());</span><br><span class="line">            &#125;</span><br><span class="line">            buf.clear();</span><br><span class="line">            bytesRead = inChannel.read(buf);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//å¼ºåˆ¶å°†é€šé“é‡Œçš„å‰©ä½™æ•°æ®å†™åˆ°ç£ç›˜ä¸­</span></span><br><span class="line">        inChannel.force(<span class="keyword">true</span>);</span><br><span class="line">        aFile.close();</span><br><span class="line">        System.out.println(<span class="string">&quot;æ“ä½œç»“æŸ&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//è¦†ç›–èµ·å§‹ä½ç½®å¼€å§‹çš„å¯¹åº”ä½ç½® å†™</span></span><br><span class="line">        RandomAccessFile aFile1 = <span class="keyword">new</span> RandomAccessFile(<span class="string">&quot;src/main/resources/fileTest.txt&quot;</span>, <span class="string">&quot;rw&quot;</span>);</span><br><span class="line">        String newData = <span class="string">&quot;New String to write to file...&quot;</span> + System.currentTimeMillis();</span><br><span class="line">        ByteBuffer buf1 = ByteBuffer.allocate(<span class="number">48</span>);</span><br><span class="line">        FileChannel inChannel1 = aFile1.getChannel();</span><br><span class="line">        buf1.clear();</span><br><span class="line">        buf1.put(newData.getBytes());</span><br><span class="line">        buf1.flip();</span><br><span class="line">        <span class="keyword">while</span> (buf1.hasRemaining()) &#123;</span><br><span class="line">            inChannel1.write(buf1);</span><br><span class="line">        &#125;</span><br><span class="line">        inChannel1.close();</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        RandomAccessFile aaFile = <span class="keyword">new</span> RandomAccessFile(<span class="string">&quot;src/main/resources/fileTest.txt&quot;</span>, <span class="string">&quot;rw&quot;</span>);</span><br><span class="line">        FileChannel fromChannel = aaFile.getChannel();</span><br><span class="line">        RandomAccessFile bbFile = <span class="keyword">new</span> RandomAccessFile(<span class="string">&quot;src/main/resources/transferFrom.txt&quot;</span>, <span class="string">&quot;rw&quot;</span>);</span><br><span class="line">        FileChannel toChannel = bbFile.getChannel();</span><br><span class="line">        <span class="keyword">long</span> position = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">long</span> count = fromChannel.size();</span><br><span class="line">        <span class="comment">//        fromChannel to toChannel</span></span><br><span class="line">        toChannel.transferFrom(fromChannel, position, count);</span><br><span class="line">        <span class="comment">//        fromChannel to toChannel</span></span><br><span class="line">        fromChannel.transferTo(position, count, toChannel);</span><br><span class="line">        aaFile.close();</span><br><span class="line">        bbFile.close();</span><br><span class="line">        System.out.println(<span class="string">&quot;é€šé“ä¼ è¾“over!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="serversocketchannel" id="ServerSocketChannel">ServerSocketChannel</h5>
<p>ï¼ˆ1ï¼‰æ–°çš„socketé€šé“ç±»å¯ä»¥è¿è¡Œéé˜»å¡æ¨¡å¼å¹¶ä¸”æ˜¯å¯é€‰æ‹©çš„ï¼Œå¯ä»¥æ¿€æ´»å¤§ç¨‹åºï¼ˆå¦‚ç½‘ç»œæœåŠ¡å™¨å’Œä¸­é—´ä»¶ç»„ä»¶ï¼‰å·¨å¤§çš„å¯ä¼¸ç¼©æ€§å’Œçµæ´»æ€§ã€‚æœ¬èŠ‚ä¸­æˆ‘ä»¬ä¼šçœ‹åˆ°ï¼Œå†ä¹Ÿæ²¡æœ‰ä¸ºæ¯ä¸ªsocketè¿æ¥ä½¿ç”¨ä¸€ä¸ªçº¿ç¨‹çš„å¿…è¦äº†ï¼Œä¹Ÿé¿å…äº†ç®¡ç†å¤§é‡çº¿ç¨‹æ‰€éœ€çš„ä¸Šä¸‹æ–‡äº¤æ¢å¼€é”€ã€‚å€ŸåŠ©æ–°çš„NIOç±»ï¼Œä¸€ä¸ªæˆ–å‡ ä¸ªçº¿ç¨‹å°±å¯ä»¥ç®¡ç†æˆç™¾ä¸Šåƒçš„æ´»åŠ¨socketè¿æ¥äº†å¹¶ä¸”åªæœ‰å¾ˆå°‘ç”šè‡³å¯èƒ½æ²¡æœ‰æ€§èƒ½æŸå¤±ã€‚æ‰€æœ‰çš„socketé€šé“ç±»(DatagramChannelã€SocketChannelå’ŒServerSocketChannel)éƒ½ç»§æ‰¿äº†ä½äºjava.nio.channels.spiåŒ…ä¸­çš„AbstractSelectableChannelã€‚è¿™æ„å‘³ç€æˆ‘ä»¬å¯ä»¥ç”¨ä¸€ä¸ªSelectorå¯¹è±¡æ¥æ‰§è¡Œsocketé€šé“çš„å°±ç»ªé€‰æ‹©ï¼ˆreadiness selectionï¼‰ã€‚<br />
ï¼ˆ2ï¼‰è¯·æ³¨æ„DatagramChannelå’ŒSocketChannelå®ç°å®šä¹‰è¯»å’Œå†™åŠŸèƒ½çš„æ¥å£è€ŒServerSocketChannelä¸å®ç°ã€‚ServerSocketChannelè´Ÿè´£ç›‘å¬ä¼ å…¥çš„è¿æ¥å’Œåˆ›å»ºæ–°çš„SocketChannelå¯¹è±¡ï¼Œå®ƒæœ¬èº«ä»ä¸ä¼ è¾“æ•°æ®ã€‚<br />
ï¼ˆ3ï¼‰åœ¨æˆ‘ä»¬å…·ä½“è®¨è®ºæ¯ä¸€ç§socketé€šé“å‰ï¼Œæ‚¨åº”è¯¥äº†è§£socketå’Œsocketé€šé“ä¹‹é—´çš„å…³ç³»ã€‚é€šé“æ˜¯ä¸€ä¸ªè¿æ¥I/OæœåŠ¡å¯¼ç®¡å¹¶æä¾›ä¸è¯¥æœåŠ¡äº¤äº’çš„æ–¹æ³•ã€‚å°±æŸä¸ªsocketè€Œè¨€ï¼Œå®ƒä¸ä¼šå†æ¬¡å®ç°ä¸ä¹‹å¯¹åº”çš„socketé€šé“ç±»ä¸­çš„socketåè®®APIï¼Œè€Œjava.netä¸­å·²ç»å­˜åœ¨çš„socketé€šé“éƒ½å¯ä»¥è¢«å¤§å¤šæ•°åè®®æ“ä½œé‡å¤ä½¿ç”¨ã€‚<br />
å…¨éƒ¨socketé€šé“ç±»ï¼ˆDatagramChannelã€SocketChannelå’ŒServerSocketChannelï¼‰åœ¨è¢«å®ä¾‹åŒ–æ—¶éƒ½ä¼šåˆ›å»ºä¸€ä¸ªå¯¹ç­‰socketå¯¹è±¡ã€‚è¿™äº›æ˜¯æˆ‘ä»¬æ‰€ç†Ÿæ‚‰çš„æ¥è‡ªjava.netçš„ç±»ï¼ˆSocketã€ServerSocketå’ŒDatagramSocketï¼‰ï¼Œå®ƒä»¬å·²ç»è¢«æ›´æ–°ä»¥è¯†åˆ«é€šé“ã€‚å¯¹ç­‰socketå¯ä»¥é€šè¿‡è°ƒç”¨socket( )æ–¹æ³•ä»ä¸€ä¸ªé€šé“ä¸Šè·å–ã€‚æ­¤å¤–ï¼Œè¿™ä¸‰ä¸ªjava.netç±»ç°åœ¨éƒ½æœ‰getChannel( )æ–¹æ³•ã€‚<br />
ï¼ˆ4ï¼‰è¦æŠŠä¸€ä¸ªsocketé€šé“ç½®äºéé˜»å¡æ¨¡å¼ï¼Œæˆ‘ä»¬è¦ä¾é æ‰€æœ‰socketé€šé“ç±»çš„å…¬æœ‰è¶…çº§ç±»ï¼šSelectableChannelã€‚å°±ç»ªé€‰æ‹©ï¼ˆreadiness selectionï¼‰æ˜¯ä¸€ç§å¯ä»¥ç”¨æ¥æŸ¥è¯¢é€šé“çš„æœºåˆ¶ï¼Œè¯¥æŸ¥è¯¢å¯ä»¥åˆ¤æ–­é€šé“æ˜¯å¦å‡†å¤‡å¥½æ‰§è¡Œä¸€ä¸ªç›®æ ‡æ“ä½œï¼Œå¦‚è¯»æˆ–å†™ã€‚éé˜»å¡I/Oå’Œå¯é€‰æ‹©æ€§æ˜¯ç´§å¯†ç›¸è¿çš„ï¼Œé‚£ä¹Ÿæ­£æ˜¯ç®¡ç†é˜»å¡æ¨¡å¼çš„APIä»£ç è¦åœ¨SelectableChannelè¶…çº§ç±»ä¸­å®šä¹‰çš„åŸå› ã€‚<br />
è®¾ç½®æˆ–é‡æ–°è®¾ç½®ä¸€ä¸ªé€šé“çš„é˜»å¡æ¨¡å¼æ˜¯å¾ˆç®€å•çš„ï¼Œåªè¦è°ƒç”¨configureBlocking( )æ–¹æ³•å³å¯ï¼Œä¼ é€’å‚æ•°å€¼ä¸ºtrueåˆ™è®¾ä¸ºé˜»å¡æ¨¡å¼ï¼Œå‚æ•°å€¼ä¸ºfalseå€¼è®¾ä¸ºéé˜»å¡æ¨¡å¼ã€‚å¯ä»¥é€šè¿‡è°ƒç”¨isBlocking( )æ–¹æ³•æ¥åˆ¤æ–­æŸä¸ªsocketé€šé“å½“å‰å¤„äºå“ªç§æ¨¡å¼ã€‚</p>
<p>â€‹		éé˜»å¡socketé€šå¸¸è¢«è®¤ä¸ºæ˜¯æœåŠ¡ç«¯ä½¿ç”¨çš„ï¼Œå› ä¸ºå®ƒä»¬ä½¿åŒæ—¶ç®¡ç†å¾ˆå¤šsocketé€šé“å˜å¾—æ›´å®¹æ˜“ã€‚ä½†æ˜¯ï¼Œåœ¨å®¢æˆ·ç«¯ä½¿ç”¨ä¸€ä¸ªæˆ–å‡ ä¸ªéé˜»å¡æ¨¡å¼çš„socketé€šé“ä¹Ÿæ˜¯æœ‰ç›Šå¤„çš„ï¼Œä¾‹å¦‚ï¼Œå€ŸåŠ©éé˜»å¡socketé€šé“ï¼ŒGUIç¨‹åºå¯ä»¥ä¸“æ³¨äºç”¨æˆ·è¯·æ±‚å¹¶ä¸”åŒæ—¶ç»´æŠ¤ä¸ä¸€ä¸ªæˆ–å¤šä¸ªæœåŠ¡å™¨çš„ä¼šè¯ã€‚åœ¨å¾ˆå¤šç¨‹åºä¸Šï¼Œéé˜»å¡æ¨¡å¼éƒ½æ˜¯æœ‰ç”¨çš„ã€‚ å¶å°”åœ°ï¼Œæˆ‘ä»¬ä¹Ÿä¼šéœ€è¦é˜²æ­¢socketé€šé“çš„é˜»å¡æ¨¡å¼è¢«æ›´æ”¹ã€‚APIä¸­æœ‰ä¸€ä¸ªblockingLock( )æ–¹æ³•ï¼Œè¯¥æ–¹æ³•ä¼šè¿”å›ä¸€ä¸ªéé€æ˜çš„å¯¹è±¡å¼•ç”¨ã€‚è¿”å›çš„å¯¹è±¡æ˜¯é€šé“å®ç°ä¿®æ”¹é˜»å¡æ¨¡å¼æ—¶å†…éƒ¨ä½¿ç”¨çš„ã€‚åªæœ‰æ‹¥æœ‰æ­¤å¯¹è±¡çš„é”çš„çº¿ç¨‹æ‰èƒ½æ›´æ”¹é€šé“çš„é˜»å¡æ¨¡å¼ã€‚</p>
<p>â€‹		ServerSocketChannelæ˜¯ä¸€ä¸ªåŸºäºé€šé“çš„socketç›‘å¬å™¨ã€‚å®ƒåŒæˆ‘ä»¬æ‰€ç†Ÿæ‚‰çš„java.net.ServerSocketæ‰§è¡Œç›¸åŒçš„ä»»åŠ¡ï¼Œä¸è¿‡å®ƒå¢åŠ äº†é€šé“è¯­ä¹‰ï¼Œå› æ­¤èƒ½å¤Ÿåœ¨éé˜»å¡æ¨¡å¼ä¸‹è¿è¡Œã€‚<br />
â€‹		ç”±äºServerSocketChannelæ²¡æœ‰bind()æ–¹æ³•ï¼Œå› æ­¤æœ‰å¿…è¦å–å‡ºå¯¹ç­‰çš„socketå¹¶ä½¿ç”¨å®ƒæ¥ç»‘å®šåˆ°ä¸€ä¸ªç«¯å£ä»¥å¼€å§‹ç›‘å¬è¿æ¥ã€‚æˆ‘ä»¬ä¹Ÿæ˜¯ä½¿ç”¨å¯¹ç­‰ServerSocketçš„APIæ¥æ ¹æ®éœ€è¦è®¾ç½®å…¶ä»–çš„socketé€‰é¡¹ã€‚<br />
â€‹		åŒjava.net.ServerSocketä¸€æ ·ï¼ŒServerSocketChannelä¹Ÿæœ‰accept( )æ–¹æ³•ã€‚ä¸€æ—¦åˆ›å»ºäº†ä¸€ä¸ªServerSocketChannelå¹¶ç”¨å¯¹ç­‰socketç»‘å®šäº†å®ƒï¼Œç„¶åæ‚¨å°±å¯ä»¥åœ¨å…¶ä¸­ä¸€ä¸ªä¸Šè°ƒç”¨accept()ã€‚å¦‚æœæ‚¨é€‰æ‹©åœ¨ServerSocketä¸Šè°ƒç”¨accept( )æ–¹æ³•ï¼Œé‚£ä¹ˆå®ƒä¼šåŒä»»ä½•å…¶ä»–çš„ServerSocketè¡¨ç°ä¸€æ ·çš„è¡Œä¸ºï¼šæ€»æ˜¯é˜»å¡å¹¶è¿”å›ä¸€ä¸ªjava.net.Socketå¯¹è±¡ã€‚å¦‚æœæ‚¨é€‰æ‹©åœ¨ServerSocketChannelä¸Šè°ƒç”¨accept( )æ–¹æ³•åˆ™ä¼šè¿”å›SocketChannelç±»å‹çš„å¯¹è±¡ï¼Œè¿”å›çš„å¯¹è±¡èƒ½å¤Ÿåœ¨éé˜»å¡æ¨¡å¼ä¸‹è¿è¡Œã€‚<br />
æ¢å¥è¯è¯´ï¼š<br />
â€‹		ServerSocketChannelçš„accept()æ–¹æ³•ä¼šè¿”å›SocketChannelç±»å‹å¯¹è±¡ï¼ŒSocketChannelå¯ä»¥åœ¨éé˜»å¡æ¨¡å¼ä¸‹è¿è¡Œã€‚å…¶å®ƒSocketçš„accept()æ–¹æ³•ä¼šé˜»å¡è¿”å›ä¸€ä¸ªSocketå¯¹è±¡ã€‚å¦‚æœServerSocketChannelä»¥éé˜»å¡æ¨¡å¼è¢«è°ƒç”¨ï¼Œå½“æ²¡æœ‰ä¼ å…¥è¿æ¥åœ¨ç­‰å¾…æ—¶ï¼ŒServerSocketChannel.accept( )ä¼šç«‹å³è¿”å›nullã€‚æ­£æ˜¯è¿™ç§æ£€æŸ¥è¿æ¥è€Œä¸é˜»å¡çš„èƒ½åŠ›å®ç°äº†å¯ä¼¸ç¼©æ€§å¹¶é™ä½äº†å¤æ‚æ€§ã€‚å¯é€‰æ‹©æ€§ä¹Ÿå› æ­¤å¾—åˆ°å®ç°ã€‚æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä¸€ä¸ªé€‰æ‹©å™¨å®ä¾‹æ¥æ³¨å†ŒServerSocketChannelå¯¹è±¡ä»¥å®ç°æ–°è¿æ¥åˆ°è¾¾æ—¶è‡ªåŠ¨é€šçŸ¥çš„åŠŸèƒ½ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.net.InetSocketAddress;</span><br><span class="line"><span class="keyword">import</span> java.nio.ByteBuffer;</span><br><span class="line"><span class="keyword">import</span> java.nio.channels.ServerSocketChannel;</span><br><span class="line"><span class="keyword">import</span> java.nio.channels.SocketChannel;</span><br><span class="line"><span class="comment">//http://localhost:1234/</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ServerSocketChannelDemo</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String GREETING = <span class="string">&quot;Hello java nio.\r\n&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] argv)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> port = <span class="number">1234</span>; <span class="comment">// default</span></span><br><span class="line">        <span class="keyword">if</span> (argv.length &gt; <span class="number">0</span>) &#123;</span><br><span class="line">            port = Integer.parseInt(argv[<span class="number">0</span>]);</span><br><span class="line">        &#125;</span><br><span class="line">        ByteBuffer buffer = ByteBuffer.wrap(GREETING.getBytes());</span><br><span class="line"><span class="comment">//        æ‰“å¼€</span></span><br><span class="line">        ServerSocketChannel ssc = ServerSocketChannel.open();</span><br><span class="line">        ssc.socket().bind(<span class="keyword">new</span> InetSocketAddress(port));</span><br><span class="line">        ssc.configureBlocking(<span class="keyword">false</span>);</span><br><span class="line">        <span class="keyword">while</span> (<span class="keyword">true</span>) &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;Waiting for connections&quot;</span>);</span><br><span class="line"><span class="comment">//            ç›‘å¬æ–°çš„é“¾æ¥ï¼Œé˜»å¡ä¼šåœ¨æ­¤é˜»å¡ä½è¿›ç¨‹éé˜»å¡ä¼šè¿”å›null</span></span><br><span class="line">            SocketChannel sc = ssc.accept();</span><br><span class="line">            <span class="keyword">if</span> (sc == <span class="keyword">null</span>) &#123;</span><br><span class="line">                System.out.println(<span class="string">&quot;null&quot;</span>);</span><br><span class="line">                Thread.sleep(<span class="number">2000</span>);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                System.out.println(<span class="string">&quot;Incoming connection from: &quot;</span> + sc.socket().getRemoteSocketAddress());</span><br><span class="line"><span class="comment">//                æŒ‡é’ˆæŒ‡å‘0</span></span><br><span class="line">                buffer.rewind();</span><br><span class="line">                sc.write(buffer);</span><br><span class="line"><span class="comment">//                å…³é—­</span></span><br><span class="line">                sc.close();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="socketchannel" id="SocketChannel">SocketChannel</h5>
<p>â€‹		Java NIOä¸­çš„SocketChannelæ˜¯ä¸€ä¸ªè¿æ¥åˆ°TCPç½‘ç»œå¥—æ¥å­—çš„é€šé“ã€‚ A selectable channel for stream-oriented connecting sockets. ä»¥ä¸Šæ˜¯Java docsä¸­å¯¹äºSocketChannelçš„æè¿°ï¼šSocketChannelæ˜¯ä¸€ç§é¢å‘æµè¿æ¥socketså¥—æ¥å­—çš„å¯é€‰æ‹©é€šé“ã€‚ä»è¿™é‡Œå¯ä»¥çœ‹å‡ºï¼š<br />
â€‹	â€¢ SocketChannelæ˜¯ç”¨æ¥è¿æ¥Socketå¥—æ¥å­—<br />
â€‹	â€¢SocketChannelä¸»è¦ç”¨é€”ç”¨æ¥å¤„ç†ç½‘ç»œI/Oçš„é€šé“<br />
â€‹	â€¢ SocketChannelæ˜¯åŸºäºTCPè¿æ¥ä¼ è¾“<br />
â€‹	â€¢ SocketChannelå®ç°äº†å¯é€‰æ‹©é€šé“ï¼Œå¯ä»¥è¢«å¤šè·¯å¤ç”¨çš„<br />
â€‹		ç‰¹å¾ï¼š<br />
ï¼ˆ1ï¼‰å¯¹äºå·²ç»å­˜åœ¨çš„socketä¸èƒ½åˆ›å»ºSocketChannel<br />
ï¼ˆ2ï¼‰SocketChannelä¸­æä¾›çš„openæ¥å£åˆ›å»ºçš„Channelå¹¶æ²¡æœ‰è¿›è¡Œç½‘ç»œçº§è”ï¼Œéœ€è¦ä½¿ç”¨connectæ¥å£è¿æ¥åˆ°æŒ‡å®šåœ°å€<br />
ï¼ˆ3ï¼‰æœªè¿›è¡Œè¿æ¥çš„SocketChannleæ‰§è¡ŒI/Oæ“ä½œæ—¶ï¼Œä¼šæŠ›å‡ºNotYetConnectedException<br />
ï¼ˆ4ï¼‰SocketChannelæ”¯æŒä¸¤ç§I/Oæ¨¡å¼ï¼šé˜»å¡å¼å’Œéé˜»å¡å¼<br />
ï¼ˆ5ï¼‰SocketChannelæ”¯æŒå¼‚æ­¥å…³é—­ã€‚å¦‚æœSocketChannelåœ¨ä¸€ä¸ªçº¿ç¨‹ä¸Šreadé˜»å¡ï¼Œå¦ä¸€ä¸ªçº¿ç¨‹å¯¹è¯¥SocketChannelè°ƒç”¨shutdownInputï¼Œåˆ™è¯»é˜»å¡çš„çº¿ç¨‹å°†è¿”å›-1è¡¨ç¤ºæ²¡æœ‰è¯»å–ä»»ä½•æ•°æ®ï¼›å¦‚æœSocketChannelåœ¨ä¸€ä¸ªçº¿ç¨‹ä¸Šwriteé˜»å¡ï¼Œå¦ä¸€ä¸ªçº¿ç¨‹å¯¹è¯¥SocketChannelè°ƒç”¨shutdownWriteï¼Œåˆ™å†™é˜»å¡çš„çº¿ç¨‹å°†æŠ›å‡ºAsynchronousCloseException<br />
ï¼ˆ6ï¼‰SocketChannelæ”¯æŒè®¾å®šå‚æ•°<br />
â€‹	SO_SNDBUF å¥—æ¥å­—å‘é€ç¼“å†²åŒºå¤§å°<br />
â€‹	SO_RCVBUF å¥—æ¥å­—æ¥æ”¶ç¼“å†²åŒºå¤§å°<br />
â€‹	SO_KEEPALIVE ä¿æ´»è¿æ¥<br />
â€‹	O_REUSEADDR å¤ç”¨åœ°å€<br />
â€‹	SO_LINGER æœ‰æ•°æ®ä¼ è¾“æ—¶å»¶ç¼“å…³é—­Channel (åªæœ‰åœ¨éé˜»å¡æ¨¡å¼ä¸‹æœ‰ç”¨)<br />
â€‹	TCP_NODELAY ç¦ç”¨Nagleç®—æ³•</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> pers.lxl.mylearnproject.javase.io.nio.channel;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.net.InetSocketAddress;</span><br><span class="line"><span class="keyword">import</span> java.net.StandardSocketOptions;</span><br><span class="line"><span class="keyword">import</span> java.nio.ByteBuffer;</span><br><span class="line"><span class="keyword">import</span> java.nio.channels.SocketChannel;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SocketChannelDemo</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        SocketChannel socketChannel = SocketChannel.open(<span class="keyword">new</span> InetSocketAddress(<span class="string">&quot;www.baidu.com&quot;</span>, <span class="number">80</span>));</span><br><span class="line"></span><br><span class="line">        SocketChannel socketChanne2 = SocketChannel.open();</span><br><span class="line">        socketChanne2.connect(<span class="keyword">new</span> InetSocketAddress(<span class="string">&quot;www.baidu.com&quot;</span>, <span class="number">80</span>));</span><br><span class="line"><span class="comment">//        è¿æ¥æ ¡éªŒ</span></span><br><span class="line">        socketChannel.isOpen(); <span class="comment">// æµ‹è¯•SocketChannelæ˜¯å¦ä¸ºopençŠ¶æ€</span></span><br><span class="line">        socketChannel.isConnected(); <span class="comment">//æµ‹è¯•SocketChannelæ˜¯å¦å·²ç»è¢«è¿æ¥</span></span><br><span class="line">        socketChannel.isConnectionPending(); <span class="comment">//æµ‹è¯•SocketChannelæ˜¯å¦æ­£åœ¨è¿›è¡Œè¿æ¥</span></span><br><span class="line">        socketChannel.finishConnect(); <span class="comment">//æ ¡éªŒæ­£åœ¨è¿›è¡Œå¥—æ¥å­—è¿æ¥çš„SocketChannelæ˜¯å¦å·²ç»å®Œæˆè¿æ¥</span></span><br><span class="line"><span class="comment">//        è¯»å†™æ¨¡å¼ å‰é¢æåˆ°SocketChannelæ”¯æŒé˜»å¡å’Œéé˜»å¡ä¸¤ç§æ¨¡å¼ï¼š</span></span><br><span class="line">        socketChannel.configureBlocking(<span class="keyword">false</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//        é€šè¿‡setOptionsæ–¹æ³•å¯ä»¥è®¾ç½®socketå¥—æ¥å­—çš„ç›¸å…³å‚æ•°</span></span><br><span class="line">        socketChannel.setOption(StandardSocketOptions.SO_KEEPALIVE, Boolean.TRUE).setOption(StandardSocketOptions.TCP_NODELAY, Boolean.TRUE);</span><br><span class="line"><span class="comment">//        å¯ä»¥é€šè¿‡getOptionè·å–ç›¸å…³å‚æ•°çš„å€¼ã€‚å¦‚é»˜è®¤çš„æ¥æ”¶ç¼“å†²åŒºå¤§å°æ˜¯8192byteã€‚</span></span><br><span class="line">        socketChannel.getOption(StandardSocketOptions.SO_KEEPALIVE);</span><br><span class="line">        socketChannel.getOption(StandardSocketOptions.SO_RCVBUF);</span><br><span class="line"><span class="comment">//        è¯»å†™</span></span><br><span class="line">        ByteBuffer byteBuffer = ByteBuffer.allocate(<span class="number">16</span>);</span><br><span class="line">        socketChannel.read(byteBuffer);</span><br><span class="line">        socketChannel.close();</span><br><span class="line">        System.out.println(<span class="string">&quot;read over&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="datagramchannel" id="DatagramChannel">DatagramChannel</h5>
<p>â€‹		æ­£å¦‚SocketChannelå¯¹åº”Socketï¼ŒServerSocketChannelå¯¹åº”ServerSocketï¼Œæ¯ä¸€ä¸ªDatagramChannelå¯¹è±¡ä¹Ÿæœ‰ä¸€ä¸ªå…³è”çš„DatagramSocketå¯¹è±¡ã€‚æ­£å¦‚SocketChannelæ¨¡æ‹Ÿè¿æ¥å¯¼å‘çš„æµåè®®ï¼ˆå¦‚TCP/IPï¼‰ï¼ŒDatagramChannelåˆ™æ¨¡æ‹ŸåŒ…å¯¼å‘çš„æ— è¿æ¥åè®®ï¼ˆå¦‚UDP/IPï¼‰ã€‚DatagramChannelæ˜¯æ— è¿æ¥çš„ï¼Œæ¯ä¸ªæ•°æ®æŠ¥ï¼ˆdatagramï¼‰éƒ½æ˜¯ä¸€ä¸ªè‡ªåŒ…å«çš„å®ä½“ï¼Œæ‹¥æœ‰å®ƒè‡ªå·±çš„ç›®çš„åœ°å€åŠä¸ä¾èµ–å…¶ä»–æ•°æ®æŠ¥çš„æ•°æ®è´Ÿè½½ã€‚ä¸é¢å‘æµçš„çš„socketä¸åŒï¼ŒDatagramChannelå¯ä»¥å‘é€å•ç‹¬çš„æ•°æ®æŠ¥ç»™ä¸åŒçš„ç›®çš„åœ°å€ã€‚åŒæ ·ï¼ŒDatagramChannelå¯¹è±¡ä¹Ÿå¯ä»¥æ¥æ”¶æ¥è‡ªä»»æ„åœ°å€çš„æ•°æ®åŒ…ã€‚æ¯ä¸ªåˆ°è¾¾çš„æ•°æ®æŠ¥éƒ½å«æœ‰å…³äºå®ƒæ¥è‡ªä½•å¤„çš„ä¿¡æ¯ï¼ˆæºåœ°å€ï¼‰ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.junit.jupiter.api.Test;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.net.InetSocketAddress;</span><br><span class="line"><span class="keyword">import</span> java.net.SocketAddress;</span><br><span class="line"><span class="keyword">import</span> java.nio.ByteBuffer;</span><br><span class="line"><span class="keyword">import</span> java.nio.channels.DatagramChannel;</span><br><span class="line"><span class="keyword">import</span> java.nio.charset.Charset;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DatagramChannelDemo</span> </span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å‘åŒ…çš„datagram * * <span class="doctag">@throws</span> IOException * <span class="doctag">@throws</span> InterruptedException</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">sendDatagram</span><span class="params">()</span> <span class="keyword">throws</span> IOException, InterruptedException </span>&#123;</span><br><span class="line">        DatagramChannel sendChannel = DatagramChannel.open();</span><br><span class="line">        InetSocketAddress sendAddress = <span class="keyword">new</span> InetSocketAddress(<span class="string">&quot;127.0.0.1&quot;</span>, <span class="number">9999</span>);</span><br><span class="line">        <span class="keyword">while</span> (<span class="keyword">true</span>) &#123;</span><br><span class="line"><span class="comment">//            å‘é€</span></span><br><span class="line">            sendChannel.send(ByteBuffer.wrap(<span class="string">&quot;å‘åŒ…&quot;</span>.getBytes(<span class="string">&quot;UTF-8&quot;</span>)), sendAddress);</span><br><span class="line">            System.out.println(<span class="string">&quot;å‘åŒ…ç«¯å‘åŒ…&quot;</span>);</span><br><span class="line">            Thread.sleep(<span class="number">1000</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ”¶åŒ…ç«¯ * * <span class="doctag">@throws</span> IOException</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">receive</span><span class="params">()</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        DatagramChannel receiveChannel = DatagramChannel.open();</span><br><span class="line">        <span class="comment">//æ‰“å¼€9999ç«¯å£æ¥æ”¶UDPæ•°æ®åŒ…</span></span><br><span class="line">        InetSocketAddress receiveAddress = <span class="keyword">new</span> InetSocketAddress(<span class="number">9999</span>);</span><br><span class="line">        receiveChannel.bind(receiveAddress);</span><br><span class="line">        ByteBuffer receiveBuffer = ByteBuffer.allocate(<span class="number">512</span>);</span><br><span class="line">        <span class="keyword">while</span> (<span class="keyword">true</span>) &#123;</span><br><span class="line">            receiveBuffer.clear();</span><br><span class="line"><span class="comment">//            æ¥æ”¶</span></span><br><span class="line">            SocketAddress sendAddress = receiveChannel.receive(receiveBuffer);</span><br><span class="line">            receiveBuffer.flip();</span><br><span class="line">            System.out.print(sendAddress.toString() + <span class="string">&quot; &quot;</span>);</span><br><span class="line">            System.out.println(Charset.forName(<span class="string">&quot;UTF-8&quot;</span>).decode(receiveBuffer));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * åªæ¥æ”¶å’Œå‘é€9999çš„æ•°æ®åŒ… * * <span class="doctag">@throws</span> IOException</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testConect1</span><span class="params">()</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        DatagramChannel connChannel = DatagramChannel.open();</span><br><span class="line">        connChannel.bind(<span class="keyword">new</span> InetSocketAddress(<span class="number">9999</span>));</span><br><span class="line">        <span class="comment">//UDPä¸å­˜åœ¨çœŸæ­£æ„ä¹‰ä¸Šçš„è¿æ¥ï¼Œè¿™é‡Œçš„è¿æ¥æ˜¯å‘ç‰¹å®šæœåŠ¡åœ°å€ç”¨readå’Œwriteæ¥æ”¶å‘é€æ•°æ®åŒ…ã€‚</span></span><br><span class="line">        connChannel.connect(<span class="keyword">new</span> InetSocketAddress(<span class="string">&quot;127.0.0.1&quot;</span>, <span class="number">9999</span>));</span><br><span class="line">        connChannel.write(ByteBuffer.wrap(<span class="string">&quot;å‘åŒ…&quot;</span>.getBytes(<span class="string">&quot;UTF-8&quot;</span>)));</span><br><span class="line">        ByteBuffer readBuffer = ByteBuffer.allocate(<span class="number">512</span>);</span><br><span class="line">        <span class="comment">//read()å’Œwrite()åªæœ‰åœ¨connect()åæ‰èƒ½ä½¿ç”¨ï¼Œä¸ç„¶ä¼šæŠ›NotYetConnectedExceptionå¼‚å¸¸ã€‚ç”¨read()æ¥æ”¶æ—¶ï¼Œå¦‚æœæ²¡æœ‰æ¥æ”¶åˆ°åŒ…ï¼Œä¼šæŠ›PortUnreachableExceptionå¼‚å¸¸ã€‚</span></span><br><span class="line">        <span class="keyword">while</span> (<span class="keyword">true</span>) &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                readBuffer.clear();</span><br><span class="line">                connChannel.read(readBuffer);</span><br><span class="line">                readBuffer.flip();</span><br><span class="line">                System.out.println(Charset.forName(<span class="string">&quot;UTF-8&quot;</span>).decode(readBuffer));</span><br><span class="line">            &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h5 id="scatter%2Fgather" id="Scatter-Gather">Scatter/Gather</h5>
<p>â€‹		Java NIOå¼€å§‹æ”¯æŒscatter/gatherï¼Œscatter/gatherç”¨äºæè¿°ä»Channelä¸­è¯»å–æˆ–è€…å†™å…¥åˆ°Channelçš„æ“ä½œã€‚<br />
â€‹		 **åˆ†æ•£ï¼ˆscatterï¼‰**ä»Channelä¸­è¯»å–æ˜¯æŒ‡åœ¨è¯»æ“ä½œæ—¶å°†è¯»å–çš„æ•°æ®å†™å…¥å¤šä¸ªbufferä¸­ã€‚å› æ­¤ï¼ŒChannelå°†ä»Channelä¸­è¯»å–çš„æ•°æ®â€œåˆ†æ•£ï¼ˆscatterï¼‰â€åˆ°å¤šä¸ªBufferä¸­ã€‚<br />
â€‹		 **èšé›†ï¼ˆgatherï¼‰**å†™å…¥Channelæ˜¯æŒ‡åœ¨å†™æ“ä½œæ—¶å°†å¤šä¸ªbufferçš„æ•°æ®å†™å…¥åŒä¸€ä¸ªChannelï¼Œå› æ­¤ï¼ŒChannel å°†å¤šä¸ªBufferä¸­çš„æ•°æ®â€œèšé›†ï¼ˆgatherï¼‰â€åå‘é€åˆ°Channelã€‚ scatter / gatherç»å¸¸ç”¨äºéœ€è¦å°†ä¼ è¾“çš„æ•°æ®åˆ†å¼€å¤„ç†çš„åœºåˆï¼Œä¾‹å¦‚ä¼ è¾“ä¸€ä¸ªç”±æ¶ˆæ¯å¤´å’Œæ¶ˆæ¯ä½“ç»„æˆçš„æ¶ˆæ¯ï¼Œä½ å¯èƒ½ä¼šå°†æ¶ˆæ¯ä½“å’Œæ¶ˆæ¯å¤´åˆ†æ•£åˆ°ä¸åŒçš„bufferä¸­ï¼Œè¿™æ ·ä½ å¯ä»¥æ–¹ä¾¿çš„å¤„ç†æ¶ˆæ¯å¤´å’Œæ¶ˆæ¯ä½“ã€‚</p>
<h6 id="scattering-reads" id="Scattering-Reads">Scattering Reads</h6>
<p>Scattering <strong>Reads</strong>æ˜¯æŒ‡æ•°æ®ä»ä¸€ä¸ªchannelè¯»å–åˆ°å¤šä¸ªbufferä¸­ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">ByteBuffer header = ByteBuffer.allocate(<span class="number">128</span>); </span><br><span class="line">ByteBuffer body = ByteBuffer.allocate(<span class="number">1024</span>); </span><br><span class="line">ByteBuffer[] bufferArray = &#123; header, body &#125;;</span><br><span class="line"> channel.read(bufferArray);</span><br></pre></td></tr></table></figure>
<p>â€‹		 æ³¨æ„bufferé¦–å…ˆè¢«æ’å…¥åˆ°æ•°ç»„ï¼Œç„¶åå†å°†æ•°ç»„ä½œä¸ºchannel.read() çš„è¾“å…¥å‚æ•°ã€‚read()æ–¹æ³•æŒ‰ç…§bufferåœ¨æ•°ç»„ä¸­çš„é¡ºåºå°†ä»channelä¸­è¯»å–çš„æ•°æ®å†™å…¥åˆ°bufferï¼Œå½“ä¸€ä¸ªbufferè¢«å†™æ»¡åï¼Œchannelç´§æ¥ç€å‘å¦ä¸€ä¸ªbufferä¸­å†™ã€‚ Scattering Readsåœ¨ç§»åŠ¨ä¸‹ä¸€ä¸ªbufferå‰ï¼Œå¿…é¡»å¡«æ»¡å½“å‰çš„bufferï¼Œè¿™ä¹Ÿæ„å‘³ç€å®ƒä¸é€‚ç”¨äºåŠ¨æ€æ¶ˆæ¯(è¯‘è€…æ³¨ï¼šæ¶ˆæ¯å¤§å°ä¸å›ºå®š)ã€‚æ¢å¥è¯è¯´ï¼Œå¦‚æœå­˜åœ¨æ¶ˆæ¯å¤´å’Œæ¶ˆæ¯ä½“ï¼Œæ¶ˆæ¯å¤´å¿…é¡»å®Œæˆå¡«å……ï¼ˆä¾‹å¦‚ 128byteï¼‰ï¼ŒScattering Readsæ‰èƒ½æ­£å¸¸å·¥ä½œã€‚</p>
<h6 id="gathering-writes" id="Gathering-Writes">Gathering Writes</h6>
<p>â€‹		Gathering <strong>Writes</strong>æ˜¯æŒ‡æ•°æ®ä»å¤šä¸ªbufferå†™å…¥åˆ°åŒä¸€ä¸ªchannelã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">ByteBuffer header = ByteBuffer.allocate(<span class="number">128</span>); </span><br><span class="line">ByteBuffer body = ByteBuffer.allocate(<span class="number">1024</span>); </span><br><span class="line"><span class="comment">//write data into buffers ByteBuffer[] bufferArray = &#123; header, body &#125;;</span></span><br><span class="line">channel.write(bufferArray);</span><br></pre></td></tr></table></figure>
<p>â€‹		buffersæ•°ç»„æ˜¯write()æ–¹æ³•çš„å…¥å‚ï¼Œwrite()æ–¹æ³•ä¼šæŒ‰ç…§bufferåœ¨æ•°ç»„ä¸­çš„é¡ºåºï¼Œå°†æ•°æ®å†™å…¥åˆ°channelï¼Œæ³¨æ„åªæœ‰positionå’Œlimitä¹‹é—´çš„æ•°æ®æ‰ä¼šè¢«å†™å…¥ã€‚å› æ­¤ï¼Œå¦‚æœä¸€ä¸ªbufferçš„å®¹é‡ä¸º128byteï¼Œä½†æ˜¯ä»…ä»…åŒ…å«58byteçš„æ•°æ®ï¼Œé‚£ä¹ˆè¿™58byteçš„æ•°æ®å°†è¢«å†™å…¥åˆ°channelä¸­ã€‚å› æ­¤ä¸Scattering Readsç›¸åï¼ŒGathering Writesèƒ½è¾ƒå¥½çš„å¤„ç†åŠ¨æ€æ¶ˆæ¯ã€‚</p>
<h4 id="%E7%BC%93%E5%86%B2%E5%8C%BA" id="ç¼“å†²åŒº">ç¼“å†²åŒº</h4>
<p>å‘é€ç»™<strong>ä¸€ä¸ªé€šé“çš„æ‰€æœ‰æ•°æ®éƒ½å¿…é¡»é¦–å…ˆæ”¾åˆ°ç¼“å†²åŒºä¸­</strong>ï¼ŒåŒæ ·åœ°ï¼Œä»é€šé“ä¸­è¯»å–çš„ä»»ä½•æ•°æ®éƒ½è¦å…ˆè¯»åˆ°ç¼“å†²åŒºä¸­ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œä¸ä¼šç›´æ¥å¯¹é€šé“è¿›è¡Œè¯»å†™æ•°æ®ï¼Œè€Œæ˜¯è¦å…ˆç»è¿‡ç¼“å†²åŒºã€‚</p>
<p><img src="https://gitee.com/mychimei/picture/raw/master/work/image-20220221192014358.png" alt="image-20220221192014358" /></p>
<p>ç¼“å†²åŒºå®è´¨ä¸Šæ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œä½†å®ƒä¸ä»…ä»…æ˜¯ä¸€ä¸ªæ•°ç»„ã€‚ç¼“å†²åŒºæä¾›äº†å¯¹æ•°æ®çš„ç»“æ„åŒ–è®¿é—®ï¼Œè€Œä¸”è¿˜å¯ä»¥è·Ÿè¸ªç³»ç»Ÿçš„è¯»/å†™è¿›ç¨‹ã€‚</p>
<p>â€‹		ç¼“å†²åŒºæœ¬è´¨ä¸Šæ˜¯ä¸€å—å¯ä»¥å†™å…¥æ•°æ®ï¼Œç„¶åå¯ä»¥ä»ä¸­è¯»å–æ•°æ®çš„å†…å­˜ã€‚è¿™å—å†…å­˜è¢«åŒ…è£…æˆNIO Bufferå¯¹è±¡ï¼Œå¹¶æä¾›äº†ä¸€ç»„æ–¹æ³•ï¼Œç”¨æ¥æ–¹ä¾¿çš„è®¿é—®è¯¥å—å†…å­˜ã€‚ç¼“å†²åŒºå®é™…ä¸Šæ˜¯ä¸€ä¸ªå®¹å™¨å¯¹è±¡ï¼Œæ›´ç›´æ¥çš„è¯´ï¼Œå…¶å®å°±æ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œåœ¨NIOåº“ä¸­ï¼Œæ‰€æœ‰æ•°æ®éƒ½æ˜¯ç”¨ç¼“å†²åŒºå¤„ç†çš„ã€‚åœ¨è¯»å–æ•°æ®æ—¶ï¼Œå®ƒæ˜¯ç›´æ¥è¯»åˆ°ç¼“å†²åŒºä¸­çš„ï¼› åœ¨å†™å…¥æ•°æ®æ—¶ï¼Œå®ƒä¹Ÿæ˜¯å†™å…¥åˆ°ç¼“å†²åŒºä¸­çš„ï¼›ä»»ä½•æ—¶å€™è®¿é—® NIO ä¸­çš„æ•°æ®ï¼Œéƒ½æ˜¯å°†å®ƒæ”¾åˆ°ç¼“å†²åŒºä¸­ã€‚è€Œåœ¨é¢å‘æµI/Oç³»ç»Ÿä¸­ï¼Œæ‰€æœ‰æ•°æ®éƒ½æ˜¯ç›´æ¥å†™å…¥æˆ–è€…ç›´æ¥å°†æ•°æ®è¯»å–åˆ°Streamå¯¹è±¡ä¸­ã€‚åœ¨NIOä¸­ï¼Œæ‰€æœ‰çš„ç¼“å†²åŒºç±»å‹éƒ½ç»§æ‰¿äºæŠ½è±¡ç±»Bufferï¼Œæœ€å¸¸ç”¨çš„å°±æ˜¯ByteBufferï¼Œå¯¹äºJavaä¸­çš„åŸºæœ¬ç±»å‹ï¼ŒåŸºæœ¬éƒ½æœ‰ä¸€ä¸ªå…·ä½“Bufferç±»å‹ä¸ä¹‹ç›¸å¯¹åº”ï¼Œå®ƒä»¬ä¹‹é—´çš„ç»§æ‰¿å…³ç³»å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p>
<p><img src="https://gitee.com/mychimei/picture/raw/master/work/image-20220221192137213.png" alt="image-20220221192137213" /></p>
<p>ç¼“å†²åŒºåŒ…æ‹¬ä»¥ä¸‹ç±»å‹ï¼š</p>
<p>ByteBuffer<br />
CharBuffer<br />
ShortBuffer<br />
IntBuffer<br />
LongBuffer<br />
FloatBuffer<br />
DoubleBuffer</p>
<ul>
<li>ç¼“å†²åŒºçŠ¶æ€å˜é‡</li>
</ul>
<p>capacityï¼šæœ€å¤§å®¹é‡ï¼›<br />
positionï¼šå½“å‰å·²ç»è¯»å†™çš„å­—èŠ‚æ•°ï¼›<br />
limitï¼šè¿˜å¯ä»¥è¯»å†™çš„å­—èŠ‚æ•°ã€‚</p>
<h5 id="buffer%E7%9A%84%E5%9F%BA%E6%9C%AC%E7%94%A8%E6%B3%95" id="Bufferçš„åŸºæœ¬ç”¨æ³•">Bufferçš„åŸºæœ¬ç”¨æ³•</h5>
<p>1ã€ä½¿ç”¨Bufferè¯»å†™æ•°æ®ï¼Œä¸€èˆ¬éµå¾ªä»¥ä¸‹å››ä¸ªæ­¥éª¤ï¼š<br />
ï¼ˆ1ï¼‰å†™å…¥æ•°æ®åˆ°Buffer<br />
ï¼ˆ2ï¼‰è°ƒç”¨flip()æ–¹æ³•<br />
ï¼ˆ3ï¼‰ä»Bufferä¸­è¯»å–æ•°æ®<br />
ï¼ˆ4ï¼‰è°ƒç”¨clear()æ–¹æ³•æˆ–è€…compact()æ–¹æ³•<br />
å½“å‘bufferå†™å…¥æ•°æ®æ—¶ï¼Œbufferä¼šè®°å½•ä¸‹å†™äº†å¤šå°‘æ•°æ®ã€‚ä¸€æ—¦è¦è¯»å–æ•°æ®ï¼Œéœ€è¦é€šè¿‡<strong>flip()æ–¹æ³•å°†Bufferä»å†™æ¨¡å¼åˆ‡æ¢åˆ°è¯»æ¨¡å¼</strong>ã€‚åœ¨è¯»æ¨¡å¼ä¸‹ï¼Œå¯ä»¥è¯»å–ä¹‹å‰å†™å…¥åˆ°bufferçš„æ‰€æœ‰æ•°æ®ã€‚ä¸€æ—¦è¯»å®Œäº†æ‰€æœ‰çš„æ•°æ®ï¼Œå°±éœ€è¦æ¸…ç©ºç¼“å†²åŒºï¼Œè®©å®ƒå¯ä»¥å†æ¬¡è¢«å†™å…¥ã€‚æœ‰ä¸¤ç§æ–¹å¼èƒ½æ¸…ç©ºç¼“å†²åŒºï¼šè°ƒç”¨clear()æˆ–compact()æ–¹æ³•ã€‚clear()æ–¹æ³•ä¼šæ¸…ç©ºæ•´ä¸ªç¼“å†²åŒºã€‚compact()æ–¹æ³•åªä¼šæ¸…é™¤å·²ç»è¯»è¿‡çš„æ•°æ®ã€‚ä»»ä½•æœªè¯»çš„æ•°æ®éƒ½è¢«ç§»åˆ°ç¼“å†²åŒºçš„èµ·å§‹å¤„ï¼Œæ–°å†™å…¥çš„æ•°æ®å°†æ”¾åˆ°ç¼“å†²åŒºæœªè¯»æ•°æ®çš„åé¢ã€‚</p>
<p>Bufferä¸IntBufferä¾‹å­</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> pers.lxl.mylearnproject.javase.io.nio.buffer;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.junit.jupiter.api.Test;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.io.RandomAccessFile;</span><br><span class="line"><span class="keyword">import</span> java.nio.ByteBuffer;</span><br><span class="line"><span class="keyword">import</span> java.nio.IntBuffer;</span><br><span class="line"><span class="keyword">import</span> java.nio.channels.FileChannel;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BufferDemo</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//ä½¿ç”¨Bufferçš„ä¾‹å­</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testConect2</span><span class="params">()</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        RandomAccessFile aFile = <span class="keyword">new</span> RandomAccessFile(<span class="string">&quot;src/main/resources/fileTest.txt&quot;</span>, <span class="string">&quot;rw&quot;</span>);</span><br><span class="line">        FileChannel inChannel = aFile.getChannel(); <span class="comment">//create buffer with capacity of 48 bytes</span></span><br><span class="line">        ByteBuffer buf = ByteBuffer.allocate(<span class="number">48</span>);</span><br><span class="line">        <span class="keyword">int</span> bytesRead = inChannel.read(buf); <span class="comment">//read into buffer.</span></span><br><span class="line">        <span class="keyword">while</span> (bytesRead != -<span class="number">1</span>) &#123;</span><br><span class="line">            buf.flip();</span><br><span class="line">            <span class="comment">//make buffer ready for read</span></span><br><span class="line">            <span class="keyword">while</span> (buf.hasRemaining()) &#123;</span><br><span class="line">                System.out.print((<span class="keyword">char</span>) buf.get());</span><br><span class="line">                <span class="comment">// read 1 byte at a time</span></span><br><span class="line">            &#125;</span><br><span class="line">            buf.clear();</span><br><span class="line">            <span class="comment">//make buffer ready for writing</span></span><br><span class="line">            bytesRead = inChannel.read(buf);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//ä½¿ç”¨IntBufferçš„ä¾‹å­</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testConect3</span><span class="params">()</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        <span class="comment">// åˆ†é…æ–°çš„intç¼“å†²åŒºï¼Œå‚æ•°ä¸ºç¼“å†²åŒºå®¹é‡</span></span><br><span class="line">        <span class="comment">// æ–°ç¼“å†²åŒºçš„å½“å‰ä½ç½®å°†ä¸ºé›¶ï¼Œå…¶ç•Œé™(é™åˆ¶ä½ç½®)å°†ä¸ºå…¶å®¹é‡ã€‚</span></span><br><span class="line">        <span class="comment">// å®ƒå°†å…·æœ‰ä¸€ä¸ªåº•å±‚å®ç°æ•°ç»„ï¼Œå…¶æ•°ç»„åç§»é‡å°†ä¸ºé›¶ã€‚</span></span><br><span class="line">        IntBuffer buffer = IntBuffer.allocate(<span class="number">8</span>);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; buffer.capacity(); ++i) &#123;</span><br><span class="line">            <span class="keyword">int</span> j = <span class="number">2</span> * (i + <span class="number">1</span>);</span><br><span class="line">            <span class="comment">// å°†ç»™å®šæ•´æ•°å†™å…¥æ­¤ç¼“å†²åŒºçš„å½“å‰ä½ç½®ï¼Œå½“å‰ä½ç½®é€’å¢</span></span><br><span class="line">            buffer.put(j);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// é‡è®¾æ­¤ç¼“å†²åŒºï¼Œå°†é™åˆ¶è®¾ç½®ä¸ºå½“å‰ä½ç½®ï¼Œç„¶åå°†å½“å‰ä½ç½®è®¾ç½®ä¸º0</span></span><br><span class="line">        buffer.flip();</span><br><span class="line">        <span class="comment">// æŸ¥çœ‹åœ¨å½“å‰ä½ç½®å’Œé™åˆ¶ä½ç½®ä¹‹é—´æ˜¯å¦æœ‰å…ƒç´ </span></span><br><span class="line">        <span class="keyword">while</span> (buffer.hasRemaining()) &#123;</span><br><span class="line">            <span class="comment">// è¯»å–æ­¤ç¼“å†²åŒºå½“å‰ä½ç½®çš„æ•´æ•°ï¼Œç„¶åå½“å‰ä½ç½®é€’å¢</span></span><br><span class="line">            <span class="keyword">int</span> j = buffer.get();</span><br><span class="line">            System.out.print(j + <span class="string">&quot; &quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="buffer%E7%9A%84capacity%E3%80%81position%E5%92%8Climit" id="Bufferçš„capacityã€positionå’Œlimit">Bufferçš„capacityã€positionå’Œlimit</h5>
<p>ä¸ºäº†ç†è§£Bufferçš„å·¥ä½œåŸç†ï¼Œéœ€è¦ç†Ÿæ‚‰å®ƒçš„ä¸‰ä¸ªå±æ€§ï¼š Capacity ã€ Position ã€ limit positionå’Œlimitçš„å«ä¹‰å–å†³äºBufferå¤„åœ¨è¯»æ¨¡å¼è¿˜æ˜¯å†™æ¨¡å¼ã€‚ä¸ç®¡Bufferå¤„åœ¨ä»€ä¹ˆæ¨¡å¼ï¼Œcapacityçš„å«ä¹‰æ€»æ˜¯ä¸€æ ·çš„ã€‚ è¿™é‡Œæœ‰ä¸€ä¸ªå…³äºcapacityï¼Œpositionå’Œlimitåœ¨è¯»å†™æ¨¡å¼ä¸­çš„è¯´æ˜</p>
<p><img src="https://gitee.com/mychimei/picture/raw/master/work/image-20220221193102357.png" alt="image-20220221193102357" /></p>
<h6 id="%EF%BC%881%EF%BC%89capacity" id="ï¼ˆ1ï¼‰capacity">ï¼ˆ1ï¼‰capacity</h6>
<p>ä½œä¸ºä¸€ä¸ªå†…å­˜å—ï¼ŒBufferæœ‰ä¸€ä¸ªå›ºå®šçš„å¤§å°å€¼ï¼Œä¹Ÿå«â€œcapacityâ€.ä½ åªèƒ½å¾€é‡Œå†™capacityä¸ªbyteã€longï¼Œcharç­‰ç±»å‹ã€‚ä¸€æ—¦Buffer<strong>æ»¡äº†ï¼Œéœ€è¦å°†å…¶æ¸…ç©º</strong>ï¼ˆé€šè¿‡è¯»æ•°æ®æˆ–è€…æ¸…é™¤æ•°æ®ï¼‰æ‰èƒ½ç»§ç»­å†™æ•°æ®å¾€é‡Œå†™æ•°æ®ã€‚</p>
<h6 id="%EF%BC%882%EF%BC%89position" id="ï¼ˆ2ï¼‰position">ï¼ˆ2ï¼‰position</h6>
<p>1ï¼‰<strong>å†™æ•°æ®åˆ°Buffer</strong>ä¸­æ—¶ï¼Œpositionè¡¨ç¤º<strong>å†™å…¥æ•°æ®çš„å½“å‰ä½ç½®</strong>ï¼Œpositionçš„åˆå§‹å€¼ä¸º0ã€‚å½“ä¸€ä¸ªbyteã€longç­‰æ•°æ®å†™åˆ°Bufferåï¼Œ positionä¼šå‘ä¸‹ç§»åŠ¨åˆ°ä¸‹ä¸€ä¸ªå¯æ’å…¥æ•°æ®çš„Bufferå•å…ƒã€‚positionæœ€å¤§å¯ä¸ºcapacity â€“ 1ï¼ˆå› ä¸ºpositionçš„åˆå§‹å€¼ä¸º0ï¼‰.<br />
2ï¼‰<strong>è¯»æ•°æ®åˆ°Buffer</strong>ä¸­æ—¶ï¼Œpositionè¡¨ç¤º<strong>è¯»å…¥æ•°æ®çš„å½“å‰ä½ç½®</strong>ï¼Œå¦‚position=2æ—¶è¡¨ç¤ºå·²å¼€å§‹è¯»å…¥äº†3ä¸ªbyteï¼Œæˆ–ä»ç¬¬3ä¸ªbyteå¼€å§‹è¯»å–ã€‚é€šè¿‡ByteBuffer.flip()åˆ‡æ¢åˆ°è¯»æ¨¡å¼æ—¶positionä¼šè¢«é‡ç½®ä¸º0ï¼Œå½“Bufferä»positionè¯»å…¥æ•°æ®åï¼Œpositionä¼šä¸‹ç§»åˆ°ä¸‹ä¸€ä¸ªå¯è¯»å…¥çš„æ•°æ®Bufferå•å…ƒã€‚</p>
<h6 id="%EF%BC%883%EF%BC%89limit" id="ï¼ˆ3ï¼‰limit">ï¼ˆ3ï¼‰limit</h6>
<p>1ï¼‰<strong>å†™</strong>æ•°æ®æ—¶ï¼Œlimitè¡¨ç¤ºå¯å¯¹Buffer<strong>æœ€å¤šå†™å…¥</strong>å¤šå°‘ä¸ªæ•°æ®ã€‚å†™æ¨¡å¼ä¸‹ï¼Œlimitç­‰äºBufferçš„capacityã€‚<br />
2ï¼‰<strong>è¯»</strong>æ•°æ®æ—¶ï¼Œlimitè¡¨ç¤ºBufferé‡Œæœ‰<strong>å¤šå°‘å¯è¯»</strong>æ•°æ®ï¼ˆnot nullçš„æ•°æ®ï¼‰ï¼Œå› æ­¤èƒ½è¯»åˆ°ä¹‹å‰å†™å…¥çš„æ‰€æœ‰æ•°æ®ï¼ˆlimitè¢«è®¾ç½®æˆå·²å†™æ•°æ®çš„æ•°é‡ï¼Œè¿™ä¸ªå€¼åœ¨å†™æ¨¡å¼ä¸‹å°±æ˜¯positionï¼‰ã€‚</p>
<h5 id="buffer%E7%9A%84%E7%B1%BB%E5%9E%8B" id="Bufferçš„ç±»å‹">Bufferçš„ç±»å‹</h5>
<p>Java NIO æœ‰ä»¥ä¸‹Bufferç±»å‹</p>
<ul>
<li>
<p>ByteBuffer</p>
</li>
<li>
<p>MappedByteBuffer</p>
</li>
<li>
<p>CharBuffer</p>
</li>
<li>
<p>DoubleBuffer</p>
</li>
<li>
<p>FloatBuffer</p>
</li>
<li>
<p>IntBuffer</p>
</li>
<li>
<p>LongBuffer</p>
</li>
<li>
<p>ShortBuffer<br />
è¿™äº›Bufferç±»å‹ä»£è¡¨äº†ä¸åŒçš„æ•°æ®ç±»å‹ã€‚æ¢å¥è¯è¯´ï¼Œå°±æ˜¯å¯ä»¥é€šè¿‡charï¼Œshortï¼Œintï¼Œlongï¼Œfloat æˆ– doubleç±»å‹æ¥æ“ä½œç¼“å†²åŒºä¸­çš„å­—èŠ‚ã€‚</p>
</li>
</ul>
<h5 id="buffer%E5%88%86%E9%85%8D%E5%92%8C%E5%86%99%E6%95%B0%E6%8D%AE" id="Bufferåˆ†é…å’Œå†™æ•°æ®">Bufferåˆ†é…å’Œå†™æ•°æ®</h5>
<h6 id="buffer%E5%88%86%E9%85%8D" id="Bufferåˆ†é…">Bufferåˆ†é…</h6>
<p>è¦æƒ³è·å¾—ä¸€ä¸ªBufferå¯¹è±¡é¦–å…ˆè¦è¿›è¡Œåˆ†é…ã€‚ æ¯ä¸€ä¸ªBufferç±»éƒ½æœ‰ä¸€ä¸ª<strong>allocate</strong>æ–¹æ³•ã€‚<br />
ä¸‹é¢æ˜¯ä¸€ä¸ªåˆ†é…48å­—èŠ‚capacityçš„ByteBufferçš„ä¾‹å­ã€‚<br />
ByteBuffer buf = ByteBuffer.allocate(48);<br />
è¿™æ˜¯åˆ†é…ä¸€ä¸ªå¯å­˜å‚¨1024ä¸ªå­—ç¬¦çš„CharBufferï¼š<br />
CharBuffer buf = CharBuffer.allocate(1024);</p>
<h6 id="%E5%90%91buffer%E4%B8%AD%E5%86%99%E6%95%B0%E6%8D%AE" id="å‘Bufferä¸­å†™æ•°æ®">å‘Bufferä¸­å†™æ•°æ®</h6>
<p>å†™æ•°æ®åˆ°Bufferæœ‰ä¸¤ç§æ–¹å¼ï¼š<br />
ï¼ˆ1ï¼‰ä»Channelå†™åˆ°Bufferã€‚<br />
ï¼ˆ2ï¼‰é€šè¿‡Bufferçš„put()æ–¹æ³•å†™åˆ°Bufferé‡Œã€‚<br />
ä»Channelå†™åˆ°Bufferçš„ä¾‹å­<br />
int bytesRead = inChannel.read(buf); //read into buffer.<br />
é€šè¿‡putæ–¹æ³•å†™Bufferçš„ä¾‹å­ï¼š<br />
buf.put(127);<br />
putæ–¹æ³•æœ‰å¾ˆå¤šç‰ˆæœ¬ï¼Œå…è®¸ä½ ä»¥ä¸åŒçš„æ–¹å¼æŠŠæ•°æ®å†™å…¥åˆ°Bufferä¸­ã€‚ä¾‹å¦‚ï¼Œ å†™åˆ°ä¸€ä¸ªæŒ‡å®šçš„ä½ç½®ï¼Œæˆ–è€…æŠŠä¸€ä¸ªå­—èŠ‚æ•°ç»„å†™å…¥åˆ°Buffer</p>
<h6 id="flip()%E6%96%B9%E6%B3%95" id="flip-æ–¹æ³•">flip()æ–¹æ³•</h6>
<p>flipæ–¹æ³•å°†Buffer<strong>ä»å†™æ¨¡å¼åˆ‡æ¢åˆ°è¯»æ¨¡å¼</strong>ã€‚è°ƒç”¨flip()æ–¹æ³•ä¼šå°†positionè®¾å›0ï¼Œå¹¶å°†limitè®¾ç½®æˆä¹‹å‰positionçš„å€¼ã€‚æ¢å¥è¯è¯´ï¼Œpositionç°åœ¨ç”¨äºæ ‡è®°è¯»çš„ä½ç½®ï¼Œlimitè¡¨ç¤ºä¹‹å‰å†™è¿›äº†å¤šå°‘ä¸ªbyteã€charç­‰ ï¼ˆç°åœ¨èƒ½è¯»å–å¤šå°‘ä¸ªbyteã€charç­‰ï¼‰ã€‚</p>
<h5 id="%E4%BB%8Ebuffer%E4%B8%AD%E8%AF%BB%E5%8F%96%E6%95%B0%E6%8D%AE" id="ä»Bufferä¸­è¯»å–æ•°æ®">ä»Bufferä¸­è¯»å–æ•°æ®</h5>
<p>ä»Bufferä¸­è¯»å–æ•°æ®æœ‰ä¸¤ç§æ–¹å¼ï¼š<br />
ï¼ˆ1ï¼‰ä»Bufferè¯»å–æ•°æ®åˆ°Channelã€‚<br />
ï¼ˆ2ï¼‰ä½¿ç”¨get()æ–¹æ³•ä»Bufferä¸­è¯»å–æ•°æ®ã€‚<br />
ä»Bufferè¯»å–æ•°æ®åˆ°Channelçš„ä¾‹å­ï¼š<br />
//read from buffer into channel.<br />
int bytesWritten = inChannel.write(buf);<br />
ä½¿ç”¨get()æ–¹æ³•ä»Bufferä¸­è¯»å–æ•°æ®çš„ä¾‹å­<br />
byte aByte = buf.get();<br />
getæ–¹æ³•æœ‰å¾ˆå¤šç‰ˆæœ¬ï¼Œå…è®¸ä½ ä»¥ä¸åŒçš„æ–¹å¼ä»Bufferä¸­è¯»å–æ•°æ®ã€‚ä¾‹å¦‚ï¼Œä»æŒ‡å®špositionè¯»å–ï¼Œæˆ–è€…ä»Bufferä¸­è¯»å–æ•°æ®åˆ°å­—èŠ‚æ•°ç»„ã€‚</p>
<h5 id="buffer%E5%87%A0%E4%B8%AA%E6%96%B9%E6%B3%95" id="Bufferå‡ ä¸ªæ–¹æ³•">Bufferå‡ ä¸ªæ–¹æ³•</h5>
<h6 id="rewind()%E6%96%B9%E6%B3%95%E6%96%B9%E6%B3%95" id="rewind-æ–¹æ³•æ–¹æ³•">rewind()æ–¹æ³•æ–¹æ³•</h6>
<p>Buffer.rewind()å°†<strong>positionè®¾å›0</strong>ï¼Œæ‰€ä»¥ä½ å¯ä»¥é‡è¯»Bufferä¸­çš„æ‰€æœ‰æ•°æ®ã€‚limitä¿æŒä¸å˜ï¼Œä»ç„¶è¡¨ç¤ºèƒ½ä»Bufferä¸­è¯»å–å¤šå°‘ä¸ªå…ƒç´ ï¼ˆbyteã€charç­‰ï¼‰ã€‚</p>
<h6 id="clear()%E4%B8%8Ecompact()%E6%96%B9%E6%B3%95%E6%96%B9%E6%B3%95" id="clear-ä¸compact-æ–¹æ³•æ–¹æ³•">clear()ä¸compact()æ–¹æ³•æ–¹æ³•</h6>
<p>â€‹		  ä¸€æ—¦è¯»å®ŒBufferä¸­çš„æ•°æ®ï¼Œéœ€è¦è®©Bufferå‡†å¤‡å¥½å†æ¬¡è¢«å†™å…¥ã€‚å¯ä»¥é€šè¿‡clear()æˆ–compact()æ–¹æ³•æ¥å®Œæˆã€‚<br />
å¦‚æœè°ƒç”¨çš„æ˜¯**clear()<strong>æ–¹æ³•ï¼Œpositionå°†è¢«è®¾å›0ï¼Œlimitè¢«è®¾ç½®æˆ capacityçš„å€¼ã€‚æ¢å¥è¯è¯´ï¼ŒBuffer è¢«æ¸…ç©ºäº†ã€‚Bufferä¸­çš„æ•°æ®å¹¶æœªæ¸…é™¤ï¼Œåªæ˜¯è¿™äº›æ ‡è®°å‘Šè¯‰æˆ‘ä»¬å¯ä»¥ä»å“ªé‡Œå¼€å§‹å¾€Bufferé‡Œå†™æ•°æ®ã€‚<br />
å¦‚æœBufferä¸­æœ‰ä¸€äº›æœªè¯»çš„æ•°æ®ï¼Œè°ƒç”¨clear()æ–¹æ³•ï¼Œæ•°æ®å°†â€œè¢«é—å¿˜â€ï¼Œæ„å‘³ç€ä¸å†æœ‰ä»»ä½•æ ‡è®°ä¼šå‘Šè¯‰ä½ å“ªäº›æ•°æ®è¢«è¯»è¿‡ï¼Œå“ªäº›è¿˜æ²¡æœ‰ã€‚<br />
å¦‚æœBufferä¸­ä»æœ‰æœªè¯»çš„æ•°æ®ï¼Œä¸”åç»­è¿˜éœ€è¦è¿™äº›æ•°æ®ï¼Œä½†æ˜¯æ­¤æ—¶æƒ³è¦å…ˆå…ˆå†™äº›æ•°æ®ï¼Œé‚£ä¹ˆä½¿ç”¨</strong>compact()**æ–¹æ³•ã€‚<br />
compact()æ–¹æ³•å°†æ‰€æœ‰æœªè¯»çš„æ•°æ®æ‹·è´åˆ°Bufferèµ·å§‹å¤„ã€‚ç„¶åå°†positionè®¾åˆ°æœ€åä¸€ä¸ªæœªè¯»å…ƒç´ æ­£åé¢ã€‚limitå±æ€§ä¾ç„¶åƒclear()æ–¹æ³•ä¸€æ ·ï¼Œè®¾ç½®æˆcapacityã€‚ç°åœ¨Bufferå‡†å¤‡å¥½å†™æ•°æ®äº†ï¼Œä½†æ˜¯ä¸ä¼šè¦†ç›–æœªè¯»çš„æ•°æ®ã€‚</p>
<h6 id="mark()%E4%B8%8Ereset()%E6%96%B9%E6%B3%95%E6%96%B9%E6%B3%95" id="mark-ä¸reset-æ–¹æ³•æ–¹æ³•">mark()ä¸reset()æ–¹æ³•æ–¹æ³•</h6>
<p>é€šè¿‡è°ƒç”¨Buffer.mark()æ–¹æ³•ï¼Œå¯ä»¥æ ‡è®°Bufferä¸­çš„ä¸€ä¸ªç‰¹å®špositionã€‚ä¹‹åå¯ä»¥é€šè¿‡è°ƒç”¨Buffer.reset()æ–¹æ³•æ¢å¤åˆ°è¿™ä¸ªpositionã€‚ä¾‹å¦‚ï¼š<br />
buffer.mark();<br />
//call buffer.get() a couple of times, e.g. during parsing.<br />
buffer.reset(); //set position back to mark.</p>
<h5 id="%E7%BC%93%E5%86%B2%E5%8C%BA%E6%93%8D%E4%BD%9C" id="ç¼“å†²åŒºæ“ä½œ">ç¼“å†²åŒºæ“ä½œ</h5>
<h6 id="%E7%BC%93%E5%86%B2%E5%8C%BA%E5%88%86%E7%89%87" id="ç¼“å†²åŒºåˆ†ç‰‡">ç¼“å†²åŒºåˆ†ç‰‡</h6>
<p>â€‹		åœ¨NIOä¸­ï¼Œé™¤äº†å¯ä»¥åˆ†é…æˆ–è€…åŒ…è£…ä¸€ä¸ªç¼“å†²åŒºå¯¹è±¡å¤–ï¼Œè¿˜å¯ä»¥æ ¹æ®ç°æœ‰çš„ç¼“å†²åŒºå¯¹è±¡æ¥åˆ›å»ºä¸€ä¸ªå­ç¼“å†²åŒºï¼Œå³åœ¨ç°æœ‰ç¼“å†²åŒºä¸Šåˆ‡å‡ºä¸€ç‰‡æ¥ä½œä¸ºä¸€ä¸ªæ–°çš„ç¼“å†²åŒºï¼Œä½†ç°æœ‰çš„ç¼“å†²åŒºä¸åˆ›å»ºçš„å­ç¼“å†²åŒºåœ¨åº•å±‚æ•°ç»„å±‚é¢ä¸Šæ˜¯<strong>æ•°æ®å…±äº«</strong>çš„ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå­ç¼“å†²åŒºç›¸å½“äºæ˜¯ç°æœ‰ç¼“å†²åŒºçš„ä¸€ä¸ªè§†å›¾çª—å£ã€‚è°ƒç”¨**slice()**æ–¹æ³•å¯ä»¥åˆ›å»ºä¸€ä¸ªå­ç¼“å†²åŒºã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testConect2</span><span class="params">()</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">    ByteBuffer buffer = ByteBuffer.allocate(<span class="number">10</span>);</span><br><span class="line">    <span class="comment">// ç¼“å†²åŒºä¸­çš„æ•°æ®0-9</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; buffer.capacity(); ++i) &#123;</span><br><span class="line">        buffer.put((<span class="keyword">byte</span>) i);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// åˆ›å»ºå­ç¼“å†²åŒº</span></span><br><span class="line">    buffer.position(<span class="number">3</span>);</span><br><span class="line">    buffer.limit(<span class="number">7</span>);</span><br><span class="line">    ByteBuffer slice = buffer.slice();</span><br><span class="line">    <span class="comment">// æ”¹å˜å­ç¼“å†²åŒºçš„å†…å®¹</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; slice.capacity(); ++i) &#123;</span><br><span class="line">        <span class="keyword">byte</span> b = slice.get(i);</span><br><span class="line">        b *= <span class="number">10</span>;</span><br><span class="line">        slice.put(i, b);</span><br><span class="line">    &#125;</span><br><span class="line">    buffer.position(<span class="number">0</span>);</span><br><span class="line">    buffer.limit(buffer.capacity());</span><br><span class="line">    <span class="keyword">while</span> (buffer.remaining() &gt; <span class="number">0</span>) &#123;</span><br><span class="line">        System.out.println(buffer.get());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h6 id="%E5%8F%AA%E8%AF%BB%E7%BC%93%E5%86%B2%E5%8C%BA" id="åªè¯»ç¼“å†²åŒº">åªè¯»ç¼“å†²åŒº</h6>
<p>â€‹		åªè¯»ç¼“å†²åŒºéå¸¸ç®€å•ï¼Œ<strong>å¯è¯»ç¦å†™</strong>ã€‚å¯ä»¥é€šè¿‡è°ƒç”¨ç¼“å†²åŒºçš„asReadOnlyBuffer()æ–¹æ³•ï¼Œå°†ä»»ä½•å¸¸è§„ç¼“å†²åŒºè½¬ æ¢ä¸ºåªè¯»ç¼“å†²åŒºï¼Œè¿™ä¸ªæ–¹æ³•è¿”å›ä¸€ä¸ªä¸åŸç¼“å†²åŒºå®Œå…¨ç›¸åŒçš„ç¼“å†²åŒºï¼Œå¹¶ä¸åŸç¼“å†²åŒºå…±äº«æ•°æ®ï¼Œåªä¸è¿‡å®ƒæ˜¯åªè¯»çš„ã€‚<strong>åŸå˜åªè¯»å˜</strong>ï¼Œå¦‚æœåŸç¼“å†²åŒºçš„å†…å®¹å‘ç”Ÿäº†å˜åŒ–ï¼Œåªè¯»ç¼“å†²åŒºçš„å†…å®¹ä¹Ÿéšä¹‹å‘ç”Ÿå˜åŒ–ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"> <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testConect4</span><span class="params">()</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">     ByteBuffer buffer = ByteBuffer.allocate(<span class="number">10</span>);</span><br><span class="line">     <span class="comment">// ç¼“å†²åŒºä¸­çš„æ•°æ®0-9 </span></span><br><span class="line">     <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; buffer.capacity(); ++i) &#123;</span><br><span class="line">         buffer.put((<span class="keyword">byte</span>) i);</span><br><span class="line">     &#125;</span><br><span class="line">     <span class="comment">// åˆ›å»ºåªè¯»ç¼“å†²åŒº </span></span><br><span class="line">     ByteBuffer readonly = buffer.asReadOnlyBuffer();</span><br><span class="line">     <span class="comment">// æ”¹å˜åŸç¼“å†²åŒºçš„å†…å®¹ </span></span><br><span class="line">     <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; buffer.capacity(); ++i) &#123;</span><br><span class="line">         <span class="keyword">byte</span> b = buffer.get(i);</span><br><span class="line">         b *= <span class="number">10</span>;</span><br><span class="line">         buffer.put(i, b);</span><br><span class="line">     &#125;</span><br><span class="line">     readonly.position(<span class="number">0</span>);</span><br><span class="line">     readonly.limit(buffer.capacity());</span><br><span class="line">     <span class="comment">// åªè¯»ç¼“å†²åŒºçš„å†…å®¹ä¹Ÿéšä¹‹æ”¹å˜ </span></span><br><span class="line">     <span class="keyword">while</span> (readonly.remaining() &gt; <span class="number">0</span>) &#123;</span><br><span class="line">         System.out.println(readonly.get());</span><br><span class="line">     &#125;</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>
<p>â€‹		å¦‚æœå°è¯•ä¿®æ”¹åªè¯»ç¼“å†²åŒºçš„å†…å®¹ï¼Œåˆ™ä¼šæŠ¥ReadOnlyBufferExceptionå¼‚å¸¸ã€‚åªè¯»ç¼“å†²åŒºå¯¹äºä¿æŠ¤æ•°æ®å¾ˆæœ‰ç”¨ã€‚åœ¨å°†ç¼“å†²åŒºä¼ é€’ç»™æŸä¸ª å¯¹è±¡çš„æ–¹æ³•æ—¶ï¼Œæ— æ³•çŸ¥é“è¿™ä¸ªæ–¹æ³•æ˜¯å¦ä¼šä¿®æ”¹ç¼“å†²åŒºä¸­çš„æ•°æ®ã€‚åˆ›å»ºä¸€ä¸ªåªè¯»çš„ç¼“å†²åŒºå¯ä»¥ä¿è¯è¯¥ç¼“å†²åŒºä¸ä¼šè¢«ä¿®æ”¹ã€‚åªå¯ä»¥æŠŠå¸¸è§„ç¼“å†²åŒºè½¬æ¢ä¸ºåªè¯»ç¼“å†²åŒºï¼Œè€Œä¸èƒ½å°†åªè¯»çš„ç¼“å†²åŒºè½¬æ¢ä¸ºå¯å†™çš„ç¼“å†²åŒºã€‚</p>
<h6 id="%E7%9B%B4%E6%8E%A5%E7%BC%93%E5%86%B2%E5%8C%BA" id="ç›´æ¥ç¼“å†²åŒº">ç›´æ¥ç¼“å†²åŒº</h6>
<p>â€‹		ç›´æ¥ç¼“å†²åŒºæ˜¯ä¸ºåŠ å¿«I/Oé€Ÿåº¦ï¼Œä½¿ç”¨ä¸€ç§ç‰¹æ®Šæ–¹å¼ä¸ºå…¶åˆ†é…å†…å­˜çš„ç¼“å†²åŒºï¼ŒJDKæ–‡æ¡£ä¸­çš„æè¿°ä¸ºï¼šç»™å®šä¸€ä¸ªç›´æ¥å­—èŠ‚ç¼“å†²åŒºï¼ŒJavaè™šæ‹Ÿæœºå°†å°½æœ€å¤§åŠªåŠ›ç›´æ¥å¯¹å®ƒæ‰§è¡Œæœ¬æœºI/Oæ“ä½œã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå®ƒä¼šåœ¨æ¯ä¸€æ¬¡è°ƒç”¨åº•å±‚æ“ä½œç³»ç»Ÿçš„æœ¬æœºI/Oæ“ä½œä¹‹å‰(æˆ–ä¹‹å)ï¼Œå°è¯•é¿å…å°†ç¼“å†²åŒºçš„å†…å®¹æ‹·è´åˆ°ä¸€ä¸ªä¸­é—´ç¼“å†²åŒºä¸­ æˆ–è€…ä»ä¸€ä¸ªä¸­é—´ç¼“å†²åŒºä¸­æ‹·è´æ•°æ®ã€‚è¦åˆ†é…ç›´æ¥ç¼“å†²åŒºï¼Œéœ€è¦è°ƒç”¨allocateDirect()æ–¹æ³•ï¼Œè€Œä¸æ˜¯allocate()æ–¹æ³•ï¼Œä½¿ç”¨æ–¹å¼ä¸æ™®é€šç¼“å†²åŒºå¹¶æ— åŒºåˆ«ã€‚ æ‹·è´æ–‡ä»¶ç¤ºä¾‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testConect5</span><span class="params">()</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        String infile = <span class="string">&quot;d:\\atguigu\\01.txt&quot;</span>;</span><br><span class="line">        FileInputStream fin = <span class="keyword">new</span> FileInputStream(infile);</span><br><span class="line">        FileChannel fcin = fin.getChannel();</span><br><span class="line">        String outfile = String.format(<span class="string">&quot;d:\\atguigu\\02.txt&quot;</span>);</span><br><span class="line">        FileOutputStream fout = <span class="keyword">new</span> FileOutputStream(outfile);</span><br><span class="line">        FileChannel fcout = fout.getChannel();</span><br><span class="line"><span class="comment">// ä½¿ç”¨allocateDirectï¼Œè€Œä¸æ˜¯allocate </span></span><br><span class="line">        ByteBuffer buffer = ByteBuffer.allocateDirect(<span class="number">1024</span>);</span><br><span class="line">        <span class="keyword">while</span> (<span class="keyword">true</span>) &#123;</span><br><span class="line">            buffer.clear();</span><br><span class="line">            <span class="keyword">int</span> r = fcin.read(buffer);</span><br><span class="line">            <span class="keyword">if</span> (r == -<span class="number">1</span>) &#123;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            buffer.flip();</span><br><span class="line">            fcout.write(buffer);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<h6 id="%E5%86%85%E5%AD%98%E6%98%A0%E5%B0%84%E6%96%87%E4%BB%B6i%2Fo" id="å†…å­˜æ˜ å°„æ–‡ä»¶I-O">å†…å­˜æ˜ å°„æ–‡ä»¶I/O</h6>
<p>â€‹		å†…å­˜æ˜ å°„æ–‡ä»¶I/Oæ˜¯ä¸€ç§è¯»å’Œå†™æ–‡ä»¶æ•°æ®çš„æ–¹æ³•ï¼Œå®ƒå¯ä»¥æ¯”å¸¸è§„çš„åŸºäºæµæˆ–è€…åŸºäºé€šé“çš„I/Oå¿«çš„å¤šã€‚å†…å­˜æ˜ å°„æ–‡ä»¶I/Oæ˜¯é€šè¿‡ä½¿æ–‡ä»¶ä¸­çš„æ•°æ®å‡ºç°ä¸º å†…å­˜æ•°ç»„çš„å†…å®¹æ¥å®Œæˆçš„ï¼Œè¿™å…¶åˆå¬èµ·æ¥ä¼¼ä¹ä¸è¿‡å°±æ˜¯å°†æ•´ä¸ªæ–‡ä»¶è¯»åˆ°å†…å­˜ä¸­ï¼Œä½†æ˜¯äº‹å®ä¸Šå¹¶ä¸æ˜¯è¿™æ ·ã€‚ä¸€èˆ¬æ¥è¯´ï¼Œåªæœ‰æ–‡ä»¶ä¸­å®é™…è¯»å–æˆ–è€…å†™å…¥çš„éƒ¨åˆ†æ‰ä¼šæ˜ å°„åˆ°å†…å­˜ä¸­ã€‚ç¤ºä¾‹ä»£ç ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">static</span> <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">int</span> start = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">int</span> size = <span class="number">1024</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">static</span> <span class="keyword">public</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String args[])</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        RandomAccessFile raf = <span class="keyword">new</span> RandomAccessFile(<span class="string">&quot;d:\\atguigu\\01.txt&quot;</span>, <span class="string">&quot;rw&quot;</span>);</span><br><span class="line">        FileChannel fc = raf.getChannel();</span><br><span class="line">        MappedByteBuffer mbb = fc.map(FileChannel.MapMode.READ_WRITE, start, size);</span><br><span class="line">        mbb.put(<span class="number">0</span>, (<span class="keyword">byte</span>) <span class="number">97</span>);</span><br><span class="line">        mbb.put(<span class="number">1023</span>, (<span class="keyword">byte</span>) <span class="number">122</span>);</span><br><span class="line">        raf.close();</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<h3 id="%E9%80%89%E6%8B%A9%E5%99%A8" id="é€‰æ‹©å™¨">é€‰æ‹©å™¨</h3>
<h4 id="selector%E7%AE%80%E4%BB%8B" id="Selectorç®€ä»‹">Selectorç®€ä»‹</h4>
<h5 id="1%E3%80%81-selector%E5%92%8C-channel%E5%85%B3%E7%B3%BB" id="1ã€-Selectorå’Œ-Channelå…³ç³»">1ã€ Selectorå’Œ Channelå…³ç³»</h5>
<p>â€‹		Selector ä¸€èˆ¬ç§° ä¸ºé€‰æ‹©å™¨ ï¼Œä¹Ÿå¯ä»¥ç¿»è¯‘ä¸º å¤šè·¯å¤ç”¨å™¨ ã€‚å®ƒæ˜¯Java NIOæ ¸å¿ƒç»„ä»¶ä¸­çš„ä¸€ä¸ªï¼Œ**ç”¨äºæ£€æŸ¥ä¸€ä¸ªæˆ–å¤šä¸ªNIO Channelï¼ˆé€šé“ï¼‰çš„çŠ¶æ€æ˜¯å¦å¤„äºå¯è¯»ã€å¯å†™ã€‚**å¦‚æ­¤å¯ä»¥å®ç°å•çº¿ç¨‹ç®¡ç†å¤šä¸ªchannels,ä¹Ÿå°±æ˜¯å¯ä»¥ç®¡ç†å¤šä¸ªç½‘ç»œé“¾æ¥ã€‚å³ä½¿ç”¨Selectorçš„å¥½å¤„åœ¨äºï¼š ä½¿ç”¨æ›´å°‘çš„çº¿ç¨‹æ¥å°±å¯ä»¥æ¥å¤„ç†é€šé“äº†ï¼Œ ç›¸æ¯”ä½¿ç”¨å¤šä¸ªçº¿ç¨‹ï¼Œé¿å…äº†çº¿ç¨‹ä¸Šä¸‹æ–‡åˆ‡æ¢å¸¦æ¥çš„å¼€é”€ã€‚NIO å®ç°äº† IO å¤šè·¯å¤ç”¨ä¸­çš„ Reactor æ¨¡å‹ï¼Œä¸€ä¸ªçº¿ç¨‹ Thread ä½¿ç”¨ä¸€ä¸ªé€‰æ‹©å™¨ Selector é€šè¿‡è½®è¯¢çš„æ–¹å¼å»ç›‘å¬å¤šä¸ªé€šé“ Channel ä¸Šçš„äº‹ä»¶ï¼Œä»è€Œè®©ä¸€ä¸ªçº¿ç¨‹å°±å¯ä»¥å¤„ç†å¤šä¸ªäº‹ä»¶ã€‚é€šè¿‡é…ç½®ç›‘å¬çš„é€šé“ Channel ä¸ºéé˜»å¡ï¼Œé‚£ä¹ˆå½“ Channel ä¸Šçš„ IO äº‹ä»¶è¿˜æœªåˆ°è¾¾æ—¶ï¼Œå°±ä¸ä¼šè¿›å…¥é˜»å¡çŠ¶æ€ä¸€ç›´ç­‰å¾…ï¼Œè€Œæ˜¯ç»§ç»­è½®è¯¢å…¶å®ƒ Channelï¼Œæ‰¾åˆ° IO äº‹ä»¶å·²ç»åˆ°è¾¾çš„ Channel æ‰§è¡Œã€‚å› ä¸ºåˆ›å»ºå’Œåˆ‡æ¢çº¿ç¨‹çš„å¼€é”€å¾ˆå¤§ï¼Œå› æ­¤ä½¿ç”¨ä¸€ä¸ªçº¿ç¨‹æ¥å¤„ç†å¤šä¸ªäº‹ä»¶è€Œä¸æ˜¯ä¸€ä¸ªçº¿ç¨‹å¤„ç†ä¸€ä¸ªäº‹ä»¶ï¼Œå¯¹äº IO å¯†é›†å‹çš„åº”ç”¨å…·æœ‰å¾ˆå¥½åœ°æ€§èƒ½ã€‚</p>
<p><img src="https://gitee.com/mychimei/picture/raw/master/work/image-20220221201825702.png" alt="image-20220221201825702" /></p>
<h5 id="2%E3%80%81-%E5%8F%AF%E9%80%89%E6%8B%A9%E9%80%9A%E9%81%93-(selectablechannel)" id="2ã€-å¯é€‰æ‹©é€šé“-SelectableChannel">2ã€ å¯é€‰æ‹©é€šé“ (SelectableChannel)</h5>
<p>ï¼ˆ1ï¼‰ä¸æ˜¯æ‰€æœ‰çš„Channeléƒ½å¯ä»¥è¢«Selector å¤ç”¨çš„ã€‚æ¯”æ–¹è¯´ï¼Œ<strong>FileChannelå°±ä¸èƒ½è¢«é€‰æ‹©å™¨å¤ç”¨</strong>ã€‚åˆ¤æ–­ä¸€ä¸ªChannel èƒ½è¢«Selector å¤ç”¨ï¼Œæœ‰ä¸€ä¸ªå‰æï¼šåˆ¤æ–­ä»–æ˜¯å¦ç»§æ‰¿äº†ä¸€ä¸ªæŠ½è±¡ç±»SelectableChannelã€‚å¦‚æœ<strong>ç»§æ‰¿äº†SelectableChannelï¼Œåˆ™å¯ä»¥è¢«å¤ç”¨</strong>ï¼Œå¦åˆ™ä¸èƒ½ã€‚<br />
ï¼ˆ2ï¼‰SelectableChannelç±»æä¾›äº†å®ç°é€šé“çš„å¯é€‰æ‹©æ€§æ‰€éœ€è¦çš„å…¬å…±æ–¹æ³•ã€‚å®ƒæ˜¯æ‰€æœ‰æ”¯æŒå°±ç»ªæ£€æŸ¥çš„é€šé“ç±»çš„çˆ¶ç±»ã€‚æ‰€æœ‰socketé€šé“ï¼Œéƒ½ç»§æ‰¿äº†SelectableChannelç±»éƒ½æ˜¯å¯é€‰æ‹©çš„ï¼ŒåŒ…æ‹¬ä»ç®¡é“(Pipe)å¯¹è±¡çš„ä¸­è·å¾—çš„é€šé“ã€‚è€ŒFileChannelç±»ï¼Œæ²¡æœ‰ç»§æ‰¿SelectableChannelï¼Œå› æ­¤æ˜¯ä¸æ˜¯å¯é€‰é€šé“ã€‚<br />
ï¼ˆ3ï¼‰ä¸€ä¸ªé€šé“å¯ä»¥è¢«æ³¨å†Œåˆ°å¤šä¸ªé€‰æ‹©å™¨ä¸Šï¼Œä½†å¯¹æ¯ä¸ªé€‰æ‹©å™¨è€Œè¨€åªèƒ½è¢«æ³¨å†Œä¸€æ¬¡,å³<strong>é€šé“ä¸é€‰æ‹©å™¨ä¸€å¯¹å¤š</strong>ã€‚é€šé“å’Œé€‰æ‹©å™¨ä¹‹é—´çš„å…³ç³»ï¼Œä½¿ç”¨æ³¨å†Œçš„æ–¹å¼å®Œæˆã€‚SelectableChannelå¯ä»¥è¢«æ³¨å†Œåˆ°Selectorå¯¹è±¡ä¸Šï¼Œåœ¨æ³¨å†Œçš„æ—¶å€™ï¼Œéœ€è¦æŒ‡å®šé€šé“çš„å“ªäº›æ“ä½œï¼Œæ˜¯Selectoræ„Ÿå…´è¶£çš„ã€‚</p>
<p><img src="https://gitee.com/mychimei/picture/raw/master/work/image-20220221202034823.png" alt="image-20220221202034823" /></p>
<h5 id="3%E3%80%81channel%E6%B3%A8%E5%86%8C%E5%88%B0%E6%B3%A8%E5%86%8C%E5%88%B0selector" id="3ã€Channelæ³¨å†Œåˆ°æ³¨å†Œåˆ°Selector">3ã€Channelæ³¨å†Œåˆ°æ³¨å†Œåˆ°Selector</h5>
<p>ï¼ˆ1ï¼‰ä½¿ç”¨<strong>Channel.registerï¼ˆSelector selï¼Œint opsï¼‰<strong>æ–¹æ³•ï¼Œå°†ä¸€ä¸ªé€šé“æ³¨å†Œåˆ°ä¸€ä¸ªé€‰æ‹©å™¨æ—¶ã€‚ç¬¬ä¸€ä¸ªå‚æ•°ï¼ŒæŒ‡å®šé€šé“è¦æ³¨å†Œçš„é€‰æ‹©å™¨ã€‚ç¬¬äºŒä¸ªå‚æ•°æŒ‡å®šé€‰æ‹©å™¨éœ€è¦æŸ¥è¯¢çš„é€šé“æ“ä½œã€‚<br />
ï¼ˆ2ï¼‰å¯ä»¥ä¾›é€‰æ‹©å™¨æŸ¥è¯¢çš„</strong>é€šé“æ“ä½œå››ç±»</strong>ï¼š</p>
<ul>
<li>
<p>å¯è¯» : SelectionKey.OP_READ</p>
</li>
<li>
<p>å¯å†™ : SelectionKey.OP_WRITE</p>
</li>
<li>
<p>è¿æ¥ : SelectionKey.OP_CONNECT</p>
</li>
<li>
<p>æ¥æ”¶ : SelectionKey.OP_ACCEPT<br />
Selectorå¯¹é€šé“çš„<strong>å¤šæ“ä½œç±»å‹ç”¨â€œä½æˆ–â€æ“ä½œç¬¦å®ç°</strong>ï¼š<br />
æ¯”å¦‚ï¼šint key = SelectionKey.OP_READ | SelectionKey.OP_WRITE ;</p>
</li>
</ul>
<p>ï¼ˆ3ï¼‰é€‰æ‹©å™¨æŸ¥è¯¢çš„ä¸æ˜¯é€šé“çš„æ“ä½œï¼Œè€Œæ˜¯é€šé“çš„æŸä¸ªæ“ä½œçš„ä¸€ç§å°±ç»ªçŠ¶æ€ã€‚ä»€ä¹ˆæ˜¯æ“ä½œçš„å°±ç»ªçŠ¶æ€ï¼Ÿä¸€æ—¦é€šé“å…·å¤‡å®ŒæˆæŸä¸ªæ“ä½œçš„æ¡ä»¶ï¼Œè¡¨ç¤ºè¯¥é€šé“çš„æŸä¸ªæ“ä½œå·²ç»å°±ç»ªï¼Œå°±å¯ä»¥è¢«SelectoræŸ¥è¯¢åˆ°ï¼Œç¨‹åºå¯ä»¥å¯¹é€šé“è¿›è¡Œå¯¹åº”çš„æ“ä½œã€‚æ¯”æ–¹è¯´ï¼ŒæŸä¸ªSocketChannelé€šé“å¯ä»¥è¿æ¥åˆ°ä¸€ä¸ªæœåŠ¡å™¨ï¼Œåˆ™å¤„äºâ€œè¿æ¥å°±ç»ªâ€(OP_CONNECT)ã€‚å†æ¯”æ–¹è¯´ï¼Œä¸€ä¸ªServerSocketChannelæœåŠ¡å™¨é€šé“å‡†å¤‡å¥½æ¥æ”¶æ–°è¿›å…¥çš„è¿æ¥ï¼Œåˆ™å¤„äºâ€œæ¥æ”¶å°±ç»ªâ€ï¼ˆOP_ACCEPTï¼‰çŠ¶æ€ã€‚è¿˜æ¯”æ–¹è¯´ï¼Œä¸€ä¸ªæœ‰æ•°æ®å¯è¯»çš„é€šé“ï¼Œå¯ä»¥è¯´æ˜¯â€œè¯»å°±ç»ªâ€(OP_READ)ã€‚ä¸€ä¸ªç­‰å¾…å†™æ•°æ®çš„é€šé“å¯ä»¥è¯´æ˜¯â€œå†™å°±ç»ªâ€(OP_WRITE)ã€‚</p>
<h5 id="4%E3%80%81%E9%80%89%E6%8B%A9%E9%94%AE(selectionkey)" id="4ã€é€‰æ‹©é”®-SelectionKey">4ã€é€‰æ‹©é”®(SelectionKey)</h5>
<p>ï¼ˆ1ï¼‰Channelæ³¨å†Œåˆ°åï¼Œå¹¶ä¸”ä¸€æ—¦é€šé“å¤„äºæŸç§å°±ç»ªçš„çŠ¶æ€ï¼Œå°±å¯ä»¥è¢«é€‰æ‹©å™¨æŸ¥è¯¢åˆ°ã€‚è¿™ä¸ªå·¥ä½œï¼Œä½¿ç”¨é€‰æ‹©å™¨Selectorçš„<strong>selectï¼ˆï¼‰<strong>æ–¹æ³•å®Œæˆã€‚selectæ–¹æ³•çš„ä½œç”¨ï¼Œå¯¹æ„Ÿå…´è¶£çš„é€šé“æ“ä½œï¼Œè¿›è¡Œ</strong>å°±ç»ªçŠ¶æ€çš„æŸ¥è¯¢</strong>ã€‚<br />
ï¼ˆ2ï¼‰Selectorå¯ä»¥ä¸æ–­çš„æŸ¥è¯¢Channelä¸­å‘ç”Ÿçš„æ“ä½œçš„å°±ç»ªçŠ¶æ€ã€‚å¹¶ä¸”æŒ‘é€‰æ„Ÿå…´è¶£çš„æ“ä½œå°±ç»ªçŠ¶æ€ã€‚ä¸€æ—¦é€šé“æœ‰æ“ä½œçš„å°±ç»ªçŠ¶æ€è¾¾æˆï¼Œå¹¶ä¸”æ˜¯Selectoræ„Ÿå…´è¶£çš„æ“ä½œï¼Œå°±ä¼šè¢«Selectoré€‰ä¸­ï¼Œæ”¾å…¥<strong>é€‰æ‹©é”®é›†åˆ</strong>ä¸­ã€‚<br />
ï¼ˆ3ï¼‰ä¸€ä¸ªé€‰æ‹©é”®ï¼Œé¦–å…ˆæ˜¯åŒ…å«äº†æ³¨å†Œåœ¨Selectorçš„é€šé“æ“ä½œçš„<strong>ç±»å‹</strong>ï¼Œæ¯”æ–¹è¯´SelectionKey.OP_READã€‚ä¹ŸåŒ…å«äº†ç‰¹å®šçš„é€šé“ä¸ç‰¹å®šçš„é€‰æ‹©å™¨ä¹‹é—´çš„<strong>æ³¨å†Œå…³ç³»</strong>ã€‚<br />
å¼€å‘åº”ç”¨ç¨‹åºæ˜¯ï¼Œé€‰æ‹©é”®æ˜¯ç¼–ç¨‹çš„å…³é”®ã€‚NIOçš„ç¼–ç¨‹ï¼Œå°±æ˜¯æ ¹æ®å¯¹åº”çš„é€‰æ‹©é”®ï¼Œè¿›è¡Œä¸åŒçš„ä¸šåŠ¡é€»è¾‘å¤„ç†ã€‚<br />
ï¼ˆ4ï¼‰é€‰æ‹©é”®çš„æ¦‚å¿µï¼Œå’Œäº‹ä»¶çš„æ¦‚å¿µæ¯”è¾ƒç›¸ä¼¼ã€‚ä¸€ä¸ªé€‰æ‹©é”®ç±»ä¼¼ç›‘å¬å™¨æ¨¡å¼é‡Œè¾¹çš„ä¸€ä¸ªäº‹ä»¶ã€‚ç”±äºSelectorä¸æ˜¯äº‹ä»¶è§¦å‘çš„æ¨¡å¼ï¼Œè€Œæ˜¯<strong>ä¸»åŠ¨å»æŸ¥è¯¢</strong>çš„æ¨¡å¼ï¼Œæ‰€ä»¥ä¸å«äº‹ä»¶Eventï¼Œè€Œæ˜¯å«SelectionKeyé€‰æ‹©é”®ã€‚</p>
<ul>
<li>NIO å¸¸å¸¸è¢«å«åšéé˜»å¡ IOï¼Œä¸»è¦æ˜¯å› ä¸º NIO åœ¨ç½‘ç»œé€šä¿¡ä¸­çš„éé˜»å¡ç‰¹æ€§è¢«å¹¿æ³›ä½¿ç”¨ã€‚</li>
</ul>
<h4 id="selector%E7%9A%84%E4%BD%BF%E7%94%A8%E6%96%B9%E6%B3%95" id="Selectorçš„ä½¿ç”¨æ–¹æ³•">Selectorçš„ä½¿ç”¨æ–¹æ³•</h4>
<h5 id="1.selector-%E7%9A%84%E5%88%9B%E5%BB%BA" id="1-Selector-çš„åˆ›å»º">1.Selector çš„åˆ›å»º</h5>
<p>é€šè¿‡è°ƒç”¨Selector.open()æ–¹æ³•åˆ›å»ºä¸€ä¸ªSelectorå¯¹è±¡ï¼Œå¦‚ä¸‹ï¼š</p>
<p>// 1ã€è·å–Selectoré€‰æ‹©å™¨ Selector selector = Selector.open();</p>
<h5 id="2.%E6%B3%A8%E5%86%8C-channel-%E5%88%B0-selector" id="2-æ³¨å†Œ-Channel-åˆ°-Selector">2.æ³¨å†Œ Channel åˆ° Selector</h5>
<p>è¦å®ç°Selectorç®¡ç†Channelï¼Œéœ€è¦å°†channelæ³¨å†Œåˆ°ç›¸åº”çš„Selectorä¸Š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 1ã€è·å–Selectoré€‰æ‹©å™¨ Selector selector = Selector.open(); </span></span><br><span class="line"><span class="comment">// 2ã€è·å–é€šé“ ServerSocketChannel serverSocketChannel = ServerSocketChannel.open(); </span></span><br><span class="line"><span class="comment">// 3.è®¾ç½®ä¸ºéé˜»å¡ serverSocketChannel.configureBlocking(false); </span></span><br><span class="line"><span class="comment">// 4ã€ç»‘å®šè¿æ¥ serverSocketChannel.bind(new InetSocketAddress(9999)); </span></span><br><span class="line"><span class="comment">// 5ã€å°†é€šé“æ³¨å†Œåˆ°é€‰æ‹©å™¨ä¸Š,å¹¶åˆ¶å®šç›‘å¬äº‹ä»¶ä¸ºï¼šâ€œæ¥æ”¶â€äº‹ä»¶ serverSocketChannel.register(selector,SelectionKey.OP_ACCEPT);</span></span><br></pre></td></tr></table></figure>
<p>ä¸Šé¢é€šè¿‡è°ƒç”¨é€šé“çš„register()æ–¹æ³•ä¼šå°†å®ƒæ³¨å†Œåˆ°ä¸€ä¸ªé€‰æ‹©å™¨ä¸Šã€‚<br />
é¦–å…ˆéœ€è¦æ³¨æ„çš„æ˜¯ï¼š<br />
ï¼ˆ1ï¼‰ä¸Selectorä¸€èµ·ä½¿ç”¨æ—¶ï¼Œ<strong>Channelå¿…é¡»å¤„äºéé˜»å¡æ¨¡å¼ä¸‹</strong>ï¼Œå¦åˆ™å°†æŠ›å‡ºå¼‚å¸¸IllegalBlockingModeExceptionã€‚è¿™æ„å‘³ç€ï¼ŒFileChannelä¸èƒ½ä¸Selectorä¸€èµ·ä½¿ç”¨ï¼Œå› ä¸ºFileChannelä¸èƒ½åˆ‡æ¢åˆ°éé˜»å¡æ¨¡å¼ï¼Œè€Œå¥—æ¥å­—ç›¸å…³çš„æ‰€æœ‰çš„é€šé“éƒ½å¯ä»¥ã€‚<br />
ï¼ˆ2ï¼‰ä¸€ä¸ªé€šé“ï¼Œå¹¶æ²¡æœ‰ä¸€å®šè¦æ”¯æŒæ‰€æœ‰çš„å››ç§æ“ä½œã€‚æ¯”å¦‚æœåŠ¡å™¨é€šé“ServerSocketChannelæ”¯æŒAccept æ¥å—æ“ä½œï¼Œè€ŒSocketChannelå®¢æˆ·ç«¯é€šé“åˆ™ä¸æ”¯æŒã€‚å¯ä»¥é€šè¿‡é€šé“ä¸Šçš„<strong>validOps()æ–¹æ³•ï¼Œæ¥è·å–ç‰¹å®šé€šé“ä¸‹æ‰€æœ‰æ”¯æŒçš„æ“ä½œé›†åˆ</strong>ã€‚</p>
<h5 id="3.%E8%BD%AE%E8%AF%A2%E6%9F%A5%E8%AF%A2%E5%B0%B1%E7%BB%AA%E6%93%8D%E4%BD%9C%E8%BD%AE%E8%AF%A2%E6%9F%A5%E8%AF%A2%E5%B0%B1%E7%BB%AA%E6%93%8D%E4%BD%9C" id="3-è½®è¯¢æŸ¥è¯¢å°±ç»ªæ“ä½œè½®è¯¢æŸ¥è¯¢å°±ç»ªæ“ä½œ">3.è½®è¯¢æŸ¥è¯¢å°±ç»ªæ“ä½œè½®è¯¢æŸ¥è¯¢å°±ç»ªæ“ä½œ</h5>
<p>ï¼ˆ1ï¼‰é€šè¿‡Selectorçš„selectï¼ˆï¼‰æ–¹æ³•ï¼Œå¯ä»¥æŸ¥è¯¢å‡ºå·²ç»å°±ç»ªçš„é€šé“æ“ä½œï¼Œè¿™äº›å°±ç»ªçš„çŠ¶æ€é›†åˆï¼ŒåŒ…å­˜åœ¨ä¸€ä¸ªå…ƒç´ æ˜¯SelectionKeyå¯¹è±¡çš„Seté›†åˆä¸­ã€‚<br />
ï¼ˆ2ï¼‰ä¸‹é¢æ˜¯Selectorå‡ ä¸ªé‡è½½çš„æŸ¥è¯¢select()æ–¹æ³•ï¼š</p>
<ul>
<li>
<p>select():é˜»å¡åˆ°è‡³å°‘æœ‰ä¸€ä¸ªé€šé“åœ¨ä½ æ³¨å†Œçš„äº‹ä»¶ä¸Šå°±ç»ªäº†ã€‚</p>
</li>
<li>
<p>select(long timeout)ï¼šå’Œselect()ä¸€æ ·ï¼Œä½†æœ€é•¿é˜»å¡äº‹ä»¶ä¸ºtimeoutæ¯«ç§’ã€‚</p>
</li>
<li>
<p>selectNow():éé˜»å¡ï¼Œåªè¦æœ‰é€šé“å°±ç»ªå°±ç«‹åˆ»è¿”å›ã€‚<br />
select()æ–¹æ³•è¿”å›çš„intå€¼ï¼Œè¡¨ç¤ºæœ‰å¤šå°‘é€šé“å·²ç»å°±ç»ªï¼Œæ›´å‡†ç¡®çš„è¯´ï¼Œæ˜¯è‡ªå‰ä¸€æ¬¡selectæ–¹æ³•ä»¥æ¥åˆ°è¿™ä¸€æ¬¡selectæ–¹æ³•ä¹‹é—´çš„æ—¶é—´æ®µä¸Šï¼Œæœ‰å¤šå°‘é€šé“å˜æˆå°±ç»ªçŠ¶æ€ã€‚<br />
ä¾‹å¦‚ï¼šé¦–æ¬¡è°ƒç”¨select()æ–¹æ³•ï¼Œå¦‚æœæœ‰ä¸€ä¸ªé€šé“å˜æˆå°±ç»ªçŠ¶æ€ï¼Œè¿”å›äº†1ï¼Œè‹¥å†æ¬¡è°ƒç”¨select()æ–¹æ³•ï¼Œå¦‚æœå¦ä¸€ä¸ªé€šé“å°±ç»ªäº†ï¼Œå®ƒä¼šå†æ¬¡è¿”å›1ã€‚å¦‚æœå¯¹ç¬¬ä¸€ä¸ªå°±ç»ªçš„channelæ²¡æœ‰åšä»»ä½•æ“ä½œï¼Œç°åœ¨å°±æœ‰ä¸¤ä¸ªå°±ç»ªçš„é€šé“ï¼Œä½†åœ¨æ¯æ¬¡select()æ–¹æ³•è°ƒç”¨ä¹‹é—´ï¼Œåªæœ‰ä¸€ä¸ªé€šé“å°±ç»ªäº†ã€‚<br />
ä¸€æ—¦è°ƒç”¨select()æ–¹æ³•ï¼Œå¹¶ä¸”è¿”å›å€¼ä¸ä¸º0æ—¶ï¼Œåœ¨Selectorä¸­æœ‰ä¸€ä¸ªselectedKeys()æ–¹æ³•ï¼Œç”¨æ¥è®¿é—®å·²é€‰æ‹©é”®é›†åˆï¼Œè¿­ä»£é›†åˆçš„æ¯ä¸€ä¸ªé€‰æ‹©é”®å…ƒç´ ï¼Œæ ¹æ®å°±ç»ªæ“ä½œçš„ç±»å‹ï¼Œå®Œæˆå¯¹åº”çš„æ“ä½œï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"> Set selectedKeys = selector.selectedKeys();</span><br><span class="line">Iterator keyIterator = selectedKeys.iterator(); </span><br><span class="line"><span class="keyword">while</span>(keyIterator.hasNext()) &#123; </span><br><span class="line">    SelectionKey key = keyIterator.next(); </span><br><span class="line">    <span class="keyword">if</span>(key.isAcceptable()) &#123; </span><br><span class="line">        <span class="comment">// a connection was accepted by a ServerSocketChannel. </span></span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (key.isConnectable()) &#123;</span><br><span class="line">        <span class="comment">// a connection was established with a remote server. </span></span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (key.isReadable()) &#123; </span><br><span class="line">        <span class="comment">// a channel is ready for reading </span></span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (key.isWritable()) &#123; </span><br><span class="line">        <span class="comment">// a channel is ready for writing &#125; keyIterator.remove(); </span></span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h5 id="4.%E5%81%9C%E6%AD%A2%E9%80%89%E6%8B%A9%E7%9A%84%E6%96%B9%E6%B3%95%E5%81%9C%E6%AD%A2%E9%80%89%E6%8B%A9%E7%9A%84%E6%96%B9%E6%B3%95" id="4-åœæ­¢é€‰æ‹©çš„æ–¹æ³•åœæ­¢é€‰æ‹©çš„æ–¹æ³•">4.åœæ­¢é€‰æ‹©çš„æ–¹æ³•åœæ­¢é€‰æ‹©çš„æ–¹æ³•</h5>
<p>â€‹		é€‰æ‹©å™¨æ‰§è¡Œé€‰æ‹©çš„è¿‡ç¨‹ï¼Œç³»ç»Ÿåº•å±‚ä¼šä¾æ¬¡è¯¢é—®æ¯ä¸ªé€šé“æ˜¯å¦å·²ç»å°±ç»ªï¼Œè¿™ä¸ªè¿‡ç¨‹å¯èƒ½ä¼šé€ æˆè°ƒç”¨çº¿ç¨‹è¿›å…¥é˜»å¡çŠ¶æ€,é‚£ä¹ˆæˆ‘ä»¬æœ‰ä»¥ä¸‹ä¸‰ç§æ–¹å¼å¯ä»¥å”¤é†’åœ¨selectï¼ˆï¼‰æ–¹æ³•ä¸­é˜»å¡çš„çº¿ç¨‹ã€‚<br />
wakeup()æ–¹æ³• ï¼šé€šè¿‡è°ƒç”¨Selectorå¯¹è±¡çš„wakeupï¼ˆï¼‰æ–¹æ³•è®©å¤„åœ¨é˜»å¡çŠ¶æ€çš„select()æ–¹æ³•ç«‹åˆ»è¿”å›<br />
è¯¥æ–¹æ³•ä½¿å¾—é€‰æ‹©å™¨ä¸Šçš„ç¬¬ä¸€ä¸ªè¿˜æ²¡æœ‰è¿”å›çš„é€‰æ‹©æ“ä½œç«‹å³è¿”å›ã€‚å¦‚æœå½“å‰æ²¡æœ‰è¿›è¡Œä¸­çš„é€‰æ‹©æ“ä½œï¼Œé‚£ä¹ˆä¸‹ä¸€æ¬¡å¯¹select()æ–¹æ³•çš„ä¸€æ¬¡è°ƒç”¨å°†ç«‹å³è¿”å›ã€‚<br />
close()æ–¹æ³• ï¼šé€šè¿‡closeï¼ˆï¼‰æ–¹æ³•å…³é—­Selectorï¼Œ<br />
è¯¥æ–¹æ³•ä½¿å¾—ä»»ä½•ä¸€ä¸ªåœ¨é€‰æ‹©æ“ä½œä¸­é˜»å¡çš„çº¿ç¨‹éƒ½è¢«å”¤é†’ï¼ˆç±»ä¼¼wakeupï¼ˆï¼‰ï¼‰ï¼ŒåŒæ—¶ä½¿å¾—æ³¨å†Œåˆ°è¯¥Selectorçš„æ‰€æœ‰Channelè¢«æ³¨é”€ï¼Œæ‰€æœ‰çš„é”®å°†è¢«å–æ¶ˆï¼Œä½†æ˜¯Channelæœ¬èº«å¹¶ä¸ä¼šå…³é—­ã€‚</p>
<h4 id="%E7%A4%BA%E4%BE%8B%E4%BB%A3%E7%A0%81" id="ç¤ºä¾‹ä»£ç ">ç¤ºä¾‹ä»£ç </h4>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.junit.jupiter.api.Test;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.net.InetSocketAddress;</span><br><span class="line"><span class="keyword">import</span> java.nio.ByteBuffer;</span><br><span class="line"><span class="keyword">import</span> java.nio.channels.SelectionKey;</span><br><span class="line"><span class="keyword">import</span> java.nio.channels.Selector;</span><br><span class="line"><span class="keyword">import</span> java.nio.channels.ServerSocketChannel;</span><br><span class="line"><span class="keyword">import</span> java.nio.channels.SocketChannel;</span><br><span class="line"><span class="keyword">import</span> java.nio.charset.StandardCharsets;</span><br><span class="line"><span class="keyword">import</span> java.util.Date;</span><br><span class="line"><span class="keyword">import</span> java.util.Iterator;</span><br><span class="line"><span class="keyword">import</span> java.util.Scanner;</span><br><span class="line"><span class="keyword">import</span> java.util.Set;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SelectorDemo</span> </span>&#123;</span><br><span class="line">    <span class="comment">//æœåŠ¡ç«¯</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">ServerDemo</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line"><span class="comment">//      1.è·å–æœåŠ¡ç«¯é€šé“</span></span><br><span class="line">        ServerSocketChannel ssc = ServerSocketChannel.open();</span><br><span class="line"><span class="comment">//        2.ç»‘å®šç«¯å£å·</span></span><br><span class="line">        ssc.socket().bind(<span class="keyword">new</span> InetSocketAddress(<span class="string">&quot;127.0.0.1&quot;</span>, <span class="number">8000</span>));</span><br><span class="line"><span class="comment">//        3.åˆ‡æ¢éé˜»å¡æ¨¡å¼</span></span><br><span class="line">        ssc.configureBlocking(<span class="keyword">false</span>);</span><br><span class="line"><span class="comment">//        4.åˆ›å»ºé€‰æ‹©å™¨</span></span><br><span class="line">        Selector selector = Selector.open();</span><br><span class="line"><span class="comment">//        5.æ³¨å†Œchannelï¼Œå¹¶ä¸”æŒ‡å®šæ„Ÿå…´è¶£çš„äº‹ä»¶æ˜¯ Accept</span></span><br><span class="line">        ssc.register(selector, SelectionKey.OP_ACCEPT);</span><br><span class="line"><span class="comment">//        6.åˆ›å»ºbuffer</span></span><br><span class="line">        ByteBuffer readBuff = ByteBuffer.allocate(<span class="number">1024</span>);</span><br><span class="line">        ByteBuffer writeBuff = ByteBuffer.allocate(<span class="number">128</span>);</span><br><span class="line">        writeBuff.put(<span class="string">&quot;received&quot;</span>.getBytes());</span><br><span class="line">        writeBuff.flip();</span><br><span class="line">        <span class="keyword">while</span> (<span class="keyword">true</span>) &#123;</span><br><span class="line"><span class="comment">//            7.æ£€æµ‹é€šé“å°±ç»ªçŠ¶æ€</span></span><br><span class="line">            <span class="keyword">int</span> nReady = selector.select();</span><br><span class="line"><span class="comment">//            8.éå†é€‰æ‹©å™¨ï¼Œè·å–å°±ç»ªé€šé“é›†åˆ</span></span><br><span class="line">            Set&lt;SelectionKey&gt; keys = selector.selectedKeys();</span><br><span class="line">            Iterator&lt;SelectionKey&gt; it = keys.iterator();</span><br><span class="line">            <span class="keyword">while</span> (it.hasNext()) &#123;</span><br><span class="line">                SelectionKey key = it.next();</span><br><span class="line">                it.remove();</span><br><span class="line"><span class="comment">//                åˆ¤æ–­çŠ¶æ€</span></span><br><span class="line">                <span class="keyword">if</span> (key.isAcceptable()) &#123;</span><br><span class="line"><span class="comment">//              åˆ›å»ºæ–°çš„è¿æ¥ï¼Œå¹¶ä¸”æŠŠè¿æ¥æ³¨å†Œåˆ°selectorä¸Šï¼Œè¿›è¡Œç›‘å¬ï¼Œå£°æ˜è¿™ä¸ªchannelåªå¯¹è¯»æ“ä½œæ„Ÿå…´è¶£ã€‚</span></span><br><span class="line">                    SocketChannel socketChannel = ssc.accept();</span><br><span class="line"><span class="comment">//                    åˆ‡æ¢åˆ°éé˜»å¡</span></span><br><span class="line">                    socketChannel.configureBlocking(<span class="keyword">false</span>);</span><br><span class="line"><span class="comment">//                    æ³¨å†Œ</span></span><br><span class="line">                    socketChannel.register(selector, SelectionKey.OP_READ);</span><br><span class="line">                &#125; <span class="keyword">else</span> <span class="keyword">if</span> (key.isReadable()) &#123;</span><br><span class="line"><span class="comment">//                    è·å–é€šé“</span></span><br><span class="line">                    SocketChannel socketChannel = (SocketChannel) key.channel();</span><br><span class="line">                    readBuff.clear();</span><br><span class="line">                    socketChannel.read(readBuff);</span><br><span class="line">                    readBuff.flip();</span><br><span class="line">                    System.out.println(<span class="string">&quot;received : &quot;</span> + <span class="keyword">new</span> String(readBuff.array()));</span><br><span class="line">                    key.interestOps(SelectionKey.OP_WRITE);</span><br><span class="line">                &#125; <span class="keyword">else</span> <span class="keyword">if</span> (key.isWritable()) &#123;</span><br><span class="line">                    writeBuff.rewind();</span><br><span class="line">                    SocketChannel socketChannel = (SocketChannel) key.channel();</span><br><span class="line">                    socketChannel.write(writeBuff);</span><br><span class="line">                    key.interestOps(SelectionKey.OP_READ);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//å®¢æˆ·ç«¯ä»£ç </span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">ClientDemo</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line"><span class="comment">//            1.è·å–é€šé“ï¼Œç»‘å®šä¸»æœºä¸ç«¯å£å·</span></span><br><span class="line">        SocketChannel socketChannel = SocketChannel.open();</span><br><span class="line">        socketChannel.connect(<span class="keyword">new</span> InetSocketAddress(<span class="string">&quot;127.0.0.1&quot;</span>, <span class="number">8000</span>));</span><br><span class="line"><span class="comment">//            2.åˆ‡æ¢åˆ°éé˜»å¡æ¨¡å¼</span></span><br><span class="line">        socketChannel.configureBlocking(<span class="keyword">false</span>);</span><br><span class="line"><span class="comment">//            3.åˆ›å»ºbuffer</span></span><br><span class="line">        ByteBuffer writeBuffer = ByteBuffer.allocate(<span class="number">32</span>);</span><br><span class="line">        ByteBuffer readBuffer = ByteBuffer.allocate(<span class="number">32</span>);</span><br><span class="line"><span class="comment">//            4.å†™å…¥bufferæ•°æ®</span></span><br><span class="line">        Scanner scanner = <span class="keyword">new</span> Scanner(System.in);</span><br><span class="line">        <span class="keyword">while</span> (scanner.hasNext()) &#123;</span><br><span class="line">            String str = scanner.next();</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//            writeBuffer.put(&quot;hello&quot;.getBytes());</span></span><br><span class="line">            writeBuffer.put((<span class="keyword">new</span> Date().toString() + <span class="string">&quot;----&gt;&quot;</span> + str).getBytes());</span><br><span class="line"><span class="comment">//            5.æ¨¡å¼åˆ‡æ¢</span></span><br><span class="line">            writeBuffer.flip();</span><br><span class="line">            <span class="keyword">while</span> (<span class="keyword">true</span>) &#123;</span><br><span class="line">                <span class="comment">// å°†positionè®¾å›0</span></span><br><span class="line">                writeBuffer.rewind();</span><br><span class="line"><span class="comment">//                6.å†™å…¥é€šé“</span></span><br><span class="line">                socketChannel.write(writeBuffer);</span><br><span class="line"><span class="comment">//                7.å…³é—­</span></span><br><span class="line">                readBuffer.clear();</span><br><span class="line">                socketChannel.read(readBuffer);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="comment">//              è¾“å…¥æ–¹å¼ å®¢æˆ·ç«¯</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        <span class="comment">//            1.è·å–é€šé“ï¼Œç»‘å®šä¸»æœºä¸ç«¯å£å·</span></span><br><span class="line">        SocketChannel socketChannel = SocketChannel.open();</span><br><span class="line">        socketChannel.connect(<span class="keyword">new</span> InetSocketAddress(<span class="string">&quot;127.0.0.1&quot;</span>, <span class="number">8000</span>));</span><br><span class="line"><span class="comment">//            2.åˆ‡æ¢åˆ°éé˜»å¡æ¨¡å¼</span></span><br><span class="line">        socketChannel.configureBlocking(<span class="keyword">false</span>);</span><br><span class="line"><span class="comment">//            3.åˆ›å»ºbuffer  è¶…è¿‡ä¼šæŠ¥é”™Exception in thread &quot;main&quot; java.nio.BufferOverflowException</span></span><br><span class="line">        ByteBuffer writeBuffer = ByteBuffer.allocate(<span class="number">1024</span>);</span><br><span class="line">        ByteBuffer readBuffer = ByteBuffer.allocate(<span class="number">1024</span>);</span><br><span class="line"><span class="comment">//            4.å†™å…¥bufferæ•°æ®</span></span><br><span class="line">        Scanner scanner = <span class="keyword">new</span> Scanner(System.in);</span><br><span class="line">        <span class="keyword">while</span> (scanner.hasNext()) &#123;</span><br><span class="line">            String str = scanner.next();</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//            writeBuffer.put(&quot;hello&quot;.getBytes());</span></span><br><span class="line">            writeBuffer.put((<span class="keyword">new</span> Date().toString() + <span class="string">&quot;----&gt;&quot;</span> + str).getBytes());</span><br><span class="line"><span class="comment">//            5.æ¨¡å¼åˆ‡æ¢</span></span><br><span class="line">            writeBuffer.flip();</span><br><span class="line">            <span class="keyword">while</span> (<span class="keyword">true</span>) &#123;</span><br><span class="line">                <span class="comment">// å°†positionè®¾å›0</span></span><br><span class="line">                writeBuffer.rewind();</span><br><span class="line"><span class="comment">//                6.å†™å…¥é€šé“</span></span><br><span class="line">                socketChannel.write(writeBuffer);</span><br><span class="line"><span class="comment">//                7.å…³é—­</span></span><br><span class="line">                readBuffer.clear();</span><br><span class="line">                socketChannel.read(readBuffer);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h4 id="nio%E7%BC%96%E7%A8%8B%E6%AD%A5%E9%AA%A4%E6%80%BB%E7%BB%93" id="NIOç¼–ç¨‹æ­¥éª¤æ€»ç»“">NIOç¼–ç¨‹æ­¥éª¤æ€»ç»“</h4>
<p>ç¬¬ä¸€æ­¥ï¼šåˆ›å»ºSelectoré€‰æ‹©å™¨<br />
ç¬¬äºŒæ­¥ï¼šåˆ›å»ºServerSocketChannelé€šé“ï¼Œå¹¶ç»‘å®šç›‘å¬ç«¯å£<br />
ç¬¬ä¸‰æ­¥ï¼šè®¾ç½®Channelé€šé“æ˜¯éé˜»å¡æ¨¡å¼<br />
ç¬¬å››æ­¥ï¼šæŠŠChannelæ³¨å†Œåˆ°Socketoré€‰æ‹©å™¨ä¸Šï¼Œç›‘å¬è¿æ¥äº‹ä»¶<br />
ç¬¬äº”æ­¥ï¼šè°ƒç”¨Selectorçš„selectæ–¹æ³•ï¼ˆå¾ªç¯è°ƒç”¨ï¼‰ï¼Œç›‘æµ‹é€šé“çš„å°±ç»ªçŠ¶å†µ<br />
ç¬¬å…­æ­¥ï¼šè°ƒç”¨selectKeysæ–¹æ³•è·å–å°±ç»ªchannelé›†åˆ<br />
ç¬¬ä¸ƒæ­¥ï¼šéå†å°±ç»ªchannelé›†åˆï¼Œåˆ¤æ–­å°±ç»ªäº‹ä»¶ç±»å‹ï¼Œå®ç°å…·ä½“çš„ä¸šåŠ¡æ“ä½œ<br />
ç¬¬å…«æ­¥ï¼šæ ¹æ®ä¸šåŠ¡ï¼Œå†³å®šæ˜¯å¦éœ€è¦å†æ¬¡æ³¨å†Œç›‘å¬äº‹ä»¶ï¼Œé‡å¤æ‰§è¡Œç¬¬ä¸‰æ­¥æ“ä½œ</p>
<ol>
<li>åˆ›å»ºé€‰æ‹©å™¨</li>
</ol>
<p>Selector selector = Selector.open();</p>
<ol start="2">
<li>å°†é€šé“æ³¨å†Œåˆ°é€‰æ‹©å™¨ä¸Š<br />
ServerSocketChannel ssChannel = ServerSocketChannel.open();<br />
ssChannel.configureBlocking(false);<br />
ssChannel.register(selector, SelectionKey.OP_ACCEPT);<br />
é€šé“å¿…é¡»é…ç½®ä¸ºéé˜»å¡æ¨¡å¼ï¼Œå¦åˆ™ä½¿ç”¨é€‰æ‹©å™¨å°±æ²¡æœ‰ä»»ä½•æ„ä¹‰äº†ï¼Œå› ä¸ºå¦‚æœé€šé“åœ¨æŸä¸ªäº‹ä»¶ä¸Šè¢«é˜»å¡ï¼Œé‚£ä¹ˆæœåŠ¡å™¨å°±ä¸èƒ½å“åº”å…¶å®ƒäº‹ä»¶ï¼Œå¿…é¡»ç­‰å¾…è¿™ä¸ªäº‹ä»¶å¤„ç†å®Œæ¯•æ‰èƒ½å»å¤„ç†å…¶å®ƒäº‹ä»¶ï¼Œæ˜¾ç„¶è¿™å’Œé€‰æ‹©å™¨çš„ä½œç”¨èƒŒé“è€Œé©°ã€‚</li>
</ol>
<p>åœ¨å°†é€šé“æ³¨å†Œåˆ°é€‰æ‹©å™¨ä¸Šæ—¶ï¼Œè¿˜éœ€è¦æŒ‡å®šè¦æ³¨å†Œçš„å…·ä½“äº‹ä»¶ï¼Œä¸»è¦æœ‰ä»¥ä¸‹å‡ ç±»ï¼š</p>
<p>SelectionKey.OP_CONNECT<br />
SelectionKey.OP_ACCEPT<br />
SelectionKey.OP_READ<br />
SelectionKey.OP_WRITE<br />
å®ƒä»¬åœ¨ SelectionKey çš„å®šä¹‰å¦‚ä¸‹ï¼š</p>
<p>public static final int OP_READ = 1 &lt;&lt; 0;<br />
public static final int OP_WRITE = 1 &lt;&lt; 2;<br />
public static final int OP_CONNECT = 1 &lt;&lt; 3;<br />
public static final int OP_ACCEPT = 1 &lt;&lt; 4;<br />
å¯ä»¥çœ‹å‡ºæ¯ä¸ªäº‹ä»¶å¯ä»¥è¢«å½“æˆä¸€ä¸ªä½åŸŸï¼Œä»è€Œç»„æˆäº‹ä»¶é›†æ•´æ•°ã€‚ä¾‹å¦‚ï¼š</p>
<p>int interestSet = SelectionKey.OP_READ | SelectionKey.OP_WRITE;</p>
<ol start="3">
<li>
<p>ç›‘å¬äº‹ä»¶<br />
int num = selector.select();<br />
ä½¿ç”¨ select() æ¥ç›‘å¬åˆ°è¾¾çš„äº‹ä»¶ï¼Œå®ƒä¼šä¸€ç›´é˜»å¡ç›´åˆ°æœ‰è‡³å°‘ä¸€ä¸ªäº‹ä»¶åˆ°è¾¾ã€‚</p>
</li>
<li>
<p>è·å–åˆ°è¾¾çš„äº‹ä»¶<br />
Set<SelectionKey> keys = selector.selectedKeys();<br />
Iterator<SelectionKey> keyIterator = keys.iterator();<br />
while (keyIterator.hasNext()) {<br />
SelectionKey key = keyIterator.next();<br />
if (key.isAcceptable()) {<br />
// ...<br />
} else if (key.isReadable()) {<br />
// ...<br />
}<br />
keyIterator.remove();<br />
}</p>
</li>
<li>
<p>äº‹ä»¶å¾ªç¯<br />
å› ä¸ºä¸€æ¬¡ select() è°ƒç”¨ä¸èƒ½å¤„ç†å®Œæ‰€æœ‰çš„äº‹ä»¶ï¼Œå¹¶ä¸”æœåŠ¡å™¨ç«¯æœ‰å¯èƒ½éœ€è¦ä¸€ç›´ç›‘å¬äº‹ä»¶ï¼Œå› æ­¤æœåŠ¡å™¨ç«¯å¤„ç†äº‹ä»¶çš„ä»£ç ä¸€èˆ¬ä¼šæ”¾åœ¨ä¸€ä¸ªæ­»å¾ªç¯å†…ã€‚</p>
</li>
</ol>
<p>while (true) {<br />
int num = selector.select();<br />
Set<SelectionKey> keys = selector.selectedKeys();<br />
Iterator<SelectionKey> keyIterator = keys.iterator();<br />
while (keyIterator.hasNext()) {<br />
SelectionKey key = keyIterator.next();<br />
if (key.isAcceptable()) {<br />
// ...<br />
} else if (key.isReadable()) {<br />
// ...<br />
}<br />
keyIterator.remove();<br />
}<br />
}</p>
<h3 id="pipe" id="Pipe">Pipe</h3>
<p>Java NIO ç®¡é“æ˜¯2ä¸ªçº¿ç¨‹ä¹‹é—´çš„å•å‘æ•°æ®è¿æ¥ã€‚Pipeæœ‰ä¸€ä¸ªsourceé€šé“å’Œä¸€ä¸ªsinké€šé“ã€‚æ•°æ®ä¼šè¢«å†™åˆ°sinké€šé“ï¼Œä»sourceé€šé“è¯»å–ã€‚</p>
<p><img src="https://gitee.com/mychimei/picture/raw/master/work/image-20220222134658767.png" alt="image-20220222134658767" /></p>
<h4 id="1%E3%80%81%E5%88%9B%E5%BB%BA%E7%AE%A1%E9%81%93" id="1ã€åˆ›å»ºç®¡é“">1ã€åˆ›å»ºç®¡é“</h4>
<p>é€šè¿‡Pipe.open()æ–¹æ³•æ‰“å¼€ç®¡é“ã€‚ Pipe pipe = Pipe.open();</p>
<h4 id="2%E3%80%81%E5%86%99%E5%85%A5%E7%AE%A1%E9%81%93" id="2ã€å†™å…¥ç®¡é“">2ã€å†™å…¥ç®¡é“</h4>
<p sinkChannel.write(buf);="">è¦å‘ç®¡é“å†™æ•°æ®ï¼Œéœ€è¦è®¿é—®sinké€šé“ã€‚ï¼š Pipe.SinkChannel sinkChannel = pipe.sink();<br />
é€šè¿‡è°ƒç”¨SinkChannelçš„write()æ–¹æ³•ï¼Œå°†æ•°æ®å†™å…¥SinkChannelï¼š String newData = &quot;New String to write to file...&quot; + System.currentTimeMillis(); ByteBuffer buf = ByteBuffer.allocate(48); buf.clear(); buf.put(newData.getBytes()); buf.flip(); while(buf.hasRemaining())</p>
<h4 id="3%E3%80%81%E4%BB%8E%E7%AE%A1%E9%81%93%E8%AF%BB%E5%8F%96%E6%95%B0%E6%8D%AE" id="3ã€ä»ç®¡é“è¯»å–æ•°æ®">3ã€ä»ç®¡é“è¯»å–æ•°æ®</h4>
<p>è®¿é—®sourceé€šé“<br />
Pipe.SourceChannel sourceChannel = pipe.source();<br />
è°ƒç”¨sourceé€šé“çš„read()æ–¹æ³•æ¥è¯»å–æ•°æ®ï¼š<br />
ByteBuffer buf = ByteBuffer.allocate(48);<br />
int bytesRead = sourceChannel.read(buf);<br />
read()æ–¹æ³•è¿”å›çš„intå€¼ä¼šå‘Šè¯‰æˆ‘ä»¬å¤šå°‘å­—èŠ‚è¢«è¯»è¿›äº†ç¼“å†²åŒºã€‚</p>
<h4 id="4%E3%80%81%E4%BB%A3%E7%A0%81%E7%A4%BA%E4%BE%8B" id="4ã€ä»£ç ç¤ºä¾‹">4ã€ä»£ç ç¤ºä¾‹</h4>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> pers.lxl.mylearnproject.javase.io.nio.pipe;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.junit.jupiter.api.Test;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.nio.ByteBuffer;</span><br><span class="line"><span class="keyword">import</span> java.nio.channels.Pipe;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">PipeDemo</span> </span>&#123;</span><br><span class="line"></span><br><span class="line"><span class="comment">//        1.è·å–ç®¡é“</span></span><br><span class="line"><span class="comment">//        2è·å–sinké€šé“</span></span><br><span class="line"><span class="comment">//        3.åˆ›å»ºç¼“å†²åŒº</span></span><br><span class="line"><span class="comment">//        4.å†™å…¥æ•°æ®</span></span><br><span class="line"><span class="comment">//        5.è·å–sourceé€šé“</span></span><br><span class="line"><span class="comment">//        6.åˆ›å»ºsourceé€šé“</span></span><br><span class="line"><span class="comment">//        7.åˆ›å»ºç¼“å†²åŒºï¼Œè¯»å–æ•°æ®</span></span><br><span class="line"><span class="comment">//        8.å…³é—­é€šé“</span></span><br><span class="line">    <span class="comment">/**/</span></span><br><span class="line"><span class="comment">    <span class="doctag">@Test</span></span></span><br><span class="line"><span class="comment">    public void testPipe() throws IOException &#123;</span></span><br><span class="line"><span class="comment">        // 1ã€è·å–é€šé“</span></span><br><span class="line"><span class="comment">        Pipe pipe = Pipe.open();</span></span><br><span class="line"><span class="comment">        // 2ã€è·å–sinkç®¡é“ï¼Œç”¨æ¥ä¼ é€æ•°æ®</span></span><br><span class="line"><span class="comment">        Pipe.SinkChannel sinkChannel = pipe.sink();</span></span><br><span class="line"><span class="comment">        // 3ã€ç”³è¯·ä¸€å®šå¤§å°çš„ç¼“å†²åŒº</span></span><br><span class="line"><span class="comment">        ByteBuffer byteBuffer = ByteBuffer.allocate(1024);</span></span><br><span class="line"><span class="comment">        byteBuffer.put(&quot;atguigu&quot;.getBytes());</span></span><br><span class="line"><span class="comment">        byteBuffer.flip();</span></span><br><span class="line"><span class="comment">        // 4ã€sinkå‘é€æ•°æ®</span></span><br><span class="line"><span class="comment">        sinkChannel.write(byteBuffer);</span></span><br><span class="line"><span class="comment">        // 5ã€åˆ›å»ºæ¥æ”¶pipeæ•°æ®çš„sourceç®¡é“</span></span><br><span class="line"><span class="comment">        Pipe.SourceChannel sourceChannel = pipe.source();</span></span><br><span class="line"><span class="comment">        // 6ã€æ¥æ”¶æ•°æ®ï¼Œå¹¶ä¿å­˜åˆ°ç¼“å†²åŒºä¸­</span></span><br><span class="line"><span class="comment">        ByteBuffer byteBuffer2 = ByteBuffer.allocate(1024);</span></span><br><span class="line"><span class="comment">        int length = sourceChannel.read(byteBuffer2);</span></span><br><span class="line"><span class="comment">        System.out.println(new String(byteBuffer2.array(), 0, length));</span></span><br><span class="line"><span class="comment">        sourceChannel.close();</span></span><br><span class="line"><span class="comment">        sinkChannel.close();</span></span><br><span class="line"><span class="comment">    &#125;</span></span><br><span class="line"><span class="comment">&#125;</span></span><br></pre></td></tr></table></figure>
<h3 id="filelock" id="FileLock">FileLock</h3>
<h4 id="1%E3%80%81-filelock-%E7%AE%80%E4%BB%8B" id="1ã€-FileLock-ç®€ä»‹">1ã€ FileLock ç®€ä»‹</h4>
<p>â€‹		æ–‡ä»¶é”åœ¨OSä¸­å¾ˆå¸¸è§ï¼Œå¦‚æœå¤šä¸ªç¨‹åºåŒæ—¶è®¿é—®ã€ä¿®æ”¹åŒä¸€ä¸ªæ–‡ä»¶ï¼Œå¾ˆå®¹æ˜“å› ä¸ºæ–‡ä»¶æ•°æ®ä¸åŒæ­¥è€Œå‡ºç°é—®é¢˜ã€‚ç»™æ–‡ä»¶åŠ ä¸€ä¸ªé”ï¼ŒåŒä¸€æ—¶é—´ï¼Œåªèƒ½æœ‰ä¸€ä¸ªç¨‹åºä¿®æ”¹æ­¤æ–‡ä»¶ï¼Œæˆ–è€…ç¨‹åºéƒ½åªèƒ½è¯»æ­¤æ–‡ä»¶ï¼Œè¿™å°±è§£å†³äº†åŒæ­¥é—®é¢˜ã€‚<br />
â€‹		æ–‡ä»¶é”æ˜¯<strong>è¿›ç¨‹çº§åˆ«</strong>çš„ï¼Œä¸æ˜¯çº¿ç¨‹çº§åˆ«çš„ã€‚æ–‡ä»¶é”å¯ä»¥è§£å†³å¤šä¸ªè¿›ç¨‹å¹¶å‘è®¿é—®ã€ä¿®æ”¹åŒä¸€ä¸ªæ–‡ä»¶çš„é—®é¢˜ï¼Œä½†ä¸èƒ½è§£å†³å¤šçº¿ç¨‹å¹¶å‘è®¿é—®ã€ä¿®æ”¹åŒä¸€æ–‡ä»¶çš„é—®é¢˜ã€‚ä½¿ç”¨æ–‡ä»¶é”æ—¶ï¼ŒåŒä¸€è¿›ç¨‹å†…çš„å¤šä¸ªçº¿ç¨‹ï¼Œå¯ä»¥åŒæ—¶è®¿é—®ã€ä¿®æ”¹æ­¤æ–‡ä»¶ã€‚<br />
â€‹		æ–‡ä»¶é”æ˜¯å½“å‰ç¨‹åºæ‰€å±çš„JVMå®ä¾‹æŒæœ‰çš„ï¼Œä¸€æ—¦è·å–åˆ°æ–‡ä»¶é”ï¼ˆå¯¹æ–‡ä»¶åŠ é”ï¼‰ï¼Œè¦è°ƒç”¨release()ï¼Œæˆ–è€…å…³é—­å¯¹åº”çš„FileChannelå¯¹è±¡ï¼Œæˆ–è€…å½“å‰JVMé€€å‡ºï¼Œæ‰ä¼šé‡Šæ”¾è¿™ä¸ªé”ã€‚<br />
â€‹		ä¸€æ—¦æŸä¸ªè¿›ç¨‹ï¼ˆæ¯”å¦‚è¯´JVMå®ä¾‹ï¼‰å¯¹æŸä¸ªæ–‡ä»¶åŠ é”ï¼Œåˆ™åœ¨é‡Šæ”¾è¿™ä¸ªé”ä¹‹å‰ï¼Œæ­¤è¿›ç¨‹ä¸èƒ½å†å¯¹æ­¤æ–‡ä»¶åŠ é”ï¼Œå°±æ˜¯è¯´JVMå®ä¾‹åœ¨åŒä¸€æ–‡ä»¶ä¸Šçš„æ–‡ä»¶é”æ˜¯ä¸é‡å çš„ï¼ˆè¿›ç¨‹çº§åˆ«ä¸èƒ½é‡å¤åœ¨åŒä¸€æ–‡ä»¶ä¸Šè·å–é”ï¼‰ã€‚</p>
<h4 id="2%E3%80%81%E6%96%87%E4%BB%B6%E9%94%81%E5%88%86%E7%B1%BB%EF%BC%9A%E6%96%87%E4%BB%B6%E9%94%81%E5%88%86%E7%B1%BB%EF%BC%9A" id="2ã€æ–‡ä»¶é”åˆ†ç±»ï¼šæ–‡ä»¶é”åˆ†ç±»ï¼š">2ã€æ–‡ä»¶é”åˆ†ç±»ï¼šæ–‡ä»¶é”åˆ†ç±»ï¼š</h4>
<p>â€‹		<strong>æ’å®ƒé”</strong>ï¼šåˆå«ç‹¬å é”ã€‚å¯¹æ–‡ä»¶åŠ æ’å®ƒé”åï¼Œè¯¥è¿›ç¨‹å¯ä»¥å¯¹æ­¤æ–‡ä»¶è¿›è¡Œè¯»å†™ï¼Œè¯¥è¿›ç¨‹ç‹¬å æ­¤æ–‡ä»¶ï¼Œå…¶ä»–è¿›ç¨‹ä¸èƒ½è¯»å†™æ­¤æ–‡ä»¶ï¼Œç›´åˆ°è¯¥è¿›ç¨‹é‡Šæ”¾æ–‡ä»¶é”ã€‚<br />
â€‹		<strong>å…±äº«é”</strong>ï¼šæŸä¸ªè¿›ç¨‹å¯¹æ–‡ä»¶åŠ å…±äº«é”ï¼Œå…¶ä»–è¿›ç¨‹ä¹Ÿå¯ä»¥è®¿é—®æ­¤æ–‡ä»¶ï¼Œä½†è¿™äº›è¿›ç¨‹éƒ½åªèƒ½è¯»æ­¤æ–‡ä»¶ï¼Œä¸èƒ½å†™ã€‚çº¿ç¨‹æ˜¯å®‰å…¨çš„ã€‚åªè¦è¿˜æœ‰ä¸€ä¸ªè¿›ç¨‹æŒæœ‰å…±äº«é”ï¼Œæ­¤æ–‡ä»¶å°±åªèƒ½è¯»ï¼Œä¸èƒ½å†™ã€‚</p>
<h4 id="3%E3%80%81%E4%BD%BF%E7%94%A8%E7%A4%BA%E4%BE%8B" id="3ã€ä½¿ç”¨ç¤ºä¾‹">3ã€ä½¿ç”¨ç¤ºä¾‹</h4>
<p>//åˆ›å»ºFileChannelå¯¹è±¡ï¼Œæ–‡ä»¶é”åªèƒ½é€šè¿‡FileChannelå¯¹è±¡æ¥ä½¿ç”¨ FileChannel fileChannel=new FileOutputStream(&quot;./1.txt&quot;).getChannel();<br />
//å¯¹æ–‡ä»¶åŠ é” FileLock lock=fileChannel.lock();<br />
//å¯¹æ­¤æ–‡ä»¶è¿›è¡Œä¸€äº›è¯»å†™æ“ä½œã€‚ //.......<br />
//é‡Šæ”¾é” lock.release();<br />
æ–‡ä»¶é”è¦é€šè¿‡FileChannelå¯¹è±¡ä½¿ç”¨ã€‚</p>
<h4 id="4%E3%80%81%E8%8E%B7%E5%8F%96%E6%96%87%E4%BB%B6%E9%94%81%E6%96%B9%E6%B3%95%E3%80%81%E8%8E%B7%E5%8F%96%E6%96%87%E4%BB%B6%E9%94%81%E6%96%B9%E6%B3%95" id="4ã€è·å–æ–‡ä»¶é”æ–¹æ³•ã€è·å–æ–‡ä»¶é”æ–¹æ³•">4ã€è·å–æ–‡ä»¶é”æ–¹æ³•ã€è·å–æ–‡ä»¶é”æ–¹æ³•</h4>
<p>æœ‰4ç§è·å–æ–‡ä»¶é”çš„æ–¹æ³•ï¼š<br />
lock() //å¯¹æ•´ä¸ªæ–‡ä»¶åŠ é”ï¼Œé»˜è®¤ä¸ºæ’å®ƒé”ã€‚<br />
lock(long position, long size, booean shared) //è‡ªå®šä¹‰åŠ é”æ–¹å¼ã€‚å‰2ä¸ªå‚æ•°æŒ‡å®šè¦åŠ é”çš„éƒ¨åˆ†ï¼ˆå¯ä»¥åªå¯¹æ­¤æ–‡ä»¶çš„éƒ¨åˆ†å†…å®¹åŠ é”ï¼‰ï¼Œç¬¬ä¸‰ä¸ªå‚æ•°å€¼æŒ‡å®šæ˜¯å¦æ˜¯å…±äº«é”ã€‚<br />
tryLock() //å¯¹æ•´ä¸ªæ–‡ä»¶åŠ é”ï¼Œé»˜è®¤ä¸ºæ’å®ƒé”ã€‚<br />
tryLock(long position, long size, booean shared) //è‡ªå®šä¹‰åŠ é”æ–¹å¼ã€‚<br />
å¦‚æœæŒ‡å®šä¸ºå…±äº«é”ï¼Œåˆ™å…¶å®ƒè¿›ç¨‹å¯è¯»æ­¤æ–‡ä»¶ï¼Œæ‰€æœ‰è¿›ç¨‹å‡ä¸èƒ½å†™æ­¤æ–‡ä»¶ï¼Œå¦‚æœæŸè¿›ç¨‹è¯•å›¾å¯¹æ­¤æ–‡ä»¶è¿›è¡Œå†™æ“ä½œï¼Œä¼šæŠ›å‡ºå¼‚å¸¸ã€‚</p>
<h4 id="5%E3%80%81locklock%E4%B8%8Etrylocktrylock%E7%9A%84%E5%8C%BA%E5%88%AB" id="5ã€locklockä¸tryLocktryLockçš„åŒºåˆ«">5ã€locklockä¸tryLocktryLockçš„åŒºåˆ«</h4>
<p>lockæ˜¯é˜»å¡å¼çš„ï¼Œå¦‚æœæœªè·å–åˆ°æ–‡ä»¶é”ï¼Œä¼šä¸€ç›´é˜»å¡å½“å‰çº¿ç¨‹ï¼Œç›´åˆ°è·å–æ–‡ä»¶é”<br />
tryLockå’Œlockçš„ä½œç”¨ç›¸åŒï¼Œåªä¸è¿‡tryLockæ˜¯éé˜»å¡å¼çš„ï¼ŒtryLockæ˜¯å°è¯•è·å–æ–‡ä»¶é”ï¼Œè·å–æˆåŠŸå°±è¿”å›é”å¯¹è±¡ï¼Œå¦åˆ™è¿”å›nullï¼Œä¸ä¼šé˜»å¡å½“å‰çº¿ç¨‹ã€‚</p>
<h4 id="6%E3%80%81filelock%E4%B8%A4%E4%B8%AA%E6%96%B9%E6%B3%95%EF%BC%9A" id="6ã€FileLockä¸¤ä¸ªæ–¹æ³•ï¼š">6ã€FileLockä¸¤ä¸ªæ–¹æ³•ï¼š</h4>
<p>boolean isShared() //æ­¤æ–‡ä»¶é”æ˜¯å¦æ˜¯å…±äº«é”<br />
boolean isValid() //æ­¤æ–‡ä»¶é”æ˜¯å¦è¿˜æœ‰æ•ˆ<br />
åœ¨æŸäº›OSä¸Šï¼Œå¯¹æŸä¸ªæ–‡ä»¶åŠ é”åï¼Œä¸èƒ½å¯¹æ­¤æ–‡ä»¶ä½¿ç”¨é€šé“æ˜ å°„ã€‚</p>
<h4 id="7%E3%80%81%E5%AE%8C%E6%95%B4%E4%BE%8B%E5%AD%90" id="7ã€å®Œæ•´ä¾‹å­">7ã€å®Œæ•´ä¾‹å­</h4>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.io.BufferedReader;</span><br><span class="line"><span class="keyword">import</span> java.io.FileReader;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.nio.ByteBuffer;</span><br><span class="line"><span class="keyword">import</span> java.nio.channels.FileChannel;</span><br><span class="line"><span class="keyword">import</span> java.nio.channels.FileLock;</span><br><span class="line"><span class="keyword">import</span> java.nio.file.Path;</span><br><span class="line"><span class="keyword">import</span> java.nio.file.Paths;</span><br><span class="line"><span class="keyword">import</span> java.nio.file.StandardOpenOption;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">FileLockDemo</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        String input = <span class="string">&quot;atguigu&quot;</span>;</span><br><span class="line">        System.out.println(<span class="string">&quot;è¾“å…¥ :&quot;</span> + input);</span><br><span class="line">        ByteBuffer buf = ByteBuffer.wrap(input.getBytes());</span><br><span class="line">        String fp = <span class="string">&quot;D:\\atguigu\\01.txt&quot;</span>;</span><br><span class="line">        Path pt = Paths.get(fp);</span><br><span class="line">        FileChannel channel = FileChannel.open(pt, StandardOpenOption.WRITE, StandardOpenOption.APPEND);</span><br><span class="line">        channel.position(channel.size() - <span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// position of a cursor at the end of file</span></span><br><span class="line">        <span class="comment">// è·å¾—é”æ–¹æ³•ä¸€ï¼šlock()ï¼Œé˜»å¡æ–¹æ³•ï¼Œå½“æ–‡ä»¶é”ä¸å¯ç”¨æ—¶ï¼Œå½“å‰è¿›ç¨‹ä¼šè¢«æŒ‚èµ·</span></span><br><span class="line"><span class="comment">//            lock = channel.lock();</span></span><br><span class="line">        <span class="comment">// æ— å‚lock()ä¸ºç‹¬å é”</span></span><br><span class="line"><span class="comment">//            lock = channel.lock(0L, Long.MAX_VALUE, true);</span></span><br><span class="line">        <span class="comment">//æœ‰å‚lock()ä¸ºå…±äº«é”ï¼Œæœ‰å†™æ“ä½œä¼šæŠ¥å¼‚å¸¸</span></span><br><span class="line">        <span class="comment">// è·å¾—é”æ–¹æ³•äºŒï¼štrylock()ï¼Œéé˜»å¡çš„æ–¹æ³•ï¼Œå½“æ–‡ä»¶é”ä¸å¯ç”¨æ—¶ï¼ŒtryLock()ä¼šå¾—åˆ°nullå€¼</span></span><br><span class="line">        FileLock lock = channel.tryLock(<span class="number">0</span>, Long.MAX_VALUE, <span class="keyword">false</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;å…±äº«é”shared: &quot;</span> + lock.isShared());</span><br><span class="line">        channel.write(buf);</span><br><span class="line">        channel.close();</span><br><span class="line">        <span class="comment">// Releases the Lock</span></span><br><span class="line">        System.out.println(<span class="string">&quot;å†™æ“ä½œå®Œæˆ.&quot;</span>);</span><br><span class="line">        <span class="comment">//è¯»å–æ•°æ®</span></span><br><span class="line">        readPrint(fp);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">readPrint</span><span class="params">(String path)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        FileReader filereader = <span class="keyword">new</span> FileReader(path);</span><br><span class="line">        BufferedReader bufferedreader = <span class="keyword">new</span> BufferedReader(filereader);</span><br><span class="line">        String tr = bufferedreader.readLine();</span><br><span class="line">        System.out.println(<span class="string">&quot;è¯»å–å†…å®¹: &quot;</span>);</span><br><span class="line">        <span class="keyword">while</span> (tr != <span class="keyword">null</span>) &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot; &quot;</span> + tr);</span><br><span class="line">            tr = bufferedreader.readLine();</span><br><span class="line">        &#125;</span><br><span class="line">        filereader.close();</span><br><span class="line">        bufferedreader.close();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="path" id="Path">Path</h3>
<h4 id="1%E3%80%81-path-%E7%AE%80%E4%BB%8B" id="1ã€-Path-ç®€ä»‹">1ã€ Path ç®€ä»‹</h4>
<p>Java Pathæ¥å£æ˜¯Java NIOæ›´æ–°çš„ä¸€éƒ¨åˆ†ï¼ŒåŒJava NIOä¸€èµ·å·²ç»åŒ…æ‹¬åœ¨Java6å’ŒJava7ä¸­ã€‚Java Pathæ¥å£æ˜¯åœ¨Java7ä¸­æ·»åŠ åˆ°Java NIOçš„ã€‚Pathæ¥å£ä½äºjava.nio.fileåŒ…ä¸­ï¼Œæ‰€ä»¥Pathæ¥å£çš„å®Œå…¨é™å®šåç§°ä¸ºjava.nio.file.Pathã€‚<br />
Java Pathå®ä¾‹è¡¨ç¤ºæ–‡ä»¶ç³»ç»Ÿä¸­çš„è·¯å¾„ã€‚ä¸€ä¸ªè·¯å¾„å¯ä»¥æŒ‡å‘ä¸€ä¸ªæ–‡ä»¶æˆ–ä¸€ä¸ªç›®å½•ã€‚è·¯å¾„å¯ä»¥æ˜¯ç»å¯¹è·¯å¾„ï¼Œä¹Ÿå¯ä»¥æ˜¯ç›¸å¯¹è·¯å¾„ã€‚ç»å¯¹è·¯å¾„åŒ…å«ä»æ–‡ä»¶ç³»ç»Ÿçš„æ ¹ç›®å½•åˆ°å®ƒæŒ‡å‘çš„æ–‡ä»¶æˆ–ç›®å½•çš„å®Œæ•´è·¯å¾„ã€‚ç›¸å¯¹è·¯å¾„åŒ…å«ç›¸å¯¹äºå…¶ä»–è·¯å¾„çš„æ–‡ä»¶æˆ–ç›®å½•çš„è·¯å¾„ã€‚<br />
åœ¨è®¸å¤šæ–¹é¢ï¼Œjava.nio.file.Pathæ¥å£ç±»ä¼¼äºjava.io.Fileç±»ï¼Œä½†æ˜¯æœ‰ä¸€äº›å·®åˆ«ã€‚ä¸è¿‡ï¼Œåœ¨è®¸å¤šæƒ…å†µä¸‹ï¼Œå¯ä»¥ä½¿ç”¨Pathæ¥å£æ¥æ›¿æ¢Fileç±»çš„ä½¿ç”¨ã€‚</p>
<h4 id="2%E3%80%81%E5%88%9B%E5%BB%BApath%E5%AE%9E%E4%BE%8B" id="2ã€åˆ›å»ºPathå®ä¾‹">2ã€åˆ›å»ºPathå®ä¾‹</h4>
<p>ä½¿ç”¨java.nio.file.Pathå®ä¾‹å¿…é¡»åˆ›å»ºä¸€ä¸ªPathå®ä¾‹ã€‚å¯ä»¥ä½¿ç”¨Pathsç±»(java.nio.file.Paths)ä¸­çš„é™æ€æ–¹æ³•Paths.get()æ¥åˆ›å»ºè·¯å¾„å®ä¾‹ã€‚<br />
ç¤ºä¾‹ä»£ç :</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.nio.file.Path;</span><br><span class="line"><span class="keyword">import</span> java.nio.file.Paths;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">PathDemo</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        Path path = Paths.get(<span class="string">&quot;d:\\atguigu\\001.txt&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ä¸Šè¿°ä»£ç ï¼Œå¯ä»¥ç†è§£ä¸ºï¼ŒPaths.get()æ–¹æ³•æ˜¯Pathå®ä¾‹çš„å·¥å‚æ–¹æ³•ã€‚</p>
<h4 id="3%E3%80%81%E5%88%9B%E5%BB%BA%E7%BB%9D%E5%AF%B9%E8%B7%AF%E5%BE%84" id="3ã€åˆ›å»ºç»å¯¹è·¯å¾„">3ã€åˆ›å»ºç»å¯¹è·¯å¾„</h4>
<p>ï¼ˆ1ï¼‰åˆ›å»ºç»å¯¹è·¯å¾„ï¼Œé€šè¿‡è°ƒç”¨Paths.get()æ–¹æ³•ï¼Œç»™å®šç»å¯¹è·¯å¾„æ–‡ä»¶ä½œä¸ºå‚æ•°æ¥å®Œæˆã€‚<br />
ç¤ºä¾‹ä»£ç ï¼š Path path = Paths.get(&quot;d:\atguigu\001.txt&quot;);<br />
ä¸Šè¿°ä»£ç ä¸­ï¼Œç»å¯¹è·¯å¾„æ˜¯d:\atguigu\001.txtã€‚åœ¨Javaå­—ç¬¦ä¸²ä¸­ï¼Œ \æ˜¯ä¸€ä¸ªè½¬ä¹‰å­—ç¬¦ï¼Œéœ€è¦ç¼–å†™\ï¼Œå‘Šè¯‰Javaç¼–è¯‘å™¨åœ¨å­—ç¬¦ä¸²ä¸­å†™å…¥ä¸€ä¸ª\å­—ç¬¦ã€‚<br />
ï¼ˆ2ï¼‰å¦‚æœåœ¨Linuxã€MacOSç­‰æ“ä½œå­—ä½“ä¸Šï¼Œä¸Šé¢çš„ç»å¯¹è·¯å¾„å¯èƒ½å¦‚ä¸‹:<br />
Path path = Paths.get(&quot;/home/jakobjenkov/myfile.txt&quot;);<br />
ç»å¯¹è·¯å¾„ç°åœ¨ä¸º/home/jakobjenkov/myfile.txt.<br />
ï¼ˆ3ï¼‰å¦‚æœåœ¨Windowsæœºå™¨ä¸Šä½¿ç”¨äº†ä»/å¼€å§‹çš„è·¯å¾„ï¼Œé‚£ä¹ˆè·¯å¾„å°†è¢«è§£é‡Šä¸ºç›¸å¯¹äºå½“å‰é©±åŠ¨å™¨ã€‚</p>
<h4 id="4%E3%80%81%E5%88%9B%E5%BB%BA%E7%9B%B8%E5%AF%B9%E8%B7%AF%E5%BE%84" id="4ã€åˆ›å»ºç›¸å¯¹è·¯å¾„">4ã€åˆ›å»ºç›¸å¯¹è·¯å¾„</h4>
<p>Java NIO Pathç±»ä¹Ÿå¯ä»¥ç”¨äºå¤„ç†ç›¸å¯¹è·¯å¾„ã€‚æ‚¨å¯ä»¥ä½¿ç”¨Paths.get(basePath, relativePath)æ–¹æ³•åˆ›å»ºä¸€ä¸ªç›¸å¯¹è·¯å¾„ã€‚<br />
ç¤ºä¾‹ä»£ç : //ä»£ç 1 Path projects = Paths.get(&quot;d:\atguigu&quot;, &quot;projects&quot;); //ä»£ç 2 Path file = Paths.get(&quot;d:\atguigu&quot;, &quot;projects\002.txt&quot;);<br />
ä»£ç 1åˆ›å»ºäº†ä¸€ä¸ªJava Pathçš„å®ä¾‹ï¼ŒæŒ‡å‘è·¯å¾„(ç›®å½•):d:\atguigu\projects<br />
ä»£ç 2åˆ›å»ºäº†ä¸€ä¸ªPathçš„å®ä¾‹ï¼ŒæŒ‡å‘è·¯å¾„(æ–‡ä»¶):d:\atguigu\projects\002.txt<br />
5ã€Path.normalize()<br />
Pathæ¥å£çš„normalize()æ–¹æ³•å¯ä»¥ä½¿è·¯å¾„æ ‡å‡†åŒ–ã€‚æ ‡å‡†åŒ–æ„å‘³ç€å®ƒå°†ç§»é™¤æ‰€æœ‰åœ¨è·¯å¾„å­—ç¬¦ä¸²çš„ä¸­é—´çš„.å’Œ..ä»£ç ï¼Œå¹¶è§£æè·¯å¾„å­—ç¬¦ä¸²æ‰€å¼•ç”¨çš„è·¯å¾„ã€‚<br />
Path.normalize()ç¤ºä¾‹: String originalPath = &quot;d:\atguigu\projects\..\yygh-project&quot;; Path path1 = Paths.get(originalPath); System.out.println(&quot;path1 = &quot; + path1); Path path2 = path1.normalize(); System.out.println(&quot;path2 = &quot; + path2);<br />
è¾“å‡ºç»“æœï¼šæ ‡å‡†åŒ–çš„è·¯å¾„ä¸åŒ…å«projects..éƒ¨åˆ†</p>
<h3 id="files" id="Files">Files</h3>
<p>Java NIO Filesç±»(java.nio.file.Files)æä¾›äº†å‡ ç§æ“ä½œæ–‡ä»¶ç³»ç»Ÿä¸­çš„æ–‡ä»¶çš„æ–¹æ³•ã€‚ä»¥ä¸‹å†…å®¹ä»‹ç»Java NIO Filesæœ€å¸¸ç”¨çš„ä¸€äº›æ–¹æ³•ã€‚java.nio.file.Filesç±»ä¸java.nio.file.Pathå®ä¾‹ä¸€èµ·å·¥ä½œï¼Œå› æ­¤åœ¨å­¦ä¹ Filesç±»ä¹‹å‰ï¼Œéœ€è¦å…ˆäº†è§£Pathç±»ã€‚</p>
<h4 id="1%E3%80%81-files.createdirectory()" id="1ã€-Files-createDirectory">1ã€ Files.createDirectory()</h4>
<p>Files.createDirectory()æ–¹æ³•ï¼Œç”¨äºæ ¹æ®Pathå®ä¾‹åˆ›å»ºä¸€ä¸ªæ–°ç›®å½•<br />
ç¤ºä¾‹ï¼š Path path = Paths.get(&quot;d:\sgg&quot;); try { Path newDir = Files.createDirectory(path); } catch(FileAlreadyExistsException e){ // ç›®å½•å·²ç»å­˜åœ¨ } catch (IOException e) { // å…¶ä»–å‘ç”Ÿçš„å¼‚å¸¸ e.printStackTrace(); }<br />
ç¬¬ä¸€è¡Œåˆ›å»ºè¡¨ç¤ºè¦åˆ›å»ºçš„ç›®å½•çš„Pathå®ä¾‹ã€‚åœ¨try-catchå—ä¸­ï¼Œç”¨è·¯å¾„ä½œä¸ºå‚æ•°è°ƒç”¨Files.createDirectory()æ–¹æ³•ã€‚å¦‚æœåˆ›å»ºç›®å½•æˆåŠŸï¼Œå°†è¿”å›ä¸€ä¸ªPathå®ä¾‹ï¼Œè¯¥å®ä¾‹æŒ‡å‘æ–°åˆ›å»ºçš„è·¯å¾„ã€‚<br />
å¦‚æœè¯¥ç›®å½•å·²ç»å­˜åœ¨ï¼Œåˆ™æ˜¯æŠ›å‡ºä¸€ä¸ªjava.nio.file.FileAlreadyExistsExceptionã€‚å¦‚æœå‡ºç°å…¶ä»–é”™è¯¯ï¼Œå¯èƒ½ä¼šæŠ›å‡ºIOExceptionã€‚ä¾‹å¦‚ï¼Œå¦‚æœæƒ³è¦çš„æ–°ç›®å½•çš„çˆ¶ç›®å½•ä¸å­˜åœ¨ï¼Œåˆ™å¯èƒ½ä¼šæŠ›å‡ºIOExceptionã€‚</p>
<h4 id="2%E3%80%81files.copy()" id="2ã€Files-copy">2ã€Files.copy()</h4>
<p>ï¼ˆ1ï¼‰Files.copy()æ–¹æ³•ä»ä¸€ä¸ªè·¯å¾„æ‹·è´ä¸€ä¸ªæ–‡ä»¶åˆ°å¦å¤–ä¸€ä¸ªç›®å½•<br />
ç¤ºä¾‹ï¼š Path sourcePath = Paths.get(&quot;d:\atguigu\01.txt&quot;); Path destinationPath = Paths.get(&quot;d:\atguigu\002.txt&quot;); try { Files.copy(sourcePath, destinationPath); } catch(FileAlreadyExistsException e) { // ç›®å½•å·²ç»å­˜åœ¨ } catch (IOException e) { // å…¶ä»–å‘ç”Ÿçš„å¼‚å¸¸ e.printStackTrace(); }<br />
é¦–å…ˆï¼Œè¯¥ç¤ºä¾‹åˆ›å»ºä¸¤ä¸ªPathå®ä¾‹ã€‚ç„¶åï¼Œè¿™ä¸ªä¾‹å­è°ƒç”¨Files.copy()ï¼Œå°†ä¸¤ä¸ªPathå®ä¾‹ä½œä¸ºå‚æ•°ä¼ é€’ã€‚è¿™å¯ä»¥è®©æºè·¯å¾„å¼•ç”¨çš„æ–‡ä»¶è¢«å¤åˆ¶åˆ°ç›®æ ‡è·¯å¾„å¼•ç”¨çš„æ–‡ä»¶ä¸­ã€‚<br />
å¦‚æœç›®æ ‡æ–‡ä»¶å·²ç»å­˜åœ¨ï¼Œåˆ™æŠ›å‡ºä¸€ä¸ªjava.nio.file.FileAlreadyExistsExceptionå¼‚å¸¸ã€‚å¦‚æœæœ‰å…¶ä»–é”™è¯¯ï¼Œåˆ™ä¼šæŠ›å‡ºä¸€ä¸ªIOExceptionã€‚ä¾‹å¦‚ï¼Œå¦‚æœå°†è¯¥æ–‡ä»¶å¤åˆ¶åˆ°ä¸å­˜åœ¨çš„ç›®å½•ï¼Œåˆ™ä¼šæŠ›å‡ºIOExceptionã€‚<br />
ï¼ˆ2ï¼‰è¦†ç›–å·²å­˜åœ¨çš„æ–‡ä»¶<br />
Files.copy()æ–¹æ³•çš„ç¬¬ä¸‰ä¸ªå‚æ•°ã€‚å¦‚æœç›®æ ‡æ–‡ä»¶å·²ç»å­˜åœ¨ï¼Œè¿™ä¸ªå‚æ•°æŒ‡ç¤ºcopy()æ–¹æ³•è¦†ç›–ç°æœ‰çš„æ–‡ä»¶ã€‚ Files.copy(sourcePath, destinationPath, StandardCopyOption.REPLACE_EXISTING);</p>
<h4 id="3%E3%80%81files.move()" id="3ã€Files-move">3ã€Files.move()</h4>
<p>Files.move()ç”¨äºå°†æ–‡ä»¶ä»ä¸€ä¸ªè·¯å¾„ç§»åŠ¨åˆ°å¦ä¸€ä¸ªè·¯å¾„ã€‚ç§»åŠ¨æ–‡ä»¶ä¸é‡å‘½åç›¸åŒï¼Œä½†æ˜¯ç§»åŠ¨æ–‡ä»¶æ—¢å¯ä»¥ç§»åŠ¨åˆ°ä¸åŒçš„ç›®å½•ï¼Œä¹Ÿå¯ä»¥åœ¨ç›¸åŒçš„æ“ä½œä¸­æ›´æ”¹å®ƒçš„åç§°ã€‚<br />
ç¤ºä¾‹ï¼š Path sourcePath = Paths.get(&quot;d:\atguigu\01.txt&quot;); Path destinationPath = Paths.get(&quot;d:\atguigu\001.txt&quot;); try { Files.move(sourcePath, destinationPath, StandardCopyOption.REPLACE_EXISTING); } catch (IOException e) { //ç§»åŠ¨æ–‡ä»¶å¤±è´¥ e.printStackTrace(); }<br />
Files.move()çš„ç¬¬ä¸‰ä¸ªå‚æ•°ã€‚è¿™ä¸ªå‚æ•°å‘Šè¯‰Files.move()æ–¹æ³•æ¥è¦†ç›–ç›®æ ‡è·¯å¾„ä¸Šçš„ä»»ä½•ç°æœ‰æ–‡ä»¶ã€‚</p>
<h4 id="4%E3%80%81files.delete()" id="4ã€Files-delete">4ã€Files.delete()</h4>
<p>Files.delete()æ–¹æ³•å¯ä»¥åˆ é™¤ä¸€ä¸ªæ–‡ä»¶æˆ–è€…ç›®å½•ã€‚<br />
ç¤ºä¾‹ï¼š Path path = Paths.get(&quot;d:\atguigu\001.txt&quot;); try { Files.delete(path); } catch (IOException e) { // åˆ é™¤æ–‡ä»¶å¤±è´¥ e.printStackTrace(); }<br />
åˆ›å»ºæŒ‡å‘è¦åˆ é™¤çš„æ–‡ä»¶çš„Pathã€‚ç„¶åè°ƒç”¨Files.delete()æ–¹æ³•ã€‚å¦‚æœFiles.delete()ä¸èƒ½åˆ é™¤æ–‡ä»¶(ä¾‹å¦‚ï¼Œæ–‡ä»¶æˆ–ç›®å½•ä¸å­˜åœ¨)ï¼Œä¼šæŠ›å‡ºä¸€ä¸ªIOExceptionã€‚</p>
<h4 id="5.files.walkfiletree()" id="5-Files-walkFileTree">5.Files.walkFileTree()</h4>
<p>ï¼ˆ1ï¼‰Files.walkFileTree()æ–¹æ³•åŒ…å«é€’å½’éå†ç›®å½•æ ‘åŠŸèƒ½ï¼Œå°†Pathå®ä¾‹å’ŒFileVisitorä½œä¸ºå‚æ•°ã€‚Pathå®ä¾‹æŒ‡å‘è¦éå†çš„ç›®å½•ï¼ŒFileVisitoråœ¨éå†æœŸé—´è¢«è°ƒç”¨ã€‚<br />
ï¼ˆ2ï¼‰FileVisitoræ˜¯ä¸€ä¸ªæ¥å£ï¼Œå¿…é¡»è‡ªå·±å®ç°FileVisitoræ¥å£ï¼Œå¹¶å°†å®ç°çš„å®ä¾‹ä¼ é€’ç»™walkFileTree()æ–¹æ³•ã€‚åœ¨ç›®å½•éå†è¿‡ç¨‹ä¸­ï¼Œæ‚¨çš„FileVisitorå®ç°çš„æ¯ä¸ªæ–¹æ³•éƒ½å°†è¢«è°ƒç”¨ã€‚å¦‚æœä¸éœ€è¦å®ç°æ‰€æœ‰è¿™äº›æ–¹æ³•ï¼Œé‚£ä¹ˆå¯ä»¥æ‰©å±•SimpleFileVisitorç±»ï¼Œå®ƒåŒ…å«FileVisitoræ¥å£ä¸­æ‰€æœ‰æ–¹æ³•çš„é»˜è®¤å®ç°ã€‚<br />
ï¼ˆ3ï¼‰FileVisitoræ¥å£çš„æ–¹æ³•ä¸­ï¼Œæ¯ä¸ªéƒ½è¿”å›ä¸€ä¸ªFileVisitResultæšä¸¾å®ä¾‹ã€‚FileVisitResultæšä¸¾åŒ…å«ä»¥ä¸‹å››ä¸ªé€‰é¡¹:<br />
CONTINUE ç»§ç»­<br />
TERMINATE ç»ˆæ­¢<br />
SKIP_SIBLING è·³è¿‡åŒçº§<br />
SKIP_SUBTREE è·³è¿‡å­çº§<br />
ï¼ˆ4ï¼‰æŸ¥æ‰¾ä¸€ä¸ªåä¸º001.txtçš„æ–‡ä»¶ç¤ºä¾‹ï¼š Path rootPath = Paths.get(&quot;d:\atguigu&quot;); String fileToFind = File.separator + &quot;001.txt&quot;; try { Files.walkFileTree(rootPath, new SimpleFileVisitor<Path>() { @Override public FileVisitResult visitFile(Path file, BasicFileAttributes attrs) throws IOException { String fileString = file.toAbsolutePath().toString(); <a target="_blank" rel="noopener" href="//System.out.println">//System.out.println</a>(&quot;pathString = &quot; + fileString);<br />
if(fileString.endsWith(fileToFind)){ System.out.println(&quot;file found at path: &quot; + file.toAbsolutePath()); return FileVisitResult.TERMINATE; } return FileVisitResult.CONTINUE; } }); } catch(IOException e){ e.printStackTrace(); }<br />
ï¼ˆ5ï¼‰java.nio.file.Filesç±»åŒ…å«è®¸å¤šå…¶ä»–çš„å‡½æ•°ï¼Œæœ‰å…³è¿™äº›æ–¹æ³•çš„æ›´å¤šä¿¡æ¯ï¼Œè¯·æŸ¥çœ‹java.nio.file.Filesç±»çš„JavaDocã€‚</p>
<h3 id="asynchronousfilechannel" id="AsynchronousFileChannel">AsynchronousFileChannel</h3>
<p>åœ¨Java 7ä¸­ï¼ŒJava NIOä¸­æ·»åŠ äº†AsynchronousFileChannelï¼Œä¹Ÿå°±æ˜¯æ˜¯å¼‚æ­¥åœ°å°†æ•°æ®å†™å…¥æ–‡ä»¶ã€‚</p>
<h4 id="1%E3%80%81%E5%88%9B%E5%BB%BA-asynchronousfilechannel" id="1ã€åˆ›å»º-AsynchronousFileChannel">1ã€åˆ›å»º AsynchronousFileChannel</h4>
<p>é€šè¿‡é™æ€æ–¹æ³•open()åˆ›å»º<br />
ç¤ºä¾‹ï¼š Path path = Paths.get(&quot;d:\atguigu\01.txt&quot;); try { AsynchronousFileChannel fileChannel = AsynchronousFileChannel.open(path, StandardOpenOption.READ); } catch (IOException e) { e.printStackTrace(); }<br />
open()æ–¹æ³•çš„ç¬¬ä¸€ä¸ªå‚æ•°æŒ‡å‘ä¸AsynchronousFileChannelç›¸å…³è”æ–‡ä»¶çš„Pathå®ä¾‹ã€‚<br />
ç¬¬äºŒä¸ªå‚æ•°æ˜¯ä¸€ä¸ªæˆ–å¤šä¸ªæ‰“å¼€é€‰é¡¹ï¼Œå®ƒå‘Šè¯‰AsynchronousFileChannelåœ¨æ–‡ä»¶ä¸Šæ‰§è¡Œä»€ä¹ˆæ“ä½œã€‚åœ¨æœ¬ä¾‹ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨äº†StandardOpenOption.READé€‰é¡¹ï¼Œè¡¨ç¤ºè¯¥æ–‡ä»¶å°†è¢«æ‰“å¼€é˜…è¯»ã€‚</p>
<h4 id="2%E3%80%81%E9%80%9A%E8%BF%87future%E8%AF%BB%E5%8F%96%E6%95%B0%E6%8D%AE" id="2ã€é€šè¿‡Futureè¯»å–æ•°æ®">2ã€é€šè¿‡Futureè¯»å–æ•°æ®</h4>
<p>å¯ä»¥é€šè¿‡ä¸¤ç§æ–¹å¼ä»AsynchronousFileChannelè¯»å–æ•°æ®ã€‚ç¬¬ä¸€ç§æ–¹å¼æ˜¯è°ƒç”¨è¿”å›Futureçš„read()æ–¹æ³•<br />
ç¤ºä¾‹ï¼š Path path = Paths.get(&quot;d:\atguigu\001.txt&quot;); AsynchronousFileChannel fileChannel = null; try { fileChannel = AsynchronousFileChannel.open(path, StandardOpenOption.READ); } catch (IOException e) { e.printStackTrace(); } ByteBuffer buffer = ByteBuffer.allocate(1024); long position = 0; Future<Integer> operation = fileChannel.read(buffer, position); while(!operation.isDone()); buffer.flip(); byte[] data = new byte[buffer.limit()]; buffer.get(data); System.out.println(new String(data)); buffer.clear();<br />
ä¸Šè¿°ä»£ç ï¼š<br />
ï¼ˆ1ï¼‰åˆ›å»ºäº†ä¸€ä¸ªAsynchronousFileChannelï¼Œ<br />
ï¼ˆ2ï¼‰åˆ›å»ºä¸€ä¸ªByteBufferï¼Œå®ƒè¢«ä¼ é€’ç»™read()æ–¹æ³•ä½œä¸ºå‚æ•°ï¼Œä»¥åŠä¸€ä¸ª0çš„ä½ç½®ã€‚<br />
ï¼ˆ3ï¼‰åœ¨è°ƒç”¨read()ä¹‹åï¼Œå¾ªç¯ï¼Œç›´åˆ°è¿”å›çš„isDone()æ–¹æ³•è¿”å›trueã€‚<br />
ï¼ˆ4ï¼‰è¯»å–æ“ä½œå®Œæˆåï¼Œæ•°æ®è¯»å–åˆ°ByteBufferä¸­ï¼Œç„¶åæ‰“å°åˆ°System.outä¸­ã€‚</p>
<h4 id="3%E3%80%81%E9%80%9A%E8%BF%87completionhandler%E8%AF%BB%E5%8F%96%E6%95%B0%E6%8D%AE" id="3ã€é€šè¿‡CompletionHandlerè¯»å–æ•°æ®">3ã€é€šè¿‡CompletionHandlerè¯»å–æ•°æ®</h4>
<p>ç¬¬äºŒç§æ–¹æ³•æ˜¯è°ƒç”¨read()æ–¹æ³•ï¼Œè¯¥æ–¹æ³•å°†ä¸€ä¸ªCompletionHandlerä½œä¸ºå‚æ•° ç¤ºä¾‹ï¼š Path path = Paths.get(&quot;d:\atguigu\001.txt&quot;); AsynchronousFileChannel fileChannel = null; try { fileChannel = AsynchronousFileChannel.open(path, StandardOpenOption.READ); } catch (IOException e) { e.printStackTrace(); } ByteBuffer buffer = ByteBuffer.allocate(1024); long position = 0; fileChannel.read(buffer, position, buffer, new CompletionHandler&lt;Integer, ByteBuffer&gt;() { @Override public void completed(Integer result, ByteBuffer attachment) { System.out.println(&quot;result = &quot; + result); attachment.flip(); byte[] data = new byte[attachment.limit()]; attachment.get(data);<br />
System.out.println(new String(data)); attachment.clear(); } @Override public void failed(Throwable exc, ByteBuffer attachment) { } });<br />
ï¼ˆ1ï¼‰è¯»å–æ“ä½œå®Œæˆï¼Œå°†è°ƒç”¨CompletionHandlerçš„completed()æ–¹æ³•ã€‚<br />
ï¼ˆ2ï¼‰å¯¹äºcompleted()æ–¹æ³•çš„å‚æ•°ä¼ é€’ä¸€ä¸ªæ•´æ•°ï¼Œå®ƒå‘Šè¯‰æˆ‘ä»¬è¯»å–äº†å¤šå°‘å­—èŠ‚ï¼Œä»¥åŠä¼ é€’ç»™read()æ–¹æ³•çš„â€œé™„ä»¶â€ã€‚â€œé™„ä»¶â€æ˜¯read()æ–¹æ³•çš„ç¬¬ä¸‰ä¸ªå‚æ•°ã€‚åœ¨æœ¬ä»£ç ä¸­ï¼Œå®ƒæ˜¯ByteBufferï¼Œæ•°æ®ä¹Ÿè¢«è¯»å–ã€‚<br />
ï¼ˆ3ï¼‰å¦‚æœè¯»å–æ“ä½œå¤±è´¥ï¼Œåˆ™å°†è°ƒç”¨CompletionHandlerçš„failed()æ–¹æ³•ã€‚</p>
<h4 id="4%E3%80%81%E9%80%9A%E8%BF%87future%E5%86%99%E6%95%B0%E6%8D%AE" id="4ã€é€šè¿‡Futureå†™æ•°æ®">4ã€é€šè¿‡Futureå†™æ•°æ®</h4>
<p>å’Œè¯»å–ä¸€æ ·ï¼Œå¯ä»¥é€šè¿‡ä¸¤ç§æ–¹å¼å°†æ•°æ®å†™å…¥ä¸€ä¸ªAsynchronousFileChannel<br />
ç¤ºä¾‹ï¼š Path path = Paths.get(&quot;d:\atguigu\001.txt&quot;); AsynchronousFileChannel fileChannel = null; try { fileChannel = AsynchronousFileChannel.open(path, StandardOpenOption.WRITE); } catch (IOException e) { e.printStackTrace(); } ByteBuffer buffer = ByteBuffer.allocate(1024); long position = 0; buffer.put(&quot;atguigu data&quot;.getBytes()); buffer.flip();<br />
Future<Integer> operation = fileChannel.write(buffer, position); buffer.clear(); while(!operation.isDone()); System.out.println(&quot;Write over&quot;);<br />
é¦–å…ˆï¼ŒAsynchronousFileChannelä»¥å†™æ¨¡å¼æ‰“å¼€ã€‚ç„¶ååˆ›å»ºä¸€ä¸ªByteBufferï¼Œå¹¶å°†ä¸€äº›æ•°æ®å†™å…¥å…¶ä¸­ã€‚ç„¶åï¼ŒByteBufferä¸­çš„æ•°æ®è¢«å†™å…¥åˆ°æ–‡ä»¶ä¸­ã€‚æœ€åï¼Œç¤ºä¾‹æ£€æŸ¥è¿”å›çš„Futureï¼Œä»¥æŸ¥çœ‹å†™æ“ä½œå®Œæˆæ—¶çš„æƒ…å†µã€‚<br />
æ³¨æ„ï¼Œæ–‡ä»¶å¿…é¡»å·²ç»å­˜åœ¨ã€‚å¦‚æœè¯¥æ–‡ä»¶ä¸å­˜åœ¨ï¼Œé‚£ä¹ˆwrite()æ–¹æ³•å°†æŠ›å‡ºä¸€ä¸ªjava.nio.file.NoSuchFileExceptionã€‚</p>
<h4 id="5%E3%80%81%E9%80%9A%E8%BF%87completionhandler%E5%86%99%E6%95%B0%E6%8D%AE" id="5ã€é€šè¿‡CompletionHandlerå†™æ•°æ®">5ã€é€šè¿‡CompletionHandlerå†™æ•°æ®</h4>
<p>ç¤ºä¾‹ï¼š</p>
<p>Path path = Paths.get(&quot;d:\atguigu\001.txt&quot;); if(!Files.exists(path)){ try { Files.createFile(path); } catch (IOException e) { e.printStackTrace(); } } AsynchronousFileChannel fileChannel = null; try { fileChannel = AsynchronousFileChannel.open(path, StandardOpenOption.WRITE); } catch (IOException e) { e.printStackTrace(); } ByteBuffer buffer = ByteBuffer.allocate(1024);<br />
long position = 0; buffer.put(&quot;atguigu data&quot;.getBytes()); buffer.flip(); fileChannel.write(buffer, position, buffer, new CompletionHandler&lt;Integer, ByteBuffer&gt;() { @Override public void completed(Integer result, ByteBuffer attachment) { System.out.println(&quot;bytes written: &quot; + result); } @Override public void failed(Throwable exc, ByteBuffer attachment) { System.out.println(&quot;Write failed&quot;); exc.printStackTrace(); } });</p>
<p>å½“å†™æ“ä½œå®Œæˆæ—¶ï¼Œå°†ä¼šè°ƒç”¨CompletionHandlerçš„completed()æ–¹æ³•ã€‚å¦‚æœå†™å¤±è´¥ï¼Œåˆ™ä¼šè°ƒç”¨failed()æ–¹æ³•ã€‚</p>
<h3 id="%E5%AD%97%E7%AC%A6%E9%9B%86%EF%BC%88charset%EF%BC%89" id="å­—ç¬¦é›†ï¼ˆCharsetï¼‰">å­—ç¬¦é›†ï¼ˆCharsetï¼‰</h3>
<p>javaä¸­ä½¿ç”¨Charsetæ¥è¡¨ç¤ºå­—ç¬¦é›†ç¼–ç å¯¹è±¡</p>
<h4 id="charset%E5%B8%B8%E7%94%A8%E9%9D%99%E6%80%81%E6%96%B9%E6%B3%95" id="Charsetå¸¸ç”¨é™æ€æ–¹æ³•">Charsetå¸¸ç”¨é™æ€æ–¹æ³•</h4>
<p>public static Charset forName(String charsetName)//é€šè¿‡ç¼–ç ç±»å‹è·å¾—Charsetå¯¹è±¡<br />
public static SortedMap&lt;String,Charset&gt; availableCharsets()//è·å¾—ç³»ç»Ÿæ”¯æŒçš„æ‰€æœ‰ç¼–ç æ–¹å¼<br />
public static Charset defaultCharset()//è·å¾—è™šæ‹Ÿæœºé»˜è®¤çš„ç¼–ç æ–¹å¼<br />
public static boolean isSupported(String charsetName)//åˆ¤æ–­æ˜¯å¦æ”¯æŒè¯¥ç¼–ç ç±»å‹</p>
<h4 id="charset%E5%B8%B8%E7%94%A8%E6%99%AE%E9%80%9A%E6%96%B9%E6%B3%95" id="Charsetå¸¸ç”¨æ™®é€šæ–¹æ³•">Charsetå¸¸ç”¨æ™®é€šæ–¹æ³•</h4>
<p>public final String name()//è·å¾—Charsetå¯¹è±¡çš„ç¼–ç ç±»å‹(String)<br />
public abstract CharsetEncoder newEncoder()//è·å¾—ç¼–ç å™¨å¯¹è±¡<br />
public abstract CharsetDecoder newDecoder()//è·å¾—è§£ç å™¨å¯¹è±¡<br />
ä»£ç ç¤ºä¾‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.junit.jupiter.api.Test;</span><br><span class="line"><span class="keyword">import</span> java.nio.ByteBuffer;</span><br><span class="line"><span class="keyword">import</span> java.nio.CharBuffer;</span><br><span class="line"><span class="keyword">import</span> java.nio.charset.CharacterCodingException;</span><br><span class="line"><span class="keyword">import</span> java.nio.charset.Charset;</span><br><span class="line"><span class="keyword">import</span> java.nio.charset.CharsetDecoder;</span><br><span class="line"><span class="keyword">import</span> java.nio.charset.CharsetEncoder;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"><span class="keyword">import</span> java.util.Set;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CharsetDemo</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">charSetEncoderAndDecoder</span><span class="params">()</span> <span class="keyword">throws</span> CharacterCodingException </span>&#123;</span><br><span class="line">        Charset charset = Charset.forName(<span class="string">&quot;UTF-8&quot;</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="comment">//1.è·å–ç¼–ç å™¨</span></span><br><span class="line">        CharsetEncoder charsetEncoder = charset.newEncoder();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 2.è·å–è§£ç å™¨</span></span><br><span class="line">        CharsetDecoder charsetDecoder = charset.newDecoder();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 3.è·å–éœ€è¦è§£ç ç¼–ç çš„æ•°æ®</span></span><br><span class="line">        CharBuffer charBuffer = CharBuffer.allocate(<span class="number">1024</span>);</span><br><span class="line">        charBuffer.put(<span class="string">&quot;å­—ç¬¦é›†ç¼–ç è§£ç &quot;</span>);</span><br><span class="line">        charBuffer.flip();</span><br><span class="line">        <span class="comment">//4.ç¼–ç  </span></span><br><span class="line">        ByteBuffer byteBuffer = charsetEncoder.encode(charBuffer);</span><br><span class="line">        System.out.println(<span class="string">&quot;ç¼–ç åï¼š&quot;</span>);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; byteBuffer.limit(); i++) &#123;</span><br><span class="line">            System.out.println(byteBuffer.get());</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//5.è§£ç </span></span><br><span class="line">        byteBuffer.flip();</span><br><span class="line">        CharBuffer charBuffer1 = charsetDecoder.decode(byteBuffer);</span><br><span class="line">        System.out.println(<span class="string">&quot;è§£ç åï¼š&quot;</span>);</span><br><span class="line">        System.out.println(charBuffer1.toString());</span><br><span class="line">        System.out.println(<span class="string">&quot;æŒ‡å®šå…¶ä»–æ ¼å¼è§£ç :&quot;</span>);</span><br><span class="line">        Charset charset1 = Charset.forName(<span class="string">&quot;GBK&quot;</span>);</span><br><span class="line">        byteBuffer.flip();</span><br><span class="line">        CharBuffer charBuffer2 = charset1.decode(byteBuffer);</span><br><span class="line">        System.out.println(charBuffer2.toString());</span><br><span class="line">        <span class="comment">//6.è·å–Charsetæ‰€æ”¯æŒçš„å­—ç¬¦ç¼–ç </span></span><br><span class="line">        Map&lt;String, Charset&gt; map = Charset.availableCharsets();</span><br><span class="line">        Set&lt;Map.Entry&lt;String, Charset&gt;&gt; set = map.entrySet();</span><br><span class="line">        <span class="keyword">for</span> (Map.Entry&lt;String, Charset&gt; entry : set) &#123;</span><br><span class="line">            System.out.println(entry.getKey() + <span class="string">&quot;=&quot;</span> + entry.getValue().toString());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h3 id="nio%E5%A4%9A%E7%BA%BF%E7%A8%8B%E8%81%8A%E5%A4%A9%E5%AE%A4%E4%BE%8B%E5%AD%90" id="NIOå¤šçº¿ç¨‹èŠå¤©å®¤ä¾‹å­">NIOå¤šçº¿ç¨‹èŠå¤©å®¤ä¾‹å­</h3>
<h4 id="%E6%9C%8D%E5%8A%A1%E7%AB%AF" id="æœåŠ¡ç«¯">æœåŠ¡ç«¯</h4>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.net.InetSocketAddress;</span><br><span class="line"><span class="keyword">import</span> java.nio.ByteBuffer;</span><br><span class="line"><span class="keyword">import</span> java.nio.channels.*;</span><br><span class="line"><span class="keyword">import</span> java.nio.charset.Charset;</span><br><span class="line"><span class="keyword">import</span> java.util.Iterator;</span><br><span class="line"><span class="keyword">import</span> java.util.Set;</span><br><span class="line"></span><br><span class="line"><span class="comment">//æœåŠ¡å™¨ç«¯</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ChatServer</span> </span>&#123;</span><br><span class="line">    <span class="comment">//æœåŠ¡å™¨ç«¯å¯åŠ¨çš„æ–¹æ³•</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">startServer</span><span class="params">()</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        <span class="comment">//1 åˆ›å»ºSelectoré€‰æ‹©å™¨</span></span><br><span class="line">        Selector selector = Selector.open();</span><br><span class="line">        <span class="comment">//2 åˆ›å»ºServerSocketChannelé€šé“</span></span><br><span class="line">        ServerSocketChannel serverSocketChannel = ServerSocketChannel.open();</span><br><span class="line">        <span class="comment">//3 ä¸ºchannelé€šé“ç»‘å®šç›‘å¬ç«¯å£</span></span><br><span class="line">        serverSocketChannel.bind(<span class="keyword">new</span> InetSocketAddress(<span class="number">8000</span>));</span><br><span class="line">        <span class="comment">//è®¾ç½®éé˜»å¡æ¨¡å¼</span></span><br><span class="line">        serverSocketChannel.configureBlocking(<span class="keyword">false</span>);</span><br><span class="line">        <span class="comment">//4 æŠŠchannelé€šé“æ³¨å†Œåˆ°selectoré€‰æ‹©å™¨ä¸Š</span></span><br><span class="line">        serverSocketChannel.register(selector, SelectionKey.OP_ACCEPT);</span><br><span class="line">        System.out.println(<span class="string">&quot;æœåŠ¡å™¨å·²ç»å¯åŠ¨æˆåŠŸäº†&quot;</span>);</span><br><span class="line">        <span class="comment">//5 å¾ªç¯ï¼Œç­‰å¾…æœ‰æ–°é“¾æ¥æ¥å…¥</span></span><br><span class="line">        <span class="keyword">while</span> (<span class="keyword">true</span>) <span class="keyword">for</span> (; ; ) &#123;</span><br><span class="line">            <span class="comment">//è·å–channelæ•°é‡</span></span><br><span class="line">            <span class="keyword">int</span> readChannels = selector.select();</span><br><span class="line">            <span class="keyword">if</span> (readChannels == <span class="number">0</span>) &#123;</span><br><span class="line">                <span class="keyword">continue</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">//è·å–å¯ç”¨çš„channel</span></span><br><span class="line">            Set&lt;SelectionKey&gt; selectionKeys = selector.selectedKeys();</span><br><span class="line">            <span class="comment">//éå†é›†åˆ</span></span><br><span class="line">            Iterator&lt;SelectionKey&gt; iterator = selectionKeys.iterator();</span><br><span class="line">            <span class="keyword">while</span> (iterator.hasNext()) &#123;</span><br><span class="line">                SelectionKey selectionKey = iterator.next();</span><br><span class="line">                <span class="comment">//ç§»é™¤seté›†åˆå½“å‰selectionKey</span></span><br><span class="line">                iterator.remove();</span><br><span class="line">                <span class="comment">//6 æ ¹æ®å°±ç»ªçŠ¶æ€ï¼Œè°ƒç”¨å¯¹åº”æ–¹æ³•å®ç°å…·ä½“ä¸šåŠ¡æ“ä½œ</span></span><br><span class="line">                <span class="comment">//6.1 å¦‚æœacceptçŠ¶æ€</span></span><br><span class="line">                <span class="keyword">if</span> (selectionKey.isAcceptable()) &#123;</span><br><span class="line">                    acceptOperator(serverSocketChannel, selector);</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="comment">//6.2 å¦‚æœå¯è¯»çŠ¶æ€</span></span><br><span class="line">                <span class="keyword">if</span> (selectionKey.isReadable()) &#123;</span><br><span class="line">                    readOperator(selector, selectionKey);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//å¤„ç†å¯è¯»çŠ¶æ€æ“ä½œ</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">readOperator</span><span class="params">(Selector selector, SelectionKey selectionKey)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        <span class="comment">//1 ä»SelectionKeyè·å–åˆ°å·²ç»å°±ç»ªçš„é€šé“</span></span><br><span class="line">        SocketChannel socketChannel = (SocketChannel) selectionKey.channel();</span><br><span class="line">        <span class="comment">//2 åˆ›å»ºbuffer</span></span><br><span class="line">        ByteBuffer byteBuffer = ByteBuffer.allocate(<span class="number">1024</span>);</span><br><span class="line">        <span class="comment">//3 å¾ªç¯è¯»å–å®¢æˆ·ç«¯æ¶ˆæ¯</span></span><br><span class="line">        <span class="keyword">int</span> readLength = socketChannel.read(byteBuffer);</span><br><span class="line">        String message = <span class="string">&quot;&quot;</span>;</span><br><span class="line">        <span class="keyword">if</span> (readLength &gt; <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="comment">//åˆ‡æ¢è¯»æ¨¡å¼</span></span><br><span class="line">            byteBuffer.flip();</span><br><span class="line"></span><br><span class="line">            <span class="comment">//è¯»å–å†…å®¹</span></span><br><span class="line">            message += Charset.forName(<span class="string">&quot;UTF-8&quot;</span>).decode(byteBuffer);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//4 å°†channelå†æ¬¡æ³¨å†Œåˆ°é€‰æ‹©å™¨ä¸Šï¼Œç›‘å¬å¯è¯»çŠ¶æ€</span></span><br><span class="line">        socketChannel.register(selector, SelectionKey.OP_READ);</span><br><span class="line">        <span class="comment">//5 æŠŠå®¢æˆ·ç«¯å‘é€æ¶ˆæ¯ï¼Œå¹¿æ’­åˆ°å…¶ä»–å®¢æˆ·ç«¯</span></span><br><span class="line">        <span class="keyword">if</span> (message.length() &gt; <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="comment">//å¹¿æ’­ç»™å…¶ä»–å®¢æˆ·ç«¯</span></span><br><span class="line">            System.out.println(message);</span><br><span class="line">            castOtherClient(message, selector, socketChannel);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//å¹¿æ’­åˆ°å…¶ä»–å®¢æˆ·ç«¯</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">castOtherClient</span><span class="params">(String message, Selector selector, SocketChannel socketChannel)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        <span class="comment">//1 è·å–æ‰€æœ‰å·²ç»æ¥å…¥channel</span></span><br><span class="line">        Set&lt;SelectionKey&gt; selectionKeySet = selector.keys();</span><br><span class="line">        <span class="comment">//2 å¾ªç¯æƒ³æ‰€æœ‰channelå¹¿æ’­æ¶ˆæ¯</span></span><br><span class="line">        <span class="keyword">for</span> (SelectionKey selectionKey : selectionKeySet) &#123;</span><br><span class="line">            <span class="comment">//è·å–æ¯ä¸ªchannel</span></span><br><span class="line">            Channel tarChannel = selectionKey.channel();</span><br><span class="line">            <span class="comment">//ä¸éœ€è¦ç»™è‡ªå·±å‘é€</span></span><br><span class="line">            <span class="keyword">if</span> (tarChannel <span class="keyword">instanceof</span> SocketChannel &amp;&amp; tarChannel != socketChannel) &#123;</span><br><span class="line">                ((SocketChannel) tarChannel).write(Charset.forName(<span class="string">&quot;UTF-8&quot;</span>).encode(message));</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//å¤„ç†æ¥å…¥çŠ¶æ€æ“ä½œ</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">acceptOperator</span><span class="params">(ServerSocketChannel serverSocketChannel, Selector selector)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        <span class="comment">//1 æ¥å…¥çŠ¶æ€ï¼Œåˆ›å»ºsocketChannel</span></span><br><span class="line">        SocketChannel socketChannel = serverSocketChannel.accept();</span><br><span class="line">        <span class="comment">//2 æŠŠsocketChannelè®¾ç½®éé˜»å¡æ¨¡å¼</span></span><br><span class="line">        socketChannel.configureBlocking(<span class="keyword">false</span>);</span><br><span class="line">        <span class="comment">//3 æŠŠchannelæ³¨å†Œåˆ°selectoré€‰æ‹©å™¨ä¸Šï¼Œç›‘å¬å¯è¯»çŠ¶æ€</span></span><br><span class="line">        socketChannel.register(selector, SelectionKey.OP_READ);</span><br><span class="line">        <span class="comment">//4 å®¢æˆ·ç«¯å›å¤ä¿¡æ¯</span></span><br><span class="line">        socketChannel.write(Charset.forName(<span class="string">&quot;UTF-8&quot;</span>).encode(<span class="string">&quot;æ¬¢è¿è¿›å…¥èŠå¤©å®¤ï¼Œè¯·æ³¨æ„éšç§å®‰å…¨&quot;</span>));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//å¯åŠ¨ä¸»æ–¹æ³•</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">new</span> ChatServer().startServer();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="%E5%AE%A2%E6%88%B7%E7%AB%AF%E4%BB%A3%E7%A0%81" id="å®¢æˆ·ç«¯ä»£ç ">å®¢æˆ·ç«¯ä»£ç </h4>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.net.InetSocketAddress;</span><br><span class="line"><span class="keyword">import</span> java.nio.channels.SelectionKey;</span><br><span class="line"><span class="keyword">import</span> java.nio.channels.Selector;</span><br><span class="line"><span class="keyword">import</span> java.nio.channels.SocketChannel;</span><br><span class="line"><span class="keyword">import</span> java.nio.charset.Charset;</span><br><span class="line"><span class="keyword">import</span> java.util.Scanner;</span><br><span class="line"></span><br><span class="line"><span class="comment">//å®¢æˆ·ç«¯</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ChatClient</span> </span>&#123;</span><br><span class="line">    <span class="comment">//å¯åŠ¨å®¢æˆ·ç«¯æ–¹æ³•</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">startClient</span><span class="params">(String name)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        <span class="comment">//è¿æ¥æœåŠ¡ç«¯</span></span><br><span class="line">        SocketChannel socketChannel = SocketChannel.open(<span class="keyword">new</span> InetSocketAddress(<span class="string">&quot;127.0.0.1&quot;</span>, <span class="number">8000</span>));</span><br><span class="line">        <span class="comment">//æ¥æ”¶æœåŠ¡ç«¯å“åº”æ•°æ®</span></span><br><span class="line">        Selector selector = Selector.open();</span><br><span class="line">        socketChannel.configureBlocking(<span class="keyword">false</span>);</span><br><span class="line">        socketChannel.register(selector, SelectionKey.OP_READ);</span><br><span class="line">        <span class="comment">//åˆ›å»ºçº¿ç¨‹</span></span><br><span class="line">        <span class="keyword">new</span> Thread(<span class="keyword">new</span> ClientThread(selector)).start();</span><br><span class="line">        <span class="comment">//å‘æœåŠ¡å™¨ç«¯å‘é€æ¶ˆæ¯</span></span><br><span class="line">        Scanner scanner = <span class="keyword">new</span> Scanner(System.in);</span><br><span class="line">        <span class="keyword">while</span> (scanner.hasNextLine()) &#123;</span><br><span class="line">            String msg = scanner.nextLine();</span><br><span class="line">            <span class="keyword">if</span> (msg.length() &gt; <span class="number">0</span>) &#123;</span><br><span class="line">                socketChannel.write(Charset.forName(<span class="string">&quot;UTF-8&quot;</span>).encode(name + <span class="string">&quot; : &quot;</span> + msg));</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.nio.ByteBuffer;</span><br><span class="line"><span class="keyword">import</span> java.nio.channels.SelectionKey;</span><br><span class="line"><span class="keyword">import</span> java.nio.channels.Selector;</span><br><span class="line"><span class="keyword">import</span> java.nio.channels.SocketChannel;</span><br><span class="line"><span class="keyword">import</span> java.nio.charset.Charset;</span><br><span class="line"><span class="keyword">import</span> java.util.Iterator;</span><br><span class="line"><span class="keyword">import</span> java.util.Set;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ClientThread</span> <span class="keyword">implements</span> <span class="title">Runnable</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> Selector selector;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">ClientThread</span><span class="params">(Selector selector)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.selector = selector;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">for</span> (; ; ) &#123;</span><br><span class="line">                <span class="comment">//è·å–channelæ•°é‡</span></span><br><span class="line">                <span class="keyword">int</span> readChannels = selector.select();</span><br><span class="line">                <span class="keyword">if</span> (readChannels == <span class="number">0</span>) &#123;</span><br><span class="line">                    <span class="keyword">continue</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="comment">//è·å–å¯ç”¨çš„channel</span></span><br><span class="line">                Set&lt;SelectionKey&gt; selectionKeys = selector.selectedKeys();</span><br><span class="line">                <span class="comment">//éå†é›†åˆ</span></span><br><span class="line">                Iterator&lt;SelectionKey&gt; iterator = selectionKeys.iterator();</span><br><span class="line">                <span class="keyword">while</span> (iterator.hasNext()) &#123;</span><br><span class="line">                    SelectionKey selectionKey = iterator.next();</span><br><span class="line">                    <span class="comment">//ç§»é™¤seté›†åˆå½“å‰selectionKey</span></span><br><span class="line">                    iterator.remove();</span><br><span class="line">                    <span class="comment">//å¦‚æœå¯è¯»çŠ¶æ€</span></span><br><span class="line">                    <span class="keyword">if</span> (selectionKey.isReadable()) &#123;</span><br><span class="line">                        readOperator(selector, selectionKey);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//å¤„ç†å¯è¯»çŠ¶æ€æ“ä½œ</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">readOperator</span><span class="params">(Selector selector, SelectionKey selectionKey)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        <span class="comment">//1 ä»SelectionKeyè·å–åˆ°å·²ç»å°±ç»ªçš„é€šé“</span></span><br><span class="line">        SocketChannel socketChannel = (SocketChannel) selectionKey.channel();</span><br><span class="line">        <span class="comment">//2 åˆ›å»ºbuffer</span></span><br><span class="line">        ByteBuffer byteBuffer = ByteBuffer.allocate(<span class="number">1024</span>);</span><br><span class="line">        <span class="comment">//3 å¾ªç¯è¯»å–å®¢æˆ·ç«¯æ¶ˆæ¯</span></span><br><span class="line">        <span class="keyword">int</span> readLength = socketChannel.read(byteBuffer);</span><br><span class="line">        String message = <span class="string">&quot;&quot;</span>;</span><br><span class="line">        <span class="keyword">if</span> (readLength &gt; <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="comment">//åˆ‡æ¢è¯»æ¨¡å¼</span></span><br><span class="line">            byteBuffer.flip();</span><br><span class="line"></span><br><span class="line">            <span class="comment">//è¯»å–å†…å®¹</span></span><br><span class="line">            message += Charset.forName(<span class="string">&quot;UTF-8&quot;</span>).decode(byteBuffer);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//4 å°†channelå†æ¬¡æ³¨å†Œåˆ°é€‰æ‹©å™¨ä¸Šï¼Œç›‘å¬å¯è¯»çŠ¶æ€</span></span><br><span class="line">        socketChannel.register(selector, SelectionKey.OP_READ);</span><br><span class="line">        <span class="comment">//5 æŠŠå®¢æˆ·ç«¯å‘é€æ¶ˆæ¯ï¼Œå¹¿æ’­åˆ°å…¶ä»–å®¢æˆ·ç«¯</span></span><br><span class="line">        <span class="keyword">if</span> (message.length() &gt; <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="comment">//å¹¿æ’­ç»™å…¶ä»–å®¢æˆ·ç«¯</span></span><br><span class="line">            System.out.println(message);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AClient</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        <span class="keyword">new</span> ChatClient().startClient(<span class="string">&quot;lxl&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BClient</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        <span class="keyword">new</span> ChatClient().startClient(<span class="string">&quot;xqm&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h2 id="others" id="others">others</h2>
<h3 id="filter%E6%A8%A1%E5%BC%8F" id="Filteræ¨¡å¼">Filteræ¨¡å¼</h3>
<ul>
<li>é€šè¿‡ä¸€ä¸ªâ€œåŸºç¡€â€ç»„ä»¶å†å åŠ å„ç§â€œé™„åŠ â€åŠŸèƒ½ç»„ä»¶çš„æ¨¡å¼ï¼Œç§°ä¹‹ä¸ºFilteræ¨¡å¼ï¼ˆæˆ–è€…è£…é¥°å™¨æ¨¡å¼ï¼šDecoratorï¼‰ã€‚å®ƒå¯ä»¥è®©æˆ‘ä»¬é€šè¿‡å°‘é‡çš„ç±»æ¥å®ç°å„ç§åŠŸèƒ½çš„ç»„åˆ</li>
<li>ç¼–å†™FilterInputStream</li>
</ul>
<h3 id="%E6%93%8D%E4%BD%9Czip" id="æ“ä½œZip">æ“ä½œZip</h3>
<ul>
<li>
<p>ZipInputStream</p>
</li>
<li>
<p>JarInputStreamæ˜¯ä»ZipInputStreamæ´¾ç”Ÿ</p>
</li>
<li>
<p>è¯»å–zipåŒ…</p>
<ul>
<li>
<p>åˆ›å»ºä¸€ä¸ªZipInputStreamï¼Œé€šå¸¸æ˜¯ä¼ å…¥ä¸€ä¸ªFileInputStreamä½œä¸ºæ•°æ®æºï¼Œç„¶åï¼Œå¾ªç¯è°ƒç”¨getNextEntry()ï¼Œç›´åˆ°è¿”å›nullï¼Œè¡¨ç¤ºzipæµç»“æŸã€‚<br />
ä¸€ä¸ªZipEntryè¡¨ç¤ºä¸€ä¸ªå‹ç¼©æ–‡ä»¶æˆ–ç›®å½•ï¼Œå¦‚æœæ˜¯å‹ç¼©æ–‡ä»¶ï¼Œæˆ‘ä»¬å°±ç”¨read()æ–¹æ³•ä¸æ–­è¯»å–ï¼Œç›´åˆ°è¿”å›-1ï¼š</p>
<ul>
<li>try (ZipInputStream zip = new ZipInputStream(new FileInputStream(...))) {<br />
ZipEntry entry = null;<br />
while ((entry = zip.getNextEntry()) != null) {<br />
String name = entry.getName();<br />
if (!entry.isDirectory()) {<br />
int n;<br />
while ((n = zip.read()) != -1) {<br />
...<br />
}<br />
}<br />
}<br />
}</li>
</ul>
</li>
</ul>
</li>
<li>
<p>å†™å…¥zipåŒ…</p>
<ul>
<li>
<p>å¯ä»¥ç›´æ¥å†™å…¥å†…å®¹åˆ°zipåŒ…ã€‚æˆ‘ä»¬è¦å…ˆåˆ›å»ºä¸€ä¸ªZipOutputStreamï¼Œé€šå¸¸æ˜¯åŒ…è£…ä¸€ä¸ªFileOutputStreamï¼Œç„¶åï¼Œæ¯å†™å…¥ä¸€ä¸ªæ–‡ä»¶å‰ï¼Œå…ˆè°ƒç”¨putNextEntry()ï¼Œç„¶åç”¨write()å†™å…¥byte[]æ•°æ®ï¼Œå†™å…¥å®Œæ¯•åè°ƒç”¨closeEntry()ç»“æŸè¿™ä¸ªæ–‡ä»¶çš„æ‰“åŒ…ã€‚</p>
<ul>
<li>try (ZipOutputStream zip = new ZipOutputStream(new FileOutputStream(...))) {<br />
File[] files = ...<br />
for (File file : files) {<br />
zip.putNextEntry(new ZipEntry(file.getName()));<br />
zip.write(getFileDataAsBytes(file));<br />
zip.closeEntry();<br />
}<br />
}</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>è¯»å–classpathèµ„æº</p>
<ul>
<li>æŠŠèµ„æºå­˜å‚¨åœ¨classpathä¸­å¯ä»¥é¿å…æ–‡ä»¶è·¯å¾„ä¾èµ–ï¼›</li>
<li>Classå¯¹è±¡çš„getResourceAsStream()å¯ä»¥ä»classpathä¸­è¯»å–æŒ‡å®šèµ„æºï¼›</li>
<li>æ ¹æ®classpathè¯»å–èµ„æºæ—¶ï¼Œéœ€è¦æ£€æŸ¥è¿”å›çš„InputStreamæ˜¯å¦ä¸ºnullã€‚</li>
</ul>
<h3 id="%E4%BD%BF%E7%94%A8files" id="ä½¿ç”¨Files">ä½¿ç”¨Files</h3>
<ul>
<li>byte[] data = Files.readAllBytes(Paths.get(&quot;/path/to/file.txt&quot;));</li>
<li>// é»˜è®¤ä½¿ç”¨UTF-8ç¼–ç è¯»å–:<br />
String content1 = Files.readString(Paths.get(&quot;/path/to/file.txt&quot;));<br />
// å¯æŒ‡å®šç¼–ç :<br />
String content2 = Files.readString(Paths.get(&quot;/path/to/file.txt&quot;), StandardCharsets.ISO_8859_1);<br />
// æŒ‰è¡Œè¯»å–å¹¶è¿”å›æ¯è¡Œå†…å®¹:<br />
List<String> lines = Files.readAllLines(Paths.get(&quot;/path/to/file.txt&quot;));</li>
<li>/ å†™å…¥äºŒè¿›åˆ¶æ–‡ä»¶:<br />
byte[] data = ...<br />
Files.write(Paths.get(&quot;/path/to/file.txt&quot;), data);<br />
// å†™å…¥æ–‡æœ¬å¹¶æŒ‡å®šç¼–ç :<br />
Files.writeString(Paths.get(&quot;/path/to/file.txt&quot;), &quot;æ–‡æœ¬å†…å®¹...&quot;, StandardCharsets.ISO_8859_1);<br />
// æŒ‰è¡Œå†™å…¥æ–‡æœ¬:<br />
List<String> lines = ...<br />
Files.write(Paths.get(&quot;/path/to/file.txt&quot;), lines);</li>
<li>æ­¤å¤–ï¼ŒFileså·¥å…·ç±»è¿˜æœ‰copy()ã€delete()ã€exists()ã€move()ç­‰å¿«æ·æ–¹æ³•æ“ä½œæ–‡ä»¶å’Œç›®å½•ã€‚<br />
æœ€åéœ€è¦ç‰¹åˆ«æ³¨æ„çš„æ˜¯ï¼ŒFilesæä¾›çš„è¯»å†™æ–¹æ³•ï¼Œå—å†…å­˜é™åˆ¶ï¼Œåªèƒ½è¯»å†™å°æ–‡ä»¶ï¼Œä¾‹å¦‚é…ç½®æ–‡ä»¶ç­‰ï¼Œä¸å¯ä¸€æ¬¡è¯»å…¥å‡ ä¸ªGçš„å¤§æ–‡ä»¶ã€‚è¯»å†™å¤§å‹æ–‡ä»¶ä»ç„¶è¦ä½¿ç”¨æ–‡ä»¶æµï¼Œæ¯æ¬¡åªè¯»å†™ä¸€éƒ¨åˆ†æ–‡ä»¶å†…å®¹ã€‚</li>
</ul>
<h3 id="%E5%86%85%E5%AD%98%E6%98%A0%E5%B0%84%E6%96%87%E4%BB%B6" id="å†…å­˜æ˜ å°„æ–‡ä»¶">å†…å­˜æ˜ å°„æ–‡ä»¶</h3>
<ul>
<li>å†…å­˜æ˜ å°„æ–‡ä»¶ I/O æ˜¯ä¸€ç§è¯»å’Œå†™æ–‡ä»¶æ•°æ®çš„æ–¹æ³•ï¼Œå®ƒå¯ä»¥æ¯”å¸¸è§„çš„åŸºäºæµæˆ–è€…åŸºäºé€šé“çš„ I/O å¿«å¾—å¤šã€‚</li>
</ul>
<p>å‘å†…å­˜æ˜ å°„æ–‡ä»¶å†™å…¥å¯èƒ½æ˜¯å±é™©çš„ï¼Œåªæ˜¯æ”¹å˜æ•°ç»„çš„å•ä¸ªå…ƒç´ è¿™æ ·çš„ç®€å•æ“ä½œï¼Œå°±å¯èƒ½ä¼šç›´æ¥ä¿®æ”¹ç£ç›˜ä¸Šçš„æ–‡ä»¶ã€‚ä¿®æ”¹æ•°æ®ä¸å°†æ•°æ®ä¿å­˜åˆ°ç£ç›˜æ˜¯æ²¡æœ‰åˆ†å¼€çš„ã€‚</p>
<p>ä¸‹é¢ä»£ç è¡Œå°†æ–‡ä»¶çš„å‰ 1024 ä¸ªå­—èŠ‚æ˜ å°„åˆ°å†…å­˜ä¸­ï¼Œmap() æ–¹æ³•è¿”å›ä¸€ä¸ª MappedByteBufferï¼Œå®ƒæ˜¯ ByteBuffer çš„å­ç±»ã€‚å› æ­¤ï¼Œå¯ä»¥åƒä½¿ç”¨å…¶ä»–ä»»ä½• ByteBuffer ä¸€æ ·ä½¿ç”¨æ–°æ˜ å°„çš„ç¼“å†²åŒºï¼Œæ“ä½œç³»ç»Ÿä¼šåœ¨éœ€è¦æ—¶è´Ÿè´£æ‰§è¡Œæ˜ å°„ã€‚</p>
<p>MappedByteBuffer mbb = fc.map(FileChannel.MapMode.READ_WRITE, 0, 1024);</p>
<h3 id="office" id="OFFICE">OFFICE</h3>
<h3 id="pic" id="PIC">PIC</h3>
<h3 id="csv" id="CSV">CSV</h3>
<h3 id="html" id="HTML">HTML</h3>
<h3 id="%E5%8E%8B%E7%BC%A9%E6%96%87%E4%BB%B6" id="å‹ç¼©æ–‡ä»¶">å‹ç¼©æ–‡ä»¶</h3>
<table>
<thead>
<tr>
<th>IO</th>
<th>NIO<br/></th>
</tr>
</thead>
<tbody>
<tr>
<td>é¢å‘æµ	<br/></td>
<td>é¢å‘ç¼“å†²</td>
</tr>
<tr>
<td>é˜»å¡IO	<br/></td>
<td>éé˜»å¡IO</td>
</tr>
<tr>
<td>æ— </td>
<td>é€‰æ‹©å™¨</td>
</tr>
</tbody>
</table>
<h1 id="net">NET</h1>
<h2 id="osi%E4%B8%83%E5%B1%82%E6%A8%A1%E5%9E%8B" id="OSIä¸ƒå±‚æ¨¡å‹">OSIä¸ƒå±‚æ¨¡å‹</h2>
<h2 id="tcp%2Fip%E4%BA%94%E5%B1%82%E6%A8%A1%E5%9E%8B" id="TCP-IPäº”å±‚æ¨¡å‹">TCP/IPäº”å±‚æ¨¡å‹</h2>
<h2 id="%E4%B8%89%E6%AC%A1%E6%8F%A1%E6%89%8B%E3%80%81%E5%9B%9B%E6%AC%A1%E6%8C%A5%E6%89%8B" id="ä¸‰æ¬¡æ¡æ‰‹ã€å››æ¬¡æŒ¥æ‰‹">ä¸‰æ¬¡æ¡æ‰‹ã€å››æ¬¡æŒ¥æ‰‹</h2>
<h2 id="ip" id="IP">IP</h2>
<h2 id="%E5%9F%9F%E5%90%8D" id="åŸŸå">åŸŸå</h2>
<h2 id="%E7%AB%AF%E5%8F%A3" id="ç«¯å£">ç«¯å£</h2>
<h2 id="%E9%80%9A%E4%BF%A1%E5%8D%8F%E8%AE%AE" id="é€šä¿¡åè®®">é€šä¿¡åè®®</h2>
<h2 id="%E4%B8%80%E6%AC%A1%E8%AF%B7%E6%B1%82%E7%9A%84%E8%BF%87%E7%A8%8B" id="ä¸€æ¬¡è¯·æ±‚çš„è¿‡ç¨‹">ä¸€æ¬¡è¯·æ±‚çš„è¿‡ç¨‹</h2>
<h1 id="%E6%8F%90%E9%AB%98cpu%EF%BC%8C%E9%98%B2%E6%AD%A2%E6%9C%8D%E5%8A%A1%E5%99%A8%E9%99%8D%E9%85%8D">æé«˜CPUï¼Œé˜²æ­¢æœåŠ¡å™¨é™é…</h1>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.atguigu.java2;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">CPUTest</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        CPUTestThread cpuTestThread = <span class="keyword">new</span> CPUTestThread();</span><br><span class="line">        <span class="comment">//ä¿®æ”¹foræ¬¡æ•°</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">20</span>; i++) &#123;</span><br><span class="line"></span><br><span class="line">            Thread cpuTest = <span class="keyword">new</span> Thread(cpuTestThread);</span><br><span class="line"></span><br><span class="line">            cpuTest.start();</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//Windows Task Manager shows</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line"></span><br><span class="line">            Runtime.getRuntime().exec(<span class="string">&quot;taskmgr&quot;</span>);</span><br><span class="line"></span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e1) &#123;</span><br><span class="line"></span><br><span class="line">            e1.printStackTrace();</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">CPUTestThread</span> <span class="keyword">implements</span> <span class="title">Runnable</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">int</span> busyTime = <span class="number">10</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">int</span> idleTime = busyTime;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">long</span> startTime = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">while</span> (<span class="keyword">true</span>) &#123;</span><br><span class="line"></span><br><span class="line">                startTime = System.currentTimeMillis();</span><br><span class="line"></span><br><span class="line">            System.out.println(System.currentTimeMillis()+<span class="string">&quot;,&quot;</span>+startTime+<span class="string">&quot;,&quot;</span>+(System.currentTimeMillis() - startTime));</span><br><span class="line"></span><br><span class="line"><span class="comment">// busy loop</span></span><br><span class="line"></span><br><span class="line">            <span class="keyword">while</span> ((System.currentTimeMillis() - startTime) &lt;= busyTime)</span><br><span class="line"></span><br><span class="line">                ;</span><br><span class="line"></span><br><span class="line"><span class="comment">// idle loop</span></span><br><span class="line"></span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line"></span><br><span class="line">                Thread.sleep(idleTime);</span><br><span class="line"></span><br><span class="line">            &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line"></span><br><span class="line">                System.out.println(e);</span><br><span class="line"></span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="%E5%85%B6%E4%BB%96%E5%9F%BA%E7%A1%80">å…¶ä»–åŸºç¡€</h1>
<h2 id="%5Bjvm%E4%B8%8E%E4%B8%8A%E5%B1%82%E6%8A%80%E6%9C%AF%5D(jvm-%E4%B8%8E%E4%B8%8A%E5%B1%82%E6%8A%80%E6%9C%AF)" id="JVMä¸ä¸Šå±‚æŠ€æœ¯-JVM-ä¸ä¸Šå±‚æŠ€æœ¯">[JVMä¸ä¸Šå±‚æŠ€æœ¯](JVM ä¸ä¸Šå±‚æŠ€æœ¯)</h2>
<h2 id="hashcode%E4%B8%8E-equals%E4%B8%8E-%3D%3D" id="hashcodeä¸-equalsä¸">hashcodeä¸ equalsä¸ ==</h2>
<ul>
<li>
<p><strong>ç›¸å…³æ¦‚å¿µ</strong></p>
<p>1.equals(Object obj)æ–¹æ³•ç”¨æ¥åˆ¤æ–­ä¸¤ä¸ªå¯¹è±¡æ˜¯å¦â€œç›¸åŒâ€ï¼Œå¦‚æœâ€œç›¸åŒâ€åˆ™è¿”å›trueï¼Œå¦åˆ™è¿”å›falseã€‚<br />
hashCode()æ–¹æ³•è¿”å›ä¸€ä¸ªintæ•°ï¼Œåœ¨Objectç±»ä¸­çš„<strong>é»˜è®¤å®ç°</strong>æ˜¯â€œå°†è¯¥å¯¹è±¡çš„å†…éƒ¨åœ°å€è½¬æ¢æˆä¸€ä¸ªæ•´æ•°è¿”å›â€ã€‚</p>
<p>2.è‹¥ä¸¤ä¸ªå¯¹è±¡equals(Object obj)è¿”å›trueï¼Œåˆ™hashCodeï¼ˆï¼‰æœ‰å¿…è¦ä¹Ÿè¿”å›ç›¸åŒçš„intæ•°ã€‚</p>
<p>3.è‹¥ä¸¤ä¸ªå¯¹è±¡equals(Object obj)è¿”å›falseï¼Œåˆ™hashCodeï¼ˆï¼‰ä¸ä¸€å®šè¿”å›ä¸åŒçš„intæ•°ã€‚</p>
<p>4.è‹¥ä¸¤ä¸ªå¯¹è±¡hashCodeï¼ˆï¼‰è¿”å›ç›¸åŒintæ•°ï¼Œåˆ™equalsï¼ˆObject objï¼‰ä¸ä¸€å®šè¿”å›trueã€‚</p>
<p>5.è‹¥ä¸¤ä¸ªå¯¹è±¡hashCodeï¼ˆï¼‰è¿”å›ä¸åŒintæ•°ï¼Œåˆ™equalsï¼ˆObject objï¼‰ä¸€å®šè¿”å›falseã€‚</p>
<p>6.åŒä¸€å¯¹è±¡åœ¨æ‰§è¡ŒæœŸé—´è‹¥å·²ç»å­˜å‚¨åœ¨é›†åˆä¸­ï¼Œåˆ™ä¸èƒ½ä¿®æ”¹å½±å“hashCodeå€¼çš„ç›¸å…³ä¿¡æ¯ï¼Œå¦åˆ™ä¼šå¯¼è‡´å†…å­˜æ³„éœ²é—®é¢˜ã€‚</p>
<p>7.è‹¥é‡å†™äº†equals(Object obj)æ–¹æ³•ï¼Œåˆ™æœ‰å¿…è¦é‡å†™hashCode()æ–¹æ³•ã€‚</p>
</li>
<li>
<p><strong>ä»€ä¹ˆæ—¶å€™éœ€è¦é‡å†™hashcodeä¸equalsï¼Ÿ</strong></p>
<ol>
<li>å¯¹è±¡æ¯”è¾ƒ</li>
</ol>
</li>
<li>
<p><strong>equalsä¸==åŒºåˆ«ï¼Ÿ</strong></p>
<ol>
<li>åŸºæœ¬ç±»å‹ä¸­ï¼Œ==åˆ¤æ–­å€¼æ˜¯å¦ç›¸ç­‰ï¼Œå¼•ç”¨ç±»å‹ä¸­æ¯”è¾ƒçš„æ˜¯åœ°å€æ˜¯å¦ç›¸ç­‰</li>
<li>equalsåªèƒ½ç”¨äºå¼•ç”¨ç±»å‹ï¼Œequalså…·ä½“åˆ¤æ–­è¦åœ¨åˆ¤æ–­å¯¹è±¡ä¸­çœ‹equalså®ç°,é»˜è®¤æ˜¯åˆ¤æ–­åœ°å€ï¼Œé‡å†™ä¹‹åçœ‹å…·ä½“å®ç°ï¼Œä¸€èˆ¬æ˜¯æ¯”è¾ƒå¯¹è±¡å†…å®¹ã€‚</li>
</ol>
</li>
</ul>
<h2 id="%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1" id="é¢å‘å¯¹è±¡">é¢å‘å¯¹è±¡</h2>
<ol>
<li>
<p>å°è£…ç»§æ‰¿å¤šæ€</p>
<ul>
<li>
<p>å°è£…</p>
<p>â€‹	å°†ä¸€ç³»åˆ—æ“ä½œå°è£…æˆä¸€ä¸ªåŠŸèƒ½ï¼Œéšè—å®ç°ç»†èŠ‚ï¼Œæ–½åŠ æƒé™æ§åˆ¶ï¼Œè®©ç”¨æˆ·ä¸å†æ“å¿ƒåŠŸèƒ½å®ç°ï¼Œå‡å°‘ä»£ç å†—ä½™ã€‚</p>
</li>
<li>
<p>ç»§æ‰¿ï¼ˆextendsï¼‰</p>
<p>â€‹	æ¶ˆé™¤é‡å¤åˆ›å»ºç›¸åŒåŠŸèƒ½ç±»ï¼Œç»§æ‰¿ä»¥å¤åˆ¶åŸºç±»åŠŸèƒ½å±æ€§å¹¶<strong>è¦†ç›–</strong>å·²è¿›è¡Œæ‰©å±•ä¿®æ”¹ã€‚</p>
<p>â€‹	ç»§æ‰¿åˆå§‹åŒ–é“¾ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**å­˜åœ¨ç»§æ‰¿çš„æƒ…å†µä¸‹ï¼Œåˆå§‹åŒ–é¡ºåºä¸ºï¼š</span></span><br><span class="line"><span class="comment"> çˆ¶ç±»ï¼ˆé™æ€å˜é‡ã€é™æ€è¯­å¥å—ï¼‰</span></span><br><span class="line"><span class="comment"> å­ç±»ï¼ˆé™æ€å˜é‡ã€é™æ€è¯­å¥å—ï¼‰</span></span><br><span class="line"><span class="comment"> çˆ¶ç±»ï¼ˆå®ä¾‹å˜é‡ã€æ™®é€šè¯­å¥å—ï¼‰</span></span><br><span class="line"><span class="comment"> çˆ¶ç±»ï¼ˆæ„é€ å‡½æ•°ï¼‰</span></span><br><span class="line"><span class="comment"> å­ç±»ï¼ˆå®ä¾‹å˜é‡ã€æ™®é€šè¯­å¥å—ï¼‰</span></span><br><span class="line"><span class="comment"> å­ç±»ï¼ˆæ„é€ å‡½æ•°ï¼‰*/</span></span><br><span class="line"> é™æ€--&gt;å®ä¾‹--ã€‹æ™®é€šè¯­å¥å—--ã€‹æ„é€ </span><br></pre></td></tr></table></figure>
</li>
<li>
<p>å¤šæ€</p>
<p>æ¥å£å’Œå®ç°ç±»ï¼Œç›¸åŒæ¥å£æœ‰ä¸åŒå®ç°ç±»ä»¥å®ç°ä¸åŒæ ·å¼çš„ç›¸åŒåŠŸèƒ½ã€‚</p>
</li>
</ul>
</li>
<li></li>
</ol>
<h2 id="final%E3%80%81finally%E3%80%81finalize" id="finalã€finallyã€finalize">finalã€finallyã€finalize</h2>
<p>â€‹		finalé€šå¸¸å«ä¹‰ä¸ºä¸å¯æ”¹å˜ï¼Œæ— æ³•æ”¹å˜ç”±è®¾è®¡å’Œæ•ˆç‡ä¸¤ä¸ªæ–¹é¢ã€‚ä¿®é¥°ç±»ä¸å¯è¢«ç»§æ‰¿ï¼ˆç±»ä¸­æ–¹æ³•è¢«éšå¼ç”Ÿå‘½ä¸ºfinalï¼‰ï¼Œä¿®é¥°æ–¹æ³•ä¸å¯è¢«è¦†ç›–ï¼ˆæ•ˆæœåŒè¢«privateä¿®é¥°çš„æ–¹æ³•ï¼Œä¹Ÿè¢«éšå¼finaläº†ï¼‰ï¼Œä¿®é¥°å˜é‡ä¸å¯è¢«ä¿®æ”¹ï¼ˆåŸºæœ¬å˜é‡ä¿®é¥°åå³ä¸ºå¸¸é‡ï¼‰ï¼Œä¿®é¥°å¯¹è±¡åªæ˜¯é™åˆ¶äº†å…¶å¼•ç”¨åœ°å€ä½†ä¸ä¼šé™åˆ¶å…¶å¯¹è±¡å€¼ã€‚finallyæ˜¯åœ¨try..catchè¯­å¥ä¸­tryæ‰§è¡Œåä¸”æœªè¢«å°†ç¨‹åºç»ˆæ­¢æœ€åå¿…é¡»æ‰§è¡Œçš„è¯­å¥å—ã€finalizeç”¨äºå¯¹è±¡å›æ”¶ï¼Œå±äºObjectçš„æ–¹æ³•ï¼Œè°ƒç”¨å¹¶ä¸ä¸€å®šä¼šé©¬ä¸Šå›æ”¶å¯¹è±¡ã€‚</p>
<h2 id="%E5%90%91%E4%B8%8A%2F%E4%B8%8B%E8%BD%AC%E5%9E%8B" id="å‘ä¸Š-ä¸‹è½¬å‹">å‘ä¸Š/ä¸‹è½¬å‹</h2>
<p>å‘ä¸Šå³çˆ¶ç”¨å­ï¼Œå‘ä¸‹å³å­ç”¨çˆ¶ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Father f1 = <span class="keyword">new</span> Son();   <span class="comment">// è¿™å°±å« upcasting ï¼ˆå‘ä¸Šè½¬å‹)</span></span><br><span class="line"><span class="comment">// ç°åœ¨ f1 å¼•ç”¨æŒ‡å‘ä¸€ä¸ªSonå¯¹è±¡</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//å¹¶ä¸æ˜¯æ‰€æœ‰çš„å¯¹è±¡éƒ½å¯ä»¥å‘ä¸‹è½¬å‹ï¼Œåªæœ‰å½“è¿™ä¸ªå¯¹è±¡åŸæœ¬å°±æ˜¯å­ç±»å¯¹è±¡é€šè¿‡å‘ä¸Šè½¬å‹å¾—åˆ°çš„æ—¶å€™æ‰èƒ½å¤ŸæˆåŠŸè½¬å‹ã€‚</span></span><br><span class="line">Son s1 = (Son)f1;   <span class="comment">// è¿™å°±å« downcasting (å‘ä¸‹è½¬å‹)</span></span><br><span class="line"><span class="comment">// ç°åœ¨f1 è¿˜æ˜¯æŒ‡å‘ Sonå¯¹è±¡</span></span><br></pre></td></tr></table></figure>
<h2 id="%E5%86%85%E9%83%A8%E7%B1%BB%E3%80%81%E5%8C%BF%E5%90%8D%E5%86%85%E9%83%A8%E7%B1%BB" id="å†…éƒ¨ç±»ã€åŒ¿åå†…éƒ¨ç±»">å†…éƒ¨ç±»ã€åŒ¿åå†…éƒ¨ç±»</h2>
<p>æ²¡æœ‰åå­—çš„ç±»æˆ–æ¥å£å®ç°æ‰€ä»¥åªèƒ½ä½¿ç”¨ä¸€æ¬¡ï¼Œæ— æ³•è¢«å…¶ä»–ç±»å®ä¾‹åŒ–ï¼Œç”¨æ¥ç®€åŒ–ä»£ç ç¼–å†™ã€‚</p>
<p>åŒ¿åç±»å¯ç»§æ‰¿ã€é‡å†™çˆ¶ç±»çš„æ–¹æ³•<br />
ä½¿ç”¨åŒ¿åç±»æ—¶ï¼Œå¿…ç„¶æ˜¯åœ¨æŸä¸ªç±»ä¸­ç›´æ¥ç”¨<strong>åŒ¿åç±»åˆ›å»ºå¯¹è±¡</strong>ï¼Œå› æ­¤<strong>åŒ¿åç±»ä¸€å®šæ˜¯å†…éƒ¨ç±»</strong><br />
åŒ¿åç±»å¯ä»¥è®¿é—®å¤–åµŒç±»ä¸­çš„æˆå‘˜å˜é‡å’Œæ–¹æ³•ï¼ŒåŒ¿åç±»çš„ç±»ä½“ä¸­ä¸å¯ä»¥å£°æ˜staticæˆå‘˜å˜é‡å’Œstaticæ–¹æ³•<br />
ç”±äºåŒ¿åç±»æ˜¯ä¸€ä¸ªå­ç±»ï¼Œä½†æ²¡æœ‰ç±»åï¼Œæ‰€ä»¥åœ¨ç”¨åŒ¿åç±»åˆ›å»ºå¯¹è±¡æ—¶ï¼Œè¦ç›´æ¥ä½¿ç”¨çˆ¶ç±»çš„æ„é€ æ–¹æ³•</p>
<h2 id="static" id="static">static</h2>
<p>â€‹		æ–¹ä¾¿åœ¨æ²¡æœ‰åˆ›å»ºå¯¹è±¡çš„æƒ…å†µä¸‹æ¥è¿›è¡Œè°ƒç”¨ï¼ˆæ–¹æ³•/å˜é‡ï¼‰ï¼Œé™æ€æ–¹æ³•ä¸­ä¸èƒ½ä¾èµ–éé™æ€æ–¹æ³•ã€å±æ€§ï¼Œåä¹‹éé™æ€æˆå‘˜æ–¹æ³•ä¸­å¯è®¿é—®é™æ€æˆå‘˜å˜é‡ã€æ–¹æ³•ã€‚<br />
é™æ€å˜é‡åœ¨å†…å­˜ä¸­åªæœ‰ä¸€ä¸ªï¼Œéé™æ€å˜é‡éšå¯¹è±¡åˆ›å»ºè€Œåˆ›å»ºï¼Œå„ä¸ªå˜é‡ä¹‹é—´äº’ä¸å½±å“ã€‚<strong>staticä¸èƒ½ç”¨æ¥ä¿®é¥°å±€éƒ¨å˜é‡</strong>ã€‚é™æ€ä»£ç å—åªæœ‰åœ¨ç±»åŠ è½½çš„æ—¶å€™åˆ›å»ºä¸€æ¬¡ï¼Œé€‚åˆäºåªéœ€è¦è¿›è¡Œä¸€æ¬¡åˆå§‹åŒ–çš„æ“ä½œã€‚é™<strong>åª</strong>é™ï¼Œé<strong>å¯</strong>é™</p>
<p><img src="https://gitee.com/mychimei/picture/raw/master/work/image-20220308140536605.png" alt="image-20220308140536605" /></p>
<h2 id="cap%E3%80%81base%E7%90%86%E8%AE%BA" id="CAPã€BASEç†è®º">CAPã€BASEç†è®º</h2>
<h2 id="aqs" id="AQS">AQS</h2>
<h2 id="jdk%E6%96%B0%E7%89%88%E6%9C%AC%E7%89%B9%E5%BE%81" id="JDKæ–°ç‰ˆæœ¬ç‰¹å¾">JDKæ–°ç‰ˆæœ¬ç‰¹å¾</h2>
<h3 id="lambda-%E8%A1%A8%E8%BE%BE%E5%BC%8F" id="Lambda-è¡¨è¾¾å¼"><a target="_blank" rel="noopener" href="https://mbd.baidu.com/newspage/data/landingsuper?third=baijiahao&amp;baijiahao_id=1685401324435208513&amp;c_source=duedge&amp;p_tk=7164XVbr93kEf9ebx0OCzJEBUC%2FSHtSm0HlbQtXUZnwLWsjL7uvd3VtqGMu6%2BPCP1nEnkpjkthOA%2Fges4OjPt98pqpAcTnKrjR0H1SBkWqMgO7awH2MmJkS5erhN2ZKz%2Bqas&amp;p_timestamp=1646483138&amp;p_sign=39698dd00b7d66b85d43028d11209e58&amp;p_signature=b95e00362b799da95380ab116026ade1&amp;__pc2ps_ab=7164XVbr93kEf9ebx0OCzJEBUC%2FSHtSm0HlbQtXUZnwLWsjL7uvd3VtqGMu6%2BPCP1nEnkpjkthOA%2Fges4OjPt98pqpAcTnKrjR0H1SBkWqMgO7awH2MmJkS5erhN2ZKz%2Bqas%7C1646483138%7Cb95e00362b799da95380ab116026ade1%7C39698dd00b7d66b85d43028d11209e58">Lambda è¡¨è¾¾å¼</a></h3>
<p><img src="https://gitee.com/mychimei/picture/raw/master/c8ea15ce36d3d5399cf621bd58615a57372ab0f6.jpeg" alt="" /></p>
<h3 id="%E6%B5%81stream%EF%BC%88%EF%BC%89" id="æµStreamï¼ˆï¼‰"><a target="_blank" rel="noopener" href="https://www.runoob.com/java/java8-streams.html">æµStreamï¼ˆï¼‰</a></h3>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> pers.lxl.mylearnproject.programbase.newjdk;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Arrays;</span><br><span class="line"><span class="keyword">import</span> java.util.IntSummaryStatistics;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">import</span> java.util.Random;</span><br><span class="line"><span class="keyword">import</span> java.util.stream.Collectors;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * JDK8 æ–°ç‰¹æ€§streamï¼ˆï¼‰</span></span><br><span class="line"><span class="comment"> * ä»¥å£°æ˜çš„æ–¹å¼å¤„ç†æ•°æ®ï¼Œç±»ä¼¼ç”¨sqlä»æ•°æ®åº“æŸ¥è¯¢æ•°æ®çš„æ–¹å¼æ¥æä¾›å¯¹é›†åˆçš„è¿ç®—å’Œè¡¨è¾¾çš„é«˜é˜¶æŠ½è±¡</span></span><br><span class="line"><span class="comment"> * å…¶å°†è¦å¤„ç†çš„æ•°æ®çœ‹æˆä¸€ç§æµï¼Œæµåœ¨ç®¡é“ä¸­ä¼ è¾“ï¼Œå…¶å¯ä»¥å†ç®¡é“çš„èŠ‚ç‚¹ä¸­è¿›è¡Œç­›é€‰æ’åºèšåˆç­‰ä¸€ç³»åˆ—æ“ä½œ</span></span><br><span class="line"><span class="comment"> * Streamï¼ˆæµï¼‰æ˜¯ä¸€ä¸ªæ¥è‡ªæ•°æ®æºçš„å…ƒç´ é˜Ÿåˆ—å¹¶æ”¯æŒèšåˆæ“ä½œ</span></span><br><span class="line"><span class="comment"> * å…ƒç´ æ˜¯ç‰¹å®šç±»å‹çš„å¯¹è±¡ï¼Œå½¢æˆä¸€ä¸ªé˜Ÿåˆ—ã€‚ Javaä¸­çš„Streamå¹¶ä¸ä¼šå­˜å‚¨å…ƒç´ ï¼Œè€Œæ˜¯æŒ‰éœ€è®¡ç®—ã€‚</span></span><br><span class="line"><span class="comment"> * æ•°æ®æº æµçš„æ¥æºã€‚ å¯ä»¥æ˜¯é›†åˆï¼Œæ•°ç»„ï¼ŒI/O channelï¼Œ äº§ç”Ÿå™¨generator ç­‰ã€‚</span></span><br><span class="line"><span class="comment"> * èšåˆæ“ä½œ ç±»ä¼¼SQLè¯­å¥ä¸€æ ·çš„æ“ä½œï¼Œ æ¯”å¦‚filter, map, reduce, find, match, sortedç­‰ã€‚</span></span><br><span class="line"><span class="comment"> * å’Œä»¥å‰çš„Collectionæ“ä½œä¸åŒï¼Œ Streamæ“ä½œè¿˜æœ‰ä¸¤ä¸ªåŸºç¡€çš„ç‰¹å¾ï¼š</span></span><br><span class="line"><span class="comment"> * Pipelining: ä¸­é—´æ“ä½œéƒ½ä¼šè¿”å›æµå¯¹è±¡æœ¬èº«ã€‚ è¿™æ ·å¤šä¸ªæ“ä½œå¯ä»¥ä¸²è”æˆä¸€ä¸ªç®¡é“ï¼Œ å¦‚åŒæµå¼é£æ ¼ï¼ˆfluent styleï¼‰ã€‚ è¿™æ ·åšå¯ä»¥å¯¹æ“ä½œè¿›è¡Œä¼˜åŒ–ï¼Œ æ¯”å¦‚å»¶è¿Ÿæ‰§è¡Œ(laziness)å’ŒçŸ­è·¯(short-circuiting)ã€‚</span></span><br><span class="line"><span class="comment"> * å†…éƒ¨è¿­ä»£ï¼š ä»¥å‰å¯¹é›†åˆéå†éƒ½æ˜¯é€šè¿‡Iteratoræˆ–è€…For-Eachçš„æ–¹å¼, æ˜¾å¼çš„åœ¨é›†åˆå¤–éƒ¨è¿›è¡Œè¿­ä»£ï¼Œ è¿™å«åšå¤–éƒ¨è¿­ä»£ã€‚ Streamæä¾›äº†å†…éƒ¨è¿­ä»£çš„æ–¹å¼ï¼Œ é€šè¿‡è®¿é—®è€…æ¨¡å¼(Visitor)å®ç°ã€‚</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">StreamL</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//      1.ç”Ÿæˆæµ</span></span><br><span class="line">        <span class="comment">//stream() âˆ’ ä¸ºé›†åˆåˆ›å»ºä¸²è¡Œæµã€‚</span></span><br><span class="line">        <span class="comment">//parallelStream() âˆ’ ä¸ºé›†åˆåˆ›å»ºå¹¶è¡Œæµã€‚</span></span><br><span class="line">        List&lt;String&gt; strings = Arrays.asList(<span class="string">&quot;abc&quot;</span>, <span class="string">&quot;&quot;</span>, <span class="string">&quot;bc&quot;</span>, <span class="string">&quot;efg&quot;</span>, <span class="string">&quot;abcd&quot;</span>, <span class="string">&quot;&quot;</span>, <span class="string">&quot;jkl&quot;</span>);</span><br><span class="line">        List&lt;String&gt; filtered = strings.stream().filter(string -&gt; !string.isEmpty()).collect(Collectors.toList());</span><br><span class="line">        List&lt;String&gt; filteredParallelStream = strings.parallelStream().filter(string -&gt; !string.isEmpty()).collect(Collectors.toList());</span><br><span class="line"><span class="comment">//      2.èšåˆæ“ä½œ</span></span><br><span class="line"><span class="comment">//      è¿­ä»£æ•°æ®foreach(),limit() è·å–æŒ‡å®šæ•°é‡çš„æµ,sorted() å¯¹æµè¿›è¡Œæ’åºã€‚</span></span><br><span class="line">        Random random = <span class="keyword">new</span> Random();</span><br><span class="line">        random.ints().limit(<span class="number">10</span>).sorted().forEach(System.out::println);</span><br><span class="line"><span class="comment">//       map() æ˜ å°„æ¯ä¸ªå…ƒç´ åˆ°å¯¹åº”çš„ç»“æœ</span></span><br><span class="line">        List&lt;Integer&gt; numbers = Arrays.asList(<span class="number">3</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">7</span>, <span class="number">3</span>, <span class="number">5</span>);</span><br><span class="line"><span class="comment">//      è·å–å¯¹åº”çš„å¹³æ–¹æ•°</span></span><br><span class="line">        List&lt;Integer&gt; squaresList = numbers.stream().map( i -&gt; i*i).distinct().collect(Collectors.toList());</span><br><span class="line"><span class="comment">//      filter() é€šè¿‡è®¾ç½®çš„æ¡ä»¶è¿‡æ»¤å‡ºå…ƒç´ </span></span><br><span class="line"><span class="comment">//      è·å–ç©ºå­—ç¬¦ä¸²çš„æ•°é‡</span></span><br><span class="line">        <span class="keyword">long</span> count = strings.stream().filter(string -&gt; string.isEmpty()).count();</span><br><span class="line"><span class="comment">//        å¹¶è¡Œï¼ˆparallelï¼‰ç¨‹åº</span></span><br><span class="line"><span class="comment">//        parallelStream æ˜¯æµå¹¶è¡Œå¤„ç†ç¨‹åºçš„ä»£æ›¿æ–¹æ³•ã€‚ä»¥ä¸‹å®ä¾‹æˆ‘ä»¬ä½¿ç”¨ parallelStream æ¥è¾“å‡ºç©ºå­—ç¬¦ä¸²çš„æ•°é‡ï¼š</span></span><br><span class="line"><span class="comment">//      è·å–ç©ºå­—ç¬¦ä¸²çš„æ•°é‡</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//        3.Collectors</span></span><br><span class="line"><span class="comment">//        Collectors ç±»å®ç°å½’çº¦æ“ä½œï¼Œä¾‹å¦‚å°†æµè½¬æ¢æˆé›†åˆå’Œèšåˆå…ƒç´ ã€‚Collectors å¯ç”¨äºè¿”å›åˆ—è¡¨æˆ–å­—ç¬¦ä¸²ï¼š</span></span><br><span class="line">        System.out.println(<span class="string">&quot;ç­›é€‰åˆ—è¡¨: &quot;</span> + filtered);</span><br><span class="line">        String mergedString = strings.stream().filter(string -&gt; !string.isEmpty()).collect(Collectors.joining(<span class="string">&quot;, &quot;</span>));</span><br><span class="line">        System.out.println(<span class="string">&quot;åˆå¹¶å­—ç¬¦ä¸²: &quot;</span> + mergedString);</span><br><span class="line"><span class="comment">//        4.ç»Ÿè®¡</span></span><br><span class="line"><span class="comment">//        ä¸€äº›äº§ç”Ÿç»Ÿè®¡ç»“æœçš„æ”¶é›†å™¨ä¹Ÿéå¸¸æœ‰ç”¨ã€‚å®ƒä»¬ä¸»è¦ç”¨äºintã€doubleã€longç­‰åŸºæœ¬ç±»å‹ä¸Šï¼Œå®ƒä»¬å¯ä»¥ç”¨æ¥äº§ç”Ÿç±»ä¼¼å¦‚ä¸‹çš„ç»Ÿè®¡ç»“æœã€‚</span></span><br><span class="line">        IntSummaryStatistics stats = numbers.stream().mapToInt((x) -&gt; x).summaryStatistics();</span><br><span class="line">        System.out.println(<span class="string">&quot;åˆ—è¡¨ä¸­æœ€å¤§çš„æ•° : &quot;</span> + stats.getMax());</span><br><span class="line">        System.out.println(<span class="string">&quot;åˆ—è¡¨ä¸­æœ€å°çš„æ•° : &quot;</span> + stats.getMin());</span><br><span class="line">        System.out.println(<span class="string">&quot;æ‰€æœ‰æ•°ä¹‹å’Œ : &quot;</span> + stats.getSum());</span><br><span class="line">        System.out.println(<span class="string">&quot;å¹³å‡æ•° : &quot;</span> + stats.getAverage());</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="%E5%85%B6%E4%BB%96" id="å…¶ä»–">å…¶ä»–</h2>
<ol>
<li>
<p>å±€éƒ¨å˜é‡éœ€è¦æ˜¾ç¤ºåˆå§‹åŒ–</p>
</li>
<li>
<p>ä¿ç•™å­—ï¼š</p>
<p>1ï¼‰48ä¸ªå…³é”®å­—ï¼šabstractã€assertã€booleanã€breakã€byteã€caseã€catchã€charã€classã€continueã€defaultã€doã€doubleã€elseã€enumã€extendsã€finalã€finallyã€floatã€forã€ifã€implementsã€importã€intã€interfaceã€instanceofã€longã€nativeã€newã€packageã€privateã€protectedã€publicã€returnã€shortã€staticã€strictfpã€superã€switchã€synchronizedã€thisã€throwã€throwsã€transientã€tryã€voidã€volatileã€whileã€‚</p>
<p>2ï¼‰2ä¸ªä¿ç•™å­—ï¼ˆç°åœ¨æ²¡ç”¨ä»¥åå¯èƒ½ç”¨åˆ°ä½œä¸ºå…³é”®å­—ï¼‰ï¼šgotoã€constã€‚</p>
<p>3ï¼‰3ä¸ªç‰¹æ®Šç›´æ¥é‡ï¼štrueã€falseã€nullã€‚</p>
</li>
</ol>
<h2 id="%E5%9F%BA%E7%A1%80%E7%B1%BB%E5%BA%93%EF%BC%88%E4%BB%8E%E4%B8%8A%E5%88%B0%E4%B8%8B%E7%AE%80%E5%8C%96%E4%BA%86%E8%A7%A3%EF%BC%89" id="åŸºç¡€ç±»åº“ï¼ˆä»ä¸Šåˆ°ä¸‹ç®€åŒ–äº†è§£ï¼‰">åŸºç¡€ç±»åº“ï¼ˆä»ä¸Šåˆ°ä¸‹ç®€åŒ–äº†è§£ï¼‰</h2>
<p>ã€<a target="_blank" rel="noopener" href="http://java.io">java.io</a> java.lang java.utilã€‘</p>
<p>ã€java.lang.reflect  <a target="_blank" rel="noopener" href="http://java.net">java.net</a>  <a target="_blank" rel="noopener" href="http://javax.net">javax.net</a>.*  java.nio.*  java.util.concurrent.<em>ã€‘</em></p>
<p>ã€java.lang.annotation  javax.annotation.*  java.lang.refjava.math java.rmi.*javax.rmi. <em>java.security.</em> javax.security. <em>java.sqljavax.sql.</em> javax.transaction. *java.text javax.xml.<em>org.w3c.dom.<em>org.xml.sax.</em> javax.crypto. *  javax.imageio.</em>  javax.jws. * java.util.jar  java.util.logging  java.util.prefs  java.util.regex  java.util.zipã€‘</p>
<h2 id="%E8%AE%BF%E9%97%AE%E6%9D%83%E9%99%90" id="è®¿é—®æƒé™">è®¿é—®æƒé™</h2>
<table>
<thead>
<tr>
<th>private</th>
<th>default</th>
<th>protected</th>
<th>public</th>
<th></th>
</tr>
</thead>
<tbody>
<tr>
<td>åŒä¸€ä¸ªç±»ä¸­</td>
<td>âˆš</td>
<td>âˆš</td>
<td>âˆš</td>
<td>âˆš</td>
</tr>
<tr>
<td>åŒä¸€ä¸ªåŒ…ä¸­</td>
<td></td>
<td>âˆš</td>
<td>âˆš</td>
<td>âˆš</td>
</tr>
<tr>
<td>å­ç±»ä¸­</td>
<td></td>
<td></td>
<td>âˆš</td>
<td>âˆš</td>
</tr>
<tr>
<td>å…¨å±€èŒƒå›´å†…</td>
<td></td>
<td></td>
<td></td>
<td>âˆš</td>
</tr>
</tbody>
</table>
<h2 id="%E5%9F%BA%E6%9C%AC%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B" id="åŸºæœ¬æ•°æ®ç±»å‹">åŸºæœ¬æ•°æ®ç±»å‹</h2>
<table>
<thead>
<tr>
<th>æ•°æ®ç±»å‹</th>
<th>ä½æ•°</th>
<th>é»˜è®¤å€¼</th>
<th>å–å€¼èŒƒå›´</th>
<th>ä¸¾ä¾‹è¯´æ˜</th>
</tr>
</thead>
<tbody>
<tr>
<td>byte(ä½)</td>
<td>8</td>
<td>0</td>
<td>-2^7 --- 2^7-1</td>
<td>byte b = 10;</td>
</tr>
<tr>
<td>boolean(å¸ƒå°”å€¼)</td>
<td>8</td>
<td>false</td>
<td>trueã€false</td>
<td>boolean b = true;</td>
</tr>
<tr>
<td>short(çŸ­æ•´æ•°)</td>
<td>16</td>
<td>0</td>
<td>-2^15 --- 2^15-1</td>
<td>short s = 10;</td>
</tr>
<tr>
<td>char(å­—ç¬¦)</td>
<td>16</td>
<td>ç©º</td>
<td>0 --- 2^16-1</td>
<td>char c = 'c';</td>
</tr>
<tr>
<td>int(æ•´æ•°)</td>
<td>32</td>
<td>0</td>
<td>-2^31 --- 2^31-1</td>
<td>int i = 10;</td>
</tr>
<tr>
<td>float(å•ç²¾åº¦)</td>
<td>32</td>
<td>0.0</td>
<td>-2^31 --- 2^31-1</td>
<td>float f = 10.0<strong>f</strong>;</td>
</tr>
<tr>
<td>long(é•¿æ•´æ•°)</td>
<td>64</td>
<td>0</td>
<td>-2^63 --- 2^63-1</td>
<td>long l = 10<strong>l</strong>;</td>
</tr>
<tr>
<td>double(åŒç²¾åº¦)</td>
<td>64</td>
<td>0.0</td>
<td>-2^63 --- 2^63-1</td>
<td>double d = 10.0<strong>d</strong>;</td>
</tr>
</tbody>
</table>
<h2 id="%E8%87%AA%E5%8A%A8%E7%B1%BB%E5%9E%8B%E8%BD%AC%E6%8D%A2" id="è‡ªåŠ¨ç±»å‹è½¬æ¢">è‡ªåŠ¨ç±»å‹è½¬æ¢</h2>
<p>1.è‹¥å‚ä¸è¿ç®—çš„æ•°æ®<strong>ç±»å‹ä¸åŒ</strong>ï¼Œåˆ™å…ˆ<strong>è½¬æ¢æˆåŒä¸€ç±»å‹</strong>ï¼Œç„¶åè¿›è¡Œè¿ç®—ã€‚</p>
<p>2.<strong>è½¬æ¢æŒ‰æ•°æ®é•¿åº¦å¢åŠ çš„æ–¹å‘è¿›è¡Œ</strong>ï¼Œä»¥ä¿è¯ç²¾åº¦ä¸é™ä½ã€‚ä¾‹å¦‚intå‹å’Œlongå‹è¿ç®—æ—¶ï¼Œå…ˆæŠŠinté‡è½¬æˆlongå‹åå†è¿›è¡Œè¿ç®—ã€‚</p>
<p>3.æ‰€æœ‰çš„<strong>æµ®ç‚¹è¿ç®—éƒ½æ˜¯ä»¥åŒç²¾åº¦è¿›è¡Œ</strong>çš„ï¼Œå³ä½¿ä»…å«floatå•ç²¾åº¦é‡è¿ç®—çš„è¡¨è¾¾å¼ï¼Œä¹Ÿè¦å…ˆè½¬æ¢æˆdoubleå‹ï¼Œå†ä½œè¿ç®—ã€‚</p>
<p>4.<strong>charå‹å’Œshortå‹å‚ä¸è¿ç®—æ—¶ï¼Œå¿…é¡»å…ˆè½¬æ¢æˆintå‹</strong>ã€‚</p>
<p>5.åœ¨èµ‹å€¼è¿ç®—ä¸­ï¼Œèµ‹å€¼å·ä¸¤è¾¹çš„æ•°æ®ç±»å‹ä¸åŒæ—¶ï¼Œéœ€è¦æŠŠ<strong>å³è¾¹</strong>è¡¨è¾¾å¼çš„ç±»å‹å°†<strong>è½¬</strong>æ¢ä¸º<strong>å·¦è¾¹</strong>å˜é‡çš„ç±»å‹ã€‚å¦‚æœå³è¾¹è¡¨è¾¾å¼çš„æ•°æ®ç±»å‹é•¿åº¦æ¯”å·¦è¾¹é•¿æ—¶ï¼Œå°†ä¸¢å¤±ä¸€éƒ¨åˆ†æ•°æ®ï¼Œè¿™æ ·<strong>ä¼šé™ä½ç²¾åº¦</strong>ã€‚</p>
<p>ä¸‹å›¾è¡¨ç¤ºäº†ç±»å‹è‡ªåŠ¨è½¬æ¢çš„è§„åˆ™ï¼š</p>
<p><img src="https://gitee.com/mychimei/picture/raw/master/415611_1442458661106_F4A62FDD254F710F39378C754ED65E61" alt="img" /></p>
<h2 id="string%E3%80%81stringbuffer%E3%80%81stringbuilder-%E5%8C%BA%E5%88%AB" id="Stringã€StringBufferã€StringBuilder-åŒºåˆ«">Stringã€StringBufferã€StringBuilder åŒºåˆ«</h2>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">**</span><br><span class="line"> * Stringä½¿ç”¨+æ‹¼æ¥å­—ç¬¦ä¸²ï¼Œå¦‚æœåœ¨å¾ªç¯ä¸­ï¼Œåœ¨å¾ªç¯ä¸­ï¼Œ</span><br><span class="line"> * æ¯æ¬¡å¾ªç¯éƒ½ä¼šåˆ›å»ºæ–°çš„å­—ç¬¦ä¸²å¯¹è±¡ï¼Œç„¶åæ‰”æ‰æ—§çš„å­—ç¬¦ä¸²ã€‚</span><br><span class="line"> * è¿™æ ·ï¼Œç»å¤§éƒ¨åˆ†å­—ç¬¦ä¸²éƒ½æ˜¯ä¸´æ—¶å¯¹è±¡ï¼Œä¸ä½†æµªè´¹å†…å­˜ï¼Œè¿˜ä¼šå½±å“GCæ•ˆç‡</span><br><span class="line"> * ä¸ºé«˜æ•ˆæ‹¼æ¥å­—ç¬¦ä¸²Javaæ ‡å‡†åº“æä¾›äº†StringBuilderï¼Œå®ƒæ˜¯ä¸€ä¸ªå¯å˜å¯¹è±¡ï¼Œå¯ä»¥é¢„åˆ†é…ç¼“å†²åŒº</span><br><span class="line"> * å¯¹äºæ™®é€šçš„å­—ç¬¦ä¸²+æ“ä½œï¼Œå¹¶ä¸éœ€è¦æˆ‘ä»¬å°†å…¶æ”¹å†™ä¸ºStringBuilderï¼Œ</span><br><span class="line"> * å› ä¸ºJavaç¼–è¯‘å™¨åœ¨ç¼–è¯‘æ—¶å°±è‡ªåŠ¨æŠŠå¤šä¸ªè¿ç»­çš„+æ“ä½œç¼–ç ä¸ºStringConcatFactoryçš„æ“ä½œã€‚</span><br><span class="line"> * åœ¨è¿è¡ŒæœŸï¼ŒStringConcatFactoryä¼šè‡ªåŠ¨æŠŠå­—ç¬¦ä¸²è¿æ¥æ“ä½œä¼˜åŒ–ä¸ºæ•°ç»„å¤åˆ¶æˆ–è€…StringBuilderæ“ä½œ</span><br><span class="line"> * StringBufferé€šè¿‡åŒæ­¥æ¥ä¿è¯å¤šä¸ªçº¿ç¨‹æ“ä½œStringBufferä¹Ÿæ˜¯å®‰å…¨çš„ï¼Œä½†æ˜¯åŒæ­¥ä¼šå¸¦æ¥æ‰§è¡Œé€Ÿåº¦çš„ä¸‹é™</span><br><span class="line"> * StringBuilderå’ŒStringBufferæ¥å£å®Œå…¨ç›¸åŒï¼Œç°åœ¨å®Œå…¨æ²¡æœ‰å¿…è¦ä½¿ç”¨StringBuffer</span><br><span class="line"> * <span class="meta">@author</span> lxl*/</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">StringBuilderL</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        StringBuffer sb = <span class="keyword">new</span> StringBuffer(<span class="number">1024</span>);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">1000</span>; i++) &#123;</span><br><span class="line">            sb.append(<span class="string">&#x27;s&#x27;</span>);</span><br><span class="line">            sb.append(i);</span><br><span class="line">        &#125;</span><br><span class="line">        sb.append(<span class="string">&quot;good &quot;</span>)</span><br><span class="line">                .append(<span class="string">&quot;LXL&quot;</span>)</span><br><span class="line">                .insert(<span class="number">0</span>, <span class="string">&quot;DD&quot;</span>);<span class="comment">//é“¾å¼æ“ä½œ</span></span><br><span class="line">        String s = sb.toString();</span><br><span class="line">        System.out.println(s);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="jdk%E4%B8%8Ejre%E5%8C%BA%E5%88%AB" id="JDKä¸JREåŒºåˆ«"><a target="_blank" rel="noopener" href="https://www.cnblogs.com/bingyimeiling/p/10266949.html">JDKä¸JREåŒºåˆ«</a></h2>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#æŸ¥çœ‹JDKè·¯å¾„ </span></span><br><span class="line">java -verbose</span><br></pre></td></tr></table></figure>
<p><img src="https://gitee.com/mychimei/picture/raw/master/1362965-20190114161305916-1522316322.png" alt="img" /></p>
<h3 id="jdk-1" id="JDK-v2">JDK</h3>
<p>â€‹		JDK(Java SE Development Kit)ï¼Œ<strong>Javaæ ‡å‡†å¼€å‘åŒ…</strong>ï¼Œå®ƒæä¾›äº†ç¼–è¯‘ã€è¿è¡ŒJavaç¨‹åºæ‰€éœ€çš„å„ç§å·¥å…·å’Œèµ„æºï¼ŒåŒ…æ‹¬Javaç¼–è¯‘å™¨ã€Javaè¿è¡Œæ—¶ç¯å¢ƒï¼Œä»¥åŠå¸¸ç”¨çš„Javaç±»åº“ç­‰ã€‚</p>
<p><img src="https://gitee.com/mychimei/picture/raw/master/image-20220320112912275.png" alt="JDK" /></p>
<h3 id="jre" id="JRE">JRE</h3>
<p>â€‹		JRE( Java Runtime Environment) ã€<strong>Javaè¿è¡Œç¯å¢ƒ</strong>ï¼Œç”¨äºè§£é‡Šæ‰§è¡ŒJavaçš„å­—èŠ‚ç æ–‡ä»¶ã€‚æ™®é€šç”¨æˆ·è€Œåªéœ€è¦å®‰è£… JREï¼ˆJava Runtime Environmentï¼‰æ¥è¿è¡Œ Java ç¨‹åºã€‚è€Œç¨‹åºå¼€å‘è€…å¿…é¡»å®‰è£…JDKæ¥ç¼–è¯‘ã€è°ƒè¯•ç¨‹åºã€‚</p>
<p><img src="https://gitee.com/mychimei/picture/raw/master/image-20220320113334848.png" alt="image-20220320113334848" /></p>
<h2 id="%E7%B2%BE%E5%BA%A6%E9%81%97%E5%A4%B1%E9%97%AE%E9%A2%98" id="ç²¾åº¦é—å¤±é—®é¢˜">ç²¾åº¦é—å¤±é—®é¢˜</h2>
<p>â€‹		float è¿˜æ˜¯doubleéƒ½æ˜¯æµ®ç‚¹æ•°ï¼Œè€Œè®¡ç®—æœºæ˜¯äºŒè¿›åˆ¶çš„ï¼Œæµ®ç‚¹æ•°ä¼šå¤±å»ä¸€å®šçš„ç²¾ç¡®åº¦ï¼Œåªèƒ½ç”¨æ¥ç§‘å­¦æˆ–å·¥ç¨‹è®¡ç®—ï¼Œä¸èƒ½ç”¨æ¥å•†ä¸šè®¡ç®—ã€‚æ ¹æœ¬åŸå› æ˜¯:åè¿›åˆ¶å€¼é€šå¸¸æ²¡æœ‰å®Œå…¨ç›¸åŒçš„äºŒè¿›åˆ¶è¡¨ç¤ºå½¢å¼;åè¿›åˆ¶æ•°çš„äºŒè¿›åˆ¶è¡¨ç¤ºå½¢å¼å¯èƒ½ä¸ç²¾ç¡®ã€‚åªèƒ½æ— é™æ¥è¿‘äºé‚£ä¸ªå€¼</p>
<h3 id="bigdecimal" id="BigDecimal">BigDecimal</h3>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> pers.lxl.mylearnproject.javase.coreclass;</span><br><span class="line"><span class="keyword">import</span> com.sun.istack.internal.NotNull;</span><br><span class="line"><span class="keyword">import</span> java.math.BigDecimal;</span><br><span class="line"><span class="keyword">import</span> java.math.RoundingMode;</span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> java.math.BigDecimal.ROUND_CEILING;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Javaåœ¨java.mathåŒ…ä¸­æä¾›çš„APIç±»BigDecimalï¼Œç”¨æ¥å¯¹è¶…è¿‡16ä½æœ‰æ•ˆä½çš„æ•°è¿›è¡Œç²¾ç¡®çš„è¿ç®—ã€‚</span></span><br><span class="line"><span class="comment"> * åŒç²¾åº¦æµ®ç‚¹å‹å˜é‡doubleå¯ä»¥å¤„ç†16ä½æœ‰æ•ˆæ•°ã€‚åœ¨å®é™…åº”ç”¨ä¸­ï¼Œéœ€è¦å¯¹æ›´å¤§æˆ–è€…æ›´å°çš„æ•°è¿›è¡Œè¿ç®—å’Œå¤„ç†ã€‚</span></span><br><span class="line"><span class="comment"> * floatå’Œdoubleåªèƒ½ç”¨æ¥åšç§‘å­¦è®¡ç®—æˆ–è€…æ˜¯å·¥ç¨‹è®¡ç®—ï¼Œåœ¨å•†ä¸šè®¡ç®—ä¸­è¦ç”¨java.math.BigDecimalã€‚</span></span><br><span class="line"><span class="comment"> * BigDecimalæ‰€åˆ›å»ºçš„æ˜¯å¯¹è±¡ï¼Œæˆ‘ä»¬ä¸èƒ½ä½¿ç”¨ä¼ ç»Ÿçš„+ã€-ã€*ã€/ç­‰ç®—æœ¯è¿ç®—ç¬¦ç›´æ¥å¯¹å…¶å¯¹è±¡è¿›è¡Œæ•°å­¦è¿ç®—ï¼Œè€Œå¿…é¡»è°ƒç”¨å…¶ç›¸å¯¹åº”çš„æ–¹æ³•ã€‚</span></span><br><span class="line"><span class="comment"> * æ–¹æ³•ä¸­çš„å‚æ•°ä¹Ÿå¿…é¡»æ˜¯BigDecimalçš„å¯¹è±¡ã€‚æ„é€ å™¨æ˜¯ç±»çš„ç‰¹æ®Šæ–¹æ³•ï¼Œä¸“é—¨ç”¨æ¥åˆ›å»ºå¯¹è±¡ï¼Œç‰¹åˆ«æ˜¯å¸¦æœ‰å‚æ•°çš„å¯¹è±¡ã€‚</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> Administrator</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * å‚è€ƒï¼šhttps://blog.csdn.net/qq_35868412/article/details/89029288</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BigDecimalL</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line"><span class="comment">//        ç²¾åº¦é—å¤±é—®é¢˜</span></span><br><span class="line"><span class="comment">//        float è¿˜æ˜¯doubleéƒ½æ˜¯æµ®ç‚¹æ•°ï¼Œè€Œè®¡ç®—æœºæ˜¯äºŒè¿›åˆ¶çš„ï¼Œæµ®ç‚¹æ•°ä¼šå¤±å»ä¸€å®šçš„ç²¾ç¡®åº¦ï¼Œåªèƒ½ç”¨æ¥ç§‘å­¦æˆ–å·¥ç¨‹è®¡ç®—ï¼Œä¸èƒ½ç”¨æ¥å•†ä¸šè®¡ç®—ã€‚æ ¹æœ¬åŸå› æ˜¯:åè¿›åˆ¶å€¼é€šå¸¸æ²¡æœ‰å®Œå…¨ç›¸åŒçš„äºŒè¿›åˆ¶è¡¨ç¤ºå½¢å¼;åè¿›åˆ¶æ•°çš„äºŒè¿›åˆ¶è¡¨ç¤ºå½¢å¼å¯èƒ½ä¸ç²¾ç¡®ã€‚åªèƒ½æ— é™æ¥è¿‘äºé‚£ä¸ªå€¼</span></span><br><span class="line"><span class="comment">//        0.19999999999999998</span></span><br><span class="line">        System.out.println(<span class="number">0.3</span> - <span class="number">0.1</span>);</span><br><span class="line"><span class="comment">//       0.020000000000000004</span></span><br><span class="line">        System.out.println(<span class="number">0.2</span> * <span class="number">0.1</span>);</span><br><span class="line"><span class="comment">//        0.30000000000000004</span></span><br><span class="line">        System.out.println(<span class="number">0.2</span> + <span class="number">0.1</span>);</span><br><span class="line"><span class="comment">//        2.9999999999999996</span></span><br><span class="line">        System.out.println(<span class="number">0.3</span> / <span class="number">0.1</span>);</span><br><span class="line"><span class="comment">//é‡‘èé¡¹ç›®ä¸­éœ€è¦å‡†ç¡®è®¡ç®—ï¼Œä¸èƒ½æœ‰ç²¾åº¦é—å¤±é—®é¢˜ï¼Œæ‰€ä»¥å•†ä¸šä½¿ç”¨éœ€è¦ç”¨BigDecimal==============================</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//BigDecimal(int)       åˆ›å»ºä¸€ä¸ªå…·æœ‰å‚æ•°æ‰€æŒ‡å®šæ•´æ•°å€¼çš„å¯¹è±¡ã€‚</span></span><br><span class="line"><span class="comment">//BigDecimal(double)   åˆ›å»ºä¸€ä¸ªå…·æœ‰å‚æ•°æ‰€æŒ‡å®šåŒç²¾åº¦å€¼çš„å¯¹è±¡ã€‚ //ä¸æ¨èä½¿ç”¨</span></span><br><span class="line"><span class="comment">//BigDecimal(long)    åˆ›å»ºä¸€ä¸ªå…·æœ‰å‚æ•°æ‰€æŒ‡å®šé•¿æ•´æ•°å€¼çš„å¯¹è±¡ã€‚</span></span><br><span class="line"><span class="comment">//BigDecimal(String) åˆ›å»ºä¸€ä¸ªå…·æœ‰å‚æ•°æ‰€æŒ‡å®šä»¥å­—ç¬¦ä¸²è¡¨ç¤ºçš„æ•°å€¼çš„å¯¹è±¡ã€‚//æ¨èä½¿ç”¨</span></span><br><span class="line"><span class="comment">//add(BigDecimal)        BigDecimalå¯¹è±¡ä¸­çš„å€¼ç›¸åŠ ï¼Œç„¶åè¿”å›è¿™ä¸ªå¯¹è±¡ã€‚</span></span><br><span class="line"><span class="comment">//subtract(BigDecimal) BigDecimalå¯¹è±¡ä¸­çš„å€¼ç›¸å‡ï¼Œç„¶åè¿”å›è¿™ä¸ªå¯¹è±¡ã€‚</span></span><br><span class="line"><span class="comment">//multiply(BigDecimal)  BigDecimalå¯¹è±¡ä¸­çš„å€¼ç›¸ä¹˜ï¼Œç„¶åè¿”å›è¿™ä¸ªå¯¹è±¡ã€‚</span></span><br><span class="line"><span class="comment">//divide(BigDecimal)     BigDecimalå¯¹è±¡ä¸­çš„å€¼ç›¸é™¤ï¼Œç„¶åè¿”å›è¿™ä¸ªå¯¹è±¡ã€‚</span></span><br><span class="line"><span class="comment">//toString()                å°†BigDecimalå¯¹è±¡çš„æ•°å€¼è½¬æ¢æˆå­—ç¬¦ä¸²ã€‚</span></span><br><span class="line"><span class="comment">//doubleValue()          å°†BigDecimalå¯¹è±¡ä¸­çš„å€¼ä»¥åŒç²¾åº¦æ•°è¿”å›ã€‚</span></span><br><span class="line"><span class="comment">//floatValue()             å°†BigDecimalå¯¹è±¡ä¸­çš„å€¼ä»¥å•ç²¾åº¦æ•°è¿”å›ã€‚</span></span><br><span class="line"><span class="comment">//longValue()             å°†BigDecimalå¯¹è±¡ä¸­çš„å€¼ä»¥é•¿æ•´æ•°è¿”å›ã€‚</span></span><br><span class="line"><span class="comment">//intValue()               å°†BigDecimalå¯¹è±¡ä¸­çš„å€¼ä»¥æ•´æ•°è¿”å›ã€‚</span></span><br><span class="line">        BigDecimal bd1 = <span class="keyword">new</span> BigDecimal(<span class="string">&quot;4264.24&quot;</span>);</span><br><span class="line">        BigDecimal bd2 = <span class="keyword">new</span> BigDecimal(<span class="string">&quot;2132.1200&quot;</span>);</span><br><span class="line">        BigDecimal bd3 = <span class="keyword">new</span> BigDecimal(<span class="string">&quot;213200&quot;</span>);</span><br><span class="line">        BigDecimal bd6 = <span class="keyword">new</span> BigDecimal(<span class="string">&quot;4.0000&quot;</span>);</span><br><span class="line">        BigDecimal bd7 = <span class="keyword">new</span> BigDecimal(<span class="string">&quot;3.0&quot;</span>);</span><br><span class="line"><span class="comment">//        åŠ </span></span><br><span class="line">        System.out.println(<span class="string">&quot;åŠ &quot;</span>+bd1.add(bd3));</span><br><span class="line"><span class="comment">//        å‡</span></span><br><span class="line">        System.out.println(<span class="string">&quot;å‡&quot;</span>+bd1.subtract(bd1));</span><br><span class="line"><span class="comment">//        ä¹˜</span></span><br><span class="line">        System.out.println(<span class="string">&quot;ä¹˜&quot;</span>+bd6.multiply(bd7));</span><br><span class="line"><span class="comment">//        é™¤</span></span><br><span class="line"><span class="comment">//        ä¸åˆ†é…ä¿ç•™å°æ•°ç‚¹ä¿ç•™ä½æ•°çš„éæ•´é™¤è¿ç®—ä¼šå¯¼è‡´æŠ¥é”™java.lang.ArithmeticExceptionï¼šNon-terminating decimal expansion; no exact representable decimal result.</span></span><br><span class="line"><span class="comment">//        System.out.println(bd1.divide(bd3));</span></span><br><span class="line"><span class="comment">//        å¤šä¼ å…¥ä¸¤ä¸ªå‚æ•°å³å¯é¿å…</span></span><br><span class="line"><span class="comment">//       divide(BigDecimalï¼Œä¿ç•™å°æ•°ç‚¹åå‡ ä½å°æ•°ï¼Œèˆå…¥æ¨¡å¼)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//èˆå…¥æ¨¡å¼</span></span><br><span class="line"><span class="comment">//ROUND_CEILING    //å‘æ­£æ— ç©·æ–¹å‘èˆå…¥</span></span><br><span class="line"><span class="comment">//ROUND_DOWN    //å‘é›¶æ–¹å‘èˆå…¥</span></span><br><span class="line"><span class="comment">//ROUND_FLOOR    //å‘è´Ÿæ— ç©·æ–¹å‘èˆå…¥</span></span><br><span class="line"><span class="comment">//ROUND_HALF_DOWN    //å‘ï¼ˆè·ç¦»ï¼‰æœ€è¿‘çš„ä¸€è¾¹èˆå…¥ï¼Œé™¤éä¸¤è¾¹ï¼ˆçš„è·ç¦»ï¼‰æ˜¯ç›¸ç­‰,å¦‚æœæ˜¯è¿™æ ·ï¼Œå‘ä¸‹èˆå…¥, ä¾‹å¦‚1.55 ä¿ç•™ä¸€ä½å°æ•°ç»“æœä¸º1.5</span></span><br><span class="line"><span class="comment">//ROUND_HALF_EVEN    //å‘ï¼ˆè·ç¦»ï¼‰æœ€è¿‘çš„ä¸€è¾¹èˆå…¥ï¼Œé™¤éä¸¤è¾¹ï¼ˆçš„è·ç¦»ï¼‰æ˜¯ç›¸ç­‰,å¦‚æœæ˜¯è¿™æ ·ï¼Œå¦‚æœä¿ç•™ä½æ•°æ˜¯å¥‡æ•°ï¼Œä½¿ç”¨ROUND_HALF_UPï¼Œå¦‚æœæ˜¯å¶æ•°ï¼Œä½¿ç”¨ROUND_HALF_DOWN</span></span><br><span class="line"><span class="comment">//ROUND_HALF_UP    //å‘ï¼ˆè·ç¦»ï¼‰æœ€è¿‘çš„ä¸€è¾¹èˆå…¥ï¼Œé™¤éä¸¤è¾¹ï¼ˆçš„è·ç¦»ï¼‰æ˜¯ç›¸ç­‰,å¦‚æœæ˜¯è¿™æ ·ï¼Œå‘ä¸Šèˆå…¥, 1.55ä¿ç•™ä¸€ä½å°æ•°ç»“æœä¸º1.6,ä¹Ÿå°±æ˜¯æˆ‘ä»¬å¸¸è¯´çš„â€œå››èˆäº”å…¥â€</span></span><br><span class="line"><span class="comment">//ROUND_UNNECESSARY    //è®¡ç®—ç»“æœæ˜¯ç²¾ç¡®çš„ï¼Œä¸éœ€è¦èˆå…¥æ¨¡å¼</span></span><br><span class="line"><span class="comment">//ROUND_UP    //å‘è¿œç¦»0çš„æ–¹å‘èˆå…¥</span></span><br><span class="line"></span><br><span class="line">        System.out.println(<span class="string">&quot;é™¤&quot;</span>+bd6.divide(bd7,<span class="number">2</span>,ROUND_CEILING));</span><br><span class="line"></span><br><span class="line">        <span class="comment">//scale()è¡¨ç¤ºå°æ•°ä½æ•°</span></span><br><span class="line">        System.out.println(bd1.scale());</span><br><span class="line">        System.out.println(bd2.scale());</span><br><span class="line">        System.out.println(bd3.scale());</span><br><span class="line">        <span class="comment">//stripTrailingZeros()æ–¹æ³•ï¼Œå¯ä»¥å°†ä¸€ä¸ªBigDecimalæ ¼å¼åŒ–ä¸ºä¸€ä¸ªç›¸ç­‰çš„ï¼Œä½†å»æ‰äº†æœ«å°¾0çš„BigDecimal</span></span><br><span class="line">        BigDecimal d1 = bd1.stripTrailingZeros();</span><br><span class="line">        BigDecimal d2 = bd2.stripTrailingZeros();</span><br><span class="line">        BigDecimal d3 = bd3.stripTrailingZeros();</span><br><span class="line">        <span class="comment">//scale()è¿”å›è´Ÿæ•°ï¼Œä¾‹å¦‚ï¼Œ-2ï¼Œè¡¨ç¤ºè¿™ä¸ªæ•°æ˜¯ä¸ªæ•´æ•°ï¼Œå¹¶ä¸”æœ«å°¾æœ‰2ä¸ª0</span></span><br><span class="line">        System.out.println(d1.scale());</span><br><span class="line">        System.out.println(d2.scale());</span><br><span class="line">        System.out.println(d3.scale());</span><br><span class="line">        <span class="comment">//é™¤æ³•æ—¶ï¼Œå­˜åœ¨æ— æ³•é™¤å°½çš„æƒ…å†µï¼Œè¿™æ—¶ï¼Œå°±å¿…é¡»æŒ‡å®šç²¾åº¦ä»¥åŠå¦‚ä½•è¿›è¡Œæˆªæ–­,è¿˜å¯åŒäº‹æ±‚ä½™æ•°</span></span><br><span class="line">        <span class="comment">//å››èˆäº”å…¥</span></span><br><span class="line">        BigDecimal bd4 = bd1.setScale(<span class="number">4</span>, RoundingMode.HALF_UP);</span><br><span class="line">        <span class="comment">//ç›´æ¥æˆªæ–­</span></span><br><span class="line">        BigDecimal bd5 = bd1.setScale(<span class="number">4</span>, RoundingMode.DOWN);</span><br><span class="line">        <span class="comment">//divideAndRemainder()æ–¹æ³•æ—¶ï¼Œè¿”å›çš„æ•°ç»„åŒ…å«ä¸¤ä¸ªBigDecimalï¼Œåˆ†åˆ«æ˜¯å•†å’Œä½™æ•°ï¼Œ</span></span><br><span class="line">        <span class="comment">// å…¶ä¸­å•†æ€»æ˜¯æ•´æ•°ï¼Œä½™æ•°ä¸ä¼šå¤§äºé™¤æ•°ã€‚æˆ‘ä»¬å¯ä»¥åˆ©ç”¨è¿™ä¸ªæ–¹æ³•åˆ¤æ–­ä¸¤ä¸ªBigDecimalæ˜¯å¦æ˜¯æ•´æ•°å€æ•°</span></span><br><span class="line">        BigDecimal[] dr = bd1.divideAndRemainder(bd2);</span><br><span class="line">        <span class="keyword">if</span> (dr[<span class="number">1</span>].signum() == <span class="number">0</span>) &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;bd1æ˜¯bd2çš„æ•´&quot;</span> + dr[<span class="number">0</span>] + <span class="string">&quot;å€&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//åœ¨æ¯”è¾ƒä¸¤ä¸ªBigDecimalçš„å€¼æ˜¯å¦ç›¸ç­‰æ—¶ï¼Œè¦ç‰¹åˆ«æ³¨æ„ï¼Œä½¿ç”¨equals()æ–¹æ³•ä¸ä½†è¦æ±‚ä¸¤ä¸ªBigDecimalçš„å€¼ç›¸ç­‰ï¼Œè¿˜è¦æ±‚å®ƒä»¬çš„scale()ç›¸ç­‰</span></span><br><span class="line">        <span class="comment">//å¿…é¡»ä½¿ç”¨compareTo()æ–¹æ³•æ¥æ¯”è¾ƒï¼Œå®ƒæ ¹æ®ä¸¤ä¸ªå€¼çš„å¤§å°åˆ†åˆ«è¿”å›è´Ÿæ•°ã€æ­£æ•°å’Œ0ï¼Œåˆ†åˆ«è¡¨ç¤ºå°äºã€å¤§äºå’Œç­‰äº</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//        JDKçš„æè¿°ï¼š1ã€å‚æ•°ç±»å‹ä¸ºdoubleçš„æ„é€ æ–¹æ³•çš„ç»“æœæœ‰ä¸€å®šçš„ä¸å¯é¢„çŸ¥æ€§ã€‚æœ‰äººå¯èƒ½è®¤ä¸ºåœ¨Javaä¸­å†™å…¥newBigDecimal(0.1)æ‰€åˆ›å»ºçš„BigDecimalæ­£å¥½ç­‰äº 0.1ï¼ˆéæ ‡åº¦å€¼ 1ï¼Œå…¶æ ‡åº¦ä¸º 1ï¼‰ï¼Œ</span></span><br><span class="line"><span class="comment">//        ä½†æ˜¯å®ƒå®é™…ä¸Šç­‰äº0.1000000000000000055511151231257827021181583404541015625ã€‚è¿™æ˜¯å› ä¸º0.1æ— æ³•å‡†ç¡®åœ°è¡¨ç¤ºä¸º doubleï¼ˆæˆ–è€…è¯´å¯¹äºè¯¥æƒ…å†µï¼Œä¸èƒ½è¡¨ç¤ºä¸ºä»»ä½•æœ‰é™é•¿åº¦çš„äºŒè¿›åˆ¶å°æ•°ï¼‰ã€‚</span></span><br><span class="line"><span class="comment">//        è¿™æ ·ï¼Œä¼ å…¥åˆ°æ„é€ æ–¹æ³•çš„å€¼ä¸ä¼šæ­£å¥½ç­‰äº 0.1ï¼ˆè™½ç„¶è¡¨é¢ä¸Šç­‰äºè¯¥å€¼ï¼‰ã€‚</span></span><br><span class="line"><span class="comment">//        2ã€å¦ä¸€æ–¹é¢ï¼ŒString æ„é€ æ–¹æ³•æ˜¯å®Œå…¨å¯é¢„çŸ¥çš„ï¼šå†™å…¥ newBigDecimal(&quot;0.1&quot;) å°†åˆ›å»ºä¸€ä¸ª BigDecimalï¼Œå®ƒæ­£å¥½ç­‰äºé¢„æœŸçš„ 0.1ã€‚å› æ­¤ï¼Œæ¯”è¾ƒè€Œè¨€ï¼Œé€šå¸¸å»ºè®®ä¼˜å…ˆä½¿ç”¨Stringæ„é€ æ–¹æ³•</span></span><br><span class="line"><span class="comment">//        å½“doubleå¿…é¡»ç”¨ä½œBigDecimalçš„æºæ—¶ï¼Œè¯·ä½¿ç”¨Double.toString(double)è½¬æˆStringï¼Œç„¶åä½¿ç”¨Stringæ„é€ æ–¹æ³•ï¼Œæˆ–ä½¿ç”¨BigDecimalçš„é™æ€æ–¹æ³•valueOf</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h3 id="biginteger" id="BigInteger">BigInteger</h3>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> pers.lxl.mylearnproject.javase.coreclass;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.math.BigInteger;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**CPUåŸç”Ÿæä¾›çš„æ•´å‹æœ€å¤§èŒƒå›´æ˜¯64ä½longå‹æ•´æ•°</span></span><br><span class="line"><span class="comment"> * å¦‚æœæˆ‘ä»¬ä½¿ç”¨çš„æ•´æ•°èŒƒå›´è¶…è¿‡äº†longå‹æ€ä¹ˆåŠï¼Ÿè¿™ä¸ªæ—¶å€™ï¼Œå°±åªèƒ½ç”¨è½¯ä»¶æ¥æ¨¡æ‹Ÿä¸€ä¸ªå¤§æ•´æ•°ã€‚</span></span><br><span class="line"><span class="comment"> * java.math.BigIntegerå°±æ˜¯ç”¨æ¥è¡¨ç¤ºä»»æ„å¤§å°çš„æ•´æ•°ã€‚</span></span><br><span class="line"><span class="comment"> * BigIntegerå†…éƒ¨ç”¨ä¸€ä¸ªint[]æ•°ç»„æ¥æ¨¡æ‹Ÿä¸€ä¸ªéå¸¸å¤§çš„æ•´æ•°ï¼š</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> Administrator*/</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BigIntegerL</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        BigInteger bi = <span class="keyword">new</span> BigInteger(<span class="string">&quot;12131231231233&quot;</span>);</span><br><span class="line">        BigInteger bi1 = <span class="keyword">new</span> BigInteger(<span class="string">&quot;121321211111111&quot;</span>);</span><br><span class="line">        System.out.println(bi.pow(<span class="number">5</span>));</span><br><span class="line">        <span class="comment">//BigIntegeråšè¿ç®—çš„æ—¶å€™ï¼Œåªèƒ½ä½¿ç”¨å®ä¾‹æ–¹æ³•,å’Œlongå‹æ•´æ•°è¿ç®—æ¯”ï¼ŒBigIntegerä¸ä¼šæœ‰èŒƒå›´é™åˆ¶ï¼Œä½†ç¼ºç‚¹æ˜¯é€Ÿåº¦æ¯”è¾ƒæ…¢ã€‚</span></span><br><span class="line">        BigInteger sum = bi.add(bi1);</span><br><span class="line">        <span class="comment">/*è½¬æ¢ä¸ºbyteï¼šbyteValue()</span></span><br><span class="line"><span class="comment">         è½¬æ¢ä¸ºshortï¼šshortValue()</span></span><br><span class="line"><span class="comment">         è½¬æ¢ä¸ºintï¼šintValue()</span></span><br><span class="line"><span class="comment">         è½¬æ¢ä¸ºlongï¼šlongValue()</span></span><br><span class="line"><span class="comment">         è½¬æ¢ä¸ºfloatï¼šfloatValue()</span></span><br><span class="line"><span class="comment">         è½¬æ¢ä¸ºdoubleï¼šdoubleValue()</span></span><br><span class="line"><span class="comment">         é€šè¿‡ä¸Šè¿°æ–¹æ³•ï¼Œå¯ä»¥æŠŠBigIntegerè½¬æ¢æˆåŸºæœ¬ç±»å‹ã€‚</span></span><br><span class="line"><span class="comment">         å¦‚æœBigIntegerè¡¨ç¤ºçš„èŒƒå›´è¶…è¿‡äº†åŸºæœ¬ç±»å‹çš„èŒƒå›´ï¼Œ</span></span><br><span class="line"><span class="comment">         è½¬æ¢æ—¶å°†ä¸¢å¤±é«˜ä½ä¿¡æ¯ï¼Œå³ç»“æœä¸ä¸€å®šæ˜¯å‡†ç¡®çš„ã€‚å¦‚æœéœ€è¦å‡†ç¡®åœ°è½¬æ¢æˆåŸºæœ¬ç±»å‹ï¼Œ</span></span><br><span class="line"><span class="comment">         å¯ä»¥ä½¿ç”¨intValueExact()ã€longValueExact()ç­‰æ–¹æ³•ï¼Œåœ¨è½¬æ¢æ—¶å¦‚æœè¶…å‡ºèŒƒå›´ï¼Œ</span></span><br><span class="line"><span class="comment">         å°†ç›´æ¥æŠ›å‡ºArithmeticExceptionå¼‚å¸¸</span></span><br><span class="line"><span class="comment">         å¦‚æœBigIntegerçš„å€¼ç”šè‡³è¶…è¿‡äº†floatçš„æœ€å¤§èŒƒå›´ï¼ˆ3.4x1038ï¼‰ï¼Œé‚£ä¹ˆè¿”å›çš„floatä¸ºInfinity</span></span><br><span class="line"><span class="comment">         å…¶ä»–å¸¸ç”¨æ–¹æ³•ï¼š</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">        BigInteger abs()  è¿”å›å¤§æ•´æ•°çš„ç»å¯¹å€¼</span></span><br><span class="line"><span class="comment">        BigInteger add(BigInteger val) è¿”å›ä¸¤ä¸ªå¤§æ•´æ•°çš„å’Œ</span></span><br><span class="line"><span class="comment">        BigInteger and(BigInteger val)  è¿”å›ä¸¤ä¸ªå¤§æ•´æ•°çš„æŒ‰ä½ä¸çš„ç»“æœ</span></span><br><span class="line"><span class="comment">        BigInteger andNot(BigInteger val) è¿”å›ä¸¤ä¸ªå¤§æ•´æ•°ä¸éçš„ç»“æœ</span></span><br><span class="line"><span class="comment">        BigInteger divide(BigInteger val)  è¿”å›ä¸¤ä¸ªå¤§æ•´æ•°çš„å•†</span></span><br><span class="line"><span class="comment">        BigInteger gcd(BigInteger val)  è¿”å›å¤§æ•´æ•°çš„æœ€å¤§å…¬çº¦æ•°</span></span><br><span class="line"><span class="comment">        BigInteger max(BigInteger val) è¿”å›ä¸¤ä¸ªå¤§æ•´æ•°çš„æœ€å¤§è€…</span></span><br><span class="line"><span class="comment">        BigInteger min(BigInteger val) è¿”å›ä¸¤ä¸ªå¤§æ•´æ•°çš„æœ€å°è€…</span></span><br><span class="line"><span class="comment">        BigInteger mod(BigInteger val) ç”¨å½“å‰å¤§æ•´æ•°å¯¹valæ±‚æ¨¡</span></span><br><span class="line"><span class="comment">        BigInteger multiply(BigInteger val) è¿”å›ä¸¤ä¸ªå¤§æ•´æ•°çš„ç§¯</span></span><br><span class="line"><span class="comment">        BigInteger negate() è¿”å›å½“å‰å¤§æ•´æ•°çš„ç›¸åæ•°</span></span><br><span class="line"><span class="comment">        BigInteger not() è¿”å›å½“å‰å¤§æ•´æ•°çš„é</span></span><br><span class="line"><span class="comment">        BigInteger or(BigInteger val) è¿”å›ä¸¤ä¸ªå¤§æ•´æ•°çš„æŒ‰ä½æˆ–</span></span><br><span class="line"><span class="comment">        BigInteger pow(int exponent) è¿”å›å½“å‰å¤§æ•´æ•°çš„exponentæ¬¡æ–¹</span></span><br><span class="line"><span class="comment">        BigInteger remainder(BigInteger val) è¿”å›å½“å‰å¤§æ•´æ•°é™¤ä»¥valçš„ä½™æ•°</span></span><br><span class="line"><span class="comment">        BigInteger leftShift(int n) å°†å½“å‰å¤§æ•´æ•°å·¦ç§»nä½åè¿”å›</span></span><br><span class="line"><span class="comment">        BigInteger rightShift(int n) å°†å½“å‰å¤§æ•´æ•°å³ç§»nä½åè¿”å›</span></span><br><span class="line"><span class="comment">        BigInteger subtract(BigInteger val)è¿”å›ä¸¤ä¸ªå¤§æ•´æ•°ç›¸å‡çš„ç»“æœ</span></span><br><span class="line"><span class="comment">        byte[] toByteArray(BigInteger val)å°†å¤§æ•´æ•°è½¬æ¢æˆäºŒè¿›åˆ¶åç ä¿å­˜åœ¨byteæ•°ç»„ä¸­</span></span><br><span class="line"><span class="comment">        String toString() å°†å½“å‰å¤§æ•´æ•°è½¬æ¢æˆåè¿›åˆ¶çš„å­—ç¬¦ä¸²å½¢å¼</span></span><br><span class="line"><span class="comment">        BigInteger xor(BigInteger val) è¿”å›ä¸¤ä¸ªå¤§æ•´æ•°çš„å¼‚æˆ–</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<blockquote>
<p>å‚è€ƒèµ„æºï¼š</p>
<p>1.<a target="_blank" rel="noopener" href="https://blog.csdn.net/xushiyu1996818/article/details/91983557">https://blog.csdn.net/xushiyu1996818/article/details/91983557</a></p>
</blockquote>
<script type="text/javascript" src="https://cdn.jsdelivr.net/npm/kity@2.0.4/dist/kity.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text/javascript" src="https://cdn.jsdelivr.net/npm/hexo-simple-mindmap@0.2.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/hexo-simple-mindmap@0.2.0/dist/mindmap.min.css"></div><div class="article-licensing box"><div class="licensing-title"><p>JavaåŸºç¡€æ·±å…¥</p><p><a href="http://mrdemonlxl.github.io/2021/02/24/Draft/2021/Java/">http://mrdemonlxl.github.io/2021/02/24/Draft/2021/Java/</a></p></div><div class="licensing-meta level is-mobile"><div class="level-left"><div class="level-item is-narrow"><div><h6>ä½œè€…</h6><a href="http://MrDemonlxl.github.io"><p>é­‘é­…å…ˆç”Ÿ</p></a></div></div><div class="level-item is-narrow"><div><h6>å‘å¸ƒäº</h6><p>2021-02-24</p></div></div><div class="level-item is-narrow"><div><h6>æ›´æ–°äº</h6><p>2022-03-24</p></div></div><div class="level-item is-narrow"><div><h6>è®¸å¯åè®®</h6><p><a class="icon" rel="noopener" target="_blank" title="Creative Commons" href="https://creativecommons.org/"><i class="fab fa-creative-commons"></i></a><a class="icon" rel="noopener" target="_blank" title="Attribution" href="https://creativecommons.org/licenses/by/4.0/"><i class="fab fa-creative-commons-by"></i></a><a class="icon" rel="noopener" target="_blank" title="Noncommercial" href="https://creativecommons.org/licenses/by-nc/4.0/"><i class="fab fa-creative-commons-nc"></i></a></p></div></div></div></div></div><div class="recommend-area"><div class="recommend-post"><span class="is-size-6 has-text-grey has-mr-7">#Â æ¨èæ–‡ç« </span><br><span>Â Â 1.<a class="is-size-6" href="/2021/02/25/Draft/2021/%E5%BF%AB%E6%9F%A5/" target="_blank">å¿«æŸ¥</a><br></span><span>Â Â 2.<a class="is-size-6" href="/2021/11/10/Draft/2021/JVM%20%E4%B8%8E%E4%B8%8A%E5%B1%82%E6%8A%80%E6%9C%AF/" target="_blank">JVM ä¸ä¸Šå±‚æŠ€æœ¯</a><br></span><span>Â Â 3.<a class="is-size-6" href="/2021/02/18/Draft/2021/%E4%BA%94%E5%88%86%E9%92%9F%E6%90%AD%E5%BB%BA%E5%9C%A8%E7%BA%BF%E5%8D%9A%E5%AE%A2/" target="_blank">äº”åˆ†é’Ÿæ­å»ºåœ¨çº¿åšå®¢</a><br></span><span>Â Â 4.<a class="is-size-6" href="/2021/03/01/Draft/2021/JAVA%E5%BA%94%E7%94%A8/" target="_blank">é­‘é­…å…ˆç”Ÿ | ä¸šåŠ¡æŠ€æœ¯</a><br></span><span>Â Â 5.<a class="is-size-6" href="/2021/03/01/Draft/2021/%E5%89%8D%E7%AB%AF/" target="_blank">é­‘é­…å…ˆç”Ÿ | å‰ç«¯</a><br></span><span>Â Â 6.<a class="is-size-6" href="/2021/03/01/Draft/2021/Redis/" target="_blank">é­‘é­…å…ˆç”Ÿ | Redis</a><br></span></div></div><link rel="stylesheet" href="https://cdnjs.loli.net/ajax/libs/social-share.js/1.0.16/css/share.min.css"><div class="social-share"></div><script src="https://cdnjs.loli.net/ajax/libs/social-share.js/1.0.16/js/social-share.min.js"></script></article></div><div class="card"><div class="card-content"><h3 class="menu-label has-text-centered">å–œæ¬¢è¿™ç¯‡æ–‡ç« ï¼Ÿæ‰“èµä¸€ä¸‹ä½œè€…å§</h3><div class="buttons is-centered"><a class="button donate" data-type="alipay"><span class="icon is-small"><i class="fab fa-alipay"></i></span><span>æ”¯ä»˜å®</span><span class="qrcode"><img src="https://gitee.com/mychimei/picture/raw/master/1c4f12804cc5a92919acd743d93a869.jpg" alt="æ”¯ä»˜å®"></span></a><a class="button donate" data-type="wechat"><span class="icon is-small"><i class="fab fa-weixin"></i></span><span>å¾®ä¿¡</span><span class="qrcode"><img src="https://gitee.com/mychimei/picture/raw/master/260e4f4bc9e4053108cd9d02bae7386.png" alt="å¾®ä¿¡"></span></a></div></div></div><nav class="post-navigation mt-4 level is-mobile"><div class="level-start"><a class="article-nav-prev level level-item link-muted" href="/2021/02/24/Draft/2021/MYSQL%E4%BC%98%E5%8C%96/"><i class="level-item fas fa-chevron-left"></i><span class="level-item">MYSQLä¼˜åŒ–</span></a></div><div class="level-end"><a class="article-nav-next level level-item link-muted" href="/2021/02/22/Draft/2021/GIS/"><span class="level-item">GIS</span><i class="level-item fas fa-chevron-right"></i></a></div></nav><!--!--><div class="card"><div class="card-content"><div class="title is-5">è¯„è®º</div><div id="comment-container"></div><link rel="stylesheet" href="https://cdnjs.loli.net/ajax/libs/gitalk/1.6.0/gitalk.css"><script> $.getScript('/js/gitalk.min.js', function () { 
            var gitalk = new Gitalk({
            language:'zh-CN',
            id: 'a252aefc3b29372d180c37601c39cc61',
            repo: 'MrDemonlxl.github.io',
            owner: 'MrDemonlxl',
            clientID: '20ef8321698ab8c0c37b',
            clientSecret: '4faa4daae14b55afd2ed357fba92d1e9c7c3f729',
            admin: ["MrDemonlxl"],
            createIssueManually: true,
            distractionFreeMode: false,
            perPage: 10,
            pagerDirection: 'last',
            proxy: 'https://cors-anywhere.azm.workers.dev/https://github.com/login/oauth/access_token',
            
            enableHotKey: true,
            isLocked: false
        })
        gitalk.render('comment-container')});</script></div></div></div><div class="column column-left is-4-tablet is-4-desktop is-3-widescreen  order-1 is-sticky"><div class="card widget" id="toc" data-type="toc"><div class="card-content"><div class="menu"><h3 class="menu-label">ç›®å½•</h3><ul class="menu-list"><li><a class="is-flex is-mobile" href="#%E6%96%B0%E5%AD%A6%E5%9B%9B%E9%97%AE"><span>æ–°å­¦å››é—®</span></a></li><li><a class="is-flex is-mobile" href="#%E7%BB%BC%E5%90%88%E9%97%AE%E9%A2%98"><span>ç»¼åˆé—®é¢˜</span></a><ul class="menu-list"><li><a class="is-flex is-mobile" href="#%E5%A2%9E%E5%BC%BAfor%E5%92%8C%E6%99%AE%E9%80%9Afor%E5%8C%BA%E5%88%AB%EF%BC%9F"><span>å¢å¼ºforå’Œæ™®é€šforåŒºåˆ«ï¼Ÿ</span></a></li></ul></li><li><a class="is-flex is-mobile" href="#%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84"><span>æ•°æ®ç»“æ„</span></a><ul class="menu-list"><li><a class="is-flex is-mobile" href="#%E5%93%88%E5%B8%8C"><span>å“ˆå¸Œ</span></a></li><li><a class="is-flex is-mobile" href="#%E7%BA%A2%E9%BB%91%E6%A0%91"><span>çº¢é»‘æ ‘</span></a></li></ul></li><li><a class="is-flex is-mobile" href="#%E5%A6%82%E4%BD%95%E9%98%85%E8%AF%BB%E6%BA%90%E7%A0%81%EF%BC%9F"><span>å¦‚ä½•é˜…è¯»æºç ï¼Ÿ</span></a><ul class="menu-list"><li><a class="is-flex is-mobile" href="#%E6%96%B9%E6%B3%95%EF%BC%9A"><span>æ–¹æ³•ï¼š</span></a></li><li><a class="is-flex is-mobile" href="#%E9%A1%B9%E7%9B%AE"><span>é¡¹ç›®</span></a></li><li><a class="is-flex is-mobile" href="#jdk"><span>JDK</span></a></li><li><a class="is-flex is-mobile" href="#%E6%A1%86%E6%9E%B6"><span>æ¡†æ¶</span></a></li></ul></li><li><a class="is-flex is-mobile" href="#%E5%AE%B9%E5%99%A8"><span>å®¹å™¨</span></a><ul class="menu-list"><li><a class="is-flex is-mobile" href="#%E5%AD%A6%E4%B9%A0%E6%B5%81%E7%A8%8B"><span>å­¦ä¹ æµç¨‹</span></a><ul class="menu-list"><li><a class="is-flex is-mobile" href="#%E8%BF%9B%E5%BA%A6%EF%BC%9A"><span>è¿›åº¦ï¼š</span></a></li><li><a class="is-flex is-mobile" href="#%E6%96%B9%E6%B3%95%EF%BC%9A-1"><span>æ–¹æ³•ï¼š</span></a></li></ul></li><li><a class="is-flex is-mobile" href="#%E6%80%BB%E7%BB%93"><span>æ€»ç»“</span></a><ul class="menu-list"><li><a class="is-flex is-mobile" href="#%E6%80%BB%E5%85%B3%E7%B3%BB%E5%9B%BE"><span>æ€»å…³ç³»å›¾</span></a></li><li><a class="is-flex is-mobile" href="#%E8%A1%A8%E6%A0%BC%E6%80%BB%E7%BB%93"><span>è¡¨æ ¼æ€»ç»“</span></a></li></ul></li><li><a class="is-flex is-mobile" href="#collection"><span>Collection</span></a><ul class="menu-list"><li><a class="is-flex is-mobile" href="#%E9%81%8D%E5%8E%86%E6%96%B9%E5%BC%8F"><span>éå†æ–¹å¼</span></a></li></ul></li><li><a class="is-flex is-mobile" href="#list"><span>List</span></a><ul class="menu-list"><li><a class="is-flex is-mobile" href="#%E5%8F%AF%E6%8E%92%E5%BA%8F%E6%89%A9%E5%AE%B9%E4%B8%BA%E5%8E%9F%E6%9D%A5%E4%B8%A4%E5%80%8D"><span>å¯æ’åºæ‰©å®¹ä¸ºåŸæ¥ä¸¤å€</span></a></li><li><a class="is-flex is-mobile" href="#%E6%80%BB%E7%BB%93-1"><span>æ€»ç»“</span></a></li><li><a class="is-flex is-mobile" href="#%E6%80%BB%E7%BB%93-2"><span>æ€»ç»“</span></a></li></ul></li><li><a class="is-flex is-mobile" href="#set"><span>Set</span></a><ul class="menu-list"><li><a class="is-flex is-mobile" href="#%E5%BA%95%E5%B1%82%E3%80%81%E5%8F%AF%E6%8E%92%E5%BA%8F%E5%BA%95%E5%B1%82%E3%80%81%E5%8F%AF%E6%8E%92%E5%BA%8F"><span>åº•å±‚ã€å¯æ’åºåº•å±‚ã€å¯æ’åº</span></a></li><li><a class="is-flex is-mobile" href="#%E4%B8%8D%E9%87%8D%E5%A4%8D"><span>ä¸é‡å¤</span></a></li><li><a class="is-flex is-mobile" href="#%E5%BA%95%E5%B1%82"><span>åº•å±‚</span></a></li></ul></li><li><a class="is-flex is-mobile" href="#map"><span>Map</span></a><ul class="menu-list"><li><a class="is-flex is-mobile" href="#%E6%9E%84%E9%80%A0%E6%96%B9%E6%B3%95"><span>æ„é€ æ–¹æ³•</span></a></li><li><a class="is-flex is-mobile" href="#%E6%9C%89%E5%BA%8F"><span>æœ‰åº</span></a></li><li><a class="is-flex is-mobile" href="#%E5%BA%95%E5%B1%82%E7%BA%A2%E9%BB%91%E6%A0%91"><span>åº•å±‚çº¢é»‘æ ‘</span></a></li><li><a class="is-flex is-mobile" href="#hashtable"><span>HashTable</span></a></li><li><a class="is-flex is-mobile" href="#%E5%BA%95%E5%B1%82-3"><span>åº•å±‚</span></a></li></ul></li><li><a class="is-flex is-mobile" href="#queue"><span>Queue</span></a><ul class="menu-list"><li><a class="is-flex is-mobile" href="#priorityqueue"><span>PriorityQueue</span></a></li></ul></li><li><a class="is-flex is-mobile" href="#%E5%B7%A5%E5%85%B7%E7%B1%BB"><span>å·¥å…·ç±»</span></a><ul class="menu-list"><li><a class="is-flex is-mobile" href="#collections"><span>Collections</span></a></li><li><a class="is-flex is-mobile" href="#arrays"><span>Arrays</span></a></li><li><a class="is-flex is-mobile" href="#comparable%E5%92%8Ccomparator"><span>Comparableå’ŒComparator</span></a></li></ul></li><li><a class="is-flex is-mobile" href="#%E5%AE%B9%E5%99%A8%E7%BB%BC%E5%90%88%E9%97%AE%E9%A2%98"><span>å®¹å™¨ç»¼åˆé—®é¢˜</span></a></li></ul></li><li><a class="is-flex is-mobile" href="#juc"><span>JUC</span></a><ul class="menu-list"><li><a class="is-flex is-mobile" href="#%E5%A4%9A%E7%BA%BF%E7%A8%8B%E5%9F%BA%E7%A1%80"><span>å¤šçº¿ç¨‹åŸºç¡€</span></a></li><li><a class="is-flex is-mobile" href="#%E7%AE%A1%E7%A8%8B"><span>ç®¡ç¨‹</span></a></li><li><a class="is-flex is-mobile" href="#%E6%98%BE%E5%BC%8F%E5%88%9B%E5%BB%BA%E6%96%B0%E7%BA%BF%E7%A8%8B"><span>æ˜¾å¼åˆ›å»ºæ–°çº¿ç¨‹</span></a></li><li><a class="is-flex is-mobile" href="#%E7%BA%BF%E7%A8%8B%E7%9A%84%E7%8A%B6%E6%80%81"><span>çº¿ç¨‹çš„çŠ¶æ€</span></a></li><li><a class="is-flex is-mobile" href="#%E7%BA%BF%E7%A8%8B%E5%B1%9E%E6%80%A7"><span>çº¿ç¨‹å±æ€§</span></a><ul class="menu-list"><li><a class="is-flex is-mobile" href="#%E7%BA%BF%E7%A8%8B%E4%BC%98%E5%85%88%E7%BA%A7"><span>çº¿ç¨‹ä¼˜å…ˆçº§</span></a></li><li><a class="is-flex is-mobile" href="#%E5%AE%88%E6%8A%A4%E7%BA%BF%E7%A8%8B"><span>å®ˆæŠ¤çº¿ç¨‹</span></a></li><li><a class="is-flex is-mobile" href="#%E9%AA%8C%E8%AF%81%E6%98%AF%E5%90%A6%E4%B8%BA%E6%AD%BB%E9%94%81"><span>éªŒè¯æ˜¯å¦ä¸ºæ­»é”</span></a></li></ul></li><li><a class="is-flex is-mobile" href="#%E4%BD%BF%E7%94%A8wait%E5%92%8Cnotify"><span>ä½¿ç”¨waitå’Œnotify</span></a></li><li><a class="is-flex is-mobile" href="#%E4%BD%BF%E7%94%A8reentrantlock"><span>ä½¿ç”¨ReentrantLock</span></a></li><li><a class="is-flex is-mobile" href="#%E4%BD%BF%E7%94%A8condition"><span>ä½¿ç”¨Condition</span></a></li><li><a class="is-flex is-mobile" href="#%E9%94%81"><span>é”</span></a><ul class="menu-list"><li><a class="is-flex is-mobile" href="#%E4%B9%90%E8%A7%82%E9%94%81-vs-%E6%82%B2%E8%A7%82%E9%94%81"><span>ä¹è§‚é” VS æ‚²è§‚é”</span></a></li><li><a class="is-flex is-mobile" href="#%E8%87%AA%E6%97%8B%E9%94%81-vs-%E9%80%82%E5%BA%94%E6%80%A7%E8%87%AA%E6%97%8B%E9%94%81"><span>è‡ªæ—‹é” VS é€‚åº”æ€§è‡ªæ—‹é”</span></a></li><li><a class="is-flex is-mobile" href="#%E6%97%A0%E9%94%81-vs-%E5%81%8F%E5%90%91%E9%94%81-vs-%E8%BD%BB%E9%87%8F%E7%BA%A7%E9%94%81-vs-%E9%87%8D%E9%87%8F%E7%BA%A7%E9%94%81"><span>æ— é” VS åå‘é” VS è½»é‡çº§é” VS é‡é‡çº§é”</span></a></li><li><a class="is-flex is-mobile" href="#%E5%85%AC%E5%B9%B3%E9%94%81-vs-%E9%9D%9E%E5%85%AC%E5%B9%B3%E9%94%81"><span>å…¬å¹³é” VS éå…¬å¹³é”</span></a></li><li><a class="is-flex is-mobile" href="#%E5%8F%AF%E9%87%8D%E5%85%A5%E9%94%81-vs-%E9%9D%9E%E5%8F%AF%E9%87%8D%E5%85%A5%E9%94%81"><span>å¯é‡å…¥é” VS éå¯é‡å…¥é”</span></a></li><li><a class="is-flex is-mobile" href="#%E7%8B%AC%E4%BA%AB%E9%94%81-vs-%E5%85%B1%E4%BA%AB%E9%94%81"><span>ç‹¬äº«é” VS å…±äº«é”</span></a></li><li><a class="is-flex is-mobile" href="#%E8%AF%BB%E9%94%81%E5%86%99%E9%94%81"><span>è¯»é”å†™é”</span></a></li><li><a class="is-flex is-mobile" href="#reentrantreadwritelock-%E9%87%8C%E7%9A%84%E4%B8%A4%E6%8A%8A%E9%94%81-readlock-%E5%92%8C-writelock%EF%BC%8C%E8%AF%BB%E9%94%81%E6%98%AF%E5%85%B1%E4%BA%AB%E9%94%81%EF%BC%8C%E5%86%99%E9%94%81%E6%98%AF%E7%8B%AC%E4%BA%AB%E9%94%81%EF%BC%8C%E9%83%BD%E4%BC%9A%E5%8F%91%E7%94%9F%E6%AD%BB%E9%94%81%E3%80%82"><span>ReentrantReadWriteLock é‡Œçš„ä¸¤æŠŠé” ReadLock å’Œ WriteLockï¼Œè¯»é”æ˜¯å…±äº«é”ï¼Œå†™é”æ˜¯ç‹¬äº«é”ï¼Œéƒ½ä¼šå‘ç”Ÿæ­»é”ã€‚</span></a></li><li><a class="is-flex is-mobile" href="#%E4%BD%BF%E7%94%A8stampedlock"><span>ä½¿ç”¨StampedLock</span></a></li></ul></li><li><a class="is-flex is-mobile" href="#%E4%BD%BF%E7%94%A8concurrent%E9%9B%86%E5%90%88"><span>ä½¿ç”¨Concurrenté›†åˆ</span></a></li><li><a class="is-flex is-mobile" href="#%E4%BD%BF%E7%94%A8atomic"><span>ä½¿ç”¨Atomic</span></a></li><li><a class="is-flex is-mobile" href="#%E4%BD%BF%E7%94%A8-future"><span>ä½¿ç”¨ Future</span></a></li><li><a class="is-flex is-mobile" href="#%E4%BD%BF%E7%94%A8-completablefuture"><span>ä½¿ç”¨ CompletableFuture</span></a></li><li><a class="is-flex is-mobile" href="#%E4%BD%BF%E7%94%A8-forkjoin"><span>ä½¿ç”¨ ForkJoin</span></a></li><li><a class="is-flex is-mobile" href="#%E4%BD%BF%E7%94%A8-threadlocal"><span>ä½¿ç”¨ ThreadLocal</span></a></li><li><a class="is-flex is-mobile" href="#%E9%9B%86%E5%90%88%E7%BA%BF%E7%A8%8B%E5%AE%89%E5%85%A8"><span>é›†åˆçº¿ç¨‹å®‰å…¨</span></a></li><li><a class="is-flex is-mobile" href="#juc%E4%B8%89%E5%A4%A7%E8%BE%85%E5%8A%A9%E7%B1%BB"><span>JUCä¸‰å¤§è¾…åŠ©ç±»</span></a><ul class="menu-list"><li><a class="is-flex is-mobile" href="#countdownlatch%3A%E5%87%8F%E5%B0%91%E8%AE%A1%E6%95%B0"><span>CountDownLatch:å‡å°‘è®¡æ•°</span></a></li><li><a class="is-flex is-mobile" href="#cyclicbarrier%3A-%E5%BE%AA%E7%8E%AF%E6%A0%85%E6%A0%8F"><span>CyclicBarrier: å¾ªç¯æ …æ </span></a></li><li><a class="is-flex is-mobile" href="#semaphore%3A-%E4%BF%A1%E5%8F%B7%E7%81%AF"><span>Semaphore: ä¿¡å·ç¯</span></a></li></ul></li><li><a class="is-flex is-mobile" href="#%E9%98%BB%E5%A1%9E%E9%98%9F%E5%88%97"><span>é˜»å¡é˜Ÿåˆ—</span></a><ul class="menu-list"><li><a class="is-flex is-mobile" href="#%E4%B8%BA%E4%BB%80%E4%B9%88%E9%9C%80%E8%A6%81blockingqueue"><span>ä¸ºä»€ä¹ˆéœ€è¦BlockingQueue</span></a></li><li><a class="is-flex is-mobile" href="#linkedblockingdeque"><span>LinkedBlockingDeque</span></a></li><li><a class="is-flex is-mobile" href="#%E5%B0%8F%E7%BB%93"><span>å°ç»“</span></a></li></ul></li><li><a class="is-flex is-mobile" href="#%E7%BA%BF%E7%A8%8B%E6%B1%A0"><span>çº¿ç¨‹æ± </span></a><ul class="menu-list"><li><a class="is-flex is-mobile" href="#%E5%88%9B%E5%BB%BA%E5%B8%B8%E7%94%A8%E4%B8%89%E7%A7%8D%E7%BA%BF%E7%A8%8B%E6%B1%A0%E7%9A%84%E6%96%B9%E5%BC%8F"><span>åˆ›å»ºå¸¸ç”¨ä¸‰ç§çº¿ç¨‹æ± çš„æ–¹å¼</span></a></li><li><a class="is-flex is-mobile" href="#%E5%B8%B8%E7%94%A8%E5%8F%82%E6%95%B0-(%E9%87%8D%E7%82%B9)"><span>å¸¸ç”¨å‚æ•° (é‡ç‚¹)</span></a></li><li><a class="is-flex is-mobile" href="#%E6%8B%92%E7%BB%9D%E7%AD%96%E7%95%A5(%E9%87%8D%E7%82%B9)"><span>æ‹’ç»ç­–ç•¥(é‡ç‚¹)</span></a></li><li><a class="is-flex is-mobile" href="#newworkstealingpool"><span>newWorkStealingPool</span></a></li><li><a class="is-flex is-mobile" href="#%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86"><span>åº•å±‚åŸç†</span></a></li><li><a class="is-flex is-mobile" href="#%E6%B3%A8%E6%84%8F%E4%BA%8B%E9%A1%B9(%E9%87%8D%E8%A6%81)"><span>æ³¨æ„äº‹é¡¹(é‡è¦)</span></a></li><li><a class="is-flex is-mobile" href="#%E7%BA%BF%E7%A8%8B%E6%B1%A0%E6%B5%81%E7%A8%8B"><span>çº¿ç¨‹æ± æµç¨‹</span></a></li><li><a class="is-flex is-mobile" href="#%E7%BA%BF%E7%A8%8B%E6%B1%A0%E4%B8%BA%E4%BB%80%E4%B9%88%E9%9C%80%E8%A6%81%E4%BD%BF%E7%94%A8%EF%BC%88%E9%98%BB%E5%A1%9E%EF%BC%89%E9%98%9F%E5%88%97%EF%BC%9F"><span>çº¿ç¨‹æ± ä¸ºä»€ä¹ˆéœ€è¦ä½¿ç”¨ï¼ˆé˜»å¡ï¼‰é˜Ÿåˆ—ï¼Ÿ</span></a></li><li><a class="is-flex is-mobile" href="#%E5%A6%82%E4%BD%95%E9%85%8D%E7%BD%AE%E7%BA%BF%E7%A8%8B%E6%B1%A0"><span>å¦‚ä½•é…ç½®çº¿ç¨‹æ± </span></a></li><li><a class="is-flex is-mobile" href="#execute()%E5%92%8Csubmit()%E6%96%B9%E6%B3%95"><span>execute()å’Œsubmit()æ–¹æ³•</span></a></li></ul></li><li><a class="is-flex is-mobile" href="#fork%2Fjoin"><span>Fork/Join</span></a><ul class="menu-list"><li><a class="is-flex is-mobile" href="#fork%2Fjoin%E6%A1%86%E6%9E%B6%E7%AE%80%E4%BB%8B"><span>Fork/Joinæ¡†æ¶ç®€ä»‹</span></a></li><li><a class="is-flex is-mobile" href="#fork%2Fjoin%E6%A1%86%E6%9E%B6%E7%9A%84%E5%AE%9E%E7%8E%B0%E5%8E%9F%E7%90%86"><span>Fork/Joinæ¡†æ¶çš„å®ç°åŸç†</span></a></li><li><a class="is-flex is-mobile" href="#fork%E6%96%B9%E6%B3%95"><span>Forkæ–¹æ³•</span></a></li><li><a class="is-flex is-mobile" href="#join%E6%96%B9%E6%B3%95"><span>joinæ–¹æ³•</span></a></li><li><a class="is-flex is-mobile" href="#fork%2Fjoin%E6%A1%86%E6%9E%B6%E7%9A%84%E5%BC%82%E5%B8%B8%E5%A4%84%E7%90%86"><span>Fork/Joinæ¡†æ¶çš„å¼‚å¸¸å¤„ç†</span></a></li><li><a class="is-flex is-mobile" href="#%E5%85%A5%E9%97%A8%E6%A1%88%E4%BE%8B"><span>å…¥é—¨æ¡ˆä¾‹</span></a></li></ul></li><li><a class="is-flex is-mobile" href="#completablefuture"><span>CompletableFuture</span></a><ul class="menu-list"><li><a class="is-flex is-mobile" href="#future%E4%B8%8Ecompletablefuture"><span>Futureä¸CompletableFuture</span></a></li><li><a class="is-flex is-mobile" href="#%E7%BB%93%E6%9E%9C%E5%90%88%E5%B9%B6"><span>ç»“æœåˆå¹¶</span></a></li></ul></li></ul></li><li><a class="is-flex is-mobile" href="#%E5%8F%8D%E5%B0%84"><span>åå°„</span></a><ul class="menu-list"><li><a class="is-flex is-mobile" href="#%E8%8E%B7%E5%8F%96%E7%B1%BB%E7%9A%84%E5%AD%97%E8%8A%82%E7%A0%81"><span>è·å–ç±»çš„å­—èŠ‚ç </span></a></li></ul></li><li><a class="is-flex is-mobile" href="#io"><span>IO</span></a><ul class="menu-list"><li><a class="is-flex is-mobile" href="#%E7%A3%81%E7%9B%98%E6%93%8D%E4%BD%9C"><span>ç£ç›˜æ“ä½œ</span></a><ul class="menu-list"><li><a class="is-flex is-mobile" href="#file%E5%AF%B9%E8%B1%A1"><span>Fileå¯¹è±¡</span></a></li></ul></li><li><a class="is-flex is-mobile" href="#%E5%AD%97%E8%8A%82%E6%93%8D%E4%BD%9C"><span>å­—èŠ‚æ“ä½œ</span></a><ul class="menu-list"><li><a class="is-flex is-mobile" href="#inputstream"><span>InputStream</span></a></li><li><a class="is-flex is-mobile" href="#outputstream"><span>OutputStream</span></a></li></ul></li><li><a class="is-flex is-mobile" href="#%E5%AD%97%E7%AC%A6%E6%93%8D%E4%BD%9C"><span>å­—ç¬¦æ“ä½œ</span></a></li><li><a class="is-flex is-mobile" href="#%E5%AF%B9%E8%B1%A1%E6%93%8D%E4%BD%9C"><span>å¯¹è±¡æ“ä½œ</span></a></li><li><a class="is-flex is-mobile" href="#%E7%BD%91%E7%BB%9C%E6%93%8D%E4%BD%9C"><span>ç½‘ç»œæ“ä½œ</span></a></li><li><a class="is-flex is-mobile" href="#nio"><span>NIO</span></a><ul class="menu-list"><li><a class="is-flex is-mobile" href="#%E6%B5%81%E4%B8%8E%E5%9D%97"><span>æµä¸å—</span></a></li><li><a class="is-flex is-mobile" href="#%E5%86%85%E5%AD%98%E6%98%A0%E5%B0%84%E6%96%87%E4%BB%B6i%2Fo"><span>å†…å­˜æ˜ å°„æ–‡ä»¶I/O</span></a></li><li><a class="is-flex is-mobile" href="#nio%E7%BC%96%E7%A8%8B%E6%AD%A5%E9%AA%A4%E6%80%BB%E7%BB%93"><span>NIOç¼–ç¨‹æ­¥éª¤æ€»ç»“</span></a></li><li><a class="is-flex is-mobile" href="#4%E3%80%81%E4%BB%A3%E7%A0%81%E7%A4%BA%E4%BE%8B"><span>4ã€ä»£ç ç¤ºä¾‹</span></a></li><li><a class="is-flex is-mobile" href="#7%E3%80%81%E5%AE%8C%E6%95%B4%E4%BE%8B%E5%AD%90"><span>7ã€å®Œæ•´ä¾‹å­</span></a></li><li><a class="is-flex is-mobile" href="#4%E3%80%81%E5%88%9B%E5%BB%BA%E7%9B%B8%E5%AF%B9%E8%B7%AF%E5%BE%84"><span>4ã€åˆ›å»ºç›¸å¯¹è·¯å¾„</span></a></li><li><a class="is-flex is-mobile" href="#5.files.walkfiletree()"><span>5.Files.walkFileTree()</span></a></li><li><a class="is-flex is-mobile" href="#5%E3%80%81%E9%80%9A%E8%BF%87completionhandler%E5%86%99%E6%95%B0%E6%8D%AE"><span>5ã€é€šè¿‡CompletionHandlerå†™æ•°æ®</span></a></li><li><a class="is-flex is-mobile" href="#charset%E5%B8%B8%E7%94%A8%E6%99%AE%E9%80%9A%E6%96%B9%E6%B3%95"><span>Charsetå¸¸ç”¨æ™®é€šæ–¹æ³•</span></a></li><li><a class="is-flex is-mobile" href="#%E5%AE%A2%E6%88%B7%E7%AB%AF%E4%BB%A3%E7%A0%81"><span>å®¢æˆ·ç«¯ä»£ç </span></a></li></ul></li><li><a class="is-flex is-mobile" href="#others"><span>others</span></a><ul class="menu-list"><li><a class="is-flex is-mobile" href="#filter%E6%A8%A1%E5%BC%8F"><span>Filteræ¨¡å¼</span></a></li><li><a class="is-flex is-mobile" href="#%E6%93%8D%E4%BD%9Czip"><span>æ“ä½œZip</span></a></li><li><a class="is-flex is-mobile" href="#%E4%BD%BF%E7%94%A8files"><span>ä½¿ç”¨Files</span></a></li><li><a class="is-flex is-mobile" href="#%E5%86%85%E5%AD%98%E6%98%A0%E5%B0%84%E6%96%87%E4%BB%B6"><span>å†…å­˜æ˜ å°„æ–‡ä»¶</span></a></li><li><a class="is-flex is-mobile" href="#office"><span>OFFICE</span></a></li><li><a class="is-flex is-mobile" href="#pic"><span>PIC</span></a></li><li><a class="is-flex is-mobile" href="#csv"><span>CSV</span></a></li><li><a class="is-flex is-mobile" href="#html"><span>HTML</span></a></li><li><a class="is-flex is-mobile" href="#%E5%8E%8B%E7%BC%A9%E6%96%87%E4%BB%B6"><span>å‹ç¼©æ–‡ä»¶</span></a></li></ul></li></ul></li><li><a class="is-flex is-mobile" href="#net"><span>NET</span></a><ul class="menu-list"><li><a class="is-flex is-mobile" href="#osi%E4%B8%83%E5%B1%82%E6%A8%A1%E5%9E%8B"><span>OSIä¸ƒå±‚æ¨¡å‹</span></a></li><li><a class="is-flex is-mobile" href="#tcp%2Fip%E4%BA%94%E5%B1%82%E6%A8%A1%E5%9E%8B"><span>TCP/IPäº”å±‚æ¨¡å‹</span></a></li><li><a class="is-flex is-mobile" href="#%E4%B8%89%E6%AC%A1%E6%8F%A1%E6%89%8B%E3%80%81%E5%9B%9B%E6%AC%A1%E6%8C%A5%E6%89%8B"><span>ä¸‰æ¬¡æ¡æ‰‹ã€å››æ¬¡æŒ¥æ‰‹</span></a></li><li><a class="is-flex is-mobile" href="#ip"><span>IP</span></a></li><li><a class="is-flex is-mobile" href="#%E5%9F%9F%E5%90%8D"><span>åŸŸå</span></a></li><li><a class="is-flex is-mobile" href="#%E7%AB%AF%E5%8F%A3"><span>ç«¯å£</span></a></li><li><a class="is-flex is-mobile" href="#%E9%80%9A%E4%BF%A1%E5%8D%8F%E8%AE%AE"><span>é€šä¿¡åè®®</span></a></li><li><a class="is-flex is-mobile" href="#%E4%B8%80%E6%AC%A1%E8%AF%B7%E6%B1%82%E7%9A%84%E8%BF%87%E7%A8%8B"><span>ä¸€æ¬¡è¯·æ±‚çš„è¿‡ç¨‹</span></a></li></ul></li><li><a class="is-flex is-mobile" href="#%E6%8F%90%E9%AB%98cpu%EF%BC%8C%E9%98%B2%E6%AD%A2%E6%9C%8D%E5%8A%A1%E5%99%A8%E9%99%8D%E9%85%8D"><span>æé«˜CPUï¼Œé˜²æ­¢æœåŠ¡å™¨é™é…</span></a></li><li><a class="is-flex is-mobile" href="#%E5%85%B6%E4%BB%96%E5%9F%BA%E7%A1%80"><span>å…¶ä»–åŸºç¡€</span></a><ul class="menu-list"><li><a class="is-flex is-mobile" href="#%5Bjvm%E4%B8%8E%E4%B8%8A%E5%B1%82%E6%8A%80%E6%9C%AF%5D(jvm-%E4%B8%8E%E4%B8%8A%E5%B1%82%E6%8A%80%E6%9C%AF)"><span>[JVMä¸ä¸Šå±‚æŠ€æœ¯](JVM ä¸ä¸Šå±‚æŠ€æœ¯)</span></a></li><li><a class="is-flex is-mobile" href="#hashcode%E4%B8%8E-equals%E4%B8%8E-%3D%3D"><span>hashcodeä¸ equalsä¸ ==</span></a></li><li><a class="is-flex is-mobile" href="#%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1"><span>é¢å‘å¯¹è±¡</span></a></li><li><a class="is-flex is-mobile" href="#final%E3%80%81finally%E3%80%81finalize"><span>finalã€finallyã€finalize</span></a></li><li><a class="is-flex is-mobile" href="#%E5%90%91%E4%B8%8A%2F%E4%B8%8B%E8%BD%AC%E5%9E%8B"><span>å‘ä¸Š/ä¸‹è½¬å‹</span></a></li><li><a class="is-flex is-mobile" href="#%E5%86%85%E9%83%A8%E7%B1%BB%E3%80%81%E5%8C%BF%E5%90%8D%E5%86%85%E9%83%A8%E7%B1%BB"><span>å†…éƒ¨ç±»ã€åŒ¿åå†…éƒ¨ç±»</span></a></li><li><a class="is-flex is-mobile" href="#static"><span>static</span></a></li><li><a class="is-flex is-mobile" href="#cap%E3%80%81base%E7%90%86%E8%AE%BA"><span>CAPã€BASEç†è®º</span></a></li><li><a class="is-flex is-mobile" href="#aqs"><span>AQS</span></a></li><li><a class="is-flex is-mobile" href="#jdk%E6%96%B0%E7%89%88%E6%9C%AC%E7%89%B9%E5%BE%81"><span>JDKæ–°ç‰ˆæœ¬ç‰¹å¾</span></a><ul class="menu-list"><li><a class="is-flex is-mobile" href="#lambda-%E8%A1%A8%E8%BE%BE%E5%BC%8F"><span>Lambda è¡¨è¾¾å¼</span></a></li><li><a class="is-flex is-mobile" href="#%E6%B5%81stream%EF%BC%88%EF%BC%89"><span>æµStreamï¼ˆï¼‰</span></a></li></ul></li><li><a class="is-flex is-mobile" href="#%E5%85%B6%E4%BB%96"><span>å…¶ä»–</span></a></li><li><a class="is-flex is-mobile" href="#%E5%9F%BA%E7%A1%80%E7%B1%BB%E5%BA%93%EF%BC%88%E4%BB%8E%E4%B8%8A%E5%88%B0%E4%B8%8B%E7%AE%80%E5%8C%96%E4%BA%86%E8%A7%A3%EF%BC%89"><span>åŸºç¡€ç±»åº“ï¼ˆä»ä¸Šåˆ°ä¸‹ç®€åŒ–äº†è§£ï¼‰</span></a></li><li><a class="is-flex is-mobile" href="#%E8%AE%BF%E9%97%AE%E6%9D%83%E9%99%90"><span>è®¿é—®æƒé™</span></a></li><li><a class="is-flex is-mobile" href="#%E5%9F%BA%E6%9C%AC%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B"><span>åŸºæœ¬æ•°æ®ç±»å‹</span></a></li><li><a class="is-flex is-mobile" href="#%E8%87%AA%E5%8A%A8%E7%B1%BB%E5%9E%8B%E8%BD%AC%E6%8D%A2"><span>è‡ªåŠ¨ç±»å‹è½¬æ¢</span></a></li><li><a class="is-flex is-mobile" href="#string%E3%80%81stringbuffer%E3%80%81stringbuilder-%E5%8C%BA%E5%88%AB"><span>Stringã€StringBufferã€StringBuilder åŒºåˆ«</span></a></li><li><a class="is-flex is-mobile" href="#jdk%E4%B8%8Ejre%E5%8C%BA%E5%88%AB"><span>JDKä¸JREåŒºåˆ«</span></a><ul class="menu-list"><li><a class="is-flex is-mobile" href="#jdk-1"><span>JDK</span></a></li><li><a class="is-flex is-mobile" href="#jre"><span>JRE</span></a></li></ul></li><li><a class="is-flex is-mobile" href="#%E7%B2%BE%E5%BA%A6%E9%81%97%E5%A4%B1%E9%97%AE%E9%A2%98"><span>ç²¾åº¦é—å¤±é—®é¢˜</span></a><ul class="menu-list"><li><a class="is-flex is-mobile" href="#bigdecimal"><span>BigDecimal</span></a></li><li><a class="is-flex is-mobile" href="#biginteger"><span>BigInteger</span></a></li></ul></li></ul></li></ul></div></div><style>.menu-list > li > a.is-active + .menu-list { display: block; }.menu-list > li > a + .menu-list { display: none; }</style><script src="/js/toc.js" defer></script></div><div class="card widget" data-type="profile"><div class="card-content"><nav class="level"><div class="level-item has-text-centered flex-shrink-1"><div><figure class="image is-128x128 mx-auto mb-2"><img class="avatar is-rounded" src="https://gitee.com/mychimei/picture/raw/master/å¾®ä¿¡å›¾ç‰‡_20210131173244.jpg" alt="é­‘é­…å…ˆç”Ÿ"></figure><p class="title is-size-4 is-block" style="line-height:inherit;">é­‘é­…å…ˆç”Ÿ</p><p class="is-size-6 is-block">å¿«ä¹æ°¸è¿œåœ¨è§£å†³é—®é¢˜çš„é—´éš™é‡Œ(*ï¿£ï¸¶ï¿£)</p><p class="is-size-6 is-flex justify-content-center"><i class="fas fa-map-marker-alt mr-1"></i><span>æµ™æ±Ÿ-æ­å·</span></p></div></div></nav><nav class="level is-mobile"><div class="level-item has-text-centered is-marginless"><div><p class="heading">æ–‡ç« </p><a href="/archives"><p class="title">54</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">åˆ†ç±»</p><a href="/categories"><p class="title">86</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">æ ‡ç­¾</p><a href="/tags"><p class="title">43</p></a></div></div></nav><div class="level"><a class="level-item button is-primary is-rounded" href="https://github.com/MrDemonlxl" target="_blank" rel="noopener">å…³æ³¨æˆ‘</a></div><div class="level is-mobile"><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Github" href="https://github.com/MrDemonlxl"><i class="fab fa-github"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Weibo" href="https://weibo.com/MrDemonlxl"><i class="fab fa-weibo"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Email" href="/714416426@qq.com"><i class="fa fa-envelope"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Next" href="https://mrdemonlxl.github.io"><i class="fab fa-dribbble"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="RSS" href="https://mp.weixin.qq.com/mp/profile_ext?action=home&amp;__biz=MzI5NDc0MDg1Mg==#wechat_redirect"><i class="fas fa-rss"></i></a></div><div><hr><p id="hitokoto">:D ä¸€è¨€å¥å­è·å–ä¸­...</p><script type="text/javascript" defer>function getYiyan(){
                                $.getJSON("https://v1.hitokoto.cn/", function (data) {
                                if(data){
                                    $('#hitokoto').html("");
                                    $('#hitokoto').append("<strong style='color: #3273dc;'>"+data.hitokoto+"</strong>"+
                                    "<p>"+"æ¥æºã€Š"+data.from+"ã€‹</p><p>æä¾›è€…-"+data.creator+"</p>");
                                }});}
                                $(function (){getYiyan();$('#hitokoto').click(function(){getYiyan();})});</script></div></div></div><div class="card widget" data-type="links"><div class="card-content"><div class="menu"><h3 class="menu-label">é“¾æ¥</h3><ul class="menu-list"><li><a class="level is-mobile" href="https://www.jianshu.com/u/4af2d33dbe6f" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">ç®€ä¹¦</span></span><span class="level-right"><span class="level-item tag">www.jianshu.com</span></span></a></li><li><a class="level is-mobile" href="https://blog.csdn.net/qq_37862970" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">CSDN</span></span><span class="level-right"><span class="level-item tag">blog.csdn.net</span></span></a></li><li><a class="level is-mobile" href="https://github.com/MrDemonlxl" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">GitHub</span></span><span class="level-right"><span class="level-item tag">github.com</span></span></a></li></ul></div></div></div><div class="card widget"><div class="card-content"><h3 class="menu-label">æœ€æ–°è¯„è®º</h3><span class="body_hot_comment">åŠ è½½ä¸­ï¼Œæœ€æ–°è¯„è®ºæœ‰1åˆ†é’Ÿç¼“å­˜...</span></div></div><div class="card widget"><div class="card-content"><h3 class="menu-label">æœ€æ–°æ–‡ç« </h3><article class="media"><figure class="media-left"><a class="image" href="/2022/03/24/Draft/2021/MyBatis/"><img src="https://gitee.com/mychimei/picture/raw/master/webp.png" alt="MyBatis"></a></figure><div class="media-content"><p class="date"><time dateTime="2022-03-24T12:52:34.928Z">2022-03-24</time></p><p class="title"><a href="/2022/03/24/Draft/2021/MyBatis/">MyBatis</a></p><p class="categories"><a href="/categories/Frame/">Frame</a> / <a href="/categories/Frame/MyBatis/">MyBatis</a></p></div></article><article class="media"><figure class="media-left"><a class="image" href="/2021/12/13/Draft/2021/CRUD/"><img src="https://gitee.com/mychimei/picture/raw/master/wallhaven-j8d3rm.png" alt="é­‘é­…å…ˆç”Ÿ | CRUD"></a></figure><div class="media-content"><p class="date"><time dateTime="2021-12-13T14:10:43.000Z">2021-12-13</time></p><p class="title"><a href="/2021/12/13/Draft/2021/CRUD/">é­‘é­…å…ˆç”Ÿ | CRUD</a></p><p class="categories"><a href="/categories/%E7%A8%8B%E5%BA%8F%E5%9F%BA%E7%A1%80/">ç¨‹åºåŸºç¡€</a> / <a href="/categories/%E7%A8%8B%E5%BA%8F%E5%9F%BA%E7%A1%80/CRUD/">CRUD</a></p></div></article><article class="media"><figure class="media-left"><a class="image" href="/2021/11/10/Draft/2021/JVM%20%E4%B8%8E%E4%B8%8A%E5%B1%82%E6%8A%80%E6%9C%AF/"><img src="https://gitee.com/mychimei/picture/raw/master/39go6v.jpg" alt="JVM ä¸ä¸Šå±‚æŠ€æœ¯"></a></figure><div class="media-content"><p class="date"><time dateTime="2021-11-10T14:10:43.000Z">2021-11-10</time></p><p class="title"><a href="/2021/11/10/Draft/2021/JVM%20%E4%B8%8E%E4%B8%8A%E5%B1%82%E6%8A%80%E6%9C%AF/">JVM ä¸ä¸Šå±‚æŠ€æœ¯</a></p><p class="categories"><a href="/categories/%E5%BA%95%E5%B1%82%E5%AD%A6%E4%B9%A0/">åº•å±‚å­¦ä¹ </a> / <a href="/categories/%E5%BA%95%E5%B1%82%E5%AD%A6%E4%B9%A0/JVM-%E4%B8%8E%E4%B8%8A%E5%B1%82%E6%8A%80%E6%9C%AF/">JVM ä¸ä¸Šå±‚æŠ€æœ¯</a></p></div></article><article class="media"><figure class="media-left"><a class="image" href="/2021/10/20/Draft/2021/MyBatis-Plus/"><img src="https://gitee.com/mychimei/picture/raw/master/webp.png" alt="MyBatis-Plus"></a></figure><div class="media-content"><p class="date"><time dateTime="2021-10-20T14:10:43.000Z">2021-10-20</time></p><p class="title"><a href="/2021/10/20/Draft/2021/MyBatis-Plus/">MyBatis-Plus</a></p><p class="categories"><a href="/categories/Frame/">Frame</a> / <a href="/categories/Frame/MyBatis-Plus/">MyBatis-Plus</a></p></div></article><article class="media"><figure class="media-left"><a class="image" href="/2021/07/20/Draft/2021/%E9%97%AA%E5%85%89/"><img src="https://gitee.com/mychimei/picture/raw/master/webp.png" alt="æ€ç»´é—ªå…‰"></a></figure><div class="media-content"><p class="date"><time dateTime="2021-07-20T14:10:43.000Z">2021-07-20</time></p><p class="title"><a href="/2021/07/20/Draft/2021/%E9%97%AA%E5%85%89/">æ€ç»´é—ªå…‰</a></p><p class="categories"><a href="/categories/%E4%B8%B4%E6%97%B6%E8%AE%B0%E5%BD%95/">ä¸´æ—¶è®°å½•</a> / <a href="/categories/%E4%B8%B4%E6%97%B6%E8%AE%B0%E5%BD%95/%E6%80%9D%E7%BB%B4%E9%97%AA%E5%85%89/">æ€ç»´é—ªå…‰</a></p></div></article></div></div><div class="card widget"><div class="card-content"><div class="menu"><h3 class="menu-label">åˆ†ç±»</h3><ul class="menu-list"><li><a class="level is-mobile is-marginless" href="/categories/BUG%E8%AE%B0%E5%BD%95/"><span class="level-start"><span class="level-item">BUGè®°å½•</span></span><span class="level-end"><span class="level-item tag">2</span></span></a><ul class="mr-0"><li><a class="level is-mobile is-marginless" href="/categories/BUG%E8%AE%B0%E5%BD%95/BUG/"><span class="level-start"><span class="level-item">BUG</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li></ul></li><li><a class="level is-mobile is-marginless" href="/categories/English/"><span class="level-start"><span class="level-item">English</span></span><span class="level-end"><span class="level-item tag">1</span></span></a><ul class="mr-0"><li><a class="level is-mobile is-marginless" href="/categories/English/%E7%A8%8B%E5%BA%8F%E5%91%98%E8%8B%B1%E8%AF%AD/"><span class="level-start"><span class="level-item">ç¨‹åºå‘˜è‹±è¯­</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li></ul></li><li><a class="level is-mobile is-marginless" href="/categories/Frame/"><span class="level-start"><span class="level-item">Frame</span></span><span class="level-end"><span class="level-item tag">6</span></span></a><ul class="mr-0"><li><a class="level is-mobile is-marginless" href="/categories/Frame/MyBatis/"><span class="level-start"><span class="level-item">MyBatis</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile is-marginless" href="/categories/Frame/MyBatis-Plus/"><span class="level-start"><span class="level-item">MyBatis-Plus</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile is-marginless" href="/categories/Frame/Spring/"><span class="level-start"><span class="level-item">Spring</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile is-marginless" href="/categories/Frame/SpringBoot/"><span class="level-start"><span class="level-item">SpringBoot</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile is-marginless" href="/categories/Frame/SpringCloud/"><span class="level-start"><span class="level-item">SpringCloud</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li></ul></li><a class="level is-mobile is-marginless" href="/categories/"><span class="level-start"><span class="level-item">æŸ¥çœ‹å…¨éƒ¨&gt;&gt;</span></span></a></ul></div></div></div><div class="card widget"><div class="card-content"><div class="menu"><h3 class="menu-label">å½’æ¡£</h3><ul class="menu-list"><li><a class="level is-mobile is-marginless" href="/archives/2022/03/"><span class="level-start"><span class="level-item">ä¸‰æœˆ 2022</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2021/12/"><span class="level-start"><span class="level-item">åäºŒæœˆ 2021</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2021/11/"><span class="level-start"><span class="level-item">åä¸€æœˆ 2021</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2021/10/"><span class="level-start"><span class="level-item">åæœˆ 2021</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2021/07/"><span class="level-start"><span class="level-item">ä¸ƒæœˆ 2021</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><a class="level is-mobile is-marginless" href="/archives/"><span class="level-start"><span class="level-item">æŸ¥çœ‹å…¨éƒ¨&gt;&gt;</span></span></a></ul></div></div></div><div class="card widget"><div class="card-content"><div class="menu"><h3 class="menu-label">æ ‡ç­¾</h3><div class="field is-grouped is-grouped-multiline"><div class="control"><a class="tags has-addons" href="/tags/%E5%B7%A5%E5%85%B7%E6%95%99%E7%A8%8B/"><span class="tag">å·¥å…·æ•™ç¨‹</span><span class="tag is-grey-lightest">6</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Frame/"><span class="tag">Frame</span><span class="tag is-grey-lightest">5</span></a></div><div class="control"><a class="tags has-addons" href="/tags/BUG/"><span class="tag">BUG</span><span class="tag is-grey-lightest">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E5%89%8D%E7%AB%AF/"><span class="tag">å‰ç«¯</span><span class="tag is-grey-lightest">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/CRUD/"><span class="tag">CRUD</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Dubbo/"><span class="tag">Dubbo</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/English/"><span class="tag">English</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Interesting-Programs/"><span class="tag">Interesting Programs</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Life/"><span class="tag">Life</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/MongoDB/"><span class="tag">MongoDB</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/NO-GAME-NO-LIFE/"><span class="tag">NO GAME NO LIFE</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Nginx/"><span class="tag">Nginx</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Python%E5%AD%A6%E4%B9%A0/"><span class="tag">Pythonå­¦ä¹ </span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/RabbitMQ/"><span class="tag">RabbitMQ</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Redis/"><span class="tag">Redis</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Software-Engineer/"><span class="tag">Software Engineer</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/SpringCloud/"><span class="tag">SpringCloud</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E4%B8%B4%E6%97%B6%E8%AE%B0%E5%BD%95/"><span class="tag">ä¸´æ—¶è®°å½•</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E4%B9%A6%E5%BD%B1%E9%9F%B3/"><span class="tag">ä¹¦å½±éŸ³</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E4%BF%A1%E6%81%AF%E7%B3%BB%E7%BB%9F%E9%A1%B9%E7%9B%AE%E7%AE%A1%E7%90%86%E5%B8%88/"><span class="tag">ä¿¡æ¯ç³»ç»Ÿé¡¹ç›®ç®¡ç†å¸ˆ</span><span class="tag is-grey-lightest">1</span></a></div></div><div class="field is-grouped is-grouped-multiline"><a class="tags has-addons" href="/tags/"><span class="tag">æŸ¥çœ‹å…¨éƒ¨&gt;&gt;</span></a></div></div></div></div><div class="card widget" data-type="subscribe-email"><div class="card-content"><div class="menu"><h3 class="menu-label">è®¢é˜…æ›´æ–°</h3><form action="https://feedburner.google.com/fb/a/mailverify" method="post" target="popupwindow" onsubmit="window.open(&#039;https://feedburner.google.com/fb/a/mailverify?uri=mrdemonlxlFeedsId&#039;,&#039;popupwindow&#039;,&#039;scrollbars=yes,width=550,height=520&#039;);return true"><input type="hidden" value="mrdemonlxlFeedsId" name="uri"><input type="hidden" name="loc" value="en_US"><div class="field has-addons"><div class="control has-icons-left is-expanded"><input class="input" name="email" type="email" placeholder="Email"><span class="icon is-small is-left"><i class="fas fa-envelope"></i></span></div><div class="control"><input class="button" type="submit" value="è®¢é˜…"></div></div></form></div></div></div><!--!--><div class="column-right-shadow is-hidden-widescreen"></div></div></div></div></section><footer class="footer"><div class="container"><div class="level"><div class="level-start"><a class="footer-logo is-block mb-2" href="/"><img src="https://gitee.com/mychimei/picture/raw/master/å½©è‰²logo.png" alt="é­‘é­…å…ˆç”Ÿ" height="28"></a><p class="size-small"><span>&copy; 2022 é­‘é­…å…ˆç”Ÿ</span>Â Â Powered by <a href="https://hexo.io/" target="_blank">Hexo</a> &amp; <a href="https://github.com/ppoffice/hexo-theme-icarus" target="_blank">Icarus</a> &amp; <a href="https://github.com/removeif/hexo-theme-amazing" target="_blank">Amazing</a>Â <br><span>Â© <a href="http://www.beian.miit.gov.cn/" target="_blank">å·ICPå¤‡88888888å·-8</a><br></span><span>Â© ç‰ˆæƒè¯´æ˜ï¼š[æœ¬ç½‘ç«™æ‰€æœ‰å†…å®¹å‡æ”¶é›†äºäº’è”ç½‘æˆ–è‡ªå·±åˆ›ä½œ,<br />&nbsp;&nbsp;&nbsp;&nbsp;æ–¹ä¾¿äºç½‘å‹ä¸è‡ªå·±å­¦ä¹ äº¤æµï¼Œå¦‚æœ‰ä¾µæƒï¼Œè¯·<a href="/message" target="_blank">ç•™è¨€</a>ï¼Œç«‹å³å¤„ç†]<br /></span><span><span id="statistic-times">loading...</span><script>function createTime(time) {
            var n = new Date(time);
            now.setTime(now.getTime() + 250),
                days = (now - n) / 1e3 / 60 / 60 / 24,
                dnum = Math.floor(days),
                hours = (now - n) / 1e3 / 60 / 60 - 24 * dnum,
                hnum = Math.floor(hours),
            1 == String(hnum).length && (hnum = "0" + hnum),
                minutes = (now - n) / 1e3 / 60 - 1440 * dnum - 60 * hnum,
                mnum = Math.floor(minutes),
            1 == String(mnum).length && (mnum = "0" + mnum),
                seconds = (now - n) / 1e3 - 86400 * dnum - 3600 * hnum - 60 * mnum,
                snum = Math.round(seconds),
            1 == String(snum).length && (snum = "0" + snum),
                document.getElementById("statistic-times").innerHTML = "â¤ï¸æœ¬ç«™è‡ª <strong>"+time.split(" ")[0].replace(/\//g,".")+"</strong> å·²è¿è¡Œ <strong>" + dnum + "</strong> å¤© <strong>" + hnum + "</strong> å°æ—¶ <strong>" + mnum + "</strong> åˆ† <strong>" + snum + "</strong> ç§’ï¼â¤ï¸";
        }var now = new Date();setInterval("createTime('2021/02/18 00:00:00')", 250,"");</script><br></span><div class="size-small"><span>â¤ï¸æ„Ÿè°¢ <strong><span id="busuanzi_value_site_uv">99+</span></strong> å°ä¼™ä¼´çš„ <strong><span id="busuanzi_value_site_pv">99+</span></strong> æ¬¡å…‰ä¸´ï¼â¤ï¸</span></div></p></div><div class="level-end"><div class="field has-addons"><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Creative Commons" href="https://creativecommons.org/"><i class="fab fa-creative-commons"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Attribution 4.0 International" href="https://creativecommons.org/licenses/by/4.0/"><i class="fab fa-creative-commons-by"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Download on GitHub" href="https://github.com/removeif/hexo-theme-amazing"><i class="fab fa-github"></i></a></p></div><div class="sideMusic"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.css"><script src="/js/APlayer.min.js"></script><script src="https://cdn.jsdelivr.net/npm/meting@2/dist/Meting.min.js"></script><meting-js style="width: auto;height: 2000px;" server="netease" type="playlist" id="3071252637" theme="#2980b9" loop="all" autoplay="false" order="list" storageName="aplayer-setting" lrctype="0" list-max-height="400px" fixed="true"></meting-js></div></div></div></div></footer><script src="https://cdnjs.loli.net/ajax/libs/moment.js/2.22.2/moment-with-locales.min.js"></script><script src="https://cdnjs.loli.net/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" async></script><script>moment.locale("zh-CN");</script><script>var IcarusThemeSettings = {
            article: {
                highlight: {
                    clipboard: true,
                    fold: 'unfolded'
                }
            }
        };</script><script src="/js/column.js"></script><script src="/js/animation.js"></script><a id="back-to-top" title="å›åˆ°é¡¶ç«¯" href="javascript:;"><i class="fas fa-chevron-up"></i></a><script src="/js/back_to_top.js" defer></script><!--!--><!--!--><!--!--><script src="https://cdnjs.loli.net/ajax/libs/lightgallery/1.6.8/js/lightgallery.min.js" defer></script><script src="https://cdnjs.loli.net/ajax/libs/justifiedGallery/3.7.0/js/jquery.justifiedGallery.min.js" defer></script><script>window.addEventListener("load", () => {
            if (typeof $.fn.lightGallery === 'function') {
                $('.article').lightGallery({ selector: '.gallery-item' });
            }
            if (typeof $.fn.justifiedGallery === 'function') {
                if ($('.justified-gallery > p > .gallery-item').length) {
                    $('.justified-gallery > p > .gallery-item').unwrap();
                }
                $('.justified-gallery').justifiedGallery();
            }
        });</script><!--!--><!--!--><!--!--><script src="/js/main.js" defer></script><script>$.getScript('/js/comment-issue-data.js',function(){loadIssueData('20ef8321698ab8c0c37b','4faa4daae14b55afd2ed357fba92d1e9c7c3f729','MrDemonlxl','MrDemonlxl.github.io',false);})</script><div class="searchbox"><div class="searchbox-container"><div class="searchbox-header"><div class="searchbox-input-container"><input class="searchbox-input" type="text" placeholder="æƒ³è¦æŸ¥æ‰¾ä»€ä¹ˆ..."></div><a class="searchbox-close" href="javascript:;">Ã—</a></div><div class="searchbox-body"></div></div></div><script src="/js/insight.js" defer></script><script>document.addEventListener('DOMContentLoaded', function () {
            loadInsight({"contentUrl":"/content.json"}, {"hint":"æƒ³è¦æŸ¥æ‰¾ä»€ä¹ˆ...","untitled":"(æ— æ ‡é¢˜)","posts":"æ–‡ç« ","pages":"é¡µé¢","categories":"åˆ†ç±»","tags":"æ ‡ç­¾"});
        });</script><script src="https://cdn.jsdelivr.net/npm/pjax@0.2.8/pjax.js"></script><script type="text/javascript">var pjax = new Pjax({
            elements: "a",//ä»£è¡¨ç‚¹å‡»é“¾æ¥å°±æ›´æ–°
            selectors: [  //ä»£è¡¨è¦æ›´æ–°çš„èŠ‚ç‚¹
                ".section",
                "title"
            ],
            cache: true,
            cacheBust:false
        })

        function loadBusuanzi(){
        $.getScript("//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js", function () {});
        }

        function loadMathJax() { //åŠ è½½mathjax
            $.getScript("//cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.4/MathJax.js?config=TeX-MML-AM_CHTML", function () {
                MathJax.Hub.Config({ tex2jax: { inlineMath: [['$', '$'], ['\(', '\)']] } });
                var math = document.getElementsByClassName("entry-content")[0];
                MathJax.Hub.Queue(["Typeset", MathJax.Hub, math]);
            });
        };

        // å¼€å§‹ PJAX æ‰§è¡Œçš„å‡½æ•°
        document.addEventListener('pjax:send', function () {
        });
        
        // PJAX å®Œæˆä¹‹åæ‰§è¡Œçš„å‡½æ•°ï¼Œå¯ä»¥å’Œä¸Šé¢çš„é‡è½½æ”¾åœ¨ä¸€èµ·
        document.addEventListener('pjax:complete', function () {
            $(".section").css({opacity:1});
            if(true){
                $.getScript('/js/comment-issue-data.js',function(){loadIssueData('20ef8321698ab8c0c37b','4faa4daae14b55afd2ed357fba92d1e9c7c3f729','MrDemonlxl','MrDemonlxl.github.io',false);});
            }
            if(false){
                loadMathJax();
            }
            loadMainJs(jQuery, window.moment, window.ClipboardJS, window.IcarusThemeSettings);
            loadBackTop();
            loadBusuanzi();
            if(typeof loadBanner == 'function'){
                loadBanner();
            }
        });</script></body></html>