<!doctype html>
<html lang="zh"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta><title>分类: 程序基础 - 魑魅先生</title><link rel="manifest" href="/manifest.json"><meta name="application-name" content="魑魅先生"><meta name="msapplication-TileImage" content="https://gitee.com/mychimei/picture/raw/master/透明头像.png"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-title" content="魑魅先生"><meta name="apple-mobile-web-app-status-bar-style" content="default"><meta description="Java全栈开发，摄影，音乐，等技术分享交流"><meta property="og:type" content="blog"><meta property="og:title" content="魑魅先生"><meta property="og:url" content="https://mrdemonlxl.github.io/"><meta property="og:site_name" content="魑魅先生"><meta property="og:description" content="Java全栈开发，摄影，音乐，等技术分享交流"><meta property="og:locale" content="zh_CN"><meta property="og:image" content="https://gitee.com/mychimei/picture/raw/master/微信图片_20210131173244.jpg"><meta property="article:author" content="mrdemonlxl"><meta property="article:tag" content="魑魅先生,Java,全栈开发"><meta property="twitter:card" content="summary"><meta property="twitter:image" content="https://gitee.com/mychimei/picture/raw/master/微信图片_20210131173244.jpg"><script type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"http://MrDemonlxl.github.io"},"headline":"魑魅先生","image":["http://mrdemonlxl.github.io/img/og_image.png"],"author":{"@type":"Person","name":"魑魅先生"},"description":"Java全栈开发，摄影，音乐，等技术分享交流"}</script><link rel="icon" href="https://gitee.com/mychimei/picture/raw/master/透明头像.png"><meta name="referrer" content="no-referrer-when-downgrade"><link rel="stylesheet" href="https://cdnjs.loli.net/ajax/libs/font-awesome/5.12.0/css/all.min.css"><link rel="stylesheet" href="https://cdnjs.loli.net/ajax/libs/highlight.js/9.12.0/styles/atom-one-light.min.css"><link rel="stylesheet" href="https://fonts.loli.net/css2?family=Ubuntu:wght@400;600&amp;family=Source+Code+Pro"><link rel="stylesheet" href="/css/default.css"><link rel="stylesheet" href="https://cdnjs.loli.net/ajax/libs/font-awesome/5.12.0/css/all.min.css"><link rel="stylesheet" href="https://fonts.loli.net/css?family=Ubuntu:400,600|Source+Code+Pro|Monda:300,300italic,400,400italic,700,700italic|Roboto Slab:300,300italic,400,400italic,700,700italic|Microsoft YaHei:300,300italic,400,400italic,700,700italic|PT Mono:300,300italic,400,400italic,700,700italic&amp;amp;subset=latin,latin-ext|Inconsolata|Itim|Lobster.css"><script src="https://cdnjs.loli.net/ajax/libs/jquery/3.3.1/jquery.min.js"></script><script src="/js/globalUtils.js"></script><style>body>.footer,body>.navbar,body>.section{opacity:0}</style><!--!--><!--!--><script src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" defer></script><!--!--><link rel="stylesheet" href="https://cdnjs.loli.net/ajax/libs/lightgallery/1.6.8/css/lightgallery.min.css"><link rel="stylesheet" href="https://cdnjs.loli.net/ajax/libs/justifiedGallery/3.7.0/css/justifiedGallery.min.css"><!--!--><!--!--><script src="https://cdnjs.loli.net/ajax/libs/pace/1.0.2/pace.min.js"></script><link rel="stylesheet" href="/live2d/waifu.css"><script type="text/javascript" async src="/live2d/autoload.js"></script><meta name="generator" content="Hexo 5.3.0"></head><body class="is-3-column has-navbar-fixed-top"><nav class="navbar navbar-main is-fixed-top"><div class="container"><div class="navbar-brand justify-content-center"><a class="navbar-item navbar-logo" href="/"><img src="https://gitee.com/mychimei/picture/raw/master/彩色logo.png" alt="魑魅先生" height="28"></a></div><div class="navbar-menu"><div class="navbar-start"><a class="navbar-item" href="/">首页</a><a class="navbar-item" href="/archives">归档</a><a class="navbar-item" href="/categories">分类</a><a class="navbar-item" href="/tags">标签</a><a class="navbar-item" href="/album">相册</a><a class="navbar-item" href="/friend">友链</a><a class="navbar-item" href="/message">留言</a><a class="navbar-item" href="/self-talking">碎碎念</a><a class="navbar-item" href="/music">音乐</a><a class="navbar-item" href="/media">影音</a><a class="navbar-item" href="/about">关于</a></div><div class="navbar-end"><a class="navbar-item" target="_blank" rel="noopener" title="Join Gitter" href="https://gitter.im/hexo-theme-amazing/community"><i class="fab fa-gitter"></i></a><a class="navbar-item" target="_blank" rel="noopener" title="Download on GitHub" href="https://github.com/removeif/hexo-theme-amazing"><i class="fab fa-github"></i></a><a class="navbar-item search" title="搜索" href="javascript:;"><i class="fas fa-search"></i></a><a class="navbar-item" id="night-nav" title="Night Mode" href="javascript:;"><i class="fas fa-moon" id="night-icon"></i></a></div></div></div></nav><script type="text/javascript" src="/js/theme-setting.js"></script><section class="section"><div class="container"><div class="columns"><div class="column order-2 column-main is-8-tablet is-8-desktop is-6-widescreen"><div class="card"><div class="card-content"><nav class="breadcrumb" aria-label="breadcrumbs"><ul><li><a href="/categories">分类</a></li><li class="is-active"><a href="#" aria-current="page">程序基础</a></li></ul></nav></div></div><!--!--><div class="card"><div class="card-image"><a class="image is-7by3" href="/2021/03/01/Draft/2021/%E5%89%8D%E7%AB%AF/"><img class="fill" src="https://gitee.com/mychimei/picture/raw/master/wallhaven-j8d3rm.png" alt="魑魅先生 | 前端"></a></div><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><i class="far fa-calendar-plus"> </i>2021-03-01  <a class="commentCountImg" href="/2021/03/01/Draft/2021/%E5%89%8D%E7%AB%AF/#comment-container"><span class="display-none-class">1bec50ac0cdd4414c564bea03b237490</span><i class="far fa-comment-dots"></i> <span class="commentCount" id="1bec50ac0cdd4414c564bea03b237490">99+</span>  </a><span class="level-item"><i class="far fa-clock"> </i>1 分钟  <i class="fas fa-pencil-alt"> </i>0.1 k</span></div><div class="pin-icon"><i class="fas fa-thumbtack"></i></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2021/03/01/Draft/2021/%E5%89%8D%E7%AB%AF/">魑魅先生 | 前端</a></h1><div class="content"><blockquote>
<p>VUE、HTML、JS、、、、</p>
</blockquote></div><div class="index-category-tag"><div class="level-item"><i class="fas fa-folder-open has-text-grey"> </i><a class="article-more button is-small link-muted index-categories" href="/categories/%E7%A8%8B%E5%BA%8F%E5%9F%BA%E7%A1%80/">程序基础</a><span> </span><a class="article-more button is-small link-muted index-categories" href="/categories/%E7%A8%8B%E5%BA%8F%E5%9F%BA%E7%A1%80/%E5%89%8D%E7%AB%AF/">前端</a></div>  <div class="level-item"><i class="fas fa-tags has-text-grey"> </i><a class="article-more button is-small link-muted index-tags" href="/tags/%E5%89%8D%E7%AB%AF/">前端</a></div><hr></div><div class="level is-mobile is-flex"><div class="level-start"><div class="level-item"><a class="article-more button is-small size-small" href="/2021/03/01/Draft/2021/%E5%89%8D%E7%AB%AF/#more">阅读更多&gt;&gt;</a></div></div><div class="level-start"><div class="level-item has-text-grey is-size-7"><time datetime="2021-11-16T10:50:39.000Z"><i class="far fa-calendar-check"> 最后修改: </i>2021-11-16</time></div></div></div></article></div><div class="card"><div class="card-image"><a class="image is-7by3" href="/2021/03/01/Draft/2021/Redis/"><img class="fill" src="https://gitee.com/mychimei/picture/raw/master/wallhaven-73loee.jpg" alt="魑魅先生 | Redis"></a></div><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><i class="far fa-calendar-plus"> </i>2021-03-01  <a class="commentCountImg" href="/2021/03/01/Draft/2021/Redis/#comment-container"><span class="display-none-class">b262d5d9334ad80800a2ca8a59b82a7f</span><i class="far fa-comment-dots"></i> <span class="commentCount" id="b262d5d9334ad80800a2ca8a59b82a7f">99+</span>  </a><span class="level-item"><i class="far fa-clock"> </i>2 小时  <i class="fas fa-pencil-alt"> </i>21.0 k</span></div><div class="pin-icon"><i class="fas fa-thumbtack"></i></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2021/03/01/Draft/2021/Redis/">魑魅先生 | Redis</a></h1><div class="content"><a id="more"></a>
<h1 id="%E5%B7%A5%E5%85%B7">工具</h1>
<p><a target="_blank" rel="noopener" href="http://www.redis.cn/commands.html">命令查询</a></p>
<h1 id="%E5%B8%B8%E7%94%A8">常用</h1>
<table>
<thead>
<tr>
<th>数据类型</th>
<th>String</th>
<th>Hash</th>
<th>List</th>
<th>Set</th>
<th>ZSet</th>
<th>Geospatial</th>
<th>Hyperloglog</th>
<th>Bitmap</th>
<th></th>
</tr>
</thead>
<tbody>
<tr>
<td>特点</td>
<td>字符串，整数或浮点数</td>
<td>包含键（string ）值对的无序散列表</td>
<td>链表上的节点字符串元素</td>
<td>各不相同的字符串元素</td>
<td>带分数的有序集合</td>
<td>地理位置</td>
<td>基数统计<br />不占内存<br />记录网站UV</td>
<td>Bitmap 位图，数据结构！二进制位记录，0 和 1 两个状态</td>
<td></td>
</tr>
<tr>
<td>增</td>
<td>set</td>
<td>hset</td>
<td>lpush，rpush</td>
<td>sadd</td>
<td>zadd</td>
<td>geoadd</td>
<td>pfadd</td>
<td>setbit</td>
<td></td>
</tr>
<tr>
<td>取</td>
<td>get</td>
<td>hget （取单个）</td>
<td>lrange取区间值lpop左取<br />rpop 右取</td>
<td>smembers 取所有</td>
<td>zscore单取 <br />zrange  范围取<br /> zrevrange   升序取<br />zrangebyscore  所有降序取zrevrangebyscore  所有升序取</td>
<td>geopos<br />geodist（两点距离）<br />georadius（点附近点，可数量限制）</td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>删</td>
<td>del</td>
<td>hdel</td>
<td></td>
<td>srem</td>
<td>zrem</td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>取旧改新</td>
<td>getset</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>自增</td>
<td>incr <br />（可指定</td>
<td>HINCRBY增加指定步长</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>自减</td>
<td>decr <br />（可指定</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>追加</td>
<td>append</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>长度</td>
<td>strlen</td>
<td>hlen</td>
<td>llen</td>
<td></td>
<td>zcard</td>
<td></td>
<td>pfcount（不重复数量）</td>
<td>bitcount(计算状态数量)</td>
<td></td>
</tr>
<tr>
<td>批量同时设置一个或多个 key-value 对</td>
<td>mset</td>
<td>hmset</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>返回所有一个或多个给定 key 的值</td>
<td>mget</td>
<td>hmget</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>获取对象中所有的键值对</td>
<td></td>
<td>hgetall （取所有）</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>判断元素是否存在</td>
<td></td>
<td>hexists</td>
<td></td>
<td>sismember</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>获取字段名</td>
<td></td>
<td>hkeys</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>获取字段值</td>
<td></td>
<td>hvals</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>集合运算</td>
<td></td>
<td></td>
<td></td>
<td>sunion 并集，sinter 交集，sdiff 交差</td>
<td></td>
<td></td>
<td>pfmerge(合并)</td>
<td></td>
<td></td>
</tr>
<tr>
<td>应用场景</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
</tbody>
</table>
<h1 id="nosql%E7%94%B1%E6%9D%A5">Nosql由来</h1>
<h3 id="%E5%8D%95%E6%9C%BAmysql" id="单机mysql">单机mysql</h3>
<ul>
<li>
<p>mysql+缓存+垂直拆分</p>
<ul>
<li>
<p>主从读写分离</p>
<ul>
<li>
<p>分表分库+水平拆分+mysql集群</p>
<ul>
<li>现在用户社交网络数据成倍增长，sql难以支撑</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<h3 id="%E7%AE%80%E4%BB%8B" id="简介">简介</h3>
<p>Redis（<strong>Re</strong>mote <strong>Di</strong>ctionary <strong>S</strong>erver）远程字典服务</p>
<ul>
<li>免费<strong>开源</strong>的，C语言编写，提供多种语言使用，支持网络，可持久化，遵守 BSD 协议，是一个高性能的 key-value 数据库。</li>
</ul>
<p>Redis 与其他 key - value 缓存产品有以下三个<strong>特点</strong>：</p>
<p>Redis支持<strong>数据的持久化</strong>，可以将内存中的数据保存在磁盘中，重启的时候可以再次加载进行使用。<br />
Redis不仅仅支持简单的key-value类型的数据，同时还提供list，set，zset，hash等数据结构的存储。<br />
Redis支持<strong>数据的备份</strong>，即master-slave模式的数据备份。</p>
<ul>
<li><strong>Redis 优势</strong><br />
性能极高 – Redis能读的速度是110000次/s,写的速度是81000次/s 。<br />
丰富的数据类型 – Redis支持二进制案例的 Strings, Lists, Hashes, Sets 及 Ordered Sets 数据类型操作。<br />
原子 – Redis的所有操作都是原子性的，意思就是要么成功执行要么失败完全不执行。单个操作是原子性的。多个操作也支持事务，即原子性，通过MULTI和EXEC指令包起来。<br />
丰富的特性 – Redis还支持 publish/subscribe, 通知, key 过期等等特性。</li>
<li><strong>Redis与其他key-value存储有什么不同？</strong><br />
Redis有着更为复杂的数据结构并且提供对他们的原子性操作，这是一个不同于其他数据库的进化路径。Redis的数据类型都是基于基本数据结构的同时对程序员透明，无需进行额外的抽象。</li>
</ul>
<p>Redis<strong>运行在内存中但是可以持久化到磁盘</strong>，所以在对不同数据集进行高速读写时需要权衡内存，因为数据量不能大于硬件内存。在内存数据库方面的另一个优点是，相比在磁盘上相同的复杂的数据结构，在内存中操作起来非常简单，这样Redis可以做很多内部复杂性很强的事情。同时，在磁盘格式方面他们是紧凑的以追加的方式产生的，因为他们并不需要进行随机访问。</p>
<ul>
<li><strong>redis的应用场景有哪些</strong></li>
</ul>
<p>1、会话高速缓存（最常用）</p>
<p>2、消息队列，比如支付</p>
<p>3、活动排行榜或计数</p>
<p>4、发布、订阅消息（消息通知）</p>
<p>5、商品列表、评论列表、计时器、计数器</p>
<p>6、地图信息分析</p>
<p>7、内存存储、持久化（rdb，aof）</p>
<ul>
<li>REmote DIctionary Server（远程字典服务器），开源，C语言编写</li>
</ul>
<h3 id="nosql%EF%BC%88not-only-sql%EF%BC%89%E9%9D%9E%E5%85%B3%E7%B3%BB%E5%9E%8B%E6%95%B0%E6%8D%AE%E5%BA%93" id="NoSQL（Not-Only-SQL）非关系型数据库">NoSQL（Not Only SQL）非关系型数据库</h3>
<ul>
<li>不需要固定模式，无需多于操作就可以横向操作</li>
</ul>
<h3 id="3v%2B3%E9%AB%98" id="3V-3高">3V+3高</h3>
<ul>
<li>
<p>大数据时代3V（描述问题）</p>
<ul>
<li>海量Volume</li>
<li>多样Variety</li>
<li>实时Velocity</li>
</ul>
</li>
<li>
<p>互联网需求3高（对程序要求）</p>
<ul>
<li>高并发</li>
<li>高可扩</li>
<li>高性能</li>
</ul>
</li>
</ul>
<h3 id="%E7%BB%8F%E5%85%B8%E5%BA%94%E7%94%A8" id="经典应用">经典应用</h3>
<ul>
<li>阿里巴巴</li>
</ul>
<h3 id="%E5%9B%9B%E5%A4%A7%E5%88%86%E7%B1%BB" id="四大分类">四大分类</h3>
<ul>
<li>
<p>KV键值对</p>
</li>
<li>
<p>文档型数据库</p>
</li>
<li>
<p>列存储数据库</p>
</li>
<li>
<p>图关系数据库（图结构）</p>
<p><img src="https://gitee.com/mychimei/picture/raw/master/work/image-20210622194750340.png" alt="image-20210622194750340" /></p>
</li>
</ul>
<h3 id="cap" id="CAP">CAP</h3>
<ul>
<li>
<p>C：Consistency（强一致性）</p>
</li>
<li>
<p>A:Availability（可用性）</p>
</li>
<li>
<p>P：Partition tolerance（分区容错性）</p>
</li>
<li>
<p>三进二（C必实现）</p>
<ul>
<li>
<p>CA</p>
<ul>
<li>单点集群，满足一致性</li>
</ul>
</li>
<li>
<p>CP</p>
</li>
<li>
<p>AP</p>
</li>
</ul>
</li>
</ul>
<h3 id="base" id="BASE">BASE</h3>
<ul>
<li>基本可用（Basically Available）</li>
<li>软状态（Soft state）</li>
<li>最终一致性（Eventually consistent）</li>
</ul>
<h3 id="%E5%88%86%E5%B8%83%E5%BC%8F%E4%B8%8E%E9%9B%86%E7%BE%A4" id="分布式与集群">分布式与集群</h3>
<ul>
<li>子主题 1</li>
</ul>
<h3 id="acid%E5%85%B3%E7%B3%BB%E5%9E%8B%E6%95%B0%E6%8D%AE%E5%BA%93" id="ACID关系型数据库">ACID关系型数据库</h3>
<h1 id="redis-%E5%AE%89%E8%A3%85">Redis 安装</h1>
<h2 id="windows" id="windows">windows</h2>
<p>企业里面几乎不用windows开发Redis</p>
<p><a target="_blank" rel="noopener" href="https://github.com/tporadowski/redis/releases">https://github.com/tporadowski/redis/releases</a></p>
<p>redis-server.exe redis.windows.conf</p>
<p>另启一个 cmd 窗口，原来的不要关闭，不然就无法访问服务端了（可直接设置为服务自启动）</p>
<p>redis-cli.exe -h 127.0.0.1 -p 6379</p>
<p>set myKey abc</p>
<ul>
<li>get myKey</li>
</ul>
<h2 id="linux" id="Linux">Linux</h2>
<p>下载 == 解压（opt） == 基本环境安装【yum install gcc-c++】== make == make install  == redis默认安装路径/usr/local/bin ==  拷贝redis的conf文件使用拷贝配置文件启动 == daemonize改为yes改为后台启动 == 启动服务redis-server redisconfig/redis.conf == 客户端连接 redis-cli -p 6379  == ping 测试连接  === 查看redis进程是否开启  ps  -ef|grep redis  == shutdown关闭服务</p>
<h3 id="redis-benchmark%E6%80%A7%E8%83%BD%E6%B5%8B%E8%AF%95" id="redis-benchmark性能测试">redis-benchmark性能测试</h3>
<p>可选参数：</p>
<p><img src="https://gitee.com/mychimei/picture/raw/master/work/image-20210630185658552.png" alt="image-20210630185658552" /></p>
<p><strong>测试：100个并发连接 100000请求</strong></p>
<p>redis-benchmark -h localhost -p 6379 -c 100 -n 100000</p>
<img src="https://gitee.com/mychimei/picture/raw/master/work/image-20210630190808370.png" alt="image-20210630190808370" style="zoom: 67%;" />
<h1 id="%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86">基础知识</h1>
<p>redis默认有16个数据库</p>
<p>默认使用的是第0个<br />
可以使用 select 进行切换数据库！select 3</p>
<p>DBSIZE # 查看DB大小！</p>
<p>keys * # 查看数据库所有的key</p>
<p>清除当前数据库 flushdb<br />
清除全部数据库的内容 FLUSHALL</p>
<p><strong>Redis 为什么单线程还这么快？</strong><br />
1、误区1：高性能的服务器一定是多线程的？<br />
2、误区2：多线程（CPU上下文会切换！）一定比单线程效率高！<br />
先去CPU&gt;内存&gt;硬盘的速度要有所了解！<br />
核心：redis 是将所有的数据全部放在内存中的，所以说使用单线程去操作效率就是最高的，多线程<br />
（CPU上下文会切换：耗时的操作！！！），对于内存系统来说，如果没有上下文切换效率就是最高<br />
的！多次读写都是在一个CPU上的，在内存情况下，这个就是最佳的方案！</p>
<h1 id="redis-%E9%85%8D%E7%BD%AE">Redis 配置</h1>
<p>Redis 的配置文件位于 Redis 安装目录下，文件名为 redis.conf(Windows 名为 redis.windows.conf)。</p>
<p>你可以通过 CONFIG 命令查看或设置配置项。</p>
<ul>
<li>
<p>CONFIG GET CONFIG_SETTING_NAME</p>
<ul>
<li>CONFIG GET loglevel</li>
<li>CONFIG GET *</li>
</ul>
</li>
</ul>
<h3 id="%E7%BC%96%E8%BE%91%E9%85%8D%E7%BD%AE" id="编辑配置">编辑配置</h3>
<ul>
<li>
<p>可以通过修改 redis.conf 文件或使用 CONFIG set 命令来修改配置。</p>
<ul>
<li>
<p>CONFIG SET CONFIG_SETTING_NAME NEW_CONFIG_VALUE</p>
<ul>
<li>CONFIG SET loglevel &quot;notice&quot;</li>
</ul>
</li>
</ul>
</li>
</ul>
<h3 id="%E5%8F%82%E6%95%B0%E8%AF%B4%E6%98%8E" id="参数说明">参数说明</h3>
<p>redis.conf 配置项说明如下：</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://www.runoob.com/redis/redis-conf.html">https://www.runoob.com/redis/redis-conf.html</a></li>
</ul>
<h1 id="redis-%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B">Redis 数据类型</h1>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; keys * # 查看所有的key</span><br><span class="line">(empty list or set)</span><br><span class="line">127.0.0.1:6379&gt; set name kuangshen # set key</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379&gt; keys *</span><br><span class="line">1) &quot;name&quot;</span><br><span class="line">127.0.0.1:6379&gt; set age 1</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379&gt; keys *</span><br><span class="line">1) &quot;age&quot;</span><br><span class="line">2) &quot;name&quot;</span><br><span class="line">127.0.0.1:6379&gt; EXISTS name # 判断当前的key是否存在</span><br><span class="line">(integer) 1</span><br><span class="line">127.0.0.1:6379&gt; EXISTS name1</span><br><span class="line">(integer) 0</span><br><span class="line">127.0.0.1:6379&gt; move name 1 # 移除当前的key</span><br><span class="line">(integer) 1</span><br><span class="line">127.0.0.1:6379&gt; keys *</span><br><span class="line">1) &quot;age&quot;</span><br><span class="line">127.0.0.1:6379&gt; set name qinjiang</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379&gt; keys *</span><br><span class="line">1) &quot;age&quot;</span><br><span class="line">2) &quot;name&quot;</span><br><span class="line">127.0.0.1:6379&gt; clear</span><br><span class="line">127.0.0.1:6379&gt; keys *</span><br><span class="line">1) &quot;age&quot;</span><br><span class="line">2) &quot;name&quot;</span><br><span class="line">127.0.0.1:6379&gt; get name</span><br><span class="line">&quot;qinjiang&quot;</span><br><span class="line">127.0.0.1:6379&gt; EXPIRE name 10 # 设置key的过期时间，单位是秒</span><br><span class="line">(integer) 1</span><br><span class="line">127.0.0.1:6379&gt; ttl name # 查看当前key的剩余时间</span><br><span class="line">(integer) 4</span><br><span class="line">127.0.0.1:6379&gt; ttl name</span><br><span class="line">(integer) 3</span><br><span class="line">127.0.0.1:6379&gt; ttl name</span><br><span class="line">(integer) 2</span><br><span class="line">127.0.0.1:6379&gt; ttl name</span><br><span class="line">(integer) 1</span><br><span class="line">127.0.0.1:6379&gt; ttl name</span><br><span class="line">(integer) -2</span><br><span class="line">127.0.0.1:6379&gt; get name</span><br><span class="line">(nil)</span><br><span class="line">127.0.0.1:6379&gt; type name # 查看当前key的一个类型！</span><br><span class="line">string</span><br><span class="line">127.0.0.1:6379&gt; type age</span><br><span class="line">string</span><br></pre></td></tr></table></figure>
<h2 id="string%EF%BC%88%E5%AD%97%E7%AC%A6%E4%B8%B2%EF%BC%89" id="String（字符串）">String（字符串）</h2>
<ul>
<li>string 是 redis 最基本的类型，你可以理解成与 Memcached 一模一样的类型，一个 key 对应一个 value。</li>
</ul>
<p>string 类型是二进制安全的。意思是 redis 的 string 可以包含任何数据。比如jpg图片或者序列化的对象。</p>
<p>string 类型是 Redis 最基本的数据类型，string 类型的值最大能存储 512MB。</p>
<ul>
<li>
<p>SET runoob &quot;菜鸟教程&quot;</p>
<ul>
<li>GET runoob</li>
</ul>
</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br></pre></td><td class="code"><pre><span class="line">##########################################################################</span><br><span class="line">127.0.0.1:6379&gt; set key1 v1 # 设置值</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379&gt; get key1 # 获得值</span><br><span class="line">&quot;v1&quot;</span><br><span class="line">127.0.0.1:6379&gt; keys * # 获得所有的key</span><br><span class="line">1) &quot;key1&quot;</span><br><span class="line">127.0.0.1:6379&gt; EXISTS key1 # 判断某一个key是否存在</span><br><span class="line">(integer) 1</span><br><span class="line">127.0.0.1:6379&gt; APPEND key1 &quot;hello&quot; # 追加字符串，如果当前key不存在，就相当于setkey</span><br><span class="line">(integer) 7</span><br><span class="line">127.0.0.1:6379&gt; get key1</span><br><span class="line">&quot;v1hello&quot;</span><br><span class="line">127.0.0.1:6379&gt; STRLEN key1 # 获取字符串的长度！</span><br><span class="line">(integer) 7</span><br><span class="line">127.0.0.1:6379&gt; APPEND key1 &quot;,kaungshen&quot;</span><br><span class="line">(integer) 17</span><br><span class="line">127.0.0.1:6379&gt; STRLEN key1</span><br><span class="line">(integer) 17</span><br><span class="line">127.0.0.1:6379&gt; get key1</span><br><span class="line">&quot;v1hello,kaungshen&quot;</span><br><span class="line">##########################################################################</span><br><span class="line"></span><br><span class="line"># i++</span><br><span class="line"># 步长 i+&#x3D;</span><br><span class="line">127.0.0.1:6379&gt; set views 0 # 初始浏览量为0</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379&gt; get views</span><br><span class="line">&quot;0&quot;</span><br><span class="line">127.0.0.1:6379&gt; incr views # 自增1 浏览量变为1</span><br><span class="line">(integer) 1</span><br><span class="line">127.0.0.1:6379&gt; incr views</span><br><span class="line">(integer) 2</span><br><span class="line">127.0.0.1:6379&gt; get views</span><br><span class="line">&quot;2&quot;</span><br><span class="line">127.0.0.1:6379&gt; decr views # 自减1 浏览量-1</span><br><span class="line">(integer) 1</span><br><span class="line">127.0.0.1:6379&gt; decr views</span><br><span class="line">(integer) 0</span><br><span class="line">127.0.0.1:6379&gt; decr views</span><br><span class="line">(integer) -1</span><br><span class="line">127.0.0.1:6379&gt; get views</span><br><span class="line">&quot;-1&quot;</span><br><span class="line">127.0.0.1:6379&gt; INCRBY views 10 # 可以设置步长，指定增量！</span><br><span class="line">(integer) 9</span><br><span class="line">127.0.0.1:6379&gt; INCRBY views 10</span><br><span class="line">(integer) 19</span><br><span class="line">127.0.0.1:6379&gt; DECRBY views 5</span><br><span class="line">(integer) 14</span><br><span class="line">##########################################################################</span><br><span class="line"></span><br><span class="line"># 字符串范围 range</span><br><span class="line"></span><br><span class="line">127.0.0.1:6379&gt; set key1 &quot;hello,kuangshen&quot; # 设置 key1 的值</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379&gt; get key1</span><br><span class="line">&quot;hello,kuangshen&quot;</span><br><span class="line">127.0.0.1:6379&gt; GETRANGE key1 0 3 # 截取字符串 [0,3]</span><br><span class="line">&quot;hell&quot;</span><br><span class="line">127.0.0.1:6379&gt; GETRANGE key1 0 -1 # 获取全部的字符串 和 get key是一样的</span><br><span class="line">&quot;hello,kuangshen&quot;</span><br><span class="line"></span><br><span class="line"># 替换！</span><br><span class="line"></span><br><span class="line">127.0.0.1:6379&gt; set key2 abcdefg</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379&gt; get key2</span><br><span class="line">&quot;abcdefg&quot;</span><br><span class="line">127.0.0.1:6379&gt; SETRANGE key2 1 xx # 替换指定位置开始的字符串！</span><br><span class="line">(integer) 7</span><br><span class="line">127.0.0.1:6379&gt; get key2</span><br><span class="line">&quot;axxdefg&quot;</span><br><span class="line">##########################################################################</span><br><span class="line"></span><br><span class="line"># setex (set with expire) # 设置过期时间</span><br><span class="line"></span><br><span class="line"># setnx (set if not exist) # 不存在在设置 （在分布式锁中会常常使用！）</span><br><span class="line"></span><br><span class="line">127.0.0.1:6379&gt; setex key3 30 &quot;hello&quot; # 设置key3 的值为 hello,30秒后过期</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379&gt; ttl key3</span><br><span class="line">(integer) 26</span><br><span class="line">127.0.0.1:6379&gt; get key3</span><br><span class="line">&quot;hello&quot;</span><br><span class="line">127.0.0.1:6379&gt; setnx mykey &quot;redis&quot; # 如果mykey 不存在，创建mykey</span><br><span class="line">(integer) 1</span><br><span class="line">127.0.0.1:6379&gt; keys *</span><br><span class="line">1) &quot;key2&quot;</span><br><span class="line">2) &quot;mykey&quot;</span><br><span class="line">3) &quot;key1&quot;</span><br><span class="line">127.0.0.1:6379&gt; ttl key3</span><br><span class="line">(integer) -2</span><br><span class="line">127.0.0.1:6379&gt; setnx mykey &quot;MongoDB&quot; # 如果mykey存在，创建失败！</span><br><span class="line">(integer) 0</span><br><span class="line">127.0.0.1:6379&gt; get mykey</span><br><span class="line">&quot;redis&quot;</span><br><span class="line">##########################################################################</span><br><span class="line">mset</span><br><span class="line">mget</span><br><span class="line">127.0.0.1:6379&gt; mset k1 v1 k2 v2 k3 v3 # 同时设置多个值</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379&gt; keys *</span><br><span class="line">1) &quot;k1&quot;</span><br><span class="line">2) &quot;k2&quot;</span><br><span class="line">3) &quot;k3&quot;</span><br><span class="line">127.0.0.1:6379&gt; mget k1 k2 k3 # 同时获取多个值</span><br><span class="line">1) &quot;v1&quot;</span><br><span class="line">2) &quot;v2&quot;</span><br><span class="line">3) &quot;v3&quot;</span><br><span class="line">127.0.0.1:6379&gt; msetnx k1 v1 k4 v4 # msetnx 是一个原子性的操作，要么一起成功，要么一起</span><br><span class="line">失败！</span><br><span class="line">(integer) 0</span><br><span class="line">127.0.0.1:6379&gt; get k4</span><br><span class="line">(nil)</span><br><span class="line"># 对象</span><br><span class="line">set user:1 &#123;name:zhangsan,age:3&#125; # 设置一个user:1 对象 值为 json字符来保存一个对象！</span><br><span class="line"># 这里的key是一个巧妙的设计： user:&#123;id&#125;:&#123;filed&#125; , 如此设计在Redis中是完全OK了！</span><br><span class="line">127.0.0.1:6379&gt; mset user:1:name zhangsan user:1:age 2</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379&gt; mget user:1:name user:1:age</span><br><span class="line">1) &quot;zhangsan&quot;</span><br><span class="line">2) &quot;2&quot;</span><br><span class="line">##########################################################################</span><br><span class="line">getset # 先get然后在set</span><br><span class="line">127.0.0.1:6379&gt; getset db redis # 如果不存在值，则返回 nil</span><br><span class="line">(nil)</span><br><span class="line">127.0.0.1:6379&gt; get db</span><br><span class="line">&quot;redis</span><br><span class="line">127.0.0.1:6379&gt; getset db mongodb # 如果存在值，获取原来的值，并设置新的值</span><br><span class="line">&quot;redis&quot;</span><br><span class="line">127.0.0.1:6379&gt; get db</span><br><span class="line">&quot;mongodb&quot;</span><br></pre></td></tr></table></figure>
<p>数据结构是相同的！<br />
String类似的使用场景：value除了是我们的字符串还可以是我们的数字！<br />
计数器<br />
统计多单位的数量<br />
粉丝数<br />
对象缓存存储！</p>
<h2 id="hash%EF%BC%88%E5%93%88%E5%B8%8C%EF%BC%89" id="Hash（哈希）">Hash（哈希）</h2>
<ul>
<li>Redis hash 是一个键值(key=&gt;value)对集合。</li>
</ul>
<p>Redis hash 是一个 string 类型的 field 和 value 的映射表，hash 特别适合用于存储对象。</p>
<pre><code>- DEL runoob 用于删除前面测试用过的 key，不然会报错：(error) WRONGTYPE Operation against a key holding the wrong kind of value
- HMSET 设置了两个 field=&gt;value 对, HGET 获取对应 field 对应的 value。
</code></pre>
<p>每个 hash 可以存储 232 -1 键值对（40多亿）。</p>
<ul>
<li>
<p>HMSET runoob field1 &quot;Hello&quot; field2 &quot;World&quot;</p>
<ul>
<li>HGET runoob field1</li>
</ul>
</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line">Map集合，key-map! 时候这个值是一个map集合！ 本质和String类型没有太大区别，还是一个简单的</span><br><span class="line">key-vlaue！</span><br><span class="line">set myhash field kuangshen</span><br><span class="line">5) &quot;d&quot;</span><br><span class="line">##########################################################################</span><br><span class="line">127.0.0.1:6379&gt; hset myhash field1 kuangshen # set一个具体 key-vlaue</span><br><span class="line">(integer) 1</span><br><span class="line">127.0.0.1:6379&gt; hget myhash field1 # 获取一个字段值</span><br><span class="line">&quot;kuangshen&quot;</span><br><span class="line">127.0.0.1:6379&gt; hmset myhash field1 hello field2 world # set多个 key-vlaue</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379&gt; hmget myhash field1 field2 # 获取多个字段值</span><br><span class="line">1) &quot;hello&quot;</span><br><span class="line">2) &quot;world&quot;</span><br><span class="line">127.0.0.1:6379&gt; hgetall myhash # 获取全部的数据，</span><br><span class="line">1) &quot;field1&quot;</span><br><span class="line">2) &quot;hello&quot;</span><br><span class="line">3) &quot;field2&quot;</span><br><span class="line">4) &quot;world&quot;</span><br><span class="line">127.0.0.1:6379&gt; hdel myhash field1 # 删除hash指定key字段！对应的value值也就消失了！</span><br><span class="line">(integer) 1</span><br><span class="line">127.0.0.1:6379&gt; hgetall myhash</span><br><span class="line">1) &quot;field2&quot;</span><br><span class="line">2) &quot;world&quot;</span><br><span class="line">##########################################################################</span><br><span class="line">hlen</span><br><span class="line">127.0.0.1:6379&gt; hmset myhash field1 hello field2 world</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379&gt; HGETALL myhash</span><br><span class="line">1) &quot;field2&quot;</span><br><span class="line">2) &quot;world&quot;</span><br><span class="line">3) &quot;field1&quot;</span><br><span class="line">4) &quot;hello&quot;</span><br><span class="line">127.0.0.1:6379&gt; hlen myhash # 获取hash表的字段数量！</span><br><span class="line">(integer) 2</span><br><span class="line">##########################################################################</span><br><span class="line">127.0.0.1:6379&gt; HEXISTS myhash field1 # 判断hash中指定字段是否存在！</span><br><span class="line">(integer) 1</span><br><span class="line">127.0.0.1:6379&gt; HEXISTS myhash field3</span><br><span class="line">(integer) 0</span><br><span class="line">##########################################################################</span><br><span class="line"># 只获得所有field</span><br><span class="line"># 只获得所有value</span><br><span class="line">127.0.0.1:6379&gt; hkeys myhash # 只获得所有field</span><br><span class="line">1) &quot;field2&quot;</span><br><span class="line">2) &quot;field1&quot;</span><br><span class="line">hash变更的数据 user name age,尤其是是用户信息之类的，经常变动的信息！ hash 更适合于对象的</span><br><span class="line">存储，String更加适合字符串存储！</span><br></pre></td></tr></table></figure>
<h2 id="list%EF%BC%88%E5%88%97%E8%A1%A8%EF%BC%89" id="List（列表）">List（列表）</h2>
<ul>
<li>
<p>Redis 列表是简单的字符串列表，按照插入顺序排序。你可以添加一个元素到列表的头部（左边）或者尾部（右边）。</p>
</li>
<li>
<p>列表最多可存储 232 - 1 元素 (4294967295, 每个列表可存储40多亿)。</p>
</li>
<li>
<p>lpush runoob redis</p>
<ul>
<li>
<p>lpush runoob mongodb</p>
<ul>
<li>lrange runoob 0 10</li>
</ul>
</li>
</ul>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br></pre></td><td class="code"><pre><span class="line">基本的数据类型，列表</span><br><span class="line">127.0.0.1:6379&gt; msetnx k1 v1 k4 v4 # msetnx 是一个原子性的操作，要么一起成功，要么一起</span><br><span class="line">失败！</span><br><span class="line">(integer) 0</span><br><span class="line">127.0.0.1:6379&gt; get k4</span><br><span class="line">(nil)</span><br><span class="line"># 对象</span><br><span class="line">set user:1 &#123;name:zhangsan,age:3&#125; # 设置一个user:1 对象 值为 json字符来保存一个对象！</span><br><span class="line"># 这里的key是一个巧妙的设计： user:&#123;id&#125;:&#123;filed&#125; , 如此设计在Redis中是完全OK了！</span><br><span class="line">127.0.0.1:6379&gt; mset user:1:name zhangsan user:1:age 2</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379&gt; mget user:1:name user:1:age</span><br><span class="line">1) &quot;zhangsan&quot;</span><br><span class="line">2) &quot;2&quot;</span><br><span class="line">##########################################################################</span><br><span class="line">getset # 先get然后在set</span><br><span class="line">127.0.0.1:6379&gt; getset db redis # 如果不存在值，则返回 nil</span><br><span class="line">(nil)</span><br><span class="line">127.0.0.1:6379&gt; get db</span><br><span class="line">&quot;redis</span><br><span class="line">127.0.0.1:6379&gt; getset db mongodb # 如果存在值，获取原来的值，并设置新的值</span><br><span class="line">&quot;redis&quot;</span><br><span class="line">127.0.0.1:6379&gt; get db</span><br><span class="line">&quot;mongodb&quot;</span><br><span class="line">在redis里面，我们可以把list玩成 ，栈、队列、阻塞队列！</span><br><span class="line">所有的list命令都是用l开头的，Redis不区分大小命令</span><br><span class="line">##########################################################################</span><br><span class="line">127.0.0.1:6379&gt; LPUSH list one # 将一个值或者多个值，插入到列表头部 （左）</span><br><span class="line">(integer) 1</span><br><span class="line">127.0.0.1:6379&gt; LPUSH list two</span><br><span class="line">(integer) 2</span><br><span class="line">127.0.0.1:6379&gt; LPUSH list three</span><br><span class="line">(integer) 3</span><br><span class="line">127.0.0.1:6379&gt; LRANGE list 0 -1 # 获取list中值！</span><br><span class="line">1) &quot;three&quot;</span><br><span class="line">2) &quot;two&quot;</span><br><span class="line">3) &quot;one&quot;</span><br><span class="line">127.0.0.1:6379&gt; LRANGE list 0 1 # 通过区间获取具体的值！</span><br><span class="line">1) &quot;three&quot;</span><br><span class="line">2) &quot;two&quot;</span><br><span class="line">127.0.0.1:6379&gt; Rpush list righr # 将一个值或者多个值，插入到列表位部 （右）</span><br><span class="line">(integer) 4</span><br><span class="line">127.0.0.1:6379&gt; LRANGE list 0 -1</span><br><span class="line">1) &quot;three&quot;</span><br><span class="line">2) &quot;two&quot;</span><br><span class="line">3) &quot;one&quot;</span><br><span class="line">4) &quot;righr&quot;</span><br><span class="line">##########################################################################</span><br><span class="line">LPOP</span><br><span class="line">RPOP</span><br><span class="line">127.0.0.1:6379&gt; LRANGE list 0 -1</span><br><span class="line">1) &quot;three&quot;</span><br><span class="line">2) &quot;two&quot;</span><br><span class="line">3) &quot;one&quot;</span><br><span class="line">4) &quot;righr&quot;</span><br><span class="line">127.0.0.1:6379&gt; Lpop list # 移除list的第一个元素</span><br><span class="line">&quot;three&quot;</span><br><span class="line">127.0.0.1:6379&gt; Rpop list # 移除list的最后一个元素</span><br><span class="line">&quot;righr&quot;</span><br><span class="line">127.0.0.1:6379&gt; LRANGE list 0 -1</span><br><span class="line">1) &quot;two&quot;</span><br><span class="line">2) &quot;one&quot;</span><br><span class="line">##########################################################################</span><br><span class="line">Lindex</span><br><span class="line">127.0.0.1:6379&gt; LRANGE list 0 -1</span><br><span class="line">1) &quot;two&quot;</span><br><span class="line">2) &quot;one&quot;</span><br><span class="line">127.0.0.1:6379&gt; lindex list 1 # 通过下标获得 list 中的某一个值！</span><br><span class="line">&quot;one&quot;</span><br><span class="line">127.0.0.1:6379&gt; lindex list 0</span><br><span class="line">&quot;two&quot;</span><br><span class="line">##########################################################################</span><br><span class="line">Llen</span><br><span class="line">127.0.0.1:6379&gt; Lpush list one</span><br><span class="line">(integer) 1</span><br><span class="line">127.0.0.1:6379&gt; Lpush list two</span><br><span class="line">(integer) 2</span><br><span class="line">127.0.0.1:6379&gt; Lpush list three</span><br><span class="line">(integer) 3</span><br><span class="line">127.0.0.1:6379&gt; Llen list # 返回列表的长度</span><br><span class="line">(integer) 3</span><br><span class="line">##########################################################################</span><br><span class="line">移除指定的值！</span><br><span class="line">取关 uid</span><br><span class="line">Lrem</span><br><span class="line">127.0.0.1:6379&gt; LRANGE list 0 -1</span><br><span class="line">1) &quot;three&quot;</span><br><span class="line">2) &quot;three&quot;</span><br><span class="line">3) &quot;two&quot;</span><br><span class="line">4) &quot;one&quot;</span><br><span class="line">127.0.0.1:6379&gt; lrem list 1 one # 移除list集合中指定个数的value，精确匹配</span><br><span class="line">(integer) 1</span><br><span class="line">127.0.0.1:6379&gt; LRANGE list 0 -1</span><br><span class="line">1) &quot;three&quot;</span><br><span class="line">2) &quot;three&quot;</span><br><span class="line">3) &quot;two&quot;</span><br><span class="line">127.0.0.1:6379&gt; lrem list 1 three</span><br><span class="line">(integer) 1</span><br><span class="line">127.0.0.1:6379&gt; LRANGE list 0 -1</span><br><span class="line">1) &quot;three&quot;</span><br><span class="line">2) &quot;two&quot;</span><br><span class="line">127.0.0.1:6379&gt; Lpush list three</span><br><span class="line">(integer) 3</span><br><span class="line">127.0.0.1:6379&gt; lrem list 2 three</span><br><span class="line">(integer) 2</span><br><span class="line">127.0.0.1:6379&gt; LRANGE list 0 -1</span><br><span class="line">1) &quot;two&quot;</span><br><span class="line">##########################################################################</span><br><span class="line">trim 修剪。； list 截断!</span><br><span class="line">127.0.0.1:6379&gt; keys *</span><br><span class="line">(empty list or set)</span><br><span class="line">127.0.0.1:6379&gt; Rpush mylist &quot;hello&quot;</span><br><span class="line">(integer) 1</span><br><span class="line">127.0.0.1:6379&gt; Rpush mylist &quot;hello1&quot;</span><br><span class="line">(integer) 2</span><br><span class="line">127.0.0.1:6379&gt; Rpush mylist &quot;hello2&quot;</span><br><span class="line">(integer) 3</span><br><span class="line">127.0.0.1:6379&gt; Rpush mylist &quot;hello3&quot;</span><br><span class="line">(integer) 4</span><br><span class="line">127.0.0.1:6379&gt; ltrim mylist 1 2 # 通过下标截取指定的长度，这个list已经被改变了，截断了</span><br><span class="line">只剩下截取的元素！</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379&gt; LRANGE mylist 0 -1</span><br><span class="line">1) &quot;hello1&quot;</span><br><span class="line">2) &quot;hello2&quot;</span><br><span class="line">##########################################################################</span><br><span class="line">rpoplpush # 移除列表的最后一个元素，将他移动到新的列表中！</span><br><span class="line">127.0.0.1:6379&gt; rpush mylist &quot;hello&quot;</span><br><span class="line">(integer) 1</span><br><span class="line">127.0.0.1:6379&gt; rpush mylist &quot;hello1&quot;</span><br><span class="line">(integer) 2</span><br><span class="line">127.0.0.1:6379&gt; rpush mylist &quot;hello2&quot;</span><br><span class="line">(integer) 3</span><br><span class="line">127.0.0.1:6379&gt; rpoplpush mylist myotherlist # 移除列表的最后一个元素，将他移动到新的</span><br><span class="line">列表中！</span><br><span class="line">&quot;hello2&quot;</span><br><span class="line">127.0.0.1:6379&gt; lrange mylist 0 -1 # 查看原来的列表</span><br><span class="line">1) &quot;hello&quot;</span><br><span class="line">2) &quot;hello1&quot;</span><br><span class="line">127.0.0.1:6379&gt; lrange myotherlist 0 -1 # 查看目标列表中，确实存在改值！</span><br><span class="line">1) &quot;hello2&quot;</span><br><span class="line">##########################################################################</span><br><span class="line">lset 将列表中指定下标的值替换为另外一个值，更新操作</span><br><span class="line">127.0.0.1:6379&gt; EXISTS list # 判断这个列表是否存在</span><br><span class="line">(integer) 0</span><br><span class="line">127.0.0.1:6379&gt; lset list 0 item # 如果不存在列表我们去更新就会报错</span><br><span class="line">(error) ERR no such key</span><br><span class="line">127.0.0.1:6379&gt; lpush list value1</span><br><span class="line">(integer) 1</span><br><span class="line">127.0.0.1:6379&gt; LRANGE list 0 0</span><br><span class="line">1) &quot;value1&quot;</span><br><span class="line">127.0.0.1:6379&gt; lset list 0 item # 如果存在，更新当前下标的值</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379&gt; LRANGE list 0 0</span><br><span class="line">1) &quot;item&quot;</span><br><span class="line">127.0.0.1:6379&gt; lset list 1 other # 如果不存在，则会报错！</span><br><span class="line">(error) ERR index out of range</span><br><span class="line">##########################################################################</span><br><span class="line">linsert # 将某个具体的value插入到列把你中某个元素的前面或者后面！</span><br><span class="line">127.0.0.1:6379&gt; Rpush mylist &quot;hello&quot;</span><br><span class="line">(integer) 1</span><br><span class="line">127.0.0.1:6379&gt; Rpush mylist &quot;world&quot;</span><br><span class="line">(integer) 2</span><br><span class="line">127.0.0.1:6379&gt; LINSERT mylist before &quot;world&quot; &quot;other&quot;</span><br><span class="line">(integer) 3</span><br><span class="line">127.0.0.1:6379&gt; LRANGE mylist 0 -1</span><br><span class="line">1) &quot;hello&quot;</span><br><span class="line">2) &quot;other&quot;</span><br><span class="line">3) &quot;world&quot;</span><br><span class="line">127.0.0.1:6379&gt; LINSERT mylist after world new</span><br><span class="line">(integer) 4</span><br><span class="line">127.0.0.1:6379&gt; LRANGE mylist 0 -1</span><br><span class="line">1) &quot;hello&quot;</span><br><span class="line">2) &quot;other&quot;</span><br><span class="line">3) &quot;world&quot;</span><br><span class="line">4) &quot;new&quot;</span><br><span class="line">小结</span><br><span class="line">他实际上是一个链表，before Node after ， left，right 都可以插入值</span><br><span class="line">如果key 不存在，创建新的链表</span><br><span class="line">如果key存在，新增内容</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h2 id="set%EF%BC%88%E9%9B%86%E5%90%88%EF%BC%89" id="Set（集合）">Set（集合）</h2>
<ul>
<li>Redis 的 Set 是 string 类型的无序集合。</li>
</ul>
<p>集合是通过哈希表实现的，所以添加，删除，查找的复杂度都是 O(1)。</p>
<ul>
<li>sadd 命令<br />
添加一个 string 元素到 key 对应的 set 集合中，成功返回 1，如果元素已经在集合中返回 0。</li>
</ul>
<p>sadd key member</p>
<ul>
<li>
<p>集合中最大的成员数为 232 - 1(4294967295, 每个集合可存储40多亿个成员)。</p>
</li>
<li>
<p>sadd runoob redis</p>
<ul>
<li>smembers runoob</li>
</ul>
</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br></pre></td><td class="code"><pre><span class="line">set中的值是不能重读的！</span><br><span class="line">##########################################################################</span><br><span class="line">127.0.0.1:6379&gt; sadd myset &quot;hello&quot; # set集合中添加匀速</span><br><span class="line">(integer) 1</span><br><span class="line">127.0.0.1:6379&gt; sadd myset &quot;kuangshen&quot;</span><br><span class="line">(integer) 1</span><br><span class="line">127.0.0.1:6379&gt; sadd myset &quot;lovekuangshen&quot;</span><br><span class="line">(integer) 1</span><br><span class="line">127.0.0.1:6379&gt; SMEMBERS myset # 查看指定set的所有值</span><br><span class="line">1) &quot;hello&quot;</span><br><span class="line">2) &quot;lovekuangshen&quot;</span><br><span class="line">3) &quot;kuangshen&quot;</span><br><span class="line">127.0.0.1:6379&gt; SISMEMBER myset hello # 判断某一个值是不是在set集合中！</span><br><span class="line">(integer) 1</span><br><span class="line">127.0.0.1:6379&gt; SISMEMBER myset world</span><br><span class="line">(integer) 0</span><br><span class="line">##########################################################################</span><br><span class="line">127.0.0.1:6379&gt; scard myset # 获取set集合中的内容元素个数！</span><br><span class="line">(integer) 4</span><br><span class="line">##########################################################################</span><br><span class="line">rem</span><br><span class="line">127.0.0.1:6379&gt; srem myset hello # 移除set集合中的指定元素</span><br><span class="line">(integer) 1</span><br><span class="line">127.0.0.1:6379&gt; scard myset</span><br><span class="line">(integer) 3</span><br><span class="line">127.0.0.1:6379&gt; SMEMBERS myset</span><br><span class="line">1) &quot;lovekuangshen2&quot;</span><br><span class="line">2) &quot;lovekuangshen&quot;</span><br><span class="line">3) &quot;kuangshen&quot;</span><br><span class="line">##########################################################################</span><br><span class="line">set 无序不重复集合。抽随机！</span><br><span class="line">127.0.0.1:6379&gt; SMEMBERS myset</span><br><span class="line">1) &quot;lovekuangshen2&quot;</span><br><span class="line">2) &quot;lovekuangshen&quot;</span><br><span class="line">3) &quot;kuangshen&quot;</span><br><span class="line">127.0.0.1:6379&gt; SRANDMEMBER myset # 随机抽选出一个元素</span><br><span class="line">&quot;kuangshen&quot;</span><br><span class="line">127.0.0.1:6379&gt; SRANDMEMBER myset</span><br><span class="line">&quot;kuangshen&quot;</span><br><span class="line">127.0.0.1:6379&gt; SRANDMEMBER myset</span><br><span class="line">&quot;kuangshen&quot;</span><br><span class="line">127.0.0.1:6379&gt; SRANDMEMBER myset</span><br><span class="line">&quot;kuangshen&quot;</span><br><span class="line">127.0.0.1:6379&gt; SRANDMEMBER myset 2 # 随机抽选出指定个数的元素</span><br><span class="line">1) &quot;lovekuangshen&quot;</span><br><span class="line">2) &quot;lovekuangshen2&quot;</span><br><span class="line">127.0.0.1:6379&gt; SRANDMEMBER myset 2</span><br><span class="line">1) &quot;lovekuangshen&quot;</span><br><span class="line">2) &quot;lovekuangshen2&quot;</span><br><span class="line">127.0.0.1:6379&gt; SRANDMEMBER myset # 随机抽选出一个元素</span><br><span class="line">&quot;lovekuangshen2&quot;</span><br><span class="line">##########################################################################</span><br><span class="line">删除定的key，随机删除key！</span><br><span class="line">127.0.0.1:6379&gt; SMEMBERS myset</span><br><span class="line">1) &quot;lovekuangshen2&quot;</span><br><span class="line">2) &quot;lovekuangshen&quot;</span><br><span class="line">3) &quot;kuangshen&quot;</span><br><span class="line">127.0.0.1:6379&gt; spop myset # 随机删除一些set集合中的元素！</span><br><span class="line">&quot;lovekuangshen2&quot;</span><br><span class="line">127.0.0.1:6379&gt; spop myset</span><br><span class="line">&quot;lovekuangshen&quot;</span><br><span class="line">127.0.0.1:6379&gt; SMEMBERS myset</span><br><span class="line">1) &quot;kuangshen&quot;</span><br><span class="line">##########################################################################</span><br><span class="line">将一个指定的值，移动到另外一个set集合！</span><br><span class="line">127.0.0.1:6379&gt; sadd myset &quot;hello&quot;</span><br><span class="line">(integer) 1</span><br><span class="line">127.0.0.1:6379&gt; sadd myset &quot;world&quot;</span><br><span class="line">(integer) 1</span><br><span class="line">127.0.0.1:6379&gt; sadd myset &quot;kuangshen&quot;</span><br><span class="line">(integer) 1</span><br><span class="line">127.0.0.1:6379&gt; sadd myset2 &quot;set2&quot;</span><br><span class="line">(integer) 1</span><br><span class="line">127.0.0.1:6379&gt; smove myset myset2 &quot;kuangshen&quot; # 将一个指定的值，移动到另外一个set集</span><br><span class="line">合！</span><br><span class="line">(integer) 1</span><br><span class="line">127.0.0.1:6379&gt; SMEMBERS myset</span><br><span class="line">1) &quot;world&quot;</span><br><span class="line">2) &quot;hello&quot;</span><br><span class="line">127.0.0.1:6379&gt; SMEMBERS myset2</span><br><span class="line">1) &quot;kuangshen&quot;</span><br><span class="line">2) &quot;set2&quot;</span><br><span class="line">##########################################################################</span><br><span class="line">微博，B站，共同关注！(并集)</span><br><span class="line">数字集合类：</span><br><span class="line">- 差集 SDIFF</span><br><span class="line">- 交集</span><br><span class="line">- 并集</span><br><span class="line">127.0.0.1:6379&gt; SDIFF key1 key2 # 差集</span><br><span class="line">1) &quot;b&quot;</span><br><span class="line">2) &quot;a&quot;</span><br><span class="line">127.0.0.1:6379&gt; SINTER key1 key2 # 交集 共同好友就可以这样实现</span><br><span class="line">1) &quot;c&quot;</span><br><span class="line">127.0.0.1:6379&gt; SUNION key1 key2 # 并集</span><br><span class="line">1) &quot;b&quot;</span><br><span class="line">2) &quot;c&quot;</span><br><span class="line">3) &quot;e&quot;</span><br><span class="line">4) &quot;a&quot;</span><br><span class="line">微博，A用户将所有关注的人放在一个set集合中！将它的粉丝也放在一个集合中！</span><br><span class="line">共同关注，共同爱好，二度好友，推荐好友！（六度分割理论）</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h2 id="zset(%E6%9C%89%E5%BA%8F%E9%9B%86%E5%90%88)" id="ZSet-有序集合">ZSet(有序集合)</h2>
<ul>
<li>Redis zset (sorted set：有序集合)和 set 一样也是string类型元素的集合,且不允许重复的成员。不同的是每个元素都会关联一个double类型的分数。redis正是通过分数来为集合中的成员进行从小到大的<strong>排序</strong>。</li>
</ul>
<p>zset的成员是唯一的,但分数(score)却可以重复。</p>
<ul>
<li>zadd 命令<br />
添加元素到集合，元素在集合中存在则更新对应score</li>
</ul>
<p>zadd key score member</p>
<ul>
<li>
<p>zadd runoob 0 redis</p>
<ul>
<li>ZRANGEBYSCORE runoob 0 1000</li>
</ul>
</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br></pre></td><td class="code"><pre><span class="line">在set的基础上，增加了一个值，set k1 v1 zset k1 score1 v1</span><br><span class="line">127.0.0.1:6379&gt; hvals myhash # 只获得所有value</span><br><span class="line">1) &quot;world&quot;</span><br><span class="line">2) &quot;hello&quot;</span><br><span class="line">##########################################################################</span><br><span class="line">incr decr</span><br><span class="line">127.0.0.1:6379&gt; hset myhash field3 5 #指定增量！</span><br><span class="line">(integer) 1</span><br><span class="line">127.0.0.1:6379&gt; HINCRBY myhash field3 1</span><br><span class="line">(integer) 6</span><br><span class="line">127.0.0.1:6379&gt; HINCRBY myhash field3 -1</span><br><span class="line">(integer) 5</span><br><span class="line">127.0.0.1:6379&gt; hsetnx myhash field4 hello # 如果不存在则可以设置</span><br><span class="line">(integer) 1</span><br><span class="line">127.0.0.1:6379&gt; hsetnx myhash field4 world # 如果存在则不能设置</span><br><span class="line">(integer) 0</span><br><span class="line">127.0.0.1:6379&gt; zadd myset 1 one # 添加一个值</span><br><span class="line">(integer) 1</span><br><span class="line">127.0.0.1:6379&gt; zadd myset 2 two 3 three # 添加多个值</span><br><span class="line">(integer) 2</span><br><span class="line">127.0.0.1:6379&gt; ZRANGE myset 0 -1</span><br><span class="line">1) &quot;one&quot;</span><br><span class="line">2) &quot;two&quot;</span><br><span class="line">3) &quot;three&quot;</span><br><span class="line">##########################################################################</span><br><span class="line">排序如何实现</span><br><span class="line">127.0.0.1:6379&gt; zadd salary 2500 xiaohong # 添加三个用户</span><br><span class="line">(integer) 1</span><br><span class="line">127.0.0.1:6379&gt; zadd salary 5000 zhangsan</span><br><span class="line">(integer) 1</span><br><span class="line">127.0.0.1:6379&gt; zadd salary 500 kaungshen</span><br><span class="line">(integer) 1</span><br><span class="line"># ZRANGEBYSCORE key min max</span><br><span class="line">127.0.0.1:6379&gt; ZRANGEBYSCORE salary -inf +inf # 显示全部的用户 从小到大！</span><br><span class="line">1) &quot;kaungshen&quot;</span><br><span class="line">2) &quot;xiaohong&quot;</span><br><span class="line">3) &quot;zhangsan&quot;</span><br><span class="line">127.0.0.1:6379&gt; ZREVRANGE salary 0 -1 # 从大到进行排序！</span><br><span class="line">1) &quot;zhangsan&quot;</span><br><span class="line">2) &quot;kaungshen&quot;</span><br><span class="line">127.0.0.1:6379&gt; ZRANGEBYSCORE salary -inf +inf withscores # 显示全部的用户并且附带成</span><br><span class="line">绩</span><br><span class="line">1) &quot;kaungshen&quot;</span><br><span class="line">2) &quot;500&quot;</span><br><span class="line">3) &quot;xiaohong&quot;</span><br><span class="line">4) &quot;2500&quot;</span><br><span class="line">5) &quot;zhangsan&quot;</span><br><span class="line">6) &quot;5000&quot;</span><br><span class="line">127.0.0.1:6379&gt; ZRANGEBYSCORE salary -inf 2500 withscores # 显示工资小于2500员工的升</span><br><span class="line">序排序！</span><br><span class="line">1) &quot;kaungshen&quot;</span><br><span class="line">2) &quot;500&quot;</span><br><span class="line">3) &quot;xiaohong&quot;</span><br><span class="line">4) &quot;2500&quot;</span><br><span class="line">##########################################################################</span><br><span class="line"># 移除rem中的元素</span><br><span class="line">127.0.0.1:6379&gt; zrange salary 0 -1</span><br><span class="line">1) &quot;kaungshen&quot;</span><br><span class="line">2) &quot;xiaohong&quot;</span><br><span class="line">3) &quot;zhangsan&quot;</span><br><span class="line">127.0.0.1:6379&gt; zrem salary xiaohong # 移除有序集合中的指定元素</span><br><span class="line">(integer) 1</span><br><span class="line">127.0.0.1:6379&gt; zrange salary 0 -1</span><br><span class="line">1) &quot;kaungshen&quot;</span><br><span class="line">2) &quot;zhangsan&quot;</span><br><span class="line">127.0.0.1:6379&gt; zcard salary # 获取有序集合中的个数</span><br><span class="line">(integer) 2</span><br><span class="line">##########################################################################</span><br><span class="line">127.0.0.1:6379&gt; zadd myset 1 hello</span><br><span class="line">(integer) 1</span><br><span class="line">127.0.0.1:6379&gt; zadd myset 2 world 3 kuangshen</span><br><span class="line">(integer) 2</span><br><span class="line">127.0.0.1:6379&gt; zcount myset 1 3 # 获取指定区间的成员数量！</span><br><span class="line">(integer) 3</span><br><span class="line">127.0.0.1:6379&gt; zcount myset 1 2</span><br><span class="line">(integer) 2</span><br><span class="line">案例思路：set 排序 存储班级成绩表，工资表排序！</span><br><span class="line">普通消息，1， 重要消息 2，带权重进行判断！</span><br><span class="line">排行榜应用实现，取Top N 测试！</span><br></pre></td></tr></table></figure>
<h2 id="geospatial-%E5%9C%B0%E7%90%86%E4%BD%8D%E7%BD%AE" id="Geospatial-地理位置">Geospatial 地理位置</h2>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br></pre></td><td class="code"><pre><span class="line">朋友的定位，附近的人，打车距离计算？</span><br><span class="line">Redis 的 Geo 在Redis3.2 版本就推出了！ 这个功能可以推算地理位置的信息，两地之间的距离，方圆</span><br><span class="line">几里的人！</span><br><span class="line">可以查询一些测试数据：http:&#x2F;&#x2F;www.jsons.cn&#x2F;lngcodeinfo&#x2F;0706D99C19A781A3&#x2F;</span><br><span class="line">只有 六个命令：</span><br><span class="line">4) &quot;2500&quot;</span><br><span class="line">5) &quot;zhangsan&quot;</span><br><span class="line">6) &quot;5000&quot;</span><br><span class="line">127.0.0.1:6379&gt; ZRANGEBYSCORE salary -inf 2500 withscores # 显示工资小于2500员工的升</span><br><span class="line">序排序！</span><br><span class="line">1) &quot;kaungshen&quot;</span><br><span class="line">2) &quot;500&quot;</span><br><span class="line">3) &quot;xiaohong&quot;</span><br><span class="line">4) &quot;2500&quot;</span><br><span class="line">##########################################################################</span><br><span class="line"># 移除rem中的元素</span><br><span class="line">127.0.0.1:6379&gt; zrange salary 0 -1</span><br><span class="line">1) &quot;kaungshen&quot;</span><br><span class="line">2) &quot;xiaohong&quot;</span><br><span class="line">3) &quot;zhangsan&quot;</span><br><span class="line">127.0.0.1:6379&gt; zrem salary xiaohong # 移除有序集合中的指定元素</span><br><span class="line">(integer) 1</span><br><span class="line">127.0.0.1:6379&gt; zrange salary 0 -1</span><br><span class="line">1) &quot;kaungshen&quot;</span><br><span class="line">2) &quot;zhangsan&quot;</span><br><span class="line">127.0.0.1:6379&gt; zcard salary # 获取有序集合中的个数</span><br><span class="line">(integer) 2</span><br><span class="line">##########################################################################</span><br><span class="line">127.0.0.1:6379&gt; zadd myset 1 hello</span><br><span class="line">(integer) 1</span><br><span class="line">127.0.0.1:6379&gt; zadd myset 2 world 3 kuangshen</span><br><span class="line">(integer) 2</span><br><span class="line">127.0.0.1:6379&gt; zcount myset 1 3 # 获取指定区间的成员数量！</span><br><span class="line">(integer) 3</span><br><span class="line">127.0.0.1:6379&gt; zcount myset 1 2</span><br><span class="line">(integer) 2</span><br><span class="line">官方文档：https:&#x2F;&#x2F;www.redis.net.cn&#x2F;order&#x2F;3685.html</span><br><span class="line">getadd</span><br><span class="line">getpos</span><br><span class="line">获得当前定位：一定是一个坐标值！</span><br><span class="line">GEODIST</span><br><span class="line"># getadd 添加地理位置</span><br><span class="line"># 规则：两级无法直接添加，我们一般会下载城市数据，直接通过java程序一次性导入！</span><br><span class="line"># 有效的经度从-180度到180度。</span><br><span class="line"># 有效的纬度从-85.05112878度到85.05112878度。</span><br><span class="line"># 当坐标位置超出上述指定范围时，该命令将会返回一个错误。</span><br><span class="line"># 127.0.0.1:6379&gt; geoadd china:city 39.90 116.40 beijin</span><br><span class="line">(error) ERR invalid longitude,latitude pair 39.900000,116.400000</span><br><span class="line"># 参数 key 值（）</span><br><span class="line">127.0.0.1:6379&gt; geoadd china:city 116.40 39.90 beijing</span><br><span class="line">(integer) 1</span><br><span class="line">127.0.0.1:6379&gt; geoadd china:city 121.47 31.23 shanghai</span><br><span class="line">(integer) 1</span><br><span class="line">127.0.0.1:6379&gt; geoadd china:city 106.50 29.53 chongqi 114.05 22.52 shengzhen</span><br><span class="line">(integer) 2</span><br><span class="line">127.0.0.1:6379&gt; geoadd china:city 120.16 30.24 hangzhou 108.96 34.26 xian</span><br><span class="line">(integer) 2</span><br><span class="line">127.0.0.1:6379&gt; GEOPOS china:city beijing # 获取指定的城市的经度和纬度！</span><br><span class="line">1) 1) &quot;116.39999896287918091&quot;</span><br><span class="line">2) &quot;39.90000009167092543&quot;</span><br><span class="line">127.0.0.1:6379&gt; GEOPOS china:city beijing chongqi</span><br><span class="line">1) 1) &quot;116.39999896287918091&quot;</span><br><span class="line">2) &quot;39.90000009167092543&quot;</span><br><span class="line">2) 1) &quot;106.49999767541885376&quot;</span><br><span class="line">2) &quot;29.52999957900659211&quot;</span><br><span class="line">两人之间的距离！</span><br><span class="line">单位：</span><br><span class="line">m 表示单位为米。</span><br><span class="line">km 表示单位为千米。</span><br><span class="line">mi 表示单位为英里。</span><br><span class="line">ft 表示单位为英尺。</span><br><span class="line">georadius 以给定的经纬度为中心， 找出某一半径内的元素</span><br><span class="line">我附近的人？ （获得所有附近的人的地址，定位！）通过半径来查询！</span><br><span class="line">获得指定数量的人，200</span><br><span class="line">所有数据应该都录入：china:city ，才会让结果更加请求！</span><br><span class="line">127.0.0.1:6379&gt; GEODIST china:city beijing shanghai km # 查看上海到北京的直线距离</span><br><span class="line">&quot;1067.3788&quot;</span><br><span class="line">127.0.0.1:6379&gt; GEODIST china:city beijing chongqi km # 查看重庆到北京的直线距离</span><br><span class="line">&quot;1464.0708&quot;</span><br><span class="line">127.0.0.1:6379&gt; GEORADIUS china:city 110 30 1000 km # 以110，30 这个经纬度为中心，寻</span><br><span class="line">找方圆1000km内的城市</span><br><span class="line">1) &quot;chongqi&quot;</span><br><span class="line">2) &quot;xian&quot;</span><br><span class="line">3) &quot;shengzhen&quot;</span><br><span class="line">4) &quot;hangzhou&quot;</span><br><span class="line">127.0.0.1:6379&gt; GEORADIUS china:city 110 30 500 km</span><br><span class="line">1) &quot;chongqi&quot;</span><br><span class="line">2) &quot;xian&quot;</span><br><span class="line">127.0.0.1:6379&gt; GEORADIUS china:city 110 30 500 km withdist # 显示到中间距离的位置</span><br><span class="line">1) 1) &quot;chongqi&quot;</span><br><span class="line">2) &quot;341.9374&quot;</span><br><span class="line">2) 1) &quot;xian&quot;</span><br><span class="line">2) &quot;483.8340&quot;</span><br><span class="line">127.0.0.1:6379&gt; GEORADIUS china:city 110 30 500 km withcoord # 显示他人的定位信息</span><br><span class="line">1) 1) &quot;chongqi&quot;</span><br><span class="line">2) 1) &quot;106.49999767541885376&quot;</span><br><span class="line">2) &quot;29.52999957900659211&quot;</span><br><span class="line">2) 1) &quot;xian&quot;</span><br><span class="line">2) 1) &quot;108.96000176668167114&quot;</span><br><span class="line">2) &quot;34.25999964418929977&quot;</span><br><span class="line">127.0.0.1:6379&gt; GEORADIUS china:city 110 30 500 km withdist withcoord count 1 #</span><br><span class="line">筛选出指定的结果！</span><br><span class="line">1) 1) &quot;chongqi&quot;</span><br><span class="line">2) &quot;341.9374&quot;</span><br><span class="line">3) 1) &quot;106.49999767541885376&quot;</span><br><span class="line">2) &quot;29.52999957900659211&quot;</span><br><span class="line">127.0.0.1:6379&gt; GEORADIUS china:city 110 30 500 km withdist withcoord count 2</span><br><span class="line">1) 1) &quot;chongqi&quot;</span><br><span class="line">2) &quot;341.9374&quot;</span><br><span class="line">3) 1) &quot;106.49999767541885376&quot;</span><br><span class="line">2) &quot;29.52999957900659211&quot;</span><br><span class="line">2) 1) &quot;xian&quot;</span><br><span class="line">2) &quot;483.8340&quot;</span><br><span class="line">3) 1) &quot;108.96000176668167114&quot;</span><br><span class="line">2) &quot;34.25999964418929977&quot;</span><br><span class="line">GEORADIUSBYMEMBER</span><br><span class="line">GEOHASH 命令 - 返回一个或多个位置元素的 Geohash 表示</span><br><span class="line">该命令将返回11个字符的Geohash字符串!</span><br><span class="line">GEO 底层的实现原理其实就是 Zset！我们可以使用Zset命令来操作geo！</span><br></pre></td></tr></table></figure>
<h2 id="hyperloglog" id="Hyperloglog">Hyperloglog</h2>
<h3 id="%E4%BB%80%E4%B9%88%E6%98%AF%E5%9F%BA%E6%95%B0%EF%BC%9F" id="什么是基数？">什么是基数？</h3>
<p 1,3,5,7,8,7="">A</p>
<p 1，3,5,7,8="">B</p>
<p>基数（不重复的元素） = 5，可以接受误差！</p>
<h3 id="%E7%AE%80%E4%BB%8B-1" id="简介-v2">简介</h3>
<p>Redis 2.8.9 版本就更新了 Hyperloglog 数据结构！</p>
<p>Redis Hyperloglog 基数统计的算法！</p>
<p>优点：占用的内存是固定，2^64 不同的元素的技术，只需要废 12KB内存！如果要从内存角度来比较的<br />
话 Hyperloglog 首选！<br />
网页的 UV （一个人访问一个网站多次，但是还是算作一个人！）<br />
传统的方式， set 保存用户的id，然后就可以统计 set 中的元素数量作为标准判断 !<br />
这个方式如果保存大量的用户id，就会比较麻烦！我们的目的是为了计数，而不是保存用户id；<br />
0.81% 错误率！ 统计UV任务，可以忽略不计的！</p>
<h3 id="%E6%B5%8B%E8%AF%95%E4%BD%BF%E7%94%A8" id="测试使用">测试使用</h3>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; PFadd mykey a b c d e f g h i j # 创建第一组元素 mykey</span><br><span class="line">(integer) 1</span><br><span class="line">127.0.0.1:6379&gt; PFCOUNT mykey # 统计 mykey 元素的基数数量</span><br><span class="line">(integer) 10</span><br><span class="line">127.0.0.1:6379&gt; PFadd mykey2 i j z x c v b n m # 创建第二组元素 mykey2</span><br><span class="line">(integer) 1</span><br><span class="line">127.0.0.1:6379&gt; PFCOUNT mykey2</span><br><span class="line">(integer) 9</span><br><span class="line">127.0.0.1:6379&gt; PFMERGE mykey3 mykey mykey2 # 合并两组 mykey mykey2 &#x3D;&gt; mykey3 并集</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379&gt; PFCOUNT mykey3 # 看并集的数量！</span><br><span class="line">(integer) 15</span><br><span class="line">如果允许容错，那么一定可以使用 Hyperloglog ！</span><br><span class="line">如果不允许容错，就使用 set 或者自己的数据类型即可！</span><br></pre></td></tr></table></figure>
<h2 id="bitmap" id="Bitmap">Bitmap</h2>
<p>位存储<br />
统计用户信息，活跃，不活跃！ 登录 、 未登录！ 打卡，365打卡！ <strong>两个状态的，都可以使用</strong><br />
Bitmaps！<br />
Bitmap 位图，数据结构！ 都是操作二进制位来进行记录，就只有0 和 1 两个状态！<br />
365 天 = 365 bit 1字节 = 8bit 46 个字节左右！</p>
<h1 id="redis-%E5%91%BD%E4%BB%A4">Redis 命令</h1>
<h2 id="redis-%E5%91%BD%E4%BB%A4-1" id="Redis-命令">Redis 命令</h2>
<ul>
<li>语法<br />
Redis 客户端的基本语法为：</li>
</ul>
<p>$ redis-cli</p>
<pre><code>- 以下实例讲解了如何启动 redis 客户端：
</code></pre>
<p>启动 redis 服务器，打开终端并输入命令 redis-cli，该命令会连接本地的 redis 服务。</p>
<p>$ redis-cli<br />
redis 127.0.0.1:6379&gt;<br />
redis 127.0.0.1:6379&gt; PING</p>
<p>PONG<br />
在以上实例中我们连接到本地的 redis 服务并执行 PING 命令，该命令用于检测 redis 服务是否启动。</p>
<ul>
<li>
<p>在远程服务上执行命令</p>
<ul>
<li>$ redis-cli -h host -p port -a password</li>
</ul>
</li>
</ul>
<h2 id="redis-keys-%E5%91%BD%E4%BB%A4%E5%A4%A7%E5%85%A8" id="Redis-keys-命令大全">Redis keys 命令大全</h2>
<ul>
<li><a target="_blank" rel="noopener" href="https://redis.io/commands">https://redis.io/commands</a></li>
</ul>
<h2 id="redis-hyperloglog" id="Redis-HyperLogLog">Redis HyperLogLog</h2>
<ul>
<li>Redis 在 2.8.9 版本添加了 HyperLogLog 结构。</li>
</ul>
<p>Redis HyperLogLog 是用来做基数统计的算法，HyperLogLog 的优点是，在输入元素的数量或者体积非常非常大时，计算基数所需的空间总是固定 的、并且是很小的。</p>
<p>在 Redis 里面，每个 HyperLogLog 键只需要花费 12 KB 内存，就可以计算接近 2^64 个不同元素的基 数。这和计算基数时，元素越多耗费内存就越多的集合形成鲜明对比。</p>
<p>但是，因为 HyperLogLog 只会根据输入元素来计算基数，而不会储存输入元素本身，所以 HyperLogLog 不能像集合那样，返回输入的各个元素。</p>
<ul>
<li>
<p>什么是基数?<br />
比如数据集 {1, 3, 5, 7, 5, 7, 8}， 那么这个数据集的基数集为 {1, 3, 5 ,7, 8}, 基数(不重复元素)为5。 基数估计就是在误差可接受的范围内，快速计算基数。</p>
</li>
<li>
<p>PFADD runoobkey &quot;redis&quot;</p>
<ul>
<li>PFCOUNT runoobkey</li>
</ul>
</li>
</ul>
<h2 id="redis-%E5%8F%91%E5%B8%83%E8%AE%A2%E9%98%85" id="Redis-发布订阅">Redis 发布订阅</h2>
<ul>
<li>Redis 发布订阅 (pub/sub) 是一种消息通信模式：发送者 (pub) 发送消息，订阅者 (sub) 接收消息。</li>
</ul>
<p>Redis 客户端可以订阅任意数量的频道。</p>
<p>订阅/发布消息图： 第一个：消息发送者， 第二个：频道 第三个：消息订阅者！</p>
<p><img src="https://gitee.com/mychimei/picture/raw/master/work/image-20210712141326489.png" alt="image-20210712141326489" /></p>
<p>下图展示了频道 channel1 ， 以及订阅这个频道的三个客户端 —— client2 、 client5 和 client1 之间的 关系：</p>
<p><img src="https://gitee.com/mychimei/picture/raw/master/work/image-20210712141343138.png" alt="image-20210712141343138" /></p>
<p>当有新消息通过 PUBLISH 命令发送给频道 channel1 时， 这个消息就会被发送给订阅它的三个客户 端：</p>
<p><img src="https://gitee.com/mychimei/picture/raw/master/work/image-20210712141358255.png" alt="image-20210712141358255" /></p>
<p>命令</p>
<p>这些命令被广泛用于构建即时通信应用，比如网络聊天室(chatroom)和实时广播、实时提醒等</p>
<p><img src="https://gitee.com/mychimei/picture/raw/master/work/image-20210712141420254.png" alt="image-20210712141420254" /></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">测试</span><br><span class="line">订阅端：</span><br><span class="line">127.0.0.1:6379&gt; SUBSCRIBE kuangshenshuo # 订阅一个频道 kuangshenshuo</span><br><span class="line">Reading messages... (press Ctrl-C to quit)</span><br><span class="line">1) &quot;subscribe&quot;</span><br><span class="line">2) &quot;kuangshenshuo&quot;</span><br><span class="line">3) (integer) 1</span><br><span class="line"># 等待读取推送的信息</span><br><span class="line">1) &quot;message&quot; # 消息</span><br><span class="line">2) &quot;kuangshenshuo&quot; # 那个频道的消息</span><br><span class="line">3) &quot;hello,kuangshen&quot; # 消息的具体内容</span><br><span class="line">1) &quot;message&quot;</span><br><span class="line">2) &quot;kuangshenshuo&quot;</span><br><span class="line">3) &quot;hello,redis&quot;</span><br><span class="line">发送端：</span><br><span class="line">127.0.0.1:6379&gt; PUBLISH kuangshenshuo &quot;hello,kuangshen&quot; # 发布者发布消息到频道！</span><br><span class="line">(integer) 1</span><br><span class="line">127.0.0.1:6379&gt; PUBLISH kuangshenshuo &quot;hello,redis&quot; # 发布者发布消息到频道！</span><br><span class="line">(integer) 1</span><br><span class="line">127.0.0.1:6379&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>原理<br />
Redis是使用C实现的，通过分析 Redis 源码里的 pubsub.c 文件，了解发布和订阅机制的底层实现，借此加深对 Redis 的理解。</p>
<p>Redis 通过 PUBLISH 、SUBSCRIBE 和 PSUBSCRIBE 等命令实现发布和订阅功能。 微信： 通过 SUBSCRIBE 命令订阅某频道后，redis-server 里维护了一个字典，字典的键就是一个个 频道！， 而字典的值则是一个链表，链表中保存了所有订阅这个 channel 的客户端。SUBSCRIBE 命令的关键， 就是将客户端添加到给定 channel 的订阅链表中。</p>
<p>通过 PUBLISH 命令向订阅者发送消息，redis-server 会使用给定的频道作为键，在它所维护的 channel 字典中查找记录了订阅这个频道的所有客户端的链表，遍历这个链表，将消息发布给所有订阅者。Pub/Sub 从字面上理解就是发布（Publish）与订阅（Subscribe），在Redis中，你可以设定对某一个 key值进行消息发布及消息订阅，当一个key值上进行了消息发布后，所有订阅它的客户端都会收到相应 的消息。这一功能最明显的用法就是用作实时消息系统，比如普通的即时聊天，群聊等功能。</p>
<p>使用场景：</p>
<p>1、实时消息系统！</p>
<p>2、事实聊天！（频道当做聊天室，将信息回显给所有人即可！）</p>
<p>3、订阅，关注系统都是可以的！ 稍微复杂的场景我们就会使用 消息中间件 MQ （）</p>
<ul>
<li>
<p>SUBSCRIBE runoobChat</p>
<ul>
<li>PUBLISH runoobChat &quot;Redis PUBLISH test&quot;</li>
<li>重新开启个 redis 客户端在同一个频道 runoobChat 发布两次消息，订阅者就能接收到消息。</li>
</ul>
</li>
</ul>
<h2 id="redis-%E4%BA%8B%E5%8A%A1(%E4%B8%8D%E5%9B%9E%E6%BB%9A%EF%BC%8C%E6%89%B9%E9%87%8F%E6%89%A7%E8%A1%8C%E4%BD%9C%E7%94%A8)" id="Redis-事务-不回滚，批量执行作用">Redis 事务(不回滚，批量执行作用)</h2>
<ul>
<li>Redis 事务可以一次执行多个命令， 并且带有以下三个重要的保证：</li>
</ul>
<p>批量操作在发送 EXEC 命令前被放入队列缓存。<br />
收到 EXEC 命令后进入事务执行，<strong>事务中任意命令执行失败，其余的命令依然被执行,代码错误，所有命令都不会执行</strong>。<br />
在事务执行过程，其他客户端提交的命令请求不会插入到事务执行命令序列中。<strong>DISCARD放弃事物，所有不执行</strong><br />
一个事务从开始到执行会经历以下三个阶段：</p>
<p><strong>开始事务。</strong><br />
<strong>命令入队。</strong><br />
<strong>执行事务。</strong></p>
<ul>
<li>
<p><strong>MULTI</strong> 开始一个事务</p>
</li>
<li>
<p>将多个命令入队到事务中</p>
</li>
<li>
<p>SET book-name &quot;Mastering C++ in 21 days&quot;</p>
</li>
<li>
<p>GET book-name</p>
</li>
<li>
<p>SADD tag &quot;C++&quot; &quot;Programming&quot; &quot;Mastering Series&quot;</p>
</li>
<li>
<p>SMEMBERS tag</p>
</li>
<li>
<p><strong>EXEC/DISCARD</strong></p>
</li>
<li>
<p><strong>单个 Redis 命令的执行是原子性的，但 Redis 没有在事务上增加任何维持原子性的机制，所以 Redis 事务的执行并不是原子性的。</strong></p>
</li>
</ul>
<p>事务可以理解为一个打包的批量执行脚本，但批量指令并非原子化的操作，中间某条指令的失败不会导致前面已做指令的回滚，也不会造成后续的指令不做。</p>
<p>悲观锁：<br />
很悲观，认为什么时候都会出问题，无论做什么都会加锁！<br />
乐观锁：<br />
很乐观，认为什么时候都不会出问题，所以不会上锁！ 更新数据的时候去判断一下，在此期间是否有人修改过这个数据，<br />
获取version<br />
更新的时候比较 version<br />
Redis测监视测试<br />
正常执行成功！<br />
测试多线程修改值 , 使用watch 可以当做redis的乐观锁操作！</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; set money 100</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379&gt; set out 0</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379&gt; watch money # 监视 money 对象</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379&gt; multi # 事务正常结束，数据期间没有发生变动，这个时候就正常执行成功！</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379&gt; DECRBY money 20</span><br><span class="line">QUEUED</span><br><span class="line">127.0.0.1:6379&gt; INCRBY out 20</span><br><span class="line">QUEUED</span><br><span class="line">127.0.0.1:6379&gt; exec</span><br><span class="line">1) (integer) 80</span><br><span class="line">2) (integer) 20</span><br></pre></td></tr></table></figure>
<p>测试多线程修改值 , 使用watch 可以当做redis的乐观锁操作！</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; watch money # 监视 money</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379&gt; multi</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379&gt; DECRBY money 10</span><br><span class="line">QUEUED</span><br><span class="line">127.0.0.1:6379&gt; INCRBY out 10</span><br><span class="line">QUEUED</span><br><span class="line">127.0.0.1:6379&gt; exec # 执行之前，另外一个线程，修改了我们的值，这个时候，就会导致事务执行失</span><br><span class="line">败！</span><br><span class="line">(nil)</span><br></pre></td></tr></table></figure>
<h2 id="redis-%E8%84%9A%E6%9C%AC" id="Redis-脚本">Redis 脚本</h2>
<ul>
<li>
<p>Redis 脚本使用 Lua 解释器来执行脚本。 Redis 2.6 版本通过内嵌支持 Lua 环境。执行脚本的常用命令为 EVAL。</p>
</li>
<li>
<p>EVAL script numkeys key [key ...] arg [arg ...]</p>
<ul>
<li>EVAL &quot;return {KEYS[1],KEYS[2],ARGV[1],ARGV[2]}&quot; 2 key1 key2 first second</li>
</ul>
</li>
</ul>
<h2 id="redis-%E8%BF%9E%E6%8E%A5" id="Redis-连接">Redis 连接</h2>
<ul>
<li>
<p>Redis 连接命令主要是用于连接 redis 服务。</p>
<ul>
<li>
<p>客户端如何通过密码验证连接到 redis 服务，并检测服务是否在运行：</p>
<ul>
<li>
<p>AUTH &quot;password&quot;</p>
<ul>
<li>PING</li>
</ul>
</li>
</ul>
</li>
<li>
<p>1 AUTH password<br />
验证密码是否正确<br />
2	ECHO message<br />
打印字符串<br />
3	PING<br />
查看服务是否运行<br />
4	QUIT<br />
关闭当前连接<br />
5	SELECT index<br />
切换到指定的数据库</p>
</li>
</ul>
</li>
</ul>
<h2 id="redis%E6%9C%8D%E5%8A%A1%E5%99%A8" id="Redis服务器">Redis服务器</h2>
<ul>
<li>Redis服务器命令主要是用于管理redis服务</li>
</ul>
<h2 id="redis-geo" id="Redis-GEO">Redis GEO</h2>
<ul>
<li>Redis GEO 主要用于存储地理位置信息，并对存储的信息进行操作，该功能在 Redis 3.2 版本新增。</li>
</ul>
<p>Redis GEO 操作方法有：</p>
<p>geoadd：添加地理位置的坐标。<br />
geopos：获取地理位置的坐标。<br />
geodist：计算两个位置之间的距离。<br />
georadius：根据用户给定的经纬度坐标来获取指定范围内的地理位置集合。<br />
georadiusbymember：根据储存在位置集合里面的某个地点获取指定范围内的地理位置集合。<br />
geohash：返回一个或多个位置对象的 geohash 值。</p>
<ul>
<li>geoadd<br />
geoadd 用于存储指定的地理空间位置，可以将一个或多个经度(longitude)、纬度(latitude)、位置名称(member)添加到指定的 key 中。</li>
</ul>
<p>geoadd 语法格式如下：</p>
<p>GEOADD key longitude latitude member [longitude latitude member ...]</p>
<pre><code>- GEOADD Sicily 13.361389 38.115556 &quot;Palermo&quot; 15.087269 37.502669 &quot;Catania&quot;

	- GEODIST Sicily Palermo Catania

		- geodist 用于返回两个给定位置之间的距离。
</code></pre>
<p>geodist 语法格式如下：</p>
<p>GEODIST key member1 member2 [m|km|ft|mi]<br />
member1 member2 为两个地理位置。</p>
<p>最后一个距离单位参数说明：</p>
<p>m ：米，默认单位。<br />
km ：千米。<br />
mi ：英里。<br />
ft ：英尺。</p>
<pre><code>	- GEORADIUS Sicily 15 37 100 km

		- georadius 以给定的经纬度为中心， 返回键包含的位置元素当中， 与中心的距离不超过给定最大距离的所有位置元素。
</code></pre>
<p>georadiusbymember 和 GEORADIUS 命令一样， 都可以找出位于指定范围内的元素， 但是 georadiusbymember 的中心点是由给定的位置元素决定的， 而不是使用经度和纬度来决定中心点。</p>
<p>georadius 与 georadiusbymember 语法格式如下：</p>
<p>GEORADIUS key longitude latitude radius m|km|ft|mi [WITHCOORD] [WITHDIST] [WITHHASH] [COUNT count] [ASC|DESC] [STORE key] [STOREDIST key]<br />
GEORADIUSBYMEMBER key member radius m|km|ft|mi [WITHCOORD] [WITHDIST] [WITHHASH] [COUNT count] [ASC|DESC] [STORE key] [STOREDIST key]<br />
参数说明：</p>
<p>m ：米，默认单位。<br />
km ：千米。<br />
mi ：英里。<br />
ft ：英尺。<br />
WITHDIST: 在返回位置元素的同时， 将位置元素与中心之间的距离也一并返回。<br />
WITHCOORD: 将位置元素的经度和维度也一并返回。<br />
WITHHASH: 以 52 位有符号整数的形式， 返回位置元素经过原始 geohash 编码的有序集合分值。 这个选项主要用于底层应用或者调试， 实际中的作用并不大。<br />
COUNT 限定返回的记录数。<br />
ASC: 查找结果根据距离从近到远排序。<br />
DESC: 查找结果根据从远到近排序。</p>
<pre><code>	- GEOPOS Sicily Palermo Catania NonExisting

		- geopos 用于从给定的 key 里返回所有指定名称(member)的位置（经度和纬度），不存在的返回 nil。
</code></pre>
<p>geopos 语法格式如下：</p>
<p>GEOPOS key member [member ...]</p>
<pre><code>	- GEOHASH Sicily Palermo Catania

		- geohash
</code></pre>
<p>Redis GEO 使用 geohash 来保存地理位置的坐标。</p>
<p>geohash 用于获取一个或多个位置元素的 geohash 值。</p>
<p>geohash 语法格式如下：</p>
<p>GEOHASH key member [member ...]</p>
<h2 id="redis-stream" id="Redis-Stream">Redis Stream</h2>
<ul>
<li>Redis Stream 是 Redis 5.0 版本新增加的数据结构。</li>
</ul>
<p>Redis Stream 主要用于消息队列（MQ，Message Queue），Redis 本身是有一个 Redis 发布订阅 (pub/sub) 来实现消息队列的功能，但它有个缺点就是消息无法持久化，如果出现网络断开、Redis 宕机等，消息就会被丢弃。</p>
<p>简单来说发布订阅 (pub/sub) 可以分发消息，但无法记录历史消息。</p>
<p>而 Redis Stream 提供了消息的持久化和主备复制功能，可以让任何客户端访问任何时刻的数据，并且能记住每一个客户端的访问位置，还能保证消息不丢失。</p>
<p>Redis Stream 的结构如下所示，它有一个消息链表，将所有加入的消息都串起来，每个消息都有一个唯一的 ID 和对应的内容：</p>
<pre><code>- 子主题 1
- 每个 Stream 都有唯一的名称，它就是 Redis 的 key，在我们首次使用 xadd 指令追加消息时自动创建。
</code></pre>
<p>上图解析：</p>
<p>Consumer Group ：消费组，使用 XGROUP CREATE 命令创建，一个消费组有多个消费者(Consumer)。<br />
last_delivered_id ：游标，每个消费组会有个游标 last_delivered_id，任意一个消费者读取了消息都会使游标 last_delivered_id 往前移动。<br />
pending_ids ：消费者(Consumer)的状态变量，作用是维护消费者的未确认的 id。 pending_ids 记录了当前已经被客户端读取的消息，但是还没有 ack (Acknowledge character：确认字符）。<br />
- 消息队列相关命令：</p>
<p>XADD - 添加消息到末尾<br />
XTRIM - 对流进行修剪，限制长度<br />
XDEL - 删除消息<br />
XLEN - 获取流包含的元素数量，即消息长度<br />
XRANGE - 获取消息列表，会自动过滤已经删除的消息<br />
XREVRANGE - 反向获取消息列表，ID 从大到小<br />
XREAD - 以阻塞或非阻塞方式获取消息列表<br />
消费者组相关命令：</p>
<p>XGROUP CREATE - 创建消费者组<br />
XREADGROUP GROUP - 读取消费者组中的消息<br />
XACK - 将消息标记为&quot;已处理&quot;<br />
XGROUP SETID - 为消费者组设置新的最后递送消息ID<br />
XGROUP DELCONSUMER - 删除消费者<br />
XGROUP DESTROY - 删除消费者组<br />
XPENDING - 显示待处理消息的相关信息<br />
XCLAIM - 转移消息的归属权<br />
XINFO - 查看流和消费者组的相关信息；<br />
XINFO GROUPS - 打印消费者组的信息；<br />
XINFO STREAM - 打印流信息</p>
<ul>
<li>
<p>XADD</p>
<ul>
<li>使用 XADD 向队列添加消息，如果指定的队列不存在，则创建一个队列，XADD 语法格式：</li>
</ul>
</li>
</ul>
<p>XADD key ID field value [field value ...]<br />
key ：队列名称，如果不存在就创建<br />
ID ：消息 id，我们使用 * 表示由 redis 生成，可以自定义，但是要自己保证递增性。<br />
field value ： 记录。<br />
- XADD mystream * name Sara surname OConnor</p>
<pre><code>	- XADD mystream * field1 value1 field2 value2 field3 value3

		- XLEN mystream

			- XRANGE mystream - +
</code></pre>
<ul>
<li>
<p>XTRIM</p>
<ul>
<li>使用 XTRIM 对流进行修剪，限制长度， 语法格式：</li>
</ul>
</li>
</ul>
<p>XTRIM key MAXLEN [~] count<br />
key ：队列名称<br />
MAXLEN ：长度<br />
count ：数量<br />
- XADD mystream * field1 A field2 B field3 C field4 D</p>
<pre><code>	- XTRIM mystream MAXLEN 2

		- XRANGE mystream - +
</code></pre>
<ul>
<li>
<p>XDEL</p>
<ul>
<li>使用 XDEL 删除消息，语法格式：</li>
</ul>
</li>
</ul>
<p>XDEL key ID [ID ...]<br />
key：队列名称<br />
ID ：消息 ID<br />
使用 XDEL 删除消息，语法格式：</p>
<ul>
<li>
<p>XLEN</p>
<ul>
<li>使用 XLEN 获取流包含的元素数量，即消息长度，语法格式：</li>
</ul>
</li>
</ul>
<p>XLEN key<br />
key：队列名称<br />
- XADD mystream * item 1</p>
<pre><code>	- XLEN mystream
</code></pre>
<ul>
<li>
<p>XRANGE</p>
<ul>
<li>使用 XRANGE 获取消息列表，会自动过滤已经删除的消息 ，语法格式：</li>
</ul>
</li>
</ul>
<p>XRANGE key start end [COUNT count]<br />
key ：队列名<br />
start ：开始值， - 表示最小值<br />
end ：结束值， + 表示最大值<br />
count ：数量<br />
- XADD writers * name Ngozi surname Adichie</p>
<pre><code>	- XLEN writers

		- XRANGE writers - + COUNT 2
</code></pre>
<ul>
<li>
<p>XREVRANGE</p>
<ul>
<li>使用 XREVRANGE 获取消息列表，会自动过滤已经删除的消息 ，语法格式：</li>
</ul>
</li>
</ul>
<p>XREVRANGE key end start [COUNT count]<br />
key ：队列名<br />
end ：结束值， + 表示最大值<br />
start ：开始值， - 表示最小值<br />
count ：数量<br />
- XADD writers * name Virginia surname Woolf</p>
<pre><code>	- XLEN writers

		- XREVRANGE writers + - COUNT 1
</code></pre>
<ul>
<li>
<p>XREAD</p>
<ul>
<li>使用 XREAD 以阻塞或非阻塞方式获取消息列表 ，语法格式：</li>
</ul>
</li>
</ul>
<p>XREAD [COUNT count] [BLOCK milliseconds] STREAMS key [key ...] id [id ...]<br />
count ：数量<br />
milliseconds ：可选，阻塞毫秒数，没有设置就是非阻塞模式<br />
key ：队列名<br />
id ：消息 ID<br />
- # 从 Stream 头部读取两条消息</p>
<blockquote>
<p>XREAD COUNT 2 STREAMS mystream writers 0-0 0-0</p>
</blockquote>
<ul>
<li>
<p>XGROUP CREATE</p>
<ul>
<li>使用 XGROUP CREATE 创建消费者组，语法格式：</li>
</ul>
</li>
</ul>
<p>XGROUP [CREATE key groupname id-or-$] [SETID key groupname id-or-$] [DESTROY key groupname] [DELCONSUMER key groupname consumername]<br />
key ：队列名称，如果不存在就创建<br />
groupname ：组名。<br />
$ ： 表示从尾部开始消费，只接受新消息，当前 Stream 消息会全部忽略。<br />
从头开始消费:</p>
<p>XGROUP CREATE mystream consumer-group-name 0-0<br />
从尾部开始消费:</p>
<p>XGROUP CREATE mystream consumer-group-name $</p>
<ul>
<li>
<p>XREADGROUP GROUP</p>
<ul>
<li>使用 XREADGROUP GROUP 读取消费组中的消息，语法格式：</li>
</ul>
</li>
</ul>
<p>XREADGROUP GROUP group consumer [COUNT count] [BLOCK milliseconds] [NOACK] STREAMS key [key ...] ID [ID ...]<br />
group ：消费组名<br />
consumer ：消费者名。<br />
count ： 读取数量。<br />
milliseconds ： 阻塞毫秒数。<br />
key ： 队列名。<br />
ID ： 消息 ID。<br />
XREADGROUP GROUP consumer-group-name consumer-name COUNT 1 STREAMS mystream &gt;</p>
<h1 id="redis-%E9%AB%98%E7%BA%A7%E6%95%99%E7%A8%8B">Redis 高级教程</h1>
<h2 id="redis%E4%B8%BB%E4%BB%8E%E5%A4%8D%E5%88%B6" id="Redis主从复制">Redis主从复制</h2>
<h3 id="%E6%A6%82%E5%BF%B5" id="概念">概念</h3>
<p>主从复制，是指将一台Redis服务器的数据，复制到其他的Redis服务器。前者称为主节点 (master/leader)，后者称为从节点(slave/follower)；数据的复制是单向的，只能由主节点到从节点。 Master以写为主，Slave 以读为主。 默认情况下，每台Redis服务器都是主节点； 且一个主节点可以有多个从节点(或没有从节点)，但一个从节点只能有一个主节点。</p>
<h3 id="%E4%B8%BB%E4%BB%8E%E5%A4%8D%E5%88%B6%E7%9A%84%E4%BD%9C%E7%94%A8%E4%B8%BB%E8%A6%81%E5%8C%85%E6%8B%AC%EF%BC%9A" id="主从复制的作用主要包括：">主从复制的作用主要包括：</h3>
<p>1、数据冗余：主从复制实现了数据的热备份，是持久化之外的一种数据冗余方式。</p>
<p>2、故障恢复：当主节点出现问题时，可以由从节点提供服务，实现快速的故障恢复；实际上是一种服务 的冗余。</p>
<p>3、负载均衡：在主从复制的基础上，配合读写分离，可以由主节点提供写服务，由从节点提供读服务 （即写Redis数据时应用连接主节点，读Redis数据时应用连接从节点），分担服务器负载；尤其是在写 少读多的场景下，通过多个从节点分担读负载，可以大大提高Redis服务器的并发量。</p>
<p>4、高可用（集群）基石：除了上述作用以外，主从复制还是哨兵和集群能够实施的基础，因此说主从复 制是Redis高可用的基础。</p>
<p><strong>一般来说，要将Redis运用于工程项目中，只使用一台Redis是万万不能的（宕机），原因如下：</strong></p>
<p>1、从结构上，单个Redis服务器会发生单点故障，并且一台服务器需要处理所有的请求负载，压力较 大；</p>
<p>2、从容量上，单个Redis服务器内存容量有限，就算一台Redis服务器内存容量为256G，也不能将所有 内存用作Redis存储内存，一般来说，单台Redis最大使用内存不应该超过20G。 电商网站上的商品，一般都是一次上传，无数次浏览的，说专业点也就是&quot;多读少写&quot;。 对于这种场景，我们可以使如下这种架构：</p>
<p><img src="https://gitee.com/mychimei/picture/raw/master/work/image-20210712141739520.png" alt="image-20210712141739520" /></p>
<p>主从复制，读写分离！ 80% 的情况下都是在进行读操作！减缓服务器的压力！架构中经常使用！ 一主 二从！ 只要在公司中，主从复制就是必须要使用的，因为在真实的项目中不可能单机使用Redis！</p>
<h3 id="%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE" id="环境配置">环境配置</h3>
<p>只配置从库，不用配置主库！</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; info replication # 查看当前库的信息</span><br><span class="line"># Replication</span><br><span class="line">role:master # 角色 master</span><br><span class="line">connected_slaves:0 # 没有从机</span><br><span class="line">master_replid:b63c90e6c501143759cb0e7f450bd1eb0c70882a</span><br><span class="line">master_replid2:0000000000000000000000000000000000000000</span><br><span class="line">master_repl_offset:0</span><br><span class="line">second_repl_offset:-1</span><br><span class="line">repl_backlog_active:0</span><br><span class="line">repl_backlog_size:1048576</span><br><span class="line">repl_backlog_first_byte_offset:0</span><br><span class="line">repl_backlog_histlen:0</span><br></pre></td></tr></table></figure>
<p>复制3个配置文件，然后修改对应的信息 1、端口 2、pid 名字 3、log文件名字 4、dump.rdb 名字 修改完毕之后，启动我们的3个redis服务器，可以通过进程信息查看！</p>
<h2 id="%E4%B8%80%E4%B8%BB%E4%BA%8C%E4%BB%8E" id="一主二从">一主二从</h2>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line">默认情况下，每台Redis服务器都是主节点； 我们一般情况下只用配置从机就好了！</span><br><span class="line">认老大！ 一主 （79）二从（80，81）</span><br><span class="line">127.0.0.1:6379&gt; info replication # 查看当前库的信息</span><br><span class="line"># Replication</span><br><span class="line">role:master # 角色 master</span><br><span class="line">connected_slaves:0 # 没有从机</span><br><span class="line">master_replid:b63c90e6c501143759cb0e7f450bd1eb0c70882a</span><br><span class="line">master_replid2:0000000000000000000000000000000000000000</span><br><span class="line">master_repl_offset:0</span><br><span class="line">second_repl_offset:-1</span><br><span class="line">repl_backlog_active:0</span><br><span class="line">repl_backlog_size:1048576</span><br><span class="line">repl_backlog_first_byte_offset:0</span><br><span class="line">repl_backlog_histlen:0</span><br><span class="line">127.0.0.1:6380&gt; SLAVEOF 127.0.0.1 6379 # SLAVEOF host 6379 找谁当自己的老大！</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6380&gt; info replication</span><br><span class="line"># Replication</span><br><span class="line">role:slave # 当前角色是从机</span><br><span class="line">master_host:127.0.0.1 # 可以的看到主机的信息</span><br><span class="line">master_port:6379</span><br><span class="line">master_link_status:up</span><br><span class="line">master_last_io_seconds_ago:3</span><br><span class="line">master_sync_in_progress:0</span><br><span class="line">slave_repl_offset:14</span><br><span class="line">slave_priority:100</span><br><span class="line">slave_read_only:1</span><br><span class="line">connected_slaves:0</span><br><span class="line">master_replid:a81be8dd257636b2d3e7a9f595e69d73ff03774e</span><br><span class="line">master_replid2:0000000000000000000000000000000000000000</span><br><span class="line">master_repl_offset:14</span><br><span class="line">second_repl_offset:-1</span><br><span class="line">repl_backlog_active:1</span><br><span class="line">repl_backlog_size:1048576</span><br><span class="line">repl_backlog_first_byte_offset:1</span><br><span class="line">repl_backlog_histlen:14</span><br><span class="line"># 在主机中查看！</span><br><span class="line">127.0.0.1:6379&gt; info replication</span><br><span class="line"># Replication</span><br><span class="line">role:master</span><br><span class="line">connected_slaves:1 # 多了从机的配置</span><br><span class="line">slave0:ip&#x3D;127.0.0.1,port&#x3D;6380,state&#x3D;online,offset&#x3D;42,lag&#x3D;1 # 多了从机的配置</span><br><span class="line">master_replid:a81be8dd257636b2d3e7a9f595e69d73ff03774e</span><br><span class="line">master_replid2:0000000000000000000000000000000000000000</span><br><span class="line">master_repl_offset:42</span><br><span class="line">second_repl_offset:-1</span><br><span class="line">repl_backlog_active:1</span><br><span class="line">repl_backlog_size:1048576</span><br><span class="line">repl_backlog_first_byte_offset:1</span><br><span class="line">repl_backlog_histlen:42</span><br><span class="line">如果两个都配置完了，就是有两个从机的</span><br><span class="line">真实的从主配置应该在配置文件中配置，这样的话是永久的，我们这里使用的是命令，暂时的！</span><br></pre></td></tr></table></figure>
<h3 id="%E7%BB%86%E8%8A%82" id="细节">细节</h3>
<p>主机可以写，从机不能写只能读！主机中的所有信息和数据，都会自动被从机保存！</p>
<p>测试：主机断开连接，从机依旧连接到主机的，但是没有写操作，这个时候，主机如果回来了，从机依 旧可以直接获取到主机写的信息！ 如果是使用命令行，来配置的主从，这个时候如果重启了，就会变回主机！只要变为从机，立马就会从 主机中获取值！</p>
<h3 id="%E5%A4%8D%E5%88%B6%E5%8E%9F%E7%90%86" id="复制原理">复制原理</h3>
<p>Slave 启动成功连接到 master 后会发送一个sync同步命令 Master 接到命令，启动后台的存盘进程，同时收集所有接收到的用于修改数据集命令，在后台进程执行 完毕之后，master将传送整个数据文件到slave，并完成一次完全同步。 全量复制：而slave服务在接收到数据库文件数据后，将其存盘并加载到内存中。 增量复制：Master 继续将新的所有收集到的修改命令依次传给slave，完成同步 但是只要是重新连接master，一次完全同步（全量复制）将被自动执行！ 我们的数据一定可以在从机中 看到！</p>
<h3 id="%E5%B1%82%E5%B1%82%E9%93%BE%E8%B7%AF" id="层层链路">层层链路</h3>
<p>上一个M链接下一个 S！这时候也可以完成我们的主从复制！如果没有老大了，这个时候能不能选择一个老大出来呢？ 手动！谋朝篡位 如果主机断开了连接，我们可以使用 SLAVEOF no one 让自己变成主机！其他的节点就可以手动连 接到最新的这个主节点（手动）！如果这个时候老大修复了，那就重新连接！</p>
<p><img src="https://gitee.com/mychimei/picture/raw/master/work/image-20210712142049947.png" alt="image-20210712142049947" /></p>
<h2 id="%E5%93%A8%E5%85%B5%E6%A8%A1%E5%BC%8F" id="哨兵模式">哨兵模式</h2>
<h3 id="%E6%A6%82%E8%BF%B0" id="概述">概述</h3>
<p>（自动选举老大的模式） 主从切换技术的方法是：当主服务器宕机后，需要手动把一台从服务器切换为主服务器，这就需要人工 干预，费事费力，还会造成一段时间内服务不可用。这不是一种推荐的方式，更多时候，我们优先考虑 哨兵模式。Redis从2.8开始正式提供了Sentinel（哨兵） 架构来解决这个问题。 谋朝篡位的自动版，能够后台监控主机是否故障，如果故障了根据投票数自动将从库转换为主库。 哨兵模式是一种特殊的模式，首先Redis提供了哨兵的命令，哨兵是一个独立的进程，作为进程，它会独 立运行。其原理是哨兵通过发送命令，等待Redis服务器响应，从而监控运行的多个Redis实例。</p>
<p><strong>这里的哨兵有两个作用</strong></p>
<p>通过发送命令，让Redis服务器返回监控其运行状态，包括主服务器和从服务器。 当哨兵监测到master宕机，会自动将slave切换成master，然后通过发布订阅模式通知其他的从服 务器，修改配置文件，让它们切换主机。 然而一个哨兵进程对Redis服务器进行监控，可能会出现问题，为此，我们可以使用多个哨兵进行监控。 各个哨兵之间还会进行监控，这样就形成了多哨兵模式。</p>
<p>假设主服务器宕机，哨兵1先检测到这个结果，系统并不会马上进行failover过程，仅仅是哨兵1主观的认 为主服务器不可用，这个现象成为主观下线。当后面的哨兵也检测到主服务器不可用，并且数量达到一 定值时，那么哨兵之间就会进行一次投票，投票的结果由一个哨兵发起，进行failover[故障转移]操作。 切换成功后，就会通过发布订阅模式，让各个哨兵把自己监控的从服务器实现切换主机，这个过程称为 客观下线。</p>
<p><img src="https://gitee.com/mychimei/picture/raw/master/work/image-20210712142213507.png" alt="image-20210712142213507" /></p>
<h3 id="%E6%B5%8B%E8%AF%95" id="测试">测试</h3>
<p>我们目前的状态是 一主二从！</p>
<p>1、配置哨兵配置文件 sentinel.conf</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># sentinel monitor 被监控的名称 host port 1</span><br><span class="line">sentinel monitor myredis 127.0.0.1 6379 1</span><br></pre></td></tr></table></figure>
<p>后面的这个数字1，代表主机挂了，slave投票看让谁接替成为主机，票数最多的，就会成为主机！</p>
<p>2、启动哨兵！</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">[root@kuangshen bin]# redis-sentinel kconfig&#x2F;sentinel.conf</span><br><span class="line">26607:X 31 Mar 2020 21:13:10.027 # oO0OoO0OoO0Oo Redis is starting oO0OoO0OoO0Oo</span><br><span class="line">26607:X 31 Mar 2020 21:13:10.027 # Redis version&#x3D;5.0.8, bits&#x3D;64,</span><br><span class="line">commit&#x3D;00000000, modified&#x3D;0, pid&#x3D;26607, just started</span><br><span class="line">26607:X 31 Mar 2020 21:13:10.027 # Configuration loaded</span><br><span class="line">_._</span><br><span class="line">_.-&#96;&#96;__ &#39;&#39;-._</span><br><span class="line">_.-&#96;&#96; &#96;. &#96;_. &#39;&#39;-._ Redis 5.0.8 (00000000&#x2F;0) 64 bit</span><br><span class="line">.-&#96;&#96; .-&#96;&#96;&#96;. &#96;&#96;&#96;\&#x2F; _.,_ &#39;&#39;-._</span><br><span class="line">( &#39; , .-&#96; | &#96;, ) Running in sentinel mode</span><br><span class="line">|&#96;-._&#96;-...-&#96; __...-.&#96;&#96;-._|&#39;&#96; _.-&#39;| Port: 26379</span><br><span class="line">| &#96;-._ &#96;._ &#x2F; _.-&#39; | PID: 26607</span><br><span class="line">&#96;-._ &#96;-._ &#96;-.&#x2F; _.-&#39; _.-&#39;</span><br><span class="line">|&#96;-._&#96;-._ &#96;-.__.-&#39; _.-&#39;_.-&#39;|</span><br><span class="line">| &#96;-._&#96;-._ _.-&#39;_.-&#39; | http:&#x2F;&#x2F;redis.io</span><br><span class="line">&#96;-._ &#96;-._&#96;-.__.-&#39;_.-&#39; _.-&#39;</span><br><span class="line">|&#96;-._&#96;-._ &#96;-.__.-&#39; _.-&#39;_.-&#39;|</span><br><span class="line">| &#96;-._&#96;-._ _.-&#39;_.-&#39; |</span><br><span class="line">&#96;-._ &#96;-._&#96;-.__.-&#39;_.-&#39; _.-&#39;</span><br><span class="line">&#96;-._ &#96;-.__.-&#39; _.-&#39;</span><br><span class="line">&#96;-._ _.-&#39;</span><br><span class="line">&#96;-.__.-&#39;</span><br><span class="line">26607:X 31 Mar 2020 21:13:10.029 # WARNING: The TCP backlog setting of 511</span><br><span class="line">cannot be enforced because &#x2F;proc&#x2F;sys&#x2F;net&#x2F;core&#x2F;somaxconn is set to the lower value</span><br><span class="line">of 128.</span><br><span class="line">26607:X 31 Mar 2020 21:13:10.031 # Sentinel ID is</span><br><span class="line">4c780da7e22d2aebe3bc20c333746f202ce72996</span><br><span class="line">26607:X 31 Mar 2020 21:13:10.031 # +monitor master myredis 127.0.0.1 6379 quorum</span><br><span class="line">1</span><br><span class="line">26607:X 31 Mar 2020 21:13:10.031 * +slave slave 127.0.0.1:6380 127.0.0.1 6380 @</span><br><span class="line">myredis 127.0.0.1 6379</span><br><span class="line">26607:X 31 Mar 2020 21:13:10.033 * +slave slave 127.0.0.1:6381 127.0.0.1 6381 @</span><br><span class="line">myredis 127.0.0.1 6379</span><br></pre></td></tr></table></figure>
<p>如果Master 节点断开了，这个时候就会从从机中随机选择一个服务器！ （这里面有一个投票算法！）</p>
<p><img src="https://gitee.com/mychimei/picture/raw/master/work/image-20210712142408509.png" alt="image-20210712142408509" /></p>
<h3 id="%E5%93%A8%E5%85%B5%E6%A8%A1%E5%BC%8F-1" id="哨兵模式-v2">哨兵模式</h3>
<h4 id="%E4%BC%98%E7%82%B9%EF%BC%9A" id="优点：">优点：</h4>
<p>1、哨兵集群，基于主从复制模式，所有的主从配置优点，它全有</p>
<p>2、 主从可以切换，故障可以转移，系统的可用性就会更好 3、哨兵模式就是主从模式的升级，手动到自动，更加健壮！</p>
<h4 id="%E7%BC%BA%E7%82%B9%EF%BC%9A" id="缺点：">缺点：</h4>
<p>1、Redis 不好啊在线扩容的，集群容量一旦到达上限，在线扩容就十分麻烦！</p>
<p>2、实现哨兵模式的配置其实是很麻烦的，里面有很多选择！ 哨兵模式的全部配置！</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line"># Example sentinel.conf</span><br><span class="line"># 哨兵sentinel实例运行的端口 默认26379</span><br><span class="line">port 26379</span><br><span class="line"># 哨兵sentinel的工作目录</span><br><span class="line">dir &#x2F;tmp</span><br><span class="line"># 哨兵sentinel监控的redis主节点的 ip port</span><br><span class="line"># master-name 可以自己命名的主节点名字 只能由字母A-z、数字0-9 、这三个字符&quot;.-_&quot;组成。</span><br><span class="line"># quorum 配置多少个sentinel哨兵统一认为master主节点失联 那么这时客观上认为主节点失联了</span><br><span class="line"># sentinel monitor &lt;master-name&gt; &lt;ip&gt; &lt;redis-port&gt; &lt;quorum&gt;</span><br><span class="line">sentinel monitor mymaster 127.0.0.1 6379 2</span><br><span class="line"># 当在Redis实例中开启了requirepass foobared 授权密码 这样所有连接Redis实例的客户端都要提供</span><br><span class="line">密码</span><br><span class="line"># 设置哨兵sentinel 连接主从的密码 注意必须为主从设置一样的验证密码</span><br><span class="line"># sentinel auth-pass &lt;master-name&gt; &lt;password&gt;</span><br><span class="line">sentinel auth-pass mymaster MySUPER--secret-0123passw0rd</span><br><span class="line"># 指定多少毫秒之后 主节点没有应答哨兵sentinel 此时 哨兵主观上认为主节点下线 默认30秒</span><br><span class="line"># sentinel down-after-milliseconds &lt;master-name&gt; &lt;milliseconds&gt;</span><br><span class="line">sentinel down-after-milliseconds mymaster 30000</span><br><span class="line"># 这个配置项指定了在发生failover主备切换时最多可以有多少个slave同时对新的master进行 同步，</span><br><span class="line">这个数字越小，完成failover所需的时间就越长，</span><br><span class="line">但是如果这个数字越大，就意味着越 多的slave因为replication而不可用。</span><br><span class="line">可以通过将这个值设为 1 来保证每次只有一个slave 处于不能处理命令请求的状态。</span><br><span class="line"># sentinel parallel-syncs &lt;master-name&gt; &lt;numslaves&gt;</span><br><span class="line">sentinel parallel-syncs mymaster 1</span><br><span class="line"># 故障转移的超时时间 failover-timeout 可以用在以下这些方面：</span><br><span class="line">#1. 同一个sentinel对同一个master两次failover之间的间隔时间。</span><br><span class="line">#2. 当一个slave从一个错误的master那里同步数据开始计算时间。直到slave被纠正为向正确的master那</span><br><span class="line">里同步数据时。</span><br><span class="line">#3.当想要取消一个正在进行的failover所需要的时间。</span><br><span class="line">#4.当进行failover时，配置所有slaves指向新的master所需的最大时间。不过，即使过了这个超时，</span><br><span class="line">slaves依然会被正确配置为指向master，但是就不按parallel-syncs所配置的规则来了</span><br><span class="line"># 默认三分钟</span><br><span class="line"># sentinel failover-timeout &lt;master-name&gt; &lt;milliseconds&gt;</span><br><span class="line">sentinel failover-timeout mymaster 180000</span><br><span class="line"># SCRIPTS EXECUTION</span><br><span class="line">#配置当某一事件发生时所需要执行的脚本，可以通过脚本来通知管理员，例如当系统运行不正常时发邮件通知</span><br><span class="line">相关人员。</span><br><span class="line">#对于脚本的运行结果有以下规则：</span><br><span class="line">#若脚本执行后返回1，那么该脚本稍后将会被再次执行，重复次数目前默认为10</span><br><span class="line">#若脚本执行后返回2，或者比2更高的一个返回值，脚本将不会重复执行。</span><br><span class="line">#如果脚本在执行过程中由于收到系统中断信号被终止了，则同返回值为1时的行为相同。</span><br><span class="line">#一个脚本的最大执行时间为60s，如果超过这个时间，脚本将会被一个SIGKILL信号终止，之后重新执行。</span><br><span class="line">#通知型脚本:当sentinel有任何警告级别的事件发生时（比如说redis实例的主观失效和客观失效等等），</span><br><span class="line">将会去调用这个脚本，这时这个脚本应该通过邮件，SMS等方式去通知系统管理员关于系统不正常运行的信</span><br><span class="line">息。调用该脚本时，将传给脚本两个参数，一个是事件的类型，一个是事件的描述。如果sentinel.conf配</span><br><span class="line">置文件中配置了这个脚本路径，那么必须保证这个脚本存在于这个路径，并且是可执行的，否则sentinel无</span><br><span class="line">法正常启动成功。</span><br><span class="line">#通知脚本</span><br><span class="line"># shell编程</span><br><span class="line"># sentinel notification-script &lt;master-name&gt; &lt;script-path&gt;</span><br><span class="line">sentinel notification-script mymaster &#x2F;var&#x2F;redis&#x2F;notify.sh</span><br><span class="line"># 客户端重新配置主节点参数脚本</span><br><span class="line"># 当一个master由于failover而发生改变时，这个脚本将会被调用，通知相关的客户端关于master地址已</span><br><span class="line">经发生改变的信息。</span><br><span class="line"># 以下参数将会在调用脚本时传给脚本:</span><br><span class="line"># &lt;master-name&gt; &lt;role&gt; &lt;state&gt; &lt;from-ip&gt; &lt;from-port&gt; &lt;to-ip&gt; &lt;to-port&gt;</span><br><span class="line"># 目前&lt;state&gt;总是“failover”,</span><br><span class="line"># &lt;role&gt;是“leader”或者“observer”中的一个。</span><br><span class="line"># 参数 from-ip, from-port, to-ip, to-port是用来和旧的master和新的master(即旧的slave)通</span><br><span class="line">信的</span><br><span class="line"># 这个脚本应该是通用的，能被多次调用，不是针对性的。</span><br><span class="line"># sentinel client-reconfig-script &lt;master-name&gt; &lt;script-path&gt;</span><br><span class="line">sentinel client-reconfig-script mymaster &#x2F;var&#x2F;redis&#x2F;reconfig.sh # 一般都是由运维来配</span><br><span class="line">置！</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h2 id="redis%E7%BC%93%E5%AD%98%E7%A9%BF%E9%80%8F%E5%92%8C%E9%9B%AA%E5%B4%A9" id="Redis缓存穿透和雪崩">Redis缓存穿透和雪崩</h2>
<p>服务的高可用问题！</p>
<p>在这里我们不会详细的区分析解决方案的底层！ Redis缓存的使用，极大的提升了应用程序的性能和效率，特别是数据查询方面。但同时，它也带来了一 些问题。其中，最要害的问题，就是数据的一致性问题，从严格意义上讲，这个问题无解。如果对数据 的一致性要求很高，那么就不能使用缓存。 另外的一些典型问题就是，缓存穿透、缓存雪崩和缓存击穿。目前，业界也都有比较流行的解决方案。</p>
<p><img src="https://gitee.com/mychimei/picture/raw/master/work/image-20210712142553323.png" alt="image-20210712142553323" /></p>
<h3 id="%E7%BC%93%E5%AD%98%E7%A9%BF%E9%80%8F%EF%BC%88%E6%9F%A5%E4%B8%8D%E5%88%B0%EF%BC%89" id="缓存穿透（查不到）">缓存穿透（查不到）</h3>
<h4 id="%E6%A6%82%E5%BF%B5-1" id="概念-v2">概念</h4>
<p>缓存穿透的概念很简单，用户想要查询一个数据，发现redis内存数据库没有，也就是缓存没有命中，于 是向持久层数据库查询。发现也没有，于是本次查询失败。当用户很多的时候，缓存都没有命中（秒 杀！），于是都去请求了持久层数据库。这会给持久层数据库造成很大的压力，这时候就相当于出现了 缓存穿透。</p>
<h4 id="%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88" id="解决方案">解决方案</h4>
<h5 id="%E5%B8%83%E9%9A%86%E8%BF%87%E6%BB%A4%E5%99%A8" id="布隆过滤器">布隆过滤器</h5>
<p>布隆过滤器是一种数据结构，对所有可能查询的参数以hash形式存储，在控制层先进行校验，不符合则 丢弃，从而避免了对底层存储系统的查询压力；</p>
<p><img src="https://gitee.com/mychimei/picture/raw/master/work/image-20210712142640468.png" alt="image-20210712142640468" /></p>
<h5 id="%E7%BC%93%E5%AD%98%E7%A9%BA%E5%AF%B9%E8%B1%A1" id="缓存空对象">缓存空对象</h5>
<p>当存储层不命中后，即使返回的空对象也将其缓存起来，同时会设置一个过期时间，之后再访问这个数 据将会从缓存中获取，保护了后端数据源；</p>
<p>但是这种方法会存在两个问题： 1、如果空值能够被缓存起来，这就意味着缓存需要更多的空间存储更多的键，因为这当中可能会有很多 的空值的键； 2、即使对空值设置了过期时间，还是会存在缓存层和存储层的数据会有一段时间窗口的不一致，这对于 需要保持一致性的业务会有影响。</p>
<h4 id="%E7%BC%93%E5%AD%98%E5%87%BB%E7%A9%BF%EF%BC%88%E9%87%8F%E5%A4%AA%E5%A4%A7%EF%BC%8C%E7%BC%93%E5%AD%98%E8%BF%87%E6%9C%9F%EF%BC%81%EF%BC%89" id="缓存击穿（量太大，缓存过期！）">缓存击穿（量太大，缓存过期！）</h4>
<h5 id="%E6%A6%82%E8%BF%B0-1" id="概述-v2">概述</h5>
<p>这里需要注意和缓存击穿的区别，缓存击穿，是指一个key非常热点，在不停的扛着大并发，大并发集中 对这一个点进行访问，当这个key在失效的瞬间，持续的大并发就穿破缓存，直接请求数据库，就像在一 个屏障上凿开了一个洞。 当某个key在过期的瞬间，有大量的请求并发访问，这类数据一般是热点数据，由于缓存过期，会同时访 问数据库来查询最新数据，并且回写缓存，会导使数据库瞬间压力过大。</p>
<h5 id="%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88-1" id="解决方案-v2">解决方案</h5>
<h6 id="%E8%AE%BE%E7%BD%AE%E7%83%AD%E7%82%B9%E6%95%B0%E6%8D%AE%E6%B0%B8%E4%B8%8D%E8%BF%87%E6%9C%9F" id="设置热点数据永不过期">设置热点数据永不过期</h6>
<p>从缓存层面来看，没有设置过期时间，所以不会出现热点 key 过期后产生的问题。</p>
<h6 id="%E5%8A%A0%E4%BA%92%E6%96%A5%E9%94%81" id="加互斥锁">加互斥锁</h6>
<p>分布式锁：使用分布式锁，保证对于每个key同时只有一个线程去查询后端服务，其他线程没有获得分布 式锁的权限，因此只需要等待即可。这种方式将高并发的压力转移到了分布式锁，因此对分布式锁的考 验很大。</p>
<h3 id="%E7%BC%93%E5%AD%98%E9%9B%AA%E5%B4%A9" id="缓存雪崩">缓存雪崩</h3>
<h4 id="%E6%A6%82%E5%BF%B5-2" id="概念-v3">概念</h4>
<p>缓存雪崩，是指在某一个时间段，缓存集中过期失效。Redis 宕机！ 产生雪崩的原因之一，比如在写本文的时候，马上就要到双十二零点，很快就会迎来一波抢购，这波商 品时间比较集中的放入了缓存，假设缓存一个小时。那么到了凌晨一点钟的时候，这批商品的缓存就都 过期了。而对这批商品的访问查询，都落到了数据库上，对于数据库而言，就会产生周期性的压力波 峰。于是所有的请求都会达到存储层，存储层的调用量会暴增，造成存储层也会挂掉的情况。</p>
<p><img src="https://gitee.com/mychimei/picture/raw/master/work/image-20210712143014357.png" alt="image-20210712143014357" /></p>
<p>其实集中过期，倒不是非常致命，比较致命的缓存雪崩，是缓存服务器某个节点宕机或断网。因为自然 形成的缓存雪崩，一定是在某个时间段集中创建缓存，这个时候，数据库也是可以顶住压力的。无非就 是对数据库产生周期性的压力而已。而缓存服务节点的宕机，对数据库服务器造成的压力是不可预知 的，很有可能瞬间就把数据库压垮。</p>
<h4 id="%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88-2" id="解决方案-v3">解决方案</h4>
<p>redis高可用 这个思想的含义是，既然redis有可能挂掉，那我多增设几台redis，这样一台挂掉之后其他的还可以继续 工作，其实就是搭建的集群。（异地多活！） 限流降级（在SpringCloud讲解过！） 这个解决方案的思想是，在缓存失效后，通过加锁或者队列来控制读数据库写缓存的线程数量。比如对 某个key只允许一个线程查询数据和写缓存，其他线程等待。 数据预热 数据加热的含义就是在正式部署之前，我先把可能的数据先预先访问一遍，这样部分可能大量访问的数 据就会加载到缓存中。在即将发生大并发访问前手动触发加载缓存不同的key，设置不同的过期时间，让 缓存失效的时间点尽量均匀。</p>
<h2 id="redis%E6%8C%81%E4%B9%85%E5%8C%96" id="Redis持久化">Redis持久化</h2>
<p>面试和工作，持久化都是重点！ Redis 是内存数据库，如果不将内存中的数据库状态保存到磁盘，那么一旦服务器进程退出，服务器中 的数据库状态也会消失。所以 Redis 提供了持久化功能！</p>
<h3 id="rdb" id="RDB">RDB</h3>
<p>（Redis DataBase） 什么是RDB 在主从复制中，rdb就是备用了！从机上面！</p>
<p><img src="https://gitee.com/mychimei/picture/raw/master/work/image-20210709185020200.png" alt="image-20210709185020200" /></p>
<p>在指定的时间间隔内将内存中的数据集快照写入磁盘，也就是行话讲的Snapshot快照，它恢复时是将快照文件直接读到内存里。</p>
<p>Redis会单独创建（fork）一个子进程来进行持久化，会先将数据写入到一个临时文件中，待持久化过程<br />
都结束了，再用这个临时文件替换上次持久化好的文件。整个过程中，主进程是不进行任何IO操作的。<br />
这就确保了极高的性能。如果需要进行大规模数据的恢复，且对于数据恢复的完整性不是非常敏感，那<br />
RDB方式要比AOF方式更加的高效。RDB的缺点是最后一次持久化后的数据可能丢失。我们默认的就是<br />
RDB，一般情况下不需要修改这个配置！<br />
有时候在生产环境我们会将这个文件进行备份！<br />
rdb保存的文件是dump.rdb 都是在我们的配置文件中快照中进行配置的！</p>
<p><img src="https://gitee.com/mychimei/picture/raw/master/work/image-20210709185138765.png" alt="image-20210709185138765" /></p>
<h3 id="%E8%A7%A6%E5%8F%91%E6%9C%BA%E5%88%B6" id="触发机制">触发机制</h3>
<p>1、save的规则满足的情况下，会自动触发rdb规则</p>
<p>2、执行 flushall 命令，也会触发我们的rdb规则！</p>
<p>3、退出redis，也会产生 rdb 文件！ 备份就自动生成一个 dump.rdb</p>
<p><img src="https://gitee.com/mychimei/picture/raw/master/work/image-20210709185310501.png" alt="image-20210709185310501" /></p>
<h3 id="%E5%A6%82%E4%BD%95%E6%81%A2%E5%A4%8Drdb%E6%96%87%E4%BB%B6" id="如何恢复rdb文件">如何恢复rdb文件</h3>
<p>1、只需要将rdb文件放在我们redis启动目录就可以，redis启动的时候会自动检查dump.rdb 恢复其中 的数据！</p>
<p>2、查看需要存在的位置 几乎就他自己默认的配置就够用了，但是我们还是需要去学习！</p>
<p>优点： 1、适合大规模的数据恢复！ 2、对数据的完整性要不高！</p>
<p>缺点： 1、需要一定的时间间隔进程操作！如果redis意外宕机了，这个最后一次修改数据就没有的了！ 2、fork进程的时候，会占用一定的内容空间！！</p>
<h3 id="aof%EF%BC%88append-only-file%EF%BC%89" id="AOF（Append-Only-File）">AOF（Append Only File）</h3>
<p>将我们的所有命令都记录下来，history，恢复的时候就把这个文件全部在执行一遍！ 是什么 127.0.0.1:6379&gt; config get dir 1) &quot;dir&quot; 2) &quot;/usr/local/bin&quot; # 如果在这个目录下存在 dump.rdb 文件，启动就会自动恢复其中的数据</p>
<p><img src="https://gitee.com/mychimei/picture/raw/master/work/image-20210709185507107.png" alt="image-20210709185507107" /></p>
<p>以日志的形式来记录每个写操作，将Redis执行过的所有指令记录下来（读操作不记录），只许追加文件 但不可以改写文件，redis启动之初会读取该文件重新构建数据，换言之，redis重启的话就根据日志文件 的内容将写指令从前到后执行一次以完成数据的恢复工作</p>
<p>Aof保存的是 appendonly.aof 文件</p>
<p><img src="https://gitee.com/mychimei/picture/raw/master/work/image-20210709185553806.png" alt="image-20210709185553806" /></p>
<p>默认是不开启的，我们需要手动进行配置！我们只需要将 appendonly 改为yes就开启了 aof！</p>
<p>重启，redis 就可以生效了！</p>
<p>如果这个 aof 文件有错位，这时候 redis 是启动不起来的吗，我们需要修复这个aof文件 redis 给我们提供了一个工具 redis-check-aof --fix</p>
<p>aof 默认就是文件的无限追加，文件会越来越大！</p>
<p>如果 aof 文件大于 64m，太大了！ fork一个新的进程来将我们的文件进行重写！</p>
<p><img src="https://gitee.com/mychimei/picture/raw/master/work/image-20210709185718957.png" alt="image-20210709185718957" /></p>
<h3 id="%E4%BC%98%E7%82%B9%E5%92%8C%E7%BC%BA%E7%82%B9%EF%BC%81" id="优点和缺点！">优点和缺点！</h3>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">appendonly no # 默认是不开启aof模式的，默认是使用rdb方式持久化的，在大部分所有的情况下，</span><br><span class="line">rdb完全够用！</span><br><span class="line">appendfilename &quot;appendonly.aof&quot; # 持久化的文件的名字</span><br><span class="line"># appendfsync always # 每次修改都会 sync。消耗性能</span><br><span class="line">appendfsync everysec # 每秒执行一次 sync，可能会丢失这1s的数据！</span><br><span class="line"># appendfsync no # 不执行 sync，这个时候操作系统自己同步数据，速度最快！</span><br><span class="line"># rewrite 重写，</span><br></pre></td></tr></table></figure>
<p>优点： 1、每一次修改都同步，文件的完整会更加好！ 2、每秒同步一次，可能会丢失一秒的数据 3、从不同步，效率最高的！</p>
<p>缺点： 1、相对于数据文件来说，aof远远大于 rdb，修复的速度也比 rdb慢！ 2、Aof 运行效率也要比 rdb 慢，所以我们redis默认的配置就是rdb持久化！</p>
<p>扩展：</p>
<p>1、RDB 持久化方式能够在指定的时间间隔内对你的数据进行快照存储</p>
<p>2、AOF 持久化方式记录每次对服务器写的操作，当服务器重启的时候会重新执行这些命令来恢复原始 的数据，AOF命令以Redis 协议追加保存每次写的操作到文件末尾，Redis还能对AOF文件进行后台重 写，使得AOF文件的体积不至于过大。</p>
<p>3、只做缓存，如果你只希望你的数据在服务器运行的时候存在，你也可以不使用任何持久化 4、同时开启两种持久化方式 在这种情况下，当redis重启的时候会优先载入AOF文件来恢复原始的数据，因为在通常情况下AOF 文件保存的数据集要比RDB文件保存的数据集要完整。 RDB 的数据不实时，同时使用两者时服务器重启也只会找AOF文件，那要不要只使用AOF呢？作者 建议不要，因为RDB更适合用于备份数据库（AOF在不断变化不好备份），快速重启，而且不会有 AOF可能潜在的Bug，留着作为一个万一的手段。</p>
<p>5、性能建议 因为RDB文件只用作后备用途，建议只在Slave上持久化RDB文件，而且只要15分钟备份一次就够 了，只保留 save 900 1 这条规则。 如果Enable AOF ，好处是在最恶劣情况下也只会丢失不超过两秒数据，启动脚本较简单只load自 己的AOF文件就可以了，代价一是带来了持续的IO，二是AOF rewrite 的最后将 rewrite 过程中产 生的新数据写到新文件造成的阻塞几乎是不可避免的。只要硬盘许可，应该尽量减少AOF rewrite 的频率，AOF重写的基础大小默认值64M太小了，可以设到5G以上，默认超过原大小100%大小重 写可以改到适当的数值。 如果不Enable AOF ，仅靠 Master-Slave Repllcation 实现高可用性也可以，能省掉一大笔IO，也 减少了rewrite时带来的系统波动。代价是如果Master/Slave 同时倒掉，会丢失十几分钟的数据， 启动脚本也要比较两个 Master/Slave 中的 RDB文件，载入较新的那个，微博就是这种架构。</p>
<p><img src="https://gitee.com/mychimei/picture/raw/master/work/image-20210709190052864.png" alt="image-20210709190052864" /></p>
<h3 id="%E5%91%BD%E4%BB%A4" id="命令">命令</h3>
<p><img src="https://gitee.com/mychimei/picture/raw/master/work/image-20210709190909839.png" alt="image-20210709190909839" /></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">测试</span><br><span class="line">订阅端：</span><br><span class="line">127.0.0.1:6379&gt; SUBSCRIBE kuangshenshuo # 订阅一个频道 kuangshenshuo</span><br><span class="line">Reading messages... (press Ctrl-C to quit)</span><br><span class="line">1) &quot;subscribe&quot;</span><br><span class="line">2) &quot;kuangshenshuo&quot;</span><br><span class="line">3) (integer) 1</span><br><span class="line"># 等待读取推送的信息</span><br><span class="line">1) &quot;message&quot; # 消息</span><br><span class="line">2) &quot;kuangshenshuo&quot; # 那个频道的消息</span><br><span class="line">3) &quot;hello,kuangshen&quot; # 消息的具体内容</span><br><span class="line">1) &quot;message&quot;</span><br><span class="line">2) &quot;kuangshenshuo&quot;</span><br><span class="line">3) &quot;hello,redis&quot;</span><br><span class="line">发送端：</span><br><span class="line">127.0.0.1:6379&gt; PUBLISH kuangshenshuo &quot;hello,kuangshen&quot; # 发布者发布消息到频道！</span><br><span class="line">(integer) 1</span><br><span class="line">127.0.0.1:6379&gt; PUBLISH kuangshenshuo &quot;hello,redis&quot; # 发布者发布消息到频道！</span><br><span class="line">(integer) 1</span><br><span class="line">127.0.0.1:6379&gt;</span><br></pre></td></tr></table></figure>
<p>原理<br />
Redis是使用C实现的，通过分析 Redis 源码里的 pubsub.c 文件，了解发布和订阅机制的底层实现，借此加深对 Redis 的理解。</p>
<p>Redis 通过 PUBLISH 、SUBSCRIBE 和 PSUBSCRIBE 等命令实现发布和订阅功能。</p>
<p>微信： 通过 SUBSCRIBE 命令订阅某频道后，redis-server 里维护了一个字典，字典的键就是一个个 频道！， 而字典的值则是一个链表，链表中保存了所有订阅这个 channel 的客户端。SUBSCRIBE 命令的关键， 就是将客户端添加到给定 channel 的订阅链表中。</p>
<p>Pub/Sub 从字面上理解就是发布（Publish）与订阅（Subscribe），在Redis中，你可以设定对某一个 key值进行消息发布及消息订阅，当一个key值上进行了消息发布后，所有订阅它的客户端都会收到相应 的消息。这一功能最明显的用法就是用作实时消息系统，比如普通的即时聊天，群聊等功能。</p>
<p>使用场景：</p>
<p>1、实时消息系统！</p>
<p>2、事实聊天！（频道当做聊天室，将信息回显给所有人即可！）</p>
<p>3、订阅，关注系统都是可以的！ 稍微复杂的场景我们就会使用 消息中间件 MQ （）</p>
<h2 id="redis-%E6%95%B0%E6%8D%AE%E5%A4%87%E4%BB%BD%E4%B8%8E%E6%81%A2%E5%A4%8D" id="Redis-数据备份与恢复">Redis 数据备份与恢复</h2>
<ul>
<li>
<p>SAVE 该命令将在 redis 安装目录中创建dump.rdb文件。</p>
</li>
<li>
<p>如果需要恢复数据，只需将备份文件 (dump.rdb) 移动到 redis 安装目录并启动服务即可。获取 redis 目录可以使用 CONFIG 命令</p>
<ul>
<li>CONFIG GET dir</li>
<li>以上命令 CONFIG GET dir 输出的 redis 安装目录为 /usr/local/redis/bin。</li>
</ul>
</li>
<li>
<p>Bgsave</p>
<ul>
<li>创建 redis 备份文件也可以使用命令 BGSAVE，该命令在后台执行。</li>
</ul>
</li>
</ul>
<p>实例<br />
127.0.0.1:6379&gt; BGSAVE</p>
<p>Background saving started</p>
<h2 id="redis-%E5%AE%89%E5%85%A8" id="Redis-安全">Redis 安全</h2>
<ul>
<li>
<p>通过 redis 的配置文件设置密码参数，这样客户端连接到 redis 服务就需要密码验证，这样可以让你的 redis 服务更安全。</p>
</li>
<li>
<p>查看是否设置了密码验证：<br />
CONFIG get requirepass默认情况下 requirepass 参数是空的，这就意味着你无需通过密码验证就可以连接到 redis 服务。</p>
<ul>
<li>
<p>CONFIG set requirepass &quot;runoob&quot;</p>
<ul>
<li>
<p>AUTH &quot;runoob&quot;</p>
<ul>
<li>
<p>SET mykey &quot;Test value&quot;</p>
<ul>
<li>GET mykey</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<h2 id="redis-%E6%80%A7%E8%83%BD%E6%B5%8B%E8%AF%95" id="Redis-性能测试">Redis 性能测试</h2>
<ul>
<li>
<p>Redis 性能测试是通过同时执行多个命令实现的。</p>
<ul>
<li>redis-benchmark [option] [option value]<br />
注意：该命令是在 redis 的目录下执行的，而不是 redis 客户端的内部指令</li>
<li>以下实例同时执行 10000 个请求来检测性能：</li>
</ul>
</li>
</ul>
<p>redis-benchmark -n 10000  -q<br />
- redis 性能测试工具可选参数如下所示：</p>
<p>序号	选项	描述	默认值<br />
1	-h	指定服务器主机名	127.0.0.1<br />
2	-p	指定服务器端口	6379<br />
3	-s	指定服务器 socket	<br />
4	-c	指定并发连接数	50<br />
5	-n	指定请求数	10000<br />
6	-d	以字节的形式指定 SET/GET 值的数据大小	2<br />
7	-k	1=keep alive 0=reconnect	1<br />
8	-r	SET/GET/INCR 使用随机 key, SADD 使用随机值	<br />
9	-P	通过管道传输 <numreq> 请求	1<br />
10	-q	强制退出 redis。仅显示 query/sec 值	<br />
11	--csv	以 CSV 格式输出	<br />
12	-l	生成循环，永久执行测试	<br />
13	-t	仅运行以逗号分隔的测试命令列表。	<br />
14	-I	Idle 模式。仅打开 N 个 idle 连接并等待。</p>
<pre><code>	- redis-benchmark -h 127.0.0.1 -p 6379 -t set,lpush -n 10000 -q
</code></pre>
<h2 id="redis-%E5%AE%A2%E6%88%B7%E7%AB%AF%E8%BF%9E%E6%8E%A5" id="Redis-客户端连接">Redis 客户端连接</h2>
<ul>
<li>Redis 通过监听一个 TCP 端口或者 Unix socket 的方式来接收来自客户端的连接，当一个连接建立后，Redis 内部会进行以下一些操作：</li>
</ul>
<p>首先，客户端 socket 会被设置为非阻塞模式，因为 Redis 在网络事件处理上采用的是非阻塞多路复用模型。<br />
然后为这个 socket 设置 TCP_NODELAY 属性，禁用 Nagle 算法<br />
然后创建一个可读的文件事件用于监听这个客户端 socket 的数据发送</p>
<ul>
<li>
<p>最大连接数</p>
<ul>
<li>在 Redis2.4 中，最大连接数是被直接硬编码在代码里面的，而在2.6版本中这个值变成可配置的。</li>
</ul>
</li>
</ul>
<p>maxclients 的默认值是 10000，你也可以在 redis.conf 中对这个值进行修改。</p>
<p>config get maxclients</p>
<pre><code>	- redis-server --maxclients 100000

- S.N.	命令	描述
</code></pre>
<p>1	CLIENT LIST	返回连接到 redis 服务的客户端列表<br />
2	CLIENT SETNAME	设置当前连接的名称<br />
3	CLIENT GETNAME	获取通过 CLIENT SETNAME 命令设置的服务名称<br />
4	CLIENT PAUSE	挂起客户端连接，指定挂起的时间以毫秒计<br />
5	CLIENT KILL	关闭客户端连接</p>
<h2 id="redis%E7%AE%A1%E9%81%93%E6%8A%80%E6%9C%AF" id="Redis管道技术">Redis管道技术</h2>
<ul>
<li>Redis是一种基于客户端-服务端模型以及请求/响应协议的TCP服务。这意味着通常情况下一个请求会遵循以下步骤：</li>
</ul>
<p>客户端向服务端发送一个查询请求，并监听套接字返回，通常以一对模式，等待服务端响应。<br />
服务端处理命令，可以结果返回给客户端。</p>
<ul>
<li>
<p>Redis管道技术可以在服务端未响应时，客户端可以继续向服务端发送请求，并最终一次性读取所有服务端的响应。</p>
<ul>
<li>查看redis管道，只需要启动redis实例并输入以下命令：</li>
</ul>
</li>
</ul>
<p>$（echo -en“ PING \ r \ n SET runoobkey redis \ r \ nGET runoobkey \ r \ nINCR访问者\ r \ nINCR访问者\ r \ nINCR访问者\ r \ n”；睡眠10）| 数控本地主机6379（echo - zh - cn “ PING \ r \ n SET redoobkey redis \ r \ nGET runoobkey \ r \ nINCR访问者\ r \ nINCR访问者\ r \ nINCR访问者\ r \ n” ；睡眠10 ）| 数控本地主机6379</p>
<pre><code>	- 以上实例中我们通过使用PING命令查看redis服务是否可用，之后我们设置了runoobkey的变量redis，然后我们获取runoobkey的值并使其访客自增3次。
</code></pre>
<p>在返回的结果中我们可以看到这些命令一次性向redis服务提交，并最终一次性读取所有服务端的响应</p>
<ul>
<li>
<p>管道技术的优势</p>
<ul>
<li>管道技术最显着的优势是提高了redis服务的性能。</li>
</ul>
</li>
</ul>
<h2 id="redis-%E5%88%86%E5%8C%BA" id="Redis-分区">Redis 分区</h2>
<ul>
<li>分区是分割数据到多个Redis实例的处理过程，因此每个实例只保存key的一个子集。</li>
</ul>
<p>分区的优势<br />
通过利用多台计算机内存的和值，允许我们构造更大的数据库。<br />
通过多核和多台计算机，允许我们扩展计算能力；通过多台计算机和网络适配器，允许我们扩展网络带宽。<br />
分区的不足<br />
redis的一些特性在分区方面表现的不是很好：</p>
<p>涉及多个key的操作通常是不被支持的。举例来说，当两个set映射到不同的redis实例上时，你就不能对这两个set执行交集操作。<br />
涉及多个key的redis事务不能使用。<br />
当使用分区时，数据处理较为复杂，比如你需要处理多个rdb/aof文件，并且从多个实例和主机备份持久化文件。<br />
增加或删除容量也比较复杂。redis集群大多数支持在运行时增加、删除节点的透明数据平衡的能力，但是类似于客户端分区、代理等其他系统则不支持这项特性。然而，一种叫做presharding的技术对此是有帮助的。<br />
分区类型<br />
Redis 有两种类型分区。 假设有4个Redis实例 R0，R1，R2，R3，和类似user:1，user:2这样的表示用户的多个key，对既定的key有多种不同方式来选择这个key存放在哪个实例中。也就是说，有不同的系统来映射某个key到某个Redis服务。</p>
<p>范围分区<br />
最简单的分区方式是按范围分区，就是映射一定范围的对象到特定的Redis实例。</p>
<p>比如，ID从0到10000的用户会保存到实例R0，ID从10001到 20000的用户会保存到R1，以此类推。</p>
<p>这种方式是可行的，并且在实际中使用，不足就是要有一个区间范围到实例的映射表。这个表要被管理，同时还需要各 种对象的映射表，通常对Redis来说并非是好的方法。</p>
<p>哈希分区<br />
另外一种分区方法是hash分区。这对任何key都适用，也无需是object_name:这种形式，像下面描述的一样简单：</p>
<p>用一个hash函数将key转换为一个数字，比如使用crc32 hash函数。对key foobar执行crc32(foobar)会输出类似93024922的整数。<br />
对这个整数取模，将其转化为0-3之间的数字，就可以将这个整数映射到4个Redis实例中的一个了。93024922 % 4 = 2，就是说key foobar应该被存到R2实例中。注意：取模操作是取除的余数，通常在多种编程语言中用%操作符实现。</p>
<h1 id="java-%E4%BD%BF%E7%94%A8-redis">Java 使用 Redis</h1>
<h2 id="jedis" id="jedis">jedis</h2>
<h3 id="%E5%AE%89%E8%A3%85" id="安装">安装</h3>
<ul>
<li>开始在 Java 中使用 Redis 前， 我们需要确保已经安装了 redis 服务及 Java redis 驱动，且你的机器上能正常使用 Java。 Java的安装配置可以参考我们的 Java 开发环境配置 接下来让我们安装 Java redis 驱动：</li>
</ul>
<p>首先你需要下载驱动包 下载 jedis.jar，确保下载最新驱动包。<br />
在你的 classpath 中包含该驱动包。</p>
<p>maven jedis</p>
<h3 id="%E8%BF%9E%E6%8E%A5%E5%88%B0-redis-%E6%9C%8D%E5%8A%A1" id="连接到-redis-服务">连接到 redis 服务</h3>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">- <span class="keyword">import</span> redis.clients.jedis.Jedis;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">RedisJava</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="comment">//连接本地的 Redis 服务</span></span><br><span class="line">        Jedis jedis = <span class="keyword">new</span> Jedis(<span class="string">&quot;localhost&quot;</span>);</span><br><span class="line">        <span class="comment">// 如果 Redis 服务设置来密码，需要下面这行，没有就不需要</span></span><br><span class="line">        <span class="comment">// jedis.auth(&quot;123456&quot;); </span></span><br><span class="line">        System.out.println(<span class="string">&quot;连接成功&quot;</span>);</span><br><span class="line">        <span class="comment">//查看服务是否运行</span></span><br><span class="line">        System.out.println(<span class="string">&quot;服务正在运行: &quot;</span>+jedis.ping());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="redis-java-string(%E5%AD%97%E7%AC%A6%E4%B8%B2)-%E5%AE%9E%E4%BE%8B" id="Redis-Java-String-字符串-实例">Redis Java String(字符串) 实例</h3>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">- <span class="keyword">import</span> redis.clients.jedis.Jedis;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">RedisStringJava</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="comment">//连接本地的 Redis 服务</span></span><br><span class="line">        Jedis jedis = <span class="keyword">new</span> Jedis(<span class="string">&quot;localhost&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;连接成功&quot;</span>);</span><br><span class="line">        <span class="comment">//设置 redis 字符串数据</span></span><br><span class="line">        jedis.set(<span class="string">&quot;runoobkey&quot;</span>, <span class="string">&quot;www.runoob.com&quot;</span>);</span><br><span class="line">        <span class="comment">// 获取存储的数据并输出</span></span><br><span class="line">        System.out.println(<span class="string">&quot;redis 存储的字符串为: &quot;</span>+ jedis.get(<span class="string">&quot;runoobkey&quot;</span>));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="redis-java-list(%E5%88%97%E8%A1%A8)-%E5%AE%9E%E4%BE%8B" id="Redis-Java-List-列表-实例">Redis Java List(列表) 实例</h3>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">- <span class="keyword">import</span> java.util.List;</span><br><span class="line">  <span class="keyword">import</span> redis.clients.jedis.Jedis;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">RedisListJava</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="comment">//连接本地的 Redis 服务</span></span><br><span class="line">        Jedis jedis = <span class="keyword">new</span> Jedis(<span class="string">&quot;localhost&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;连接成功&quot;</span>);</span><br><span class="line">        <span class="comment">//存储数据到列表中</span></span><br><span class="line">        jedis.lpush(<span class="string">&quot;site-list&quot;</span>, <span class="string">&quot;Runoob&quot;</span>);</span><br><span class="line">        jedis.lpush(<span class="string">&quot;site-list&quot;</span>, <span class="string">&quot;Google&quot;</span>);</span><br><span class="line">        jedis.lpush(<span class="string">&quot;site-list&quot;</span>, <span class="string">&quot;Taobao&quot;</span>);</span><br><span class="line">        <span class="comment">// 获取存储的数据并输出</span></span><br><span class="line">        List&lt;String&gt; list = jedis.lrange(<span class="string">&quot;site-list&quot;</span>, <span class="number">0</span> ,<span class="number">2</span>);</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>; i&lt;list.size(); i++) &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;列表项为: &quot;</span>+list.get(i));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="redis-java-keys-%E5%AE%9E%E4%BE%8B" id="Redis-Java-Keys-实例">Redis Java Keys 实例</h3>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">    - <span class="keyword">import</span> java.util.Iterator;</span><br><span class="line">  <span class="keyword">import</span> java.util.Set;</span><br><span class="line">  <span class="keyword">import</span> redis.clients.jedis.Jedis;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">RedisKeyJava</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="comment">//连接本地的 Redis 服务</span></span><br><span class="line">        Jedis jedis = <span class="keyword">new</span> Jedis(<span class="string">&quot;localhost&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;连接成功&quot;</span>);</span><br><span class="line">    <span class="comment">// 获取数据并输出</span></span><br><span class="line">    Set&lt;String&gt; keys = jedis.keys(<span class="string">&quot;*&quot;</span>); </span><br><span class="line">    Iterator&lt;String&gt; it=keys.iterator() ;   </span><br><span class="line">    <span class="keyword">while</span>(it.hasNext())&#123;   </span><br><span class="line">        String key = it.next();   </span><br><span class="line">        System.out.println(key);   </span><br><span class="line">    &#125;</span><br><span class="line">&#125;&#125;</span><br></pre></td></tr></table></figure>
<h3 id="jedis%E4%BA%8B%E5%8A%A1" id="Jedis事务">Jedis事务</h3>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">Jedis jedis = <span class="keyword">new</span> Jedis(<span class="string">&quot;127.0.0.1&quot;</span>, <span class="number">6379</span>);</span><br><span class="line">jedis.flushDB();</span><br><span class="line">JSONObject jsonObject = <span class="keyword">new</span> JSONObject();</span><br><span class="line">jsonObject.put(<span class="string">&quot;hello&quot;</span>,<span class="string">&quot;world&quot;</span>);</span><br><span class="line">jsonObject.put(<span class="string">&quot;name&quot;</span>,<span class="string">&quot;kuangshen&quot;</span>);</span><br><span class="line"><span class="comment">// 开启事务</span></span><br><span class="line">Transaction multi = jedis.multi();</span><br><span class="line">String result = jsonObject.toJSONString();</span><br><span class="line"><span class="comment">// jedis.watch(result)</span></span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">multi.set(<span class="string">&quot;user1&quot;</span>,result);</span><br><span class="line">multi.set(<span class="string">&quot;user2&quot;</span>,result);</span><br><span class="line"><span class="keyword">int</span> i = <span class="number">1</span>/<span class="number">0</span> ; <span class="comment">// 代码抛出异常事务，执行失败！</span></span><br><span class="line">multi.exec(); <span class="comment">// 执行事务！</span></span><br><span class="line">&#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">multi.discard(); <span class="comment">// 放弃事务</span></span><br><span class="line">e.printStackTrace();</span><br><span class="line">&#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">System.out.println(jedis.get(<span class="string">&quot;user1&quot;</span>));</span><br><span class="line">System.out.println(jedis.get(<span class="string">&quot;user2&quot;</span>));</span><br><span class="line">jedis.close(); <span class="comment">// 关闭连接</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h2 id="springboot%E6%95%B4%E5%90%88redis" id="SpringBoot整合Redis">SpringBoot整合Redis</h2>
<p>SpringBoot 操作数据：spring-data jpa jdbc mongodb redis！<br />
SpringData 也是和 SpringBoot 齐名的项目！<br />
说明： 在 SpringBoot2.x 之后，原来使用的jedis 被替换为了 lettuce?<br />
jedis : 采用的直连，多个线程操作的话，是不安全的，如果想要避免不安全的，使用 jedis pool 连接池！ 更像 BIO 模式<br />
lettuce : 采用netty，实例可以再多个线程中进行共享，不存在线程不安全的情况！可以减少线程数据了，更像 NIO 模式<br />
源码分析：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">@Bean</span><br><span class="line">@ConditionalOnMissingBean(name &#x3D; &quot;redisTemplate&quot;) &#x2F;&#x2F; 我们可以自己定义一个</span><br><span class="line">redisTemplate来替换这个默认的！</span><br><span class="line">public RedisTemplate&lt;Object, Object&gt; redisTemplate(RedisConnectionFactory</span><br><span class="line">redisConnectionFactory)</span><br><span class="line">throws UnknownHostException &#123;</span><br><span class="line">&#x2F;&#x2F; 默认的 RedisTemplate 没有过多的设置，redis 对象都是需要序列化！</span><br><span class="line">&#x2F;&#x2F; 两个泛型都是 Object, Object 的类型，我们后使用需要强制转换 &lt;String, Object&gt;</span><br><span class="line">RedisTemplate&lt;Object, Object&gt; template &#x3D; new RedisTemplate&lt;&gt;();</span><br><span class="line">template.setConnectionFactory(redisConnectionFactory);</span><br><span class="line">return template;</span><br><span class="line">&#125;</span><br><span class="line">@Bean</span><br><span class="line">@ConditionalOnMissingBean &#x2F;&#x2F; 由于 String 是redis中最常使用的类型，所以说单独提出来了一</span><br><span class="line">个bean！</span><br><span class="line">public StringRedisTemplate stringRedisTemplate(RedisConnectionFactory</span><br><span class="line">redisConnectionFactory)</span><br><span class="line">throws UnknownHostException &#123;</span><br><span class="line">StringRedisTemplate template &#x3D; new StringRedisTemplate();</span><br><span class="line">template.setConnectionFactory(redisConnectionFactory);</span><br><span class="line">return template;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span>、导入依赖</span><br><span class="line">&lt;!-- 操作redis --&gt;</span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">&lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">&lt;artifactId&gt;spring-boot-starter-data-redis&lt;/artifactId&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br><span class="line"><span class="number">2</span>、配置连接</span><br><span class="line"># 配置redis</span><br><span class="line">spring.redis.host=<span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span></span><br><span class="line">spring.redis.port=<span class="number">6379</span></span><br><span class="line"><span class="number">3</span>、测试！</span><br><span class="line"><span class="meta">@SpringBootTest</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Redis02SpringbootApplicationTests</span> </span>&#123;</span><br><span class="line"><span class="meta">@Autowired</span></span><br><span class="line"><span class="keyword">private</span> RedisTemplate redisTemplate;</span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">contextLoads</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="comment">// redisTemplate 操作不同的数据类型，api和我们的指令是一样的</span></span><br><span class="line"><span class="comment">// opsForValue 操作字符串 类似String</span></span><br><span class="line"><span class="comment">// opsForList 操作List 类似List</span></span><br><span class="line"><span class="comment">// opsForSet</span></span><br><span class="line"><span class="comment">// opsForHash</span></span><br><span class="line"><span class="comment">// opsForZSet</span></span><br><span class="line"><span class="comment">// opsForGeo</span></span><br><span class="line"><span class="comment">// opsForHyperLogLog</span></span><br><span class="line"><span class="comment">// 除了进本的操作，我们常用的方法都可以直接通过redisTemplate操作，比如事务，和基本的</span></span><br><span class="line">CRUD</span><br><span class="line"><span class="comment">// 获取redis的连接对象</span></span><br><span class="line"><span class="comment">// RedisConnection connection =</span></span><br><span class="line">redisTemplate.getConnectionFactory().getConnection();</span><br><span class="line"><span class="comment">// connection.flushDb();</span></span><br><span class="line"><span class="comment">// connection.flushAll();</span></span><br><span class="line">redisTemplate.opsForValue().set(<span class="string">&quot;mykey&quot;</span>,<span class="string">&quot;关注狂神说公众号&quot;</span>);</span><br><span class="line">System.out.println(redisTemplate.opsForValue().get(<span class="string">&quot;mykey&quot;</span>));</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="%E5%BA%94%E7%94%A8%E5%9C%BA%E6%99%AF">应用场景</h1>
<script type="text/javascript" src="https://cdn.jsdelivr.net/npm/kity@2.0.4/dist/kity.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text/javascript" src="https://cdn.jsdelivr.net/npm/hexo-simple-mindmap@0.2.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/hexo-simple-mindmap@0.2.0/dist/mindmap.min.css"></div><div class="index-category-tag"><div class="level-item"><i class="fas fa-folder-open has-text-grey"> </i><a class="article-more button is-small link-muted index-categories" href="/categories/%E7%A8%8B%E5%BA%8F%E5%9F%BA%E7%A1%80/">程序基础</a><span> </span><a class="article-more button is-small link-muted index-categories" href="/categories/%E7%A8%8B%E5%BA%8F%E5%9F%BA%E7%A1%80/Redis/">Redis</a></div>  <div class="level-item"><i class="fas fa-tags has-text-grey"> </i><a class="article-more button is-small link-muted index-tags" href="/tags/Redis/">Redis</a></div><hr></div></article></div><div class="card"><div class="card-image"><a class="image is-7by3" href="/2021/03/01/Draft/2021/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/"><img class="fill" src="https://gitee.com/mychimei/picture/raw/master/wallhaven-j8d3rm.png" alt="魑魅先生 | 设计模式"></a></div><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><i class="far fa-calendar-plus"> </i>2021-03-01  <a class="commentCountImg" href="/2021/03/01/Draft/2021/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/#comment-container"><span class="display-none-class">8a3d6aa22daeddb9d873f447d6fff632</span><i class="far fa-comment-dots"></i> <span class="commentCount" id="8a3d6aa22daeddb9d873f447d6fff632">99+</span>  </a><span class="level-item"><i class="far fa-clock"> </i>3 小时  <i class="fas fa-pencil-alt"> </i>28.1 k</span></div><div class="pin-icon"><i class="fas fa-thumbtack"></i></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2021/03/01/Draft/2021/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/">魑魅先生 | 设计模式</a></h1><div class="content"><blockquote>
<p>学习目的：增加系统的健壮性，易修改性和可扩展性，阅读源码的通用工具，通用问题的工具箱，程序员的通用语言</p>
<p>学习方法:视频引入，博客弥补，书籍细化，代码实践</p>
<p>学习资源：大话设计模式书籍，<a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV1Qx411o7tN?p=47">bili视频</a>，<a target="_blank" rel="noopener" href="https://design-patterns.readthedocs.io/zh_CN/latest/creational_patterns/creational.html">博客1</a>,<a target="_blank" rel="noopener" href="https://blog.csdn.net/forezp/article/details/70148833">博客2</a></p>
<p>学习目标程度：了解即可</p>
</blockquote></div><div class="index-category-tag"><div class="level-item"><i class="fas fa-folder-open has-text-grey"> </i><a class="article-more button is-small link-muted index-categories" href="/categories/%E7%A8%8B%E5%BA%8F%E5%9F%BA%E7%A1%80/">程序基础</a><span> </span><a class="article-more button is-small link-muted index-categories" href="/categories/%E7%A8%8B%E5%BA%8F%E5%9F%BA%E7%A1%80/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/">设计模式</a></div>  <div class="level-item"><i class="fas fa-tags has-text-grey"> </i><a class="article-more button is-small link-muted index-tags" href="/tags/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/">设计模式</a></div><hr></div><div class="level is-mobile is-flex"><div class="level-start"><div class="level-item"><a class="article-more button is-small size-small" href="/2021/03/01/Draft/2021/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/#more">阅读更多&gt;&gt;</a></div></div><div class="level-start"><div class="level-item has-text-grey is-size-7"><time datetime="2021-07-14T06:44:04.000Z"><i class="far fa-calendar-check"> 最后修改: </i>2021-07-14</time></div></div></div></article></div><!--!--></div><div class="column column-left is-4-tablet is-4-desktop is-3-widescreen  order-1 is-sticky"><!--!--><div class="card widget" data-type="profile"><div class="card-content"><nav class="level"><div class="level-item has-text-centered flex-shrink-1"><div><figure class="image is-128x128 mx-auto mb-2"><img class="avatar is-rounded" src="https://gitee.com/mychimei/picture/raw/master/微信图片_20210131173244.jpg" alt="魑魅先生"></figure><p class="title is-size-4 is-block" style="line-height:inherit;">魑魅先生</p><p class="is-size-6 is-block">尚未执佩剑，转眼即江湖</p><p class="is-size-6 is-flex justify-content-center"><i class="fas fa-map-marker-alt mr-1"></i><span>浙江-杭州</span></p></div></div></nav><nav class="level is-mobile"><div class="level-item has-text-centered is-marginless"><div><p class="heading">文章</p><a href="/archives"><p class="title">39</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">分类</p><a href="/categories"><p class="title">57</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">标签</p><a href="/tags"><p class="title">29</p></a></div></div></nav><div class="level"><a class="level-item button is-primary is-rounded" href="https://github.com/MrDemonlxl" target="_blank" rel="noopener">关注我</a></div><div class="level is-mobile"><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Github" href="https://github.com/MrDemonlxl"><i class="fab fa-github"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Weibo" href="https://weibo.com/MrDemonlxl"><i class="fab fa-weibo"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Email" href="/714416426@qq.com"><i class="fa fa-envelope"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Next" href="https://mrdemonlxl.github.io"><i class="fab fa-dribbble"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="RSS" href="https://mp.weixin.qq.com/mp/profile_ext?action=home&amp;__biz=MzI5NDc0MDg1Mg==#wechat_redirect"><i class="fas fa-rss"></i></a></div><div><hr><p id="hitokoto">:D 一言句子获取中...</p><script type="text/javascript" defer>function getYiyan(){
                                $.getJSON("https://v1.hitokoto.cn/", function (data) {
                                if(data){
                                    $('#hitokoto').html("");
                                    $('#hitokoto').append("<strong style='color: #3273dc;'>"+data.hitokoto+"</strong>"+
                                    "<p>"+"来源《"+data.from+"》</p><p>提供者-"+data.creator+"</p>");
                                }});}
                                $(function (){getYiyan();$('#hitokoto').click(function(){getYiyan();})});</script></div></div></div><div class="card widget" data-type="links"><div class="card-content"><div class="menu"><h3 class="menu-label">链接</h3><ul class="menu-list"><li><a class="level is-mobile" href="https://www.jianshu.com/u/7b24074baf6a" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">简书</span></span><span class="level-right"><span class="level-item tag">www.jianshu.com</span></span></a></li><li><a class="level is-mobile" href="https://blog.csdn.net/qq_37862970" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">CSDN</span></span><span class="level-right"><span class="level-item tag">blog.csdn.net</span></span></a></li></ul></div></div></div><div class="column-right-shadow is-hidden-widescreen"></div></div><div class="column column-right is-4-tablet is-4-desktop is-3-widescreen is-hidden-touch is-hidden-desktop-only order-3"><div class="card widget"><div class="card-content"><h3 class="menu-label">最新评论</h3><span class="body_hot_comment">加载中，最新评论有1分钟缓存...</span></div></div><div class="card widget"><div class="card-content"><h3 class="menu-label">最新文章</h3><article class="media"><figure class="media-left"><a class="image" href="/2022/02/24/Draft/2021/Java%E5%9F%BA%E7%A1%80%E6%B7%B1%E5%85%A5/"><img src="https://gitee.com/mychimei/picture/raw/master/oxxw29.jpg" alt="Java基础深入"></a></figure><div class="media-content"><p class="date"><time dateTime="2022-02-24T14:10:43.000Z">2022-02-24</time></p><p class="title"><a href="/2022/02/24/Draft/2021/Java%E5%9F%BA%E7%A1%80%E6%B7%B1%E5%85%A5/">Java基础深入</a></p><p class="categories"><a href="/categories/%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80/">编程语言</a> / <a href="/categories/%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80/Java/">Java</a></p></div></article><article class="media"><figure class="media-left"><a class="image" href="/2022/02/24/Draft/2021/TODO/"><img src="https://gitee.com/mychimei/picture/raw/master/oxxw29.jpg" alt="TODO"></a></figure><div class="media-content"><p class="date"><time dateTime="2022-02-24T14:10:43.000Z">2022-02-24</time></p><p class="title"><a href="/2022/02/24/Draft/2021/TODO/">TODO</a></p><p class="categories"><a href="/categories/%E5%BE%85%E5%8A%9E/">待办</a> / <a href="/categories/%E5%BE%85%E5%8A%9E/Everyday-TODO/">Everyday-TODO</a></p></div></article><article class="media"><figure class="media-left"><a class="image" href="/2022/02/24/Draft/2021/%E6%95%B0%E6%8D%AE%E5%BA%93%E8%AE%BE%E8%AE%A1/"><img src="https://gitee.com/mychimei/picture/raw/master/oxxw29.jpg" alt="数据库设计"></a></figure><div class="media-content"><p class="date"><time dateTime="2022-02-24T14:10:43.000Z">2022-02-24</time></p><p class="title"><a href="/2022/02/24/Draft/2021/%E6%95%B0%E6%8D%AE%E5%BA%93%E8%AE%BE%E8%AE%A1/">数据库设计</a></p><p class="categories"><a href="/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/">数据库</a> / <a href="/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/%E6%95%B0%E6%8D%AE%E5%BA%93%E8%AE%BE%E8%AE%A1/">数据库设计</a></p></div></article><article class="media"><figure class="media-left"><a class="image" href="/2022/02/24/Draft/2021/MYSQL%E4%BC%98%E5%8C%96/"><img src="https://gitee.com/mychimei/picture/raw/master/oxxw29.jpg" alt="MYSQL优化"></a></figure><div class="media-content"><p class="date"><time dateTime="2022-02-24T14:10:43.000Z">2022-02-24</time></p><p class="title"><a href="/2022/02/24/Draft/2021/MYSQL%E4%BC%98%E5%8C%96/">MYSQL优化</a></p><p class="categories"><a href="/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/">数据库</a> / <a href="/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/MYSQL%E4%BC%98%E5%8C%96/">MYSQL优化</a></p></div></article><article class="media"><figure class="media-left"><a class="image" href="/2021/11/16/Draft/2021/JVM%20%E4%B8%8E%E4%B8%8A%E5%B1%82%E6%8A%80%E6%9C%AF/"><img src="https://gitee.com/mychimei/picture/raw/master/39go6v.jpg" alt="JVM 与上层技术"></a></figure><div class="media-content"><p class="date"><time dateTime="2021-11-16T10:45:58.345Z">2021-11-16</time></p><p class="title"><a href="/2021/11/16/Draft/2021/JVM%20%E4%B8%8E%E4%B8%8A%E5%B1%82%E6%8A%80%E6%9C%AF/">JVM 与上层技术</a></p><p class="categories"><a href="/categories/%E5%B7%A5%E5%85%B7%E6%95%99%E7%A8%8B/">工具教程</a> / <a href="/categories/%E5%B7%A5%E5%85%B7%E6%95%99%E7%A8%8B/%E4%B8%BB%E9%A2%98%E5%B7%A5%E5%85%B7/">主题工具</a></p></div></article></div></div><div class="card widget"><div class="card-content"><div class="menu"><h3 class="menu-label">分类</h3><ul class="menu-list"><li><a class="level is-mobile is-marginless" href="/categories/BUG%E8%AE%B0%E5%BD%95/"><span class="level-start"><span class="level-item">BUG记录</span></span><span class="level-end"><span class="level-item tag">2</span></span></a><ul class="mr-0"><li><a class="level is-mobile is-marginless" href="/categories/BUG%E8%AE%B0%E5%BD%95/BUG/"><span class="level-start"><span class="level-item">BUG</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li></ul></li><li><a class="level is-mobile is-marginless" href="/categories/English/"><span class="level-start"><span class="level-item">English</span></span><span class="level-end"><span class="level-item tag">1</span></span></a><ul class="mr-0"><li><a class="level is-mobile is-marginless" href="/categories/English/%E7%A8%8B%E5%BA%8F%E5%91%98%E8%8B%B1%E8%AF%AD/"><span class="level-start"><span class="level-item">程序员英语</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li></ul></li><li><a class="level is-mobile is-marginless" href="/categories/JAVA%E5%BA%94%E7%94%A8/"><span class="level-start"><span class="level-item">JAVA应用</span></span><span class="level-end"><span class="level-item tag">1</span></span></a><ul class="mr-0"><li><a class="level is-mobile is-marginless" href="/categories/JAVA%E5%BA%94%E7%94%A8/%E4%B8%9A%E5%8A%A1%E6%8A%80%E6%9C%AF/"><span class="level-start"><span class="level-item">业务技术</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li></ul></li><li><a class="level is-mobile is-marginless" href="/categories/Spring/"><span class="level-start"><span class="level-item">Spring</span></span><span class="level-end"><span class="level-item tag">1</span></span></a><ul class="mr-0"><li><a class="level is-mobile is-marginless" href="/categories/Spring/SpringCloud/"><span class="level-start"><span class="level-item">SpringCloud</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li></ul></li><li><a class="level is-mobile is-marginless" href="/categories/%E4%B8%AD%E9%97%B4%E4%BB%B6/"><span class="level-start"><span class="level-item">中间件</span></span><span class="level-end"><span class="level-item tag">3</span></span></a><ul class="mr-0"><li><a class="level is-mobile is-marginless" href="/categories/%E4%B8%AD%E9%97%B4%E4%BB%B6/Dubbo/"><span class="level-start"><span class="level-item">Dubbo</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li></ul></li><a class="level is-mobile is-marginless" href="/categories/"><span class="level-start"><span class="level-item">查看全部&gt;&gt;</span></span></a></ul></div></div></div><div class="card widget"><div class="card-content"><div class="menu"><h3 class="menu-label">归档</h3><ul class="menu-list"><li><a class="level is-mobile is-marginless" href="/archives/2022/02/"><span class="level-start"><span class="level-item">二月 2022</span></span><span class="level-end"><span class="level-item tag">4</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2021/11/"><span class="level-start"><span class="level-item">十一月 2021</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2021/08/"><span class="level-start"><span class="level-item">八月 2021</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2021/07/"><span class="level-start"><span class="level-item">七月 2021</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2021/06/"><span class="level-start"><span class="level-item">六月 2021</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><a class="level is-mobile is-marginless" href="/archives/"><span class="level-start"><span class="level-item">查看全部&gt;&gt;</span></span></a></ul></div></div></div><div class="card widget"><div class="card-content"><div class="menu"><h3 class="menu-label">标签</h3><div class="field is-grouped is-grouped-multiline"><div class="control"><a class="tags has-addons" href="/tags/%E5%B7%A5%E5%85%B7%E6%95%99%E7%A8%8B/"><span class="tag">工具教程</span><span class="tag is-grey-lightest">6</span></a></div><div class="control"><a class="tags has-addons" href="/tags/BUG/"><span class="tag">BUG</span><span class="tag is-grey-lightest">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E5%89%8D%E7%AB%AF/"><span class="tag">前端</span><span class="tag is-grey-lightest">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E6%95%B0%E6%8D%AE%E5%BA%93/"><span class="tag">数据库</span><span class="tag is-grey-lightest">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Dubbo/"><span class="tag">Dubbo</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/English/"><span class="tag">English</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/NO-GAME-NO-LIFE/"><span class="tag">NO GAME NO LIFE</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Nginx/"><span class="tag">Nginx</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Python%E5%AD%A6%E4%B9%A0/"><span class="tag">Python学习</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/RabbitMQ/"><span class="tag">RabbitMQ</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Redis/"><span class="tag">Redis</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Software-Engineer/"><span class="tag">Software Engineer</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/SpringCloud/"><span class="tag">SpringCloud</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E4%B9%A6%E5%BD%B1%E9%9F%B3/"><span class="tag">书影音</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E4%BF%A1%E6%81%AF%E7%B3%BB%E7%BB%9F%E9%A1%B9%E7%9B%AE%E7%AE%A1%E7%90%86%E5%B8%88/"><span class="tag">信息系统项目管理师</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E5%81%A5%E8%BA%AB%E5%A4%96%E5%9E%8B/"><span class="tag">健身外型</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E5%AD%A6%E4%B9%A0%E6%96%B9%E6%B3%95/"><span class="tag">学习方法</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E5%BE%85%E5%8A%9E/"><span class="tag">待办</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E5%BE%AE%E4%BF%A1%E5%B0%8F%E7%A8%8B%E5%BA%8F/"><span class="tag">微信小程序</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E5%BF%AB%E6%9F%A5/"><span class="tag">快查</span><span class="tag is-grey-lightest">1</span></a></div></div><div class="field is-grouped is-grouped-multiline"><a class="tags has-addons" href="/tags/"><span class="tag">查看全部&gt;&gt;</span></a></div></div></div></div><div class="card widget" data-type="subscribe-email"><div class="card-content"><div class="menu"><h3 class="menu-label">订阅更新</h3><form action="https://feedburner.google.com/fb/a/mailverify" method="post" target="popupwindow" onsubmit="window.open(&#039;https://feedburner.google.com/fb/a/mailverify?uri=mrdemonlxlFeedsId&#039;,&#039;popupwindow&#039;,&#039;scrollbars=yes,width=550,height=520&#039;);return true"><input type="hidden" value="mrdemonlxlFeedsId" name="uri"><input type="hidden" name="loc" value="en_US"><div class="field has-addons"><div class="control has-icons-left is-expanded"><input class="input" name="email" type="email" placeholder="Email"><span class="icon is-small is-left"><i class="fas fa-envelope"></i></span></div><div class="control"><input class="button" type="submit" value="订阅"></div></div></form></div></div></div><!--!--></div></div></div></section><footer class="footer"><div class="container"><div class="level"><div class="level-start"><a class="footer-logo is-block mb-2" href="/"><img src="https://gitee.com/mychimei/picture/raw/master/彩色logo.png" alt="魑魅先生" height="28"></a><p class="size-small"><span>&copy; 2021 魑魅先生</span>  Powered by <a href="https://hexo.io/" target="_blank">Hexo</a> &amp; <a href="https://github.com/ppoffice/hexo-theme-icarus" target="_blank">Icarus</a> &amp; <a href="https://github.com/removeif/hexo-theme-amazing" target="_blank">Amazing</a> <br><span>© <a href="http://www.beian.miit.gov.cn/" target="_blank">川ICP备88888888号-8</a><br></span><span>© 版权说明：[本网站所有内容均收集于互联网或自己创作,<br />&nbsp;&nbsp;&nbsp;&nbsp;方便于网友与自己学习交流，如有侵权，请<a href="/message" target="_blank">留言</a>，立即处理]<br /></span><span><span id="statistic-times">loading...</span><script>function createTime(time) {
            var n = new Date(time);
            now.setTime(now.getTime() + 250),
                days = (now - n) / 1e3 / 60 / 60 / 24,
                dnum = Math.floor(days),
                hours = (now - n) / 1e3 / 60 / 60 - 24 * dnum,
                hnum = Math.floor(hours),
            1 == String(hnum).length && (hnum = "0" + hnum),
                minutes = (now - n) / 1e3 / 60 - 1440 * dnum - 60 * hnum,
                mnum = Math.floor(minutes),
            1 == String(mnum).length && (mnum = "0" + mnum),
                seconds = (now - n) / 1e3 - 86400 * dnum - 3600 * hnum - 60 * mnum,
                snum = Math.round(seconds),
            1 == String(snum).length && (snum = "0" + snum),
                document.getElementById("statistic-times").innerHTML = "❤️本站自 <strong>"+time.split(" ")[0].replace(/\//g,".")+"</strong> 已运行 <strong>" + dnum + "</strong> 天 <strong>" + hnum + "</strong> 小时 <strong>" + mnum + "</strong> 分 <strong>" + snum + "</strong> 秒！❤️";
        }var now = new Date();setInterval("createTime('2021/02/18 00:00:00')", 250,"");</script><br></span><div class="size-small"><span>❤️感谢 <strong><span id="busuanzi_value_site_uv">99+</span></strong> 小伙伴的 <strong><span id="busuanzi_value_site_pv">99+</span></strong> 次光临！❤️</span></div></p></div><div class="level-end"><div class="field has-addons"><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Creative Commons" href="https://creativecommons.org/"><i class="fab fa-creative-commons"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Attribution 4.0 International" href="https://creativecommons.org/licenses/by/4.0/"><i class="fab fa-creative-commons-by"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Download on GitHub" href="https://github.com/removeif/hexo-theme-amazing"><i class="fab fa-github"></i></a></p></div><div class="sideMusic"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.css"><script src="/js/APlayer.min.js"></script><script src="https://cdn.jsdelivr.net/npm/meting@2/dist/Meting.min.js"></script><meting-js style="width: auto;height: 2000px;" server="netease" type="playlist" id="3071252637" theme="#2980b9" loop="all" autoplay="false" order="list" storageName="aplayer-setting" lrctype="0" list-max-height="400px" fixed="true"></meting-js></div></div></div></div></footer><script src="https://cdnjs.loli.net/ajax/libs/moment.js/2.22.2/moment-with-locales.min.js"></script><script src="https://cdnjs.loli.net/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" async></script><script>moment.locale("zh-CN");</script><script>var IcarusThemeSettings = {
            article: {
                highlight: {
                    clipboard: true,
                    fold: 'unfolded'
                }
            }
        };</script><script src="/js/column.js"></script><script src="/js/animation.js"></script><a id="back-to-top" title="回到顶端" href="javascript:;"><i class="fas fa-chevron-up"></i></a><script src="/js/back_to_top.js" defer></script><!--!--><!--!--><!--!--><script src="https://cdnjs.loli.net/ajax/libs/lightgallery/1.6.8/js/lightgallery.min.js" defer></script><script src="https://cdnjs.loli.net/ajax/libs/justifiedGallery/3.7.0/js/jquery.justifiedGallery.min.js" defer></script><script>window.addEventListener("load", () => {
            if (typeof $.fn.lightGallery === 'function') {
                $('.article').lightGallery({ selector: '.gallery-item' });
            }
            if (typeof $.fn.justifiedGallery === 'function') {
                if ($('.justified-gallery > p > .gallery-item').length) {
                    $('.justified-gallery > p > .gallery-item').unwrap();
                }
                $('.justified-gallery').justifiedGallery();
            }
        });</script><!--!--><!--!--><!--!--><script src="/js/main.js" defer></script><script>$.getScript('/js/comment-issue-data.js',function(){loadIssueData('20ef8321698ab8c0c37b','4faa4daae14b55afd2ed357fba92d1e9c7c3f729','MrDemonlxl','MrDemonlxl.github.io',false);})</script><div class="searchbox"><div class="searchbox-container"><div class="searchbox-header"><div class="searchbox-input-container"><input class="searchbox-input" type="text" placeholder="想要查找什么..."></div><a class="searchbox-close" href="javascript:;">×</a></div><div class="searchbox-body"></div></div></div><script src="/js/insight.js" defer></script><script>document.addEventListener('DOMContentLoaded', function () {
            loadInsight({"contentUrl":"/content.json"}, {"hint":"想要查找什么...","untitled":"(无标题)","posts":"文章","pages":"页面","categories":"分类","tags":"标签"});
        });</script><script src="https://cdn.jsdelivr.net/npm/pjax@0.2.8/pjax.js"></script><script type="text/javascript">var pjax = new Pjax({
            elements: "a",//代表点击链接就更新
            selectors: [  //代表要更新的节点
                ".section",
                "title"
            ],
            cache: true,
            cacheBust:false
        })

        function loadBusuanzi(){
        $.getScript("//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js", function () {});
        }

        // 开始 PJAX 执行的函数
        document.addEventListener('pjax:send', function () {
        });
        
        // PJAX 完成之后执行的函数，可以和上面的重载放在一起
        document.addEventListener('pjax:complete', function () {
            $(".section").css({opacity:1});
            if(true){
                $.getScript('/js/comment-issue-data.js',function(){loadIssueData('20ef8321698ab8c0c37b','4faa4daae14b55afd2ed357fba92d1e9c7c3f729','MrDemonlxl','MrDemonlxl.github.io',false);});
            }
            if(false){
                loadMathJax();
            }
            loadMainJs(jQuery, window.moment, window.ClipboardJS, window.IcarusThemeSettings);
            loadBackTop();
            loadBusuanzi();
            if(typeof loadBanner == 'function'){
                loadBanner();
            }
        });</script></body></html>